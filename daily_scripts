# more information on the fit

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakes --cminDefaultMinimizerTolerance 5.

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakes --cminDefaultMinimizerTolerance 5.

-- neither converges now

combine -M MultiDimFit fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root --algo grid --points 100 --rMin 0.95 --rMax 1.05 --name mutau_mTall_lumi1_NLL -t -1 --setParameters r=1.0,lumi_mult=1.0 --redefineSignalPOIs tau_ratio --cminDefaultMinimizerTolerance 5. --saveSpecifiedNuis norm_tt,norm_dy

limit->Draw("2*deltaNLL:tau_ratio", "deltaNLL>0 && 2*deltaNLL<10", "L")

-- the NLL does not reach 1

combine -M MultiDimFit fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root --algo grid --points 100 --rMin 0.9 --rMax 1.1 --name mutau_mTall_lumi1_NLL -t -1 --setParameters r=1.0,lumi_mult=1.0 --redefineSignalPOIs tau_ratio --cminDefaultMinimizerTolerance 5. --saveSpecifiedNuis norm_tt,norm_dy

Caught exception Nuisance Parameter norm_tt not in model.

combine -M MultiDimFit fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root --algo grid --points 100 --rMin 0.9 --rMax 1.1 --name mutau_mTall_lumi1_NLL -t -1 --setParameters r=1.0,lumi_mult=1.0 --redefineSignalPOIs tau_ratio --cminDefaultMinimizerTolerance 5. --saveSpecifiedNuis rate_elmu

Caught exception Nuisance Parameter rate_elmu not in model.

how to catch problems with the range of these params?

combine -M MultiDimFit fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root --algo grid --points 100 --rMin 0.9 --rMax 1.1 --name mutau_mTall_lumi1_NLL -t -1 --setParameters r=1.0,lumi_mult=1.0 --redefineSignalPOIs tau_ratio --cminDefaultMinimizerTolerance 5.

all points show
[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!

the range did not change

text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.txt

NLL is over 1 with 0.9-1.1 range

some points
Info in <Minuit2>: Minuit2Minimizer::Minimize : Minimization did NOT converge, Edm is above max

but the NLL curve is fine

NLL is over 4 woth 0.85-1.15 range

forgot to freeze r?!

combine -M MultiDimFit fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root --algo grid --points 100 --rMin 0.9 --rMax 1.1 --name mutau_mTall_lumi1_NLL -t -1 --setParameters r=1.0,lumi_mult=1.0 --redefineSignalPOIs tau_ratio --cminDefaultMinimizerTolerance 5. --freezeParameters r

Point 69/100 tau_ratio = 1.0585
[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!
Point 70/100 tau_ratio = 1.0615
[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!
Point 71/100 tau_ratio = 1.0645
Info in <Minuit2>: Minuit2Minimizer::Minimize : Minimization did NOT converge, Edm is above max
Point 72/100 tau_ratio = 1.0675
[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!
Point 73/100 tau_ratio = 1.0705
Info in <Minuit2>: Minuit2Minimizer::Minimize : Minimization did NOT converge, Edm is above max
Point 74/100 tau_ratio = 1.0735
[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!
Point 75/100 tau_ratio = 1.0765

all other points are
[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!

NLL is the same, good

repeat the prelim fit

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakes --cminDefaultMinimizerTolerance 5.

   tau_ratio :    +1.000   -0.059/+0.062 (68%)

but

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakes --cminDefaultMinimizerTolerance 5.

Error: closed range without finding crossing.
Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.150/+0.150 (68%)

NLL:

combine -M MultiDimFit fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root --algo grid --points 100 --rMin 0.9 --rMax 1.1 --name mutau_mTall_lumi1_NLL -t -1 --setParameters r=1.0,lumi_mult=2.0 --redefineSignalPOIs tau_ratio --cminDefaultMinimizerTolerance 5. --freezeParameters r

Point 47/100 tau_ratio = 0.9925
[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!
Point 48/100 tau_ratio = 0.9955
[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!
Point 49/100 tau_ratio = 0.9985
Info in <Minuit2>: Minuit2Minimizer::Minimize : Minimization did NOT converge, Edm is above max
Point 50/100 tau_ratio = 1.0015
Info in <Minuit2>: Minuit2Minimizer::Minimize : Minimization did NOT converge, Edm is above max
Point 51/100 tau_ratio = 1.0045
Info in <Minuit2>: Minuit2Minimizer::Minimize : Minimization did NOT converge, Edm is above max
Point 52/100 tau_ratio = 1.0075
[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!

all other points are
[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!

-- there are breaks at 0.86, with NLL > 10
   but it is practically the same as when lumi_mult=1.0!





# the old working fit with the lumi 1,2 and unc breakdowns

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakes --cminDefaultMinimizerTolerance 5.


combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakes --cminDefaultMinimizerTolerance 5.

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --cminDefaultMinimizerTolerance 5. --robustFit 1 --doFits --parallel 5   --name RatioMFakes
combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --cminDefaultMinimizerTolerance 5. -o latest_toys_asimov_impacts_ratio_94v5_processing2_fit1_higgsCombine1_four_channels_RatioMFakes.json  --name RatioMFakes
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v5_processing2_fit1_higgsCombine1_four_channels_RatioMFakes.json -o latest_toys_asimov_impacts_ratio_94v5_processing2_fit1_higgsCombine1_four_channels_RatioMFakes



combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakesLumi2 --cminDefaultMinimizerTolerance 5.

-- does not converge now

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakes --cminDefaultMinimizerTolerance 5.


combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --cminDefaultMinimizerTolerance 5. --robustFit 1 --doFits --parallel 5   --name RatioMFakesLumi2
combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --cminDefaultMinimizerTolerance 5. -o latest_toys_asimov_impacts_ratio_94v5_processing2_fit1_higgsCombine1_four_channels_RatioMFakesLumi2.json  --name RatioMFakesLumi2
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v5_processing2_fit1_higgsCombine1_four_channels_RatioMFakesLumi2.json -o latest_toys_asimov_impacts_ratio_94v5_processing2_fit1_higgsCombine1_four_channels_RatioMFakesLumi2








## unc breakdown

make fit_unc workspace=fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_taupt_temp.root nn=eltau_taupt_temp toys="-t -1 --setParameters r=1.0,lumi_mult=1.0 --redefineSignalPOIs tau_ratio --cminDefaultMinimizerTolerance 10." min=0.9 max=1.1


old working one:




make fit_unc workspace=fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root nn=mutau_mTall toys="-t -1 --setParameters r=1.0,lumi_mult=2.0 --redefineSignalPOIs tau_ratio --cminDefaultMinimizerTolerance 5." min=0.95 max=1.05
make fit_unc workspace=fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root nn=mutau_mTall_lumi1 toys="-t -1 --setParameters r=1.0,lumi_mult=1.0 --redefineSignalPOIs tau_ratio --cminDefaultMinimizerTolerance 5." min=0.95 max=1.05

plot1DScan.py --output scan_mutau_mTall_lumi1 higgsCombinemutau_mTall_lumi1FullUncertaintyWLumi.MultiDimFit.mH120.root --others 'higgsCombinemutau_mTall_lumi1FullUncertaintyNoLumi.MultiDimFit.mH120.root:lumi:4' 'higgsCombinemutau_mTall_lumi1NoSys.MultiDimFit.mH120.root:stat:2' --breakdown lumi,syst,stat --POI tau_ratio





# re-stage2 fit

cp fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.txt  fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes.txt

cp fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes.txt fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau.txt
cp fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau.txt fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_taupt.txt

text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes.txt
text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau.txt
text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_taupt.txt

cp fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_taupt.txt fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_mT.txt
text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_mT.txt


combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_taupt.root -m 125 --robustFit 1 --doInitialFit --name Ratio2ElTauPt --cminDefaultMinimizerTolerance 10.





combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_taupt_temp.root -m 125 --robustFit 1 --doInitialFit --name Ratio2ElTauPtLumi1 --cminDefaultMinimizerTolerance 10.

-- works
   tau_ratio :    +1.000   -0.059/+0.059 (68%)


combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_taupt_temp.root -m 125 --cminDefaultMinimizerTolerance 5. --robustFit 1 --doFits --parallel 5   --name Ratio2ElTauPtLumi1
combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_taupt_temp.root -m 125 --cminDefaultMinimizerTolerance 5. -o latest_toys_asimov_impacts_ratio_94v5_processing2_fit1_higgsCombine1_four_channels_Ratio2ElTauPtLumi1.json  --name Ratio2ElTauPtLumi1
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v5_processing2_fit1_higgsCombine1_four_channels_Ratio2ElTauPtLumi1.json -o latest_toys_asimov_impacts_ratio_94v5_processing2_fit1_higgsCombine1_four_channels_Ratio2ElTauPtLumi1





mT

cp fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_taupt.txt fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_taupt_temp.txt

text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_taupt_temp.txt

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_mT.root -m 125 --robustFit 1 --doInitialFit --name Ratio2ElmT --cminDefaultMinimizerTolerance 10.


cp fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_mT.txt fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_mT_temp.txt

text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_mT_temp.txt

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_mT_temp.root -m 125 --robustFit 1 --doInitialFit --name Ratio2ElmT --cminDefaultMinimizerTolerance 10.




for lumi 2!

cp fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_taupt_temp.txt fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_taupt_temp2.txt
vim fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_taupt_temp2.txt

text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_taupt_temp2.txt

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_taupt_temp2.root -m 125 --robustFit 1 --doInitialFit --name Ratio2fullRunElTauPt --cminDefaultMinimizerTolerance 10.





combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing2_fit1_higgsCombine1_temp_mult2_fakes_eltau_taupt.root -m 125 --robustFit 1 --doInitialFit --name Ratio2ElTauPt --cminDefaultMinimizerTolerance 5.

   tau_ratio :    +1.000   -0.034/+0.036 (68%)

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!111

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --cminDefaultMinimizerTolerance 5. --robustFit 1 --doFits --parallel 5   --name RatioMFakes
combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --cminDefaultMinimizerTolerance 5. -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp_mult2_fakes5.json  --name RatioMFakes
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp_mult2_fakes5.json -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp_mult2_fakes5






# control figures in re-stage2, 94v5 processing2


export file_mc=distrs//distrs_94v5_processing2_plot1.root
export file_data=distrs//distrs_94v10_processing2_plot1.root
export plot_dir=plots/94v5_processing2_plot1/

mkdir -p ${plot_dir}

python stack_plot.py ${file_mc} ${file_data} --do-not-reweight -o ${plot_dir} --overwrite -p -r -c el_sel    -d leading_lep_pt --ratio-range 0.5  --title "" --title-x "leading lepton p_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py ${file_mc} ${file_data} --do-not-reweight -o ${plot_dir} --overwrite -p -r -c mu_sel    -d leading_lep_pt --ratio-range 0.5  --title "" --title-x "leading lepton p_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf

python stack_plot.py ${file_mc} ${file_data} --do-not-reweight -o ${plot_dir} --overwrite -p -r -c el_sel    -d tau_pt --ratio-range 0.5  --title "" --title-x "tau p_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py ${file_mc} ${file_data} --do-not-reweight -o ${plot_dir} --overwrite -p -r -c mu_sel    -d tau_pt --ratio-range 0.5  --title "" --title-x "tau p_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf

python stack_plot.py ${file_mc} ${file_data} --do-not-reweight -o ${plot_dir} --overwrite -p -r -c el_sel    -d tau_sv_sign --ratio-range 0.5  --title "" --title-x "tau SV significance [#sigma]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py ${file_mc} ${file_data} --do-not-reweight -o ${plot_dir} --overwrite -p -r -c mu_sel    -d tau_sv_sign --ratio-range 0.5  --title "" --title-x "tau SV significance [#sigma]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf




hadd jobsums/distrs//distrs_94v10_processing2_plot1_SingleMuon.root      jobsums/distrs//94v10/processing2/plot1/*SingleMuo*root
hadd jobsums/distrs//distrs_94v10_processing2_plot1_SingleElectron.root  jobsums/distrs//94v10/processing2/plot1/*SingleEle*root



from here

export file_data=distrs//distrs_94v10_processing2_plot1_SingleMuon.root

python stack_plot.py ${file_mc} ${file_data} --do-not-reweight -o ${plot_dir} --overwrite -p -r -c mu_sel    -d leading_lep_pt --ratio-range 0.5  --title "" --title-x "leading lepton p_{T} [GeV]"   --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 0.5 --lumi-label 41.3  --output-type pdf
python stack_plot.py ${file_mc} ${file_data} --do-not-reweight -o ${plot_dir} --overwrite -p -r -c mu_sel    -d tau_pt         --ratio-range 0.5  --title "" --title-x "tau p_{T} [GeV]"              --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 0.5 --lumi-label 41.3  --output-type pdf
python stack_plot.py ${file_mc} ${file_data} --do-not-reweight -o ${plot_dir} --overwrite -p -r -c mu_sel    -d tau_sv_sign    --ratio-range 0.5  --title "" --title-x "tau SV significance [#sigma]" --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 0.5 --lumi-label 41.3  --output-type pdf --logy

python stack_plot.py ${file_mc} ${file_data} --do-not-reweight -o ${plot_dir} --overwrite -p -r -c mu_sel_tauSV3    -d tau_pt         --ratio-range 0.5  --title "" --title-x "tau p_{T} [GeV]"              --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 0.5 --lumi-label 41.3  --output-type pdf

export file_data=distrs//distrs_94v10_processing2_plot1_SingleElectron.root

python stack_plot.py ${file_mc} ${file_data} --do-not-reweight -o ${plot_dir} --overwrite -p -r -c tt_elmu_tight   -d leading_lep_pt --ratio-range 0.5 --title "" --title-x "leading lepton p_{T} [GeV]"   --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 0.56 --lumi-label 41.3 --output-type pdf

python stack_plot.py ${file_mc} ${file_data} --do-not-reweight -o ${plot_dir} --overwrite -p -r -c el_sel    -d leading_lep_pt --ratio-range 0.5  --title "" --title-x "leading lepton p_{T} [GeV]"   --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 0.5 --lumi-label 41.3 --output-type pdf
python stack_plot.py ${file_mc} ${file_data} --do-not-reweight -o ${plot_dir} --overwrite -p -r -c el_sel    -d tau_pt         --ratio-range 0.5  --title "" --title-x "tau p_{T} [GeV]"              --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 0.5 --lumi-label 41.3 --output-type pdf
python stack_plot.py ${file_mc} ${file_data} --do-not-reweight -o ${plot_dir} --overwrite -p -r -c el_sel    -d tau_sv_sign    --ratio-range 0.5  --title "" --title-x "tau SV significance [#sigma]" --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 0.5 --lumi-label 41.3 --output-type pdf --logy

python stack_plot.py ${file_mc} ${file_data} --do-not-reweight -o ${plot_dir} --overwrite -p -r -c el_sel_tauSV3    -d tau_pt         --ratio-range 0.5  --title "" --title-x "tau p_{T} [GeV]"              --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 0.5 --lumi-label 41.3 --output-type pdf

to here


export file_mc=distrs/distrs_v27dilep2_mc_and_data.root
export file_data=distrs/distrs_v27dilep2_mc_and_data.root
export plot_dir=plots/distrs_v27dilep2_mc_and_data_again/

setenv file_mc   distrs/distrs_v27dilep2_mc_and_data.root
setenv file_data distrs/distrs_v27dilep2_mc_and_data.root
setenv plot_dir  plots/distrs_v27dilep2_mc_and_data_again/

mkdir -p ${plot_dir}

python stack_plot.py ${file_mc} ${file_data} -o ${plot_dir} --overwrite -p -r -c dy_mumu    -d lep_pt         --ratio-range 0.5  --title "" --title-x "leading lepton p_{T} [GeV]"              --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 40000 --lumi-label 41.3 --output-type pdf


python stack_plot.py ${file_mc} ${file_data} -o ${plot_dir} --overwrite -p -r -c dy_mutau    -d lep_pt         --ratio-range 0.5  --title "" --title-x "leading lepton p_{T} [GeV]"              --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 41000 --lumi-label 41.3 --output-type pdf

python stack_plot.py ${file_mc} ${file_data} -o ${plot_dir} --overwrite -p -r -c dy_mutau    -d tau_sv_sign         --ratio-range 0.5  --title "" --title-x "tau SV significance [#sigma]"              --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 41000 --lumi-label 41.3 --output-type pdf




python stack_plot.py ${file_mc} ${file_data} --do-not-reweight -o ${plot_dir} --overwrite -p -r -c el_sel    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "m_{T}(l, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py ${file_mc} ${file_data} --do-not-reweight -o ${plot_dir} --overwrite -p -r -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "m_{T}(l, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf

python stack_plot.py ${file_mc} ${file_data} --do-not-reweight --no-data -o ${plot_dir} --overwrite -p -r -c dy_eltau    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "m_{T}(l, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py ${file_mc} ${file_data} --do-not-reweight --no-data -o ${plot_dir} --overwrite -p -r -c dy_mutau    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "m_{T}(l, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf

python stack_plot.py ${file_mc} ${file_data} --do-not-reweight --no-data -o ${plot_dir} --overwrite -p -r -c tt_elmu_tight   -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "m_{T}(l, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py ${file_mc} ${file_data} --do-not-reweight --no-data -o ${plot_dir} --overwrite -p -r -c dy_mumu   -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "m_{T}(l, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf



python stack_plot.py ${file_mc} ${file_data} --do-not-reweight --no-data -o ${plot_dir} --overwrite -p -r -c el_sel_ss -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py ${file_mc} ${file_data} --do-not-reweight --no-data -o ${plot_dir} --overwrite -p -r -c mu_sel_ss -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py ${file_mc} ${file_data} --do-not-reweight --no-data -o ${plot_dir} --overwrite -p -r -c dy_mutau_ss -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py ${file_mc} ${file_data} --do-not-reweight --no-data -o ${plot_dir} --overwrite -p -r -c dy_eltau_ss -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py ${file_mc} ${file_data} --do-not-reweight --no-data -o ${plot_dir} --overwrite -p -r -c dy_elel   -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf

python stack_plot.py ${file_mc} ${file_data} --do-not-reweight --no-data -o ${plot_dir} --overwrite -p -r -c el_sel_tauSV3    -d Mt_lep_met_c --ratio-range 0.5 --title "" --title-x "m_{T}(l, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py ${file_mc} ${file_data} --do-not-reweight --no-data -o ${plot_dir} --overwrite -p -r -c mu_sel_tauSV3    -d Mt_lep_met_c --ratio-range 0.5 --title "" --title-x "m_{T}(l, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf

python stack_plot.py ${file_mc} ${file_data} --do-not-reweight --no-data -o ${plot_dir} --overwrite -p -r -c tt_elmu_tight  -d Mt_lep_met_c --ratio-range 0.5 --title "" --title-x "m_{T}(l, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf

python stack_plot.py ${file_mc} ${file_data} --do-not-reweight --no-data -o ${plot_dir} --overwrite -p -r -c dy_mutau_tauSV3    -d Mt_lep_met_c --ratio-range 0.5 --title "" --title-x "m_{T}(l, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py ${file_mc} ${file_data} --do-not-reweight --no-data -o ${plot_dir} --overwrite -p -r -c dy_mumu        -d Mt_lep_met_c --ratio-range 0.5 --title "" --title-x "m_{T}(l, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf

python stack_plot.py ${file_mc} ${file_data} --do-not-reweight --no-data -o ${plot_dir} --overwrite -p -r -c dy_eltau_t    -d Mt_lep_met_c --ratio-range 0.5 --title "" --title-x "m_{T}(l, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf




# optimization studies

how to do it?

make this table:

           selection channel
proc def   normalized number of events

then efficiencies are easy to get
normalization is calculated per dtag



I need to watch for processes:

tt

leptau 3ch
leptau 1ch

l jets, and when a tau is selected
l jets b
l jets w
l jets other

dy tautau

wjets



leptau

py script to keep pairs and other data structure
it generates commands
run the commands in parallel with xargs
-- xargs breaks on quote symbols...
   let's write job files

python optimization_commands.py
ls opt*.sh | xargs -P 6 -I JOB sh JOB
ls optimization_jobs/*.sh | xargs -P 8 -I JOB sh JOB

template:

python sumup_ttree_draw.py "event_leptons[0].pt():@event_taus.size()" --histo-range 10,0,10,20,0,100   --cond-com "(selection_stage_dy == 135 || selection_stage_dy == 134 || selection_stage_dy == 125 || selection_stage_dy == 124)" --output test_2d_pTs_dy.root   --histo-name test_2d_pTs_dy   --ttree ttree_out  lstore_outdirs//94v5/processing1/MC2017legacy_Fall17_DYJetsToLL_50toInf_madgraph_ext1_v1/MC2017legacy_Fall17_DYJetsToLL_50toInf_madgraph_ext1_v1_1.root

can sumup_ttree_draw.py scale?



## an issue with tauSV and tauSV3

root -l optimization-studies/2/opt_HLT_mu_tt_tauSV_3ch_tt_mutau3ch.root

  KEY: TH1F	HLT_mu_tt_tauSV_3ch_tt_mutau3ch;1	5 {((HLT_mu && abs(leps_ID) == 13 && tau_IDlev[0] > 0 && nbjets_noVLooseTau > 0) && (tau_SV_geom_flightLenSign[0] > 0.)) && (((abs(gen_t_w_decay_id) > 15*15 && abs(gen_tb_w_decay_id) == 13) || (abs(gen_tb_w_decay_id) > 15*15 && abs(gen_t_w_decay_id) == 13)) && (abs(gen_t_w_decay_id) >= 15*30 || abs(gen_tb_w_decay_id) >= 15*30))}
root [2] HLT_mu_tt_tauSV_3ch_tt_mutau3ch->Print()
TH1.Print Name  = HLT_mu_tt_tauSV_3ch_tt_mutau3ch, Entries= 7148, Total sum= 7148

root -l optimization-studies/2/opt_HLT_mu_tt_tauSV_3sign_tt_mutau3ch.root

  KEY: TH1F	HLT_mu_tt_tauSV_3sign_tt_mutau3ch;1	5 {((HLT_mu && abs(leps_ID) == 13 && tau_IDlev[0] > 0 && nbjets_noVLooseTau > 0) && (tau_SV_geom_flightLenSign[0] > 3.)) && (((abs(gen_t_w_decay_id) > 15*15 && abs(gen_tb_w_decay_id) == 13) || (abs(gen_tb_w_decay_id) > 15*15 && abs(gen_t_w_decay_id) == 13)) && (abs(gen_t_w_decay_id) >= 15*30 || abs(gen_tb_w_decay_id) >= 15*30))}
root [2] HLT_mu_tt_tauSV_3sign_tt_mutau3ch->Print()
TH1.Print Name  = HLT_mu_tt_tauSV_3sign_tt_mutau3ch, Entries= 11060, Total sum= 11060

{((HLT_mu && abs(leps_ID) == 13 && tau_IDlev[0] > 0 && nbjets_noVLooseTau > 0) && (tau_SV_geom_flightLenSign[0] > 0.)) && (((abs(gen_t_w_decay_id) > 15*15 && abs(gen_tb_w_decay_id) == 13) || (abs(gen_tb_w_decay_id) > 15*15 && abs(gen_t_w_decay_id) == 13)) && (abs(gen_t_w_decay_id) >= 15*30 || abs(gen_tb_w_decay_id) >= 15*30))}
{((HLT_mu && abs(leps_ID) == 13 && tau_IDlev[0] > 0 && nbjets_noVLooseTau > 0) && (tau_SV_geom_flightLenSign[0] > 3.)) && (((abs(gen_t_w_decay_id) > 15*15 && abs(gen_tb_w_decay_id) == 13) || (abs(gen_tb_w_decay_id) > 15*15 && abs(gen_t_w_decay_id) == 13)) && (abs(gen_t_w_decay_id) >= 15*30 || abs(gen_tb_w_decay_id) >= 15*30))}

?????



## 2L VS old 1M

root -l ./lstore_outdirs//94v5/processingTestB2L/MC2017legacy_Fall17_TTTo2L2Nu/MC2017legacy_Fall17_TTTo2L2Nu_15.root
root -l ./lstore_outdirs//94v5/processingTestB1M/MC2017legacy_Fall17_TTTo2L2Nu/MC2017legacy_Fall17_TTTo2L2Nu_15.root

root -l ./lstore_outdirs//94v5/processing1/MC2017legacy_Fall17_TTTo2L2Nu/MC2017legacy_Fall17_TTTo2L2Nu_15.root

ttree_out->Draw("5", "selection_stage == 9 || selection_stage == 7")

[
1615
2231
1784
]

julia> 2231 ./ 1615
1.381424148606811

background!!!!

 I need the background!!
python genjobs.py 94v5 processingTestB2L --do-W-stitching channels_nom_sys_muon_sel_main --submit queue --batch-system condor --dtags MC2017legacy_Fall17_TTToSemiLeptonic_v2
python genjobs.py 94v5 processingTestB1M --do-W-stitching channels_nom_sys_muon_sel_main --submit queue --batch-system condor --dtags MC2017legacy_Fall17_TTToSemiLeptonic_v2


python channel_distrs_full_loop.py --do-W-stitching  -l logss ./lstore_outdirs//94v5/processingTestB2L/MC2017legacy_Fall17_TTToSemiLeptonic_v2/MC2017legacy_Fall17_TTToSemiLeptonic_v2_62.root channels_nom_sys_muon_sel_main -i ./gstore_outdirs//94v5/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v5_MC2017legacy_Fall17_TTToSemiLeptonic_v2/191201_174541/0000/MC2017legacy_Fall17_TTToSemiLeptonic_v2_62.root

root -l ./lstore_outdirs//94v5/processingTestB2L/MC2017legacy_Fall17_TTToSemiLeptonic_v2/MC2017legacy_Fall17_TTToSemiLeptonic_v2_62.root
root -l ./lstore_outdirs//94v5/processingTestB1M/MC2017legacy_Fall17_TTToSemiLeptonic_v2/MC2017legacy_Fall17_TTToSemiLeptonic_v2_62.root

root -l ./lstore_outdirs//94v5/processing1/MC2017legacy_Fall17_TTToSemiLeptonic_v2/MC2017legacy_Fall17_TTToSemiLeptonic_v2_62.root

ttree_out->Draw("5", "selection_stage == 9 || selection_stage == 7")

[
289
393
305
]

ratios

 0.178947
 0.176154
 0.170964


just 1M, no additional jets?
-- plot distrs

        event_jets_n_jets[0]  = N_jets_nom_all
        event_jets_n_bjets[0] = N_jets_nom_med
        event_jets_n_jets_lepmatched[0] = len(jets_nom.lepmatched)

ttree_out->Draw("event_jets_n_jets",  "selection_stage == 9 || selection_stage == 7")
ttree_out->Draw("event_jets_n_bjets", "selection_stage == 9 || selection_stage == 7")
ttree_out->Draw("event_jets_n_jets - event_jets_n_bjets", "selection_stage == 9 || selection_stage == 7")


### test only 1M

time python channel_distrs_full_loop.py --do-W-stitching  -l logss ./lstore_outdirs//94v5/processingTestBonly1M/MC2017legacy_Fall17_TTTo2L2Nu/MC2017legacy_Fall17_TTTo2L2Nu_15.root channels_nom_sys_muon_sel_main -i ./gstore_outdirs//94v5/TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v5_MC2017legacy_Fall17_TTTo2L2Nu/191201_173420/0000/MC2017legacy_Fall17_TTTo2L2Nu_15.root     &
time python channel_distrs_full_loop.py --do-W-stitching  -l logss ./lstore_outdirs//94v5/processingTestBonly1M/MC2017legacy_Fall17_TTToSemiLeptonic_v2/MC2017legacy_Fall17_TTToSemiLeptonic_v2_62.root channels_nom_sys_muon_sel_main -i ./gstore_outdirs//94v5/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v5_MC2017legacy_Fall17_TTToSemiLeptonic_v2/191201_174541/0000/MC2017legacy_Fall17_TTToSemiLeptonic_v2_62.root     &

root -l ./lstore_outdirs//94v5/processingTestBonly1M/MC2017legacy_Fall17_TTTo2L2Nu/MC2017legacy_Fall17_TTTo2L2Nu_15.root
root -l ./lstore_outdirs//94v5/processingTestBonly1M/MC2017legacy_Fall17_TTToSemiLeptonic_v2/MC2017legacy_Fall17_TTToSemiLeptonic_v2_62.root

2441
394

-- really? why? a random additional jet is a feature of lj background!!
plot distributions

ttree_out->Draw("event_jets_n_jets - event_jets_n_bjets", "selection_stage == 9 || selection_stage == 7")
ttree_out->Draw("event_jets_n_bjets", "selection_stage == 9 || selection_stage == 7")

semileptonic
non b tagged -- a bit at 1, peak at 2-3-4, 5-6, then tail
b tagged     -- 240 at 1, 150 at 2, 10 at 3

signal
non b tagged -- peak 1-2-3 (500-800-500), 4-5 (300-100), then tail
b tagged     -- 1400 at 1, 1000 at 2, less than 50 at 3

1Mb suits our signal best

2441. / 1784.
1.368273542600897
increase not 1.5

394. / 305
1.2918032786885245
very slight improvement of sig/bckg



## testing tt mumu

time python channel_distrs_full_loop.py --do-W-stitching  -l logss ./temp/MC2017legacy_Fall17_TTTo2L2Nu_15.root           channels_nom_sys_muon_sel_main -i ./gstore_outdirs//94v5/TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v5_MC2017legacy_Fall17_TTTo2L2Nu/191201_173420/0000/MC2017legacy_Fall17_TTTo2L2Nu_15.root     &
time python channel_distrs_full_loop.py --do-W-stitching  -l logss ./temp/MC2017legacy_Fall17_TTToSemiLeptonic_v2_62.root channels_nom_sys_muon_sel_main -i ./gstore_outdirs//94v5/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v5_MC2017legacy_Fall17_TTToSemiLeptonic_v2/191201_174541/0000/MC2017legacy_Fall17_TTToSemiLeptonic_v2_62.root     &




# plots in new ntuples, including DY final states

mkdir -p plots/94v4_processing3_plot1/

python stack_plot.py distrs//distrs_94v4_processing3_plot1.root distrs//distrs_94v4_processing3_plot1.root --do-not-reweight --no-data -o plots/94v4_processing3_plot1/ --overwrite -p -r -c el_sel    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py distrs//distrs_94v4_processing3_plot1.root distrs//distrs_94v4_processing3_plot1.root --do-not-reweight --no-data -o plots/94v4_processing3_plot1/ --overwrite -p -r -c el_sel_ss -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py distrs//distrs_94v4_processing3_plot1.root distrs//distrs_94v4_processing3_plot1.root --do-not-reweight --no-data -o plots/94v4_processing3_plot1/ --overwrite -p -r -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py distrs//distrs_94v4_processing3_plot1.root distrs//distrs_94v4_processing3_plot1.root --do-not-reweight --no-data -o plots/94v4_processing3_plot1/ --overwrite -p -r -c mu_sel_ss -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf

python stack_plot.py distrs//distrs_94v4_processing3_plot1.root distrs//distrs_94v4_processing3_plot1.root --do-not-reweight --no-data -o plots/94v4_processing3_plot1/ --overwrite -p -r -c dy_eltau    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py distrs//distrs_94v4_processing3_plot1.root distrs//distrs_94v4_processing3_plot1.root --do-not-reweight --no-data -o plots/94v4_processing3_plot1/ --overwrite -p -r -c dy_eltau_ss -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py distrs//distrs_94v4_processing3_plot1.root distrs//distrs_94v4_processing3_plot1.root --do-not-reweight --no-data -o plots/94v4_processing3_plot1/ --overwrite -p -r -c dy_mutau    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py distrs//distrs_94v4_processing3_plot1.root distrs//distrs_94v4_processing3_plot1.root --do-not-reweight --no-data -o plots/94v4_processing3_plot1/ --overwrite -p -r -c dy_mutau_ss -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf

python stack_plot.py distrs//distrs_94v4_processing3_plot1.root distrs//distrs_94v4_processing3_plot1.root --do-not-reweight --no-data -o plots/94v4_processing3_plot1/ --overwrite -p -r -c tt_elmu   -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py distrs//distrs_94v4_processing3_plot1.root distrs//distrs_94v4_processing3_plot1.root --do-not-reweight --no-data -o plots/94v4_processing3_plot1/ --overwrite -p -r -c dy_mumu   -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py distrs//distrs_94v4_processing3_plot1.root distrs//distrs_94v4_processing3_plot1.root --do-not-reweight --no-data -o plots/94v4_processing3_plot1/ --overwrite -p -r -c dy_elel   -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf



same in new processing and new ntuples:

new gen processes

 KEY: TDirectoryFile	dy_tautau;1	dy_tautau
 KEY: TDirectoryFile	dy_other;1	dy_other
 KEY: TDirectoryFile	data;1	data
 KEY: TDirectoryFile	stop_elmu;1	stop_elmu
 KEY: TDirectoryFile	stop_eltau;1	stop_eltau
 KEY: TDirectoryFile	stop_lj;1	stop_lj
 KEY: TDirectoryFile	stop_mutau;1	stop_mutau
 KEY: TDirectoryFile	stop_other;1	stop_other
 KEY: TDirectoryFile	tt_elmu;1	tt_elmu
 KEY: TDirectoryFile	tt_eltau1ch;1	tt_eltau1ch
 KEY: TDirectoryFile	tt_eltau3ch;1	tt_eltau3ch
 KEY: TDirectoryFile	tt_ljb;1	tt_ljb
 KEY: TDirectoryFile	tt_ljo;1	tt_ljo
 KEY: TDirectoryFile	tt_ljw;1	tt_ljw
 KEY: TDirectoryFile	tt_ljz;1	tt_ljz
 KEY: TDirectoryFile	tt_ltaul;1	tt_ltaul
 KEY: TDirectoryFile	tt_mutau1ch;1	tt_mutau1ch
 KEY: TDirectoryFile	tt_mutau3ch;1	tt_mutau3ch
 KEY: TDirectoryFile	tt_taueltaumu;1	tt_taueltaumu
 KEY: TDirectoryFile	tt_taulj;1	tt_taulj
 KEY: TDirectoryFile	tt_taultauh;1	tt_taultauh
 KEY: TDirectoryFile	tt_other;1	tt_other
 KEY: TDirectoryFile	wjets_tauh;1	wjets_tauh
 KEY: TDirectoryFile	wjets_taul;1	wjets_taul
 KEY: TDirectoryFile	wjets_other;1	wjets_other


export nt=94v5
export proc=processing1
export distr=plot1

export plots_dir=plots/${nt}_${proc}_${distr}/
mkdir -p $plots_dir


export nt=94v5
export proc=processing1
export distr=plot2

export more_opt=

export output_type=png

export plots_dir=plots/${nt}_${proc}_${distr}/
mkdir -p $plots_dir


for d in Mt_lep_met_c leading_lep_pt dilep_mass_dy_tautau dilep_mass
do
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c el_sel    -d ${d} --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c el_sel_ss -d ${d} --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c mu_sel    -d ${d} --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c mu_sel_ss -d ${d} --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}

python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_eltau    -d ${d} --ratio-range 0.5 ${more_opt} --title ""  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_eltau_ss -d ${d} --ratio-range 0.5 ${more_opt} --title ""  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_mutau    -d ${d} --ratio-range 0.5 ${more_opt} --title ""  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_mutau_ss -d ${d} --ratio-range 0.5 ${more_opt} --title ""  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}

python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c tt_elmu   -d ${d} --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_mumu   -d ${d} --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_elel   -d ${d} --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
done

for d in tau_pt tau_sv_sign
do
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c el_sel    -d ${d} --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c el_sel_ss -d ${d} --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c mu_sel    -d ${d} --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c mu_sel_ss -d ${d} --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}

python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_eltau    -d ${d} --ratio-range 0.5 ${more_opt} --title ""  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_eltau_ss -d ${d} --ratio-range 0.5 ${more_opt} --title ""  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_mutau    -d ${d} --ratio-range 0.5 ${more_opt} --title ""  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_mutau_ss -d ${d} --ratio-range 0.5 ${more_opt} --title ""  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
done

export more_opt="--y-range 0,140000"

for d in tau_pt
do
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_eltau    -d ${d} --ratio-range 0.5 --y-range 0,150000 --title ""  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_eltau_ss -d ${d} --ratio-range 0.5 --y-range 0,150000 --title ""  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_mutau    -d ${d} --ratio-range 0.5 --y-range 0,150000 --title ""  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_mutau_ss -d ${d} --ratio-range 0.5 --y-range 0,150000 --title ""  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
done


for d in tau_sv_sign leading_lep_pt tau_pt
do
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_eltau    -d ${d} --ratio-range 0.5  --cumulative --title ""  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_eltau_ss -d ${d} --ratio-range 0.5  --cumulative --title ""  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_mutau    -d ${d} --ratio-range 0.5  --cumulative --title ""  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_mutau_ss -d ${d} --ratio-range 0.5  --cumulative --title ""  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}

python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c el_sel    -d ${d} --ratio-range 0.5  --cumulative --title ""  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c el_sel_ss -d ${d} --ratio-range 0.5  --cumulative --title ""  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c mu_sel    -d ${d} --ratio-range 0.5  --cumulative --title ""  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c mu_sel_ss -d ${d} --ratio-range 0.5  --cumulative --title ""  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
done




python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_eltau    -d dilep_mass --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_mutau    -d dilep_mass --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf

python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_eltau    -d dilep_mass_dy_tautau --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_mutau    -d dilep_mass_dy_tautau --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf


python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c mu_sel    -d dilep_mass --ratio-range 0.5 --bin-norm --title "" --title-x "m(l, #tau_{h}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf



DEBUG:root:absent NOMINAL
DEBUG:root:absent NOMINAL dy_mutau_wjets_other_NOMINAL_dilep_mass_dy_tautau

???

-- fixed this, was a weird bug


And there is some mess-up with gen_proc_id in TTbar.




## 2d histo of pT-s? YEP, works

ttree_out->Draw("event_leptons[0].pt():event_taus[0].pt()", "(selection_stage_dy == 135 || selection_stage_dy == 134 || selection_stage_dy == 125 || selection_stage_dy == 124)", "colz")

test binning:
python sumup_ttree_draw.py "event_leptons[0].pt():@event_taus.size()" --histo-range 10,0,10,20,0,100   --cond-com "(selection_stage_dy == 135 || selection_stage_dy == 134 || selection_stage_dy == 125 || selection_stage_dy == 124)" --output test_2d_pTs_dy.root   --histo-name test_2d_pTs_dy   --ttree ttree_out  lstore_outdirs//94v5/processing1/MC2017legacy_Fall17_DYJetsToLL_50toInf_madgraph_ext1_v1/MC2017legacy_Fall17_DYJetsToLL_50toInf_madgraph_ext1_v1_1.root


python sumup_ttree_draw.py "event_leptons[0].pt():event_taus[0].pt()" --histo-range 20,0,100,20,0,150   --cond-com "(selection_stage_dy == 135 || selection_stage_dy == 134 || selection_stage_dy == 125 || selection_stage_dy == 124)" --output test_2d_pTs_dy.root     --histo-name test_2d_pTs_dy    --ttree ttree_out  lstore_outdirs//94v5/processing1/MC2017legacy_Fall17_DYJetsToLL_50toInf_madg*/MC*.root &

python sumup_ttree_draw.py "event_leptons[0].pt():event_taus[0].pt()" --histo-range 20,0,100,20,0,150   --cond-com "(selection_stage_dy == 135 || selection_stage_dy == 134 || selection_stage_dy == 125 || selection_stage_dy == 124)" --output test_2d_pTs_wjets.root  --histo-name test_2d_pTs_wjets --ttree ttree_out  lstore_outdirs//94v5/processing1/MC2017legacy_Fall17_WJets*/*root &


python sumup_ttree_draw.py "event_leptons[0].pt():event_taus[0].pt()" --histo-range 20,0,100,20,0,150   --cond-com "(selection_stage_dy == 235 || selection_stage_dy == 234 || selection_stage_dy == 225 || selection_stage_dy == 224)" --output test_2d_pTs_dy_eltau_dy.root     --histo-name test_2d_pTs_dy_eltau_dy    --ttree ttree_out  lstore_outdirs//94v5/processing1/MC2017legacy_Fall17_DYJetsToLL_50toInf_madg*/MC*.root &
python sumup_ttree_draw.py "event_leptons[0].pt():event_taus[0].pt()" --histo-range 20,0,100,20,0,150   --cond-com "(selection_stage_dy == 235 || selection_stage_dy == 234 || selection_stage_dy == 225 || selection_stage_dy == 224)" --output test_2d_pTs_dy_eltau_wjets.root  --histo-name test_2d_pTs_dy_eltau_wjets --ttree ttree_out  lstore_outdirs//94v5/processing1/MC2017legacy_Fall17_WJets*/*root &



## gen_proc_id in ttbar

export file_TTTo2L=distrs/94v5/processing1/plot1/MC2017legacy_Fall17_TTTo2L2Nu.root
export file_TTToSemiLeptonic=distrs/94v5/processing1/plot1/MC2017legacy_Fall17_TTToSemiLeptonic_v2.root
export file_TTToHadronic=distrs/94v5/processing1/plot1/MC2017legacy_Fall17_TTToHadronic_13TeV_v2.root

python stack_plot.py ${file_TTTo2L} ${file_TTTo2L}                     --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c mu_sel    -d dilep_mass --ratio-range 0.5 --bin-norm --title "" --title-x "m(l, #tau_{h}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py ${file_TTToSemiLeptonic} ${file_TTToSemiLeptonic} --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c mu_sel    -d dilep_mass --ratio-range 0.5 --bin-norm --title "" --title-x "m(l, #tau_{h}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf
python stack_plot.py ${file_TTToHadronic} ${file_TTToHadronic}         --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c mu_sel    -d dilep_mass --ratio-range 0.5 --bin-norm --title "" --title-x "m(l, #tau_{h}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type pdf

-- SemiLeptonic is mis-classified

what's in ttree-s?

python sumup_ttree_draw.py "gen_proc_id" --histo-range 50,0,50   --cond-com "(selection_stage == 9 || selection_stage == 7)" --output test_mu_sel_gen_proc_id_TTToSemiLeptonic.root  --histo-name test_mu_sel_gen_proc_id_TTToSemiLeptonic --ttree ttree_out  lstore_outdirs/94v5/processing1/MC2017legacy_Fall17_TTToSemiLeptonic_v2/MC2017legacy_Fall17_TTToSemiLeptonic_v2_*.root

-- all events are at 11 and 20-25

in sumup_loop:

1. check if the event_selection is right

    root [2] test_mu_sel_gen_proc_id_TTToSemiLeptonic->Print()
    TH1.Print Name  = test_mu_sel_gen_proc_id_TTToSemiLeptonic, Entries= 44592, Total sum= 44592

    root -l jobsums/distrs/94v5/processing1/plot1/MC2017legacy_Fall17_TTToSemiLeptonic_v2.root

	tt_elmu       ->Get("mu_sel/NOMINAL/tt_elmu_mu_sel_NOMINAL_dilep_mass")
	tt_eltau1ch   ->Get("mu_sel/NOMINAL/tt_eltau1ch_mu_sel_NOMINAL_dilep_mass")
	tt_eltau3ch   ->Get("mu_sel/NOMINAL/tt_eltau3ch_mu_sel_NOMINAL_dilep_mass")
	tt_ljb        ->Get("mu_sel/NOMINAL/tt_ljb_mu_sel_NOMINAL_dilep_mass")
	tt_ljo        ->Get("mu_sel/NOMINAL/tt_ljo_mu_sel_NOMINAL_dilep_mass")
	tt_ljw        ->Get("mu_sel/NOMINAL/tt_ljw_mu_sel_NOMINAL_dilep_mass")
	tt_ljz        ->Get("mu_sel/NOMINAL/tt_ljz_mu_sel_NOMINAL_dilep_mass")
	tt_ltaul      ->Get("mu_sel/NOMINAL/tt_ltaul_mu_sel_NOMINAL_dilep_mass")
	tt_mutau1ch   ->Get("mu_sel/NOMINAL/tt_mutau1ch_mu_sel_NOMINAL_dilep_mass")
	tt_mutau3ch   ->Get("mu_sel/NOMINAL/tt_mutau3ch_mu_sel_NOMINAL_dilep_mass")
	tt_taueltaumu ->Get("mu_sel/NOMINAL/tt_taueltaumu")
	tt_taulj      ->Get("mu_sel/NOMINAL/tt_taulj_mu_sel_NOMINAL_dilep_mass")
	tt_taultauh   ->Get("mu_sel/NOMINAL/tt_taultauh_mu_sel_NOMINAL_dilep_mass")
	tt_other      ->Get("mu_sel/NOMINAL/tt_other_mu_sel_NOMINAL_dilep_mass")

	((TH1D*) mu_sel->Get("tt_elmu/NOMINAL/mu_sel_tt_elmu_NOMINAL_dilep_mass"))             ->GetEntries() + ((TH1D*) mu_sel->Get("tt_eltau1ch/NOMINAL/mu_sel_tt_eltau1ch_NOMINAL_dilep_mass"))     ->GetEntries() + ((TH1D*) mu_sel->Get("tt_eltau3ch/NOMINAL/mu_sel_tt_eltau3ch_NOMINAL_dilep_mass"))     ->GetEntries() + ((TH1D*) mu_sel->Get("tt_ljb/NOMINAL/mu_sel_tt_ljb_NOMINAL_dilep_mass"))               ->GetEntries() + ((TH1D*) mu_sel->Get("tt_ljo/NOMINAL/mu_sel_tt_ljo_NOMINAL_dilep_mass"))               ->GetEntries() + ((TH1D*) mu_sel->Get("tt_ljw/NOMINAL/mu_sel_tt_ljw_NOMINAL_dilep_mass"))               ->GetEntries() + ((TH1D*) mu_sel->Get("tt_ljz/NOMINAL/mu_sel_tt_ljz_NOMINAL_dilep_mass"))               ->GetEntries() + ((TH1D*) mu_sel->Get("tt_ltaul/NOMINAL/mu_sel_tt_ltaul_NOMINAL_dilep_mass"))           ->GetEntries() + ((TH1D*) mu_sel->Get("tt_mutau1ch/NOMINAL/mu_sel_tt_mutau1ch_NOMINAL_dilep_mass"))     ->GetEntries() + ((TH1D*) mu_sel->Get("tt_mutau3ch/NOMINAL/mu_sel_tt_mutau3ch_NOMINAL_dilep_mass"))     ->GetEntries() + ((TH1D*) mu_sel->Get("tt_taueltaumu/NOMINAL/mu_sel_tt_taueltaumu_NOMINAL_dilep_mass")) ->GetEntries() + ((TH1D*) mu_sel->Get("tt_taulj/NOMINAL/mu_sel_tt_taulj_NOMINAL_dilep_mass"))           ->GetEntries() + ((TH1D*) mu_sel->Get("tt_taultauh/NOMINAL/mu_sel_tt_taultauh_NOMINAL_dilep_mass"))     ->GetEntries() + ((TH1D*) mu_sel->Get("tt_other/NOMINAL/mu_sel_tt_other_NOMINAL_dilep_mass"))           ->GetEntries()

    44592.000

    full match!

    root [22] ((TH1D*) mu_sel->Get("tt_elmu/NOMINAL/mu_sel_tt_elmu_NOMINAL_dilep_mass"))             ->GetEntries()
    (double) 42485.000

2. check how the processes are classified

    // temporary fix for lj events in elmu final state
    bool NT_genproc_tt_elmu_lj()
            {
            return NT_gen_proc_id == 3 || NT_gen_proc_id == 0 || (NT_gen_proc_id > 20 && NT_gen_proc_id < 30);
            }

    -- ha!

now:
all ok!


## few ttbar, a lot of DY and wjets in tt_elmu

dy_other, not tautau

python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c tt_elmu   -d ${d} --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}

    root [4] tt_elmu->Get("tt_elmu/NOMINAL/tt_elmu_tt_elmu_NOMINAL_leading_lep_pt")->Print()
    TH1.Print Name  = tt_elmu_tt_elmu_NOMINAL_leading_lep_pt, Entries= 526394, Total sum= 291311
    
    root [5] tt_elmu->Get("dy_other/NOMINAL/tt_elmu_dy_other_NOMINAL_leading_lep_pt")->Print()
    TH1.Print Name  = tt_elmu_dy_other_NOMINAL_leading_lep_pt, Entries= 16796402, Total sum= 4.18583e+07


genproc:

python sumup_ttree_draw.py "gen_proc_id" --histo-range 50,0,50   --cond-com "(selection_stage == 9 || selection_stage == 7)" --output test_mu_sel_gen_proc_id_TTToSemiLeptonic.root  --histo-name test_mu_sel_gen_proc_id_TTToSemiLeptonic --ttree ttree_out  lstore_outdirs/94v5/processing1/MC2017legacy_Fall17_TTToSemiLeptonic_v2/MC2017legacy_Fall17_TTToSemiLeptonic_v2_*.root

-- noticed immediately a bug: sel > 200 || sel < 220

all right now

python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c tt_elmu_tight   -d ${d} --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}



## the figures of tests2018, mT in ttbar and lep_pt in dy

export nt=94v5
export proc=processing1
export distr=plot2

export more_opt=

export output_type=png

export plots_dir=plots/${nt}_${proc}_${distr}/
mkdir -p $plots_dir



python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c el_sel    -d Mt_lep_met_c --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}

python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c tt_elmu_tight   -d Mt_lep_met_c --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}


python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_eltau    -d leading_lep_pt --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_mutau    -d leading_lep_pt --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}

python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_elel     -d leading_lep_pt --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_mumu     -d leading_lep_pt --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}

-- elel is empty, all the rest are OK, dy_eltau is garbage as expected

python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c el_sel_tauSV3    -d Mt_lep_met_c --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c mu_sel_tauSV3    -d Mt_lep_met_c --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}

python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_mutau_tauSV3  -d leading_lep_pt --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}

-- all right, lep_pt in DY is very different from ttbar, and we actually need a fit in tau_pt

python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c el_sel_tauSV3    -d tau_pt --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c mu_sel_tauSV3    -d tau_pt --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}

python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c dy_mutau_tauSV3  -d tau_pt --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}



python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c el_sel_ss -d Mt_lep_met_c --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}
python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c mu_sel_ss -d Mt_lep_met_c --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}





## the yields

the old yields on NCG

root -l distrs/distrs_v27dilep2_mc_and_data.root

dy_other;1	dy_other
 KEY: TDirectoryFile	dy_tautau;1	dy_tautau
 KEY: TDirectoryFile	s_top_lj;1	s_top_lj
 KEY: TDirectoryFile	s_top_mutau;1	s_top_mutau
 KEY: TDirectoryFile	s_top_other;1	s_top_other
 KEY: TDirectoryFile	tt_lj;1	tt_lj
 KEY: TDirectoryFile	tt_mutau;1	tt_mutau
 KEY: TDirectoryFile	tt_other;1	tt_other
 KEY: TDirectoryFile	tt_taulj;1	tt_taulj
 KEY: TDirectoryFile	tt_taultauh;1	tt_taultauh
 KEY: TDirectoryFile	wjets_taul;1	wjets_taul
 KEY: TDirectoryFile	wjets_tauh;1	wjets_tauh
 KEY: TDirectoryFile	wjets_other;1	wjets_other
 KEY: TDirectoryFile	dibosons

root [3] mu_selSV->Get("data/NOMINAL/mu_selSV_data_NOMINAL_Mt_lep_met_c")->Print()
TH1.Print Name  = mu_selSV_data_NOMINAL_Mt_lep_met_c, Entries= 3846, Total sum= 3804

((TH1D*) mu_selSV->Get("dy_other/NOMINAL/mu_selSV_dy_other_NOMINAL_Mt_lep_met_c"))       ->Integral() +
((TH1D*) mu_selSV->Get("dy_tautau/NOMINAL/mu_selSV_dy_tautau_NOMINAL_Mt_lep_met_c"))     ->Integral() +
((TH1D*) mu_selSV->Get("s_top_lj/NOMINAL/mu_selSV_s_top_lj_NOMINAL_Mt_lep_met_c"))       ->Integral() +
((TH1D*) mu_selSV->Get("s_top_mutau/NOMINAL/mu_selSV_s_top_mutau_NOMINAL_Mt_lep_met_c")) ->Integral() +
((TH1D*) mu_selSV->Get("s_top_other/NOMINAL/mu_selSV_s_top_other_NOMINAL_Mt_lep_met_c")) ->Integral() +
((TH1D*) mu_selSV->Get("tt_lj/NOMINAL/mu_selSV_tt_lj_NOMINAL_Mt_lep_met_c"))             ->Integral() +
((TH1D*) mu_selSV->Get("tt_mutau/NOMINAL/mu_selSV_tt_mutau_NOMINAL_Mt_lep_met_c"))       ->Integral() +
((TH1D*) mu_selSV->Get("tt_other/NOMINAL/mu_selSV_tt_other_NOMINAL_Mt_lep_met_c"))       ->Integral() +
((TH1D*) mu_selSV->Get("tt_taulj/NOMINAL/mu_selSV_tt_taulj_NOMINAL_Mt_lep_met_c"))       ->Integral() +
((TH1D*) mu_selSV->Get("tt_taultauh/NOMINAL/mu_selSV_tt_taultauh_NOMINAL_Mt_lep_met_c")) ->Integral() +
((TH1D*) mu_selSV->Get("wjets_taul/NOMINAL/mu_selSV_wjets_taul_NOMINAL_Mt_lep_met_c"))   ->Integral() +
((TH1D*) mu_selSV->Get("wjets_tauh/NOMINAL/mu_selSV_wjets_tauh_NOMINAL_Mt_lep_met_c"))   ->Integral() +
((TH1D*) mu_selSV->Get("wjets_other/NOMINAL/mu_selSV_wjets_other_NOMINAL_Mt_lep_met_c")) ->Integral() +
((TH1D*) mu_selSV->Get("dibosons/NOMINAL/mu_selSV_dibosons_NOMINAL_Mt_lep_met_c"))       ->Integral()

((TH1D*) mu_selSV->Get("dy_other/NOMINAL/mu_selSV_dy_other_NOMINAL_Mt_lep_met_c"))       ->Integral() + ((TH1D*) mu_selSV->Get("dy_tautau/NOMINAL/mu_selSV_dy_tautau_NOMINAL_Mt_lep_met_c"))     ->Integral() + ((TH1D*) mu_selSV->Get("s_top_lj/NOMINAL/mu_selSV_s_top_lj_NOMINAL_Mt_lep_met_c"))       ->Integral() + ((TH1D*) mu_selSV->Get("s_top_mutau/NOMINAL/mu_selSV_s_top_mutau_NOMINAL_Mt_lep_met_c")) ->Integral() + ((TH1D*) mu_selSV->Get("s_top_other/NOMINAL/mu_selSV_s_top_other_NOMINAL_Mt_lep_met_c")) ->Integral() + ((TH1D*) mu_selSV->Get("tt_lj/NOMINAL/mu_selSV_tt_lj_NOMINAL_Mt_lep_met_c"))             ->Integral() + ((TH1D*) mu_selSV->Get("tt_mutau/NOMINAL/mu_selSV_tt_mutau_NOMINAL_Mt_lep_met_c"))       ->Integral() + ((TH1D*) mu_selSV->Get("tt_other/NOMINAL/mu_selSV_tt_other_NOMINAL_Mt_lep_met_c"))       ->Integral() + ((TH1D*) mu_selSV->Get("tt_taulj/NOMINAL/mu_selSV_tt_taulj_NOMINAL_Mt_lep_met_c"))       ->Integral() + ((TH1D*) mu_selSV->Get("tt_taultauh/NOMINAL/mu_selSV_tt_taultauh_NOMINAL_Mt_lep_met_c")) ->Integral() + ((TH1D*) mu_selSV->Get("wjets_taul/NOMINAL/mu_selSV_wjets_taul_NOMINAL_Mt_lep_met_c"))   ->Integral() + ((TH1D*) mu_selSV->Get("wjets_tauh/NOMINAL/mu_selSV_wjets_tauh_NOMINAL_Mt_lep_met_c"))   ->Integral() + ((TH1D*) mu_selSV->Get("wjets_other/NOMINAL/mu_selSV_wjets_other_NOMINAL_Mt_lep_met_c")) ->Integral() + ((TH1D*) mu_selSV->Get("dibosons/NOMINAL/mu_selSV_dibosons_NOMINAL_Mt_lep_met_c"))       ->Integral()

0.117512 * 35900

root [24] 0.117512 * 35900
(double) 4218.68



## fitting

distrs_94v5_processing1_fit1.root

cp datacard_ratio_mu_94v3_processing1_mc_3_testModeling_autonorm.txt   datacard_ratio_tt_mu_94v5_processing1_fit1_higgsCombine1.txt
cp datacard_ratio_elmu_94v3_processing1_mc_3_testModeling_autonorm.txt datacard_ratio_tt_elmu_94v5_processing1_fit1_higgsCombine1.txt

cp datacard_ratio_tt_mu_94v5_processing1_fit1_higgsCombine1.txt        datacard_ratio_dy_mu_94v5_processing1_fit1_higgsCombine1.txt
cp datacard_ratio_tt_elmu_94v5_processing1_fit1_higgsCombine1.txt      datacard_ratio_dy_mumu_94v5_processing1_fit1_higgsCombine1.txt

vim -p datacard_ratio_dy_mu_94v5_processing1_fit1_higgsCombine1.txt datacard_ratio_dy_mumu_94v5_processing1_fit1_higgsCombine1.txt


text2workspace.py fit-stuff/datacard_ratio_tt_mu_94v5_processing1_fit1_higgsCombine1.txt
text2workspace.py fit-stuff/datacard_ratio_tt_elmu_94v5_processing1_fit1_higgsCombine1.txt

text2workspace.py fit-stuff/datacard_ratio_dy_mu_94v5_processing1_fit1_higgsCombine1.txt
text2workspace.py fit-stuff/datacard_ratio_dy_mumu_94v5_processing1_fit1_higgsCombine1.txt

-- all processed well



## tt channels

combineCards.py mu=fit-stuff/datacard_ratio_tt_mu_94v5_processing1_fit1_higgsCombine1.txt elmu=fit-stuff/datacard_ratio_tt_elmu_94v5_processing1_fit1_higgsCombine1.txt > fit-stuff/datacard_ratio_tt_both_94v5_processing1_fit1_higgsCombine1.txt

text2workspace.py fit-stuff/datacard_ratio_tt_both_94v5_processing1_fit1_higgsCombine1.txt


dilep_norm              extArg                   1.         [0.8,1.2]
tau_ratio               extArg                   1.         [0.9,1.1]
rate_elmu               rateParam  elmu tt_elmu  (@0)    dilep_norm
rate_mutau              rateParam  mu   tt_mutau (@0*@1) dilep_norm,tau_ratio


combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu,tt_other --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_tt_both_94v5_processing1_fit1_higgsCombine1.root -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu,tt_other --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_tt_both_94v5_processing1_fit1_higgsCombine1.root -m 125 --robustFit 1 --doFits --parallel 5   --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu,tt_other --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_tt_both_94v5_processing1_fit1_higgsCombine1.root -m 125 -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_tt-channels.json  --name RatioElMuShapes
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_tt-channels.json -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_tt-channels

   tau_ratio :    +1.000   -0.076/+0.084 (68%)

-- ooook

tau ID, tau fakes are gigantic
TES is third

combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_tt_both_94v5_processing1_fit1_higgsCombine1.root -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes

   tau_ratio :    +1.000   -0.076/+0.084 (68%)




### the issue with null norm of wjets_other???

export nt=94v5
export proc=processing1
export distr=fit1

export more_opt=

export output_type=png

export plots_dir=plots/${nt}_${proc}_${distr}/
mkdir -p $plots_dir


python stack_plot.py distrs//distrs_${nt}_${proc}_${distr}.root distrs//distrs_${nt}_${proc}_${distr}.root --do-not-reweight --no-data -o ${plots_dir} --overwrite -p -r -c mu_sel_tauSV3    -d Mt_lep_met_c --ratio-range 0.5 ${more_opt} --title ""    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --ratio-range 0.55 --font-size-axes-labels 20 --font-size-axes-titles 25 --lumi 1 --output-type ${output_type}

-- yeah, there are none of these, and there were none in the control distrs before the last update




## 4 channels with full norm_tt and single top in ratio

cp fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.txt fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes_cleaner.txt
text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes_cleaner.txt

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes_cleaner.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakesCleaner --cminDefaultMinimizerTolerance 5.
combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes_cleaner.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakesCleaner --cminDefaultMinimizerTolerance 5.

Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
   tau_ratio :    +1.000   -0.066/+0.100 (68%)

original lumi_mult=2.0:

   tau_ratio :    +1.000   -0.034/+0.036 (68%)

now:

Error: closed range without finding crossing.
Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.100/+0.100 (68%)


and no additional norm in mu selection:

 ---------------------------

 WARNING: MultiDimFit failed

 ---------------------------

-- with any tolerance....


bin                               mu           mu           mu           mu           mu           mu           mu           mu
process                           tt_mutau     tt_lj        stop_lj      stop_mutau   tt_taulj     dy_tautau    stop_other   tt_other

elmu         elmu         elmu         elmu         elmu         dy_mutau     dy_mutau     dy_mutau     dy_mutau     dy_mutau     dy_mutau     dy_mutau     dy_mutau     dy_mutau     dy_mumu      dy_mumu      dy_mumu      dy_mumu
tt_elmu      stop_elmu    tt_other     stop_other   tt_ltaul     tt_mutau     tt_lj        stop_lj      stop_mutau   tt_taulj     dy_tautau    tt_other     stop_other   wjets_other  dy_other     wjets_other  stop_other   tt_other 



combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --cminDefaultMinimizerTolerance 5. --robustFit 1 --doFits --parallel 5   --name RatioMFakes
combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --cminDefaultMinimizerTolerance 5. -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp_mult2_fakes5.json  --name RatioMFakes
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp_mult2_fakes5.json -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp_mult2_fakes5





## 4 channels

3% were obtained in:

ttxsec/v27dilep2_ratio_6fixed2_10kSV_all.root

-- this is only ttbar ratio

1000fb tests were done in

ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_c2_double.txt
ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_c2.root

fitting/ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_c2_double.txt

-- this is all 4 channels


norm_tt                 extArg                   1.         [0.8,1.2]
norm_dy                 extArg                   1.         [0.8,1.2]
dy_ratio                extArg                   1.         [0.85,1.15]
tt_per_dy               extArg                   1.         [0.85,1.15]

rate_elmu               rateParam  elmu     tt_other  (@0)       norm_tt
rate_eltau              rateParam  el       tt_eltau  (@0*@1*@2) norm_tt,dy_ratio,tt_per_dy

rate_mumu               rateParam  dy_mumu     dy_other  (@0)    norm_dy
rate_mutau              rateParam  dy_mutau    dy_tautau (@0*@1) norm_dy,dy_ratio

this is tt channels only now:

dilep_norm              extArg                   1.         [0.8,1.2]
tau_ratio               extArg                   1.         [0.9,1.1]
rate_elmu               rateParam  elmu tt_elmu  (@0)    dilep_norm
rate_mutau              rateParam  mu   tt_mutau (@0*@1) dilep_norm,tau_ratio



combineCards.py mu=fit-stuff/datacard_ratio_tt_mu_94v5_processing1_fit1_higgsCombine1.txt elmu=fit-stuff/datacard_ratio_tt_elmu_94v5_processing1_fit1_higgsCombine1.txt dy_mutau=fit-stuff/datacard_ratio_dy_mu_94v5_processing1_fit1_higgsCombine1.txt dy_mumu=fit-stuff/datacard_ratio_dy_mumu_94v5_processing1_fit1_higgsCombine1.txt > fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1.txt

norm_tt                 extArg                   1.         [0.8,1.2]
norm_dy                 extArg                   1.         [0.8,1.2]
dy_ratio                extArg                   1.         [0.85,1.15]
tau_ratio               extArg                   1.         [0.85,1.15]
                                                                                                                                                                                                                                                                               
rate_elmu               rateParam  elmu     tt_elmu   (@0)       norm_tt
rate_eltau              rateParam  mu       tt_mutau  (@0*@1*@2) norm_tt,dy_ratio,tau_ratio
rate_mumu               rateParam  dy_mumu     dy_other  (@0)    norm_dy
rate_mutau              rateParam  dy_mutau    dy_tautau (@0*@1) norm_dy,dy_ratio

text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1.txt


combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1.root -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1.root -m 125 --robustFit 1 --doFits --parallel 5   --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1.root -m 125 -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels.json  --name RatioElMuShapes
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels.json -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels

   tau_ratio :    +1.000   -0.150/+0.150 (68%)

 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.150/+0.150 (68%)
Done in 0.02 min (cpu), 0.02 min (real)

--- something broke

DY norm at maximum, then wjets norm

cp fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1.txt fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp.txt

removed dy_norm

text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp.txt

combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp.root -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp.root -m 125 --robustFit 1 --doFits --parallel 5   --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp.root -m 125 -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp.json  --name RatioElMuShapes
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp.json -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp

   tau_ratio :    +1.000   -0.060/+0.062 (68%)

aha!

-- fakes and wjets norm are at the top



## fit in 140 fb

cp datacard_ratio_tt_mu_94v5_processing1_fit1_higgsCombine1.txt     datacard_ratio_tt_mu_94v5_processing1_fit1_higgsCombine1_140fb.txt
cp datacard_ratio_tt_elmu_94v5_processing1_fit1_higgsCombine1.txt   datacard_ratio_tt_elmu_94v5_processing1_fit1_higgsCombine1_140fb.txt

cp datacard_ratio_dy_mu_94v5_processing1_fit1_higgsCombine1.txt     datacard_ratio_dy_mu_94v5_processing1_fit1_higgsCombine1_140fb.txt
cp datacard_ratio_dy_mumu_94v5_processing1_fit1_higgsCombine1.txt   datacard_ratio_dy_mumu_94v5_processing1_fit1_higgsCombine1_140fb.txt

combineCards.py mu=fit-stuff/datacard_ratio_tt_mu_94v5_processing1_fit1_higgsCombine1_140fb.txt elmu=fit-stuff/datacard_ratio_tt_elmu_94v5_processing1_fit1_higgsCombine1_140fb.txt dy_mutau=fit-stuff/datacard_ratio_dy_mu_94v5_processing1_fit1_higgsCombine1_140fb.txt dy_mumu=fit-stuff/datacard_ratio_dy_mumu_94v5_processing1_fit1_higgsCombine1_140fb.txt > fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_140fb.txt

norm_tt                 extArg                   1.         [0.8,1.2]
norm_dy                 extArg                   1.         [0.8,1.2]
dy_ratio                extArg                   1.         [0.85,1.15]
tau_ratio               extArg                   1.         [0.85,1.15]
                                                                                                                                                                                                                                                                               
rate_elmu               rateParam  elmu     tt_elmu   (@0)       norm_tt
rate_eltau              rateParam  mu       tt_mutau  (@0*@1*@2) norm_tt,dy_ratio,tau_ratio
rate_mumu               rateParam  dy_mumu     dy_other  (@0)    norm_dy
rate_mutau              rateParam  dy_mutau    dy_tautau (@0*@1) norm_dy,dy_ratio

text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_140fb.txt


combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_140fb.root -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_140fb.root -m 125 --robustFit 1 --doFits --parallel 5   --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_140fb.root -m 125 -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_140fb.json  --name RatioElMuShapes
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_140fb.json -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_140fb

 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.150/+0.150 (68%)
Done in 0.03 min (cpu), 0.03 min (real)

???


## fit in 1000 fb

cp datacard_ratio_tt_mu_94v5_processing1_fit1_higgsCombine1.txt     datacard_ratio_tt_mu_94v5_processing1_fit1_higgsCombine1_1000fb.txt
cp datacard_ratio_tt_elmu_94v5_processing1_fit1_higgsCombine1.txt   datacard_ratio_tt_elmu_94v5_processing1_fit1_higgsCombine1_1000fb.txt

cp datacard_ratio_dy_mu_94v5_processing1_fit1_higgsCombine1.txt     datacard_ratio_dy_mu_94v5_processing1_fit1_higgsCombine1_1000fb.txt
cp datacard_ratio_dy_mumu_94v5_processing1_fit1_higgsCombine1.txt   datacard_ratio_dy_mumu_94v5_processing1_fit1_higgsCombine1_1000fb.txt

combineCards.py mu=fit-stuff/datacard_ratio_tt_mu_94v5_processing1_fit1_higgsCombine1_1000fb.txt elmu=fit-stuff/datacard_ratio_tt_elmu_94v5_processing1_fit1_higgsCombine1_1000fb.txt dy_mutau=fit-stuff/datacard_ratio_dy_mu_94v5_processing1_fit1_higgsCombine1_1000fb.txt dy_mumu=fit-stuff/datacard_ratio_dy_mumu_94v5_processing1_fit1_higgsCombine1_1000fb.txt > fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_1000fb.txt

text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_1000fb.txt


combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_1000fb.root -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_1000fb.root -m 125 --robustFit 1 --doFits --parallel 5   --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_1000fb.root -m 125 -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_1000fb.json  --name RatioElMuShapes
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_1000fb.json -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_1000fb



 ---------------------------

 WARNING: MultiDimFit failed

 ---------------------------

 
Done in 0.01 min (cpu), 0.01 min (real)



## debugging fits in 140 and 1000 fb

difference in datafiles?

root -l fit-stuff/distrs_94v5_processing1_fit1.root
dy_mumu->Get("dy_other/NOMINAL/dy_mumu_dy_other_NOMINAL_leading_lep_pt")->Print()
.q

root -l fit-stuff/distrs_94v5_processing1_fit2.root
dy_mumu->Get("dy_other/NOMINAL/dy_mumu_dy_other_NOMINAL_leading_lep_pt")->Print()
.q

root -l fit-stuff/distrs_94v5_processing1_fit3.root
dy_mumu->Get("dy_other/NOMINAL/dy_mumu_dy_other_NOMINAL_leading_lep_pt")->Print()
.q


TH1.Print Name  = dy_mumu_dy_other_NOMINAL_leading_lep_pt, Entries= 16502484, Total sum= 4.14464e+07
TH1.Print Name  = dy_mumu_dy_other_NOMINAL_leading_lep_pt, Entries= 16502484, Total sum= 1.40496e+08
TH1.Print Name  = dy_mumu_dy_other_NOMINAL_leading_lep_pt, Entries= 16502484, Total sum= 1.00354e+09

diff fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp.txt fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit2_higgsCombine1_140fb.txt
diff fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp.txt fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit3_higgsCombine1_1000fb.txt

-- only the datafile names are different

cp fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp.root fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_WORKED.root

combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_WORKED.root -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes
   tau_ratio :    +1.000   -0.060/+0.062 (68%)



text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp.txt
text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit2_higgsCombine1_140fb.txt
text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit3_higgsCombine1_1000fb.txt

combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp.root   -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit2_higgsCombine1_140fb.root  -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit3_higgsCombine1_1000fb.root -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes

   tau_ratio :    +1.000   -0.060/+0.062 (68%)

best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.150/+0.150 (68%)
Done in 0.03 min (cpu), 0.03 min (real)

 ---------------------------

 WARNING: MultiDimFit failed

 ---------------------------


combineTool.py -M Impacts  -t -1 --setParameters tau_ratio=1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit3_higgsCombine1_1000fb.root -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes

same

combineTool.py -M Impacts  -t -1 --setParameters tau_ratio=1,norm_tt=1,norm_dy=1,dy_ratio=1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit3_higgsCombine1_1000fb.root -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes

same


combineTool.py -M Impacts  -t -1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp.root   -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes

 ---------------------------

 WARNING: MultiDimFit failed

 ---------------------------

huh?

combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp.root   -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes

   tau_ratio :    +1.000   -0.060/+0.062 (68%)

hmm? what does this mean?

combineTool.py -M Impacts  -t -1 --setParameters r=1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp.root   -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes

   tau_ratio :    +1.000   -0.060/+0.062 (68%)



combineTool.py -M Impacts  -t -1 --setParameters r=1,tau_ratio=1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit2_higgsCombine1_140fb.root  -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes

best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.150/+0.150 (68%)

combineTool.py -M Impacts  -t -1 --setParameters r=1,tau_ratio=1,norm_tt=1,norm_dy=1,dy_ratio=1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit2_higgsCombine1_140fb.root  -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes


best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.150/+0.150 (68%)


combineTool.py -M Impacts  -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp.root   -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit2_higgsCombine1_140fb.root  -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes140fb

   tau_ratio :    +1.000   -0.060/+0.062 (68%)

best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.150/+0.150 (68%)
Done in 0.03 min (cpu), 0.03 min (real)


combineTool.py -M Impacts  -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs ratio_param -d fit-stuff/datacard_ratio_nominal.root  -m 125 --robustFit 1 --doInitialFit          --name RatioShapes
combineTool.py -M Impacts  -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs ratio_param -d fit-stuff/datacard_ratio_140fb.root    -m 125 --robustFit 1 --doInitialFit          --name RatioShapes140fb

   ratio_param :    +1.000   -0.060/+0.062 (68%)

best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : ratio_param
 Warning - No valid low-error found, will report difference to minimum of range for : ratio_param
   ratio_param :    +1.000   -0.150/+0.150 (68%)
Done in 0.03 min (cpu), 0.03 min (real)







rest:

combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp.root -m 125 --robustFit 1 --doFits --parallel 5   --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp.root -m 125 -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp.json  --name RatioElMuShapes
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp.json -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp



### try removeing more nuisance parameters


cp fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit2_higgsCombine1_140fb.txt fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit2_higgsCombine1_140fb_temp.txt
text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit2_higgsCombine1_140fb_temp.txt

combineTool.py -M Impacts  -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit2_higgsCombine1_140fb_temp.root  -m 125 --robustFit 1 --doInitialFit   --name RatioElMuShapes140fb

no PDFs:
 ---------------------------

 WARNING: MultiDimFit failed

 ---------------------------

combineTool.py -M Impacts  -t -1 --setParameters r=1 --freezeParameters r --freezeNuisanceGroup exp --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit2_higgsCombine1_140fb_temp.root  -m 125 --robustFit 1 --doInitialFit   --name RatioElMuShapes140fb

best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.150/+0.150 (68%)

tau group = tau_fakes TAUID
tt_th_match group = Mfr Mf Mr
tt_th_frag group = Frag SemilepBR Peterson
exp group = JER JES PU TAUID lumi_13TeV tau_fakes TOPPT wjets_norm bSF TES

combineTool.py -M Impacts  -t -1 --setParameters r=1 --freezeParameters r --freezeNuisanceGroup exp,tt_th_match,tt_th_frag --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit2_higgsCombine1_140fb_temp.root  -m 125 --robustFit 1 --doInitialFit   --name RatioElMuShapes140fb

best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.150/+0.150 (68%)
Done in 0.00 min (cpu), 0.00 min (real)



### full impacts of 140fb, smaller variations, NLL, mult factor instead of other histos, only tt


combineTool.py -M Impacts  -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp.root   -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes

combineTool.py -M Impacts  -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit2_higgsCombine1_140fb_temp.root  -m 125 --robustFit 1 --doInitialFit   --name RatioElMuShapes140fb

-- all the same



#### full impacts of 140fb

text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit2_higgsCombine1_140fb.txt

combineTool.py -M Impacts  -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit2_higgsCombine1_140fb.root -m 125 --robustFit 1 --doInitialFit   --name RatioElMuShapes140fb

-- same

combineTool.py -M Impacts  -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit2_higgsCombine1_140fb.root -m 125 --robustFit 1 --doFits --parallel 5   --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit2_higgsCombine1_140fb.root -m 125 -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit2_higgsCombine1_four_channels_140fb.json  --name RatioElMuShapes
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v5_processing1_fit2_higgsCombine1_four_channels_140fb.json -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit2_higgsCombine1_four_channels_140fb

-- it is just empty



#### also try smaller variation of ratio

cp fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit2_higgsCombine1_140fb.txt fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit2_higgsCombine1_140fb_ratioparam.txt
text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit2_higgsCombine1_140fb_ratioparam.txt

combineTool.py -M Impacts  -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit2_higgsCombine1_140fb_ratioparam.root -m 125 --robustFit 1 --doInitialFit   --name RatioSmallElMu

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.050/+0.050 (68%)
Done in 0.02 min (cpu), 0.02 min (real)

same



#### NLL

combine -M MultiDimFit fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit2_higgsCombine1_140fb.root --algo grid -t -1 --points 100 --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1 --name RatioElMuShapes

 POI: tau_ratio= 1 -> [0.85,1.15]
Point 0/100 tau_ratio = 0.8515
[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!

Point 45/100 tau_ratio = 0.9865
Info in <Minuit2>: Minuit2Minimizer::Minimize : Minimization did NOT converge, Edm is above max
Point 46/100 tau_ratio = 0.9895
Info in <Minuit2>: Minuit2Minimizer::Minimize : Minimization did NOT converge, Edm is above max
Point 47/100 tau_ratio = 0.9925
Info in <Minuit2>: Minuit2Minimizer::Minimize : Minimization did NOT converge, Edm is above max
Point 48/100 tau_ratio = 0.9955
Info in <Minuit2>: MnGlobalCorrelationCoeff: inversion of matrix fails.
Info in <Minuit2>: Minuit2Minimizer::Minimize : Minimization did NOT converge, Edm is above max
Point 49/100 tau_ratio = 0.9985
Info in <Minuit2>: Minuit2Minimizer::Minimize : Minimization did NOT converge, Edm is above max
Point 50/100 tau_ratio = 1.0015
Info in <Minuit2>: MnGlobalCorrelationCoeff: inversion of matrix fails.
Info in <Minuit2>: Minuit2Minimizer::Minimize : Minimization did NOT converge, Edm is above max
Point 51/100 tau_ratio = 1.0045
Info in <Minuit2>: Minuit2Minimizer::Minimize : Minimization did NOT converge, Edm is above max
Point 52/100 tau_ratio = 1.0075
Info in <Minuit2>: Minuit2Minimizer::Minimize : Minimization did NOT converge, Edm is above max
Point 53/100 tau_ratio = 1.0105
Info in <Minuit2>: Minuit2Minimizer::Minimize : Minimization did NOT converge, Edm is above max
Point 54/100 tau_ratio = 1.0135
Info in <Minuit2>: Minuit2Minimizer::Minimize : Minimization did NOT converge, Edm is above max
Point 55/100 tau_ratio = 1.0165
Info in <Minuit2>: Minuit2Minimizer::Minimize : Minimization did NOT converge, Edm is above max
Point 56/100 tau_ratio = 1.0195
Info in <Minuit2>: Minuit2Minimizer::Minimize : Minimization did NOT converge, Edm is above max
Point 57/100 tau_ratio = 1.0225
Info in <Minuit2>: Minuit2Minimizer::Minimize : Minimization did NOT converge, Edm is above max
Point 58/100 tau_ratio = 1.0255



#### mult factor

cp fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp.txt fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult.txt

text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult.txt


combineTool.py -M Impacts  -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult.root -m 125 --robustFit 1 --doInitialFit   --name RatioMultlElMu


mult=1

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
   tau_ratio :    +1.000   -0.059/+0.062 (68%)
Done in 0.26 min (cpu), 0.27 min (real)


mult=1.1

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
   tau_ratio :    +1.000   -0.057/+0.060 (68%)
Done in 0.51 min (cpu), 0.51 min (real)


mult=1.2

best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
   tau_ratio :    +1.000   -0.056/+0.150 (68%)
Done in 0.45 min (cpu), 0.45 min (real)



mult=1.5

Error: minimization failed at tau_ratio = 1.00894
Error: minimization failed at tau_ratio = 0.977031

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.150/+0.150 (68%)
Done in 0.27 min (cpu), 0.27 min (real)


mult=2

 ---------------------------

 WARNING: MultiDimFit failed

 ---------------------------


full impacts with mult=1.2

combineTool.py -M Impacts  -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult.root -m 125 --robustFit 1 --doFits --parallel 5   --name RatioMultlElMu
combineTool.py -M Impacts  -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult.root -m 125 -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp_mult.json  --name RatioMultlElMu
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp_mult.json -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp_mult


-- only errors?
tau fakes are wildly off

cp  fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult.txt fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult_nofakes.txt
vim fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult_nofakes.txt

text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult_nofakes.txt


combineTool.py -M Impacts  -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult_nofakes.root -m 125 --robustFit 1 --doInitialFit   --name RatioMultlElMu

best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.150/+0.042 (68%)
Done in 0.65 min (cpu), 0.65 min (real)

hmmm

combineTool.py -M Impacts  -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult_nofakes.root -m 125 --robustFit 1 --doFits --parallel 5   --name RatioMultlElMu
combineTool.py -M Impacts  -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult_nofakes.root -m 125 -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp_mult_nofakes.json  --name RatioMultlElMu
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp_mult_nofakes.json -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp_mult_nofakes



#### freeze lumi

combineTool.py -M Impacts -t -1 --setParameters r=1 --freezeParameters r,lumi_13TeV --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult_nofakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMultlNoFakesElMu

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
   tau_ratio :    +1.000   -0.040/+0.150 (68%)
Done in 0.57 min (cpu), 0.57 min (real)



#### -v3 debug info

combineTool.py -M Impacts -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult_nofakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMultlNoFakesElMu -v3

Minuit does not converge...



#### multiply tt mutau

mult_tt                 extArg                   2.1
rate_lumi               rateParam  mu tt_mutau   (@0) mult_tt


 ---------------------------

 WARNING: MultiDimFit failed

 ---------------------------



#### only tt ratio

rate_elmu               rateParam  elmu     tt_elmu   (@0)       norm_tt
rate_eltau              rateParam  mu       tt_mutau  (@0*@1)    norm_tt,tau_ratio

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
   tau_ratio :    +1.000   -0.076/+0.082 (68%)

lumi_mult = 3.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
   tau_ratio :    +1.000   -0.076/+0.082 (68%)

rest of impacts:

combineTool.py -M Impacts -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult.root -m 125 --robustFit 1 --doInitialFit --name RatioOnlyTTElMu
combineTool.py -M Impacts -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult.root -m 125 --robustFit 1 --doFits --parallel 5   --name RatioOnlyTTElMu
combineTool.py -M Impacts -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult.root -m 125 -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp_mult_onlyTT.json  --name RatioOnlyTTElMu
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp_mult_onlyTT.json -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp_mult_onlyTT


w. dy_ratio fixed:

combineTool.py -M Impacts -t -1 --setParameters r=1,dy_ratio=1 --freezeParameters r,dy_ratio --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult.root -m 125 --robustFit 1 --doInitialFit --name RatioMultlElMu

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
   tau_ratio :    +1.000   -0.060/+0.062 (68%)


w. dy_ratio as poi:

combineTool.py -M Impacts -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio,dy_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult.root -m 125 --robustFit 1 --doInitialFit --name RatioMultlElMu

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
   tau_ratio :    +1.000   -0.076/+0.082 (68%)
    dy_ratio :    +1.000   -0.053/+0.058 (68%)

so it does not absorb anything?





#### alternative formula

rate_elmu               rateParam  elmu     tt_elmu   (@0)       norm_tt
rate_eltau              rateParam  mu       tt_mutau  (@0*@1*@2) norm_tt,dy_ratio,tau_ratio

->

rate_elmu               rateParam  elmu     tt_elmu   (@0/@1)   norm_tt,tau_ratio
rate_eltau              rateParam  mu       tt_mutau  (@0*@1)   norm_tt,dy_ratio

with
lumi_mult               extArg                   1.0

 ---------------------------

 WARNING: MultiDimFit failed

 ---------------------------





#### more POIs

cp fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult.txt fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.txt
text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.txt

combineTool.py -M Impacts -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio,dy_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 1 --doInitialFit --name RatioAllPOI


lumi_mult=3

 ---------------------------

 WARNING: MultiDimFit failed

 ---------------------------


lumi_mult=1

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
   tau_ratio :    +1.000   -0.060/+0.062 (68%)
    dy_ratio :    +1.000   -0.052/+0.058 (68%)




#### running the old datacard

cp ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_c2_double.txt ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_c2_double_newtests.txt

text2workspace.py ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_c2_double_newtests.txt

combineTool.py -M Impacts -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tt_per_dy -d ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_c2_double_newtests.root -m 125 --robustFit 1 --doInitialFit --name RatioOldDatacard

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
   tt_per_dy :    +1.000   -0.021/+0.018 (68%)


combineTool.py -M Impacts -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tt_per_dy,dy_ratio -d ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_c2_double_newtests.root -m 125 --robustFit 1 --doInitialFit --name RatioOldDatacard

best fit parameter values and profile-likelihood uncertainties: 
   tt_per_dy :    +1.000   -0.021/+0.018 (68%)
    dy_ratio :    +1.000   -0.045/+0.047 (68%)





#### random tests

lnN tau fakes

combineTool.py -M Impacts -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 1 --doInitialFit --name RatioMore

lumi_mult = 1

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.150/+0.150 (68%)

wow!

lnU:

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
   tau_ratio :    +1.000   -0.060/+0.062 (68%)


tau_fakes               lnU       -            1.5          1.5          -            1.5          -            1.5          1.5          -            -            -            -            -            -            1.5          1.5          -            1.5          -            1.5          1.5          -            -            -            -            -

randomly fixed TES

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.150/+0.150 (68%)


randomly enlarged norm_params ranges:

norm_tt                 extArg                   1.         [0.7,1.3]
norm_dy                 extArg                   1.         [0.7,1.3]
dy_ratio                extArg                   1.         [0.85,1.15]
tau_ratio               extArg                   1.         [0.85,1.15]


 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
   tau_ratio :    +1.000   -0.044/+0.046 (68%)

lumi_mult 1.5

Error: closed range without finding crossing.
Error: minimization failed at tau_ratio = 0.969062

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.150/+0.150 (68%)

norm_tt                 extArg                   1.         [0.6,1.4]
norm_dy                 extArg                   1.         [0.6,1.4]
dy_ratio                extArg                   1.         [0.9,1.1]
tau_ratio               extArg                   1.         [0.9,1.1]

Error: minimization failed at tau_ratio = 1
Error: minimization failed at tau_ratio = 1

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.100/+0.100 (68%)

lumi_mult 1.2

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.100/+0.100 (68%)


norm_tt                 extArg                   1.         [0.6,1.4]
norm_dy                 extArg                   1.         [0.6,1.4]
dy_ratio                extArg                   1.         [0.7,1.3]
tau_ratio               extArg                   1.         [0.7,1.3]

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
   tau_ratio :    +1.000   -0.038/+0.040 (68%)

lumi_mult=1.5

Error: minimization failed at tau_ratio = 1.03056
Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.300/+0.300 (68%)


norm_tt                 extArg                   1.         [0.2,1.8]
norm_dy                 extArg                   1.         [0.2,1.8]
dy_ratio                extArg                   1.         [0.4,1.6]
tau_ratio               extArg                   1.         [0.4,1.6]


 ---------------------------

 WARNING: MultiDimFit failed

 ---------------------------


Error: closed range without finding crossing.
Error: minimization failed at dy_ratio = 1
Error: minimization failed at dy_ratio = 1

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.150/+0.045 (68%)
 Warning - No valid high-error found, will report difference to maximum of range for : dy_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : dy_ratio
    dy_ratio :    +1.000   -0.150/+0.150 (68%)


norm_tt                 extArg                   1.         [0.8,1.2]
norm_dy                 extArg                   1.         [0.8,1.2]
dy_ratio                extArg                   1.         [0.4,1.6]
tau_ratio               extArg                   1.         [0.4,1.6]


Error: minimization failed at tau_ratio = 1
Error: minimization failed at tau_ratio = 1

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.600/+0.600 (68%)


norm_tt                 extArg                   1.         [0.2,1.8]
norm_dy                 extArg                   1.         [0.2,1.8]
dy_ratio                extArg                   1.         [0.8,1.2]
tau_ratio               extArg                   1.         [0.8,1.2]

 ---------------------------

 WARNING: MultiDimFit failed

 ---------------------------



combineTool.py -M Impacts -t -1 --setParameters r=1 --freezeParameters r --freezeNuisanceGroup tt_th_pdf --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 1 --doInitialFit --name RatioMore

Error: minimization failed at tau_ratio = 1
Error: minimization failed at tau_ratio = 1

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.800/+0.800 (68%)

lumi_mult=1.2

 ---------------------------

 WARNING: MultiDimFit failed

 ---------------------------


now cannot reproduce old result

norm_tt                 extArg                   1.         [0.6,1.4]
norm_dy                 extArg                   1.         [0.6,1.4]
dy_ratio                extArg                   1.         [0.9,1.1]
tau_ratio               extArg                   1.         [0.9,1.1]


combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.0 --freezeParameters r --freezeNuisanceGroup tt_th_pdf --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 1 --doInitialFit --name RatioMore


 ---------------------------

 WARNING: MultiDimFit failed

 ---------------------------


combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 1 --doInitialFit --name RatioMore

Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.100/+0.046 (68%)



combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.2 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 1 --doInitialFit --name RatioMore

Error: closed range without finding crossing.
Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.100/+0.100 (68%)

--- damn!




[olek@fermi02 fitting]$ vim fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.txt
[olek@fermi02 fitting]$ 
[olek@fermi02 fitting]$ text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.txt
^[[A^[[A^[[A
[olek@fermi02 fitting]$ combineTool.py -M Impacts -t -1 --setParameters r=1 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 1 --doInitialFit --name RatioMore
Have POIs: ['tau_ratio']
>> combine -M MultiDimFit -n _initialFit_RatioMore --algo singles --redefineSignalPOIs tau_ratio -t -1 --freezeParameters r --robustFit 1 -m 125 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root --setParameters r=1
 <<< Combine >>> 
>>> including systematics
   Options for Robust Minimizer :: 
        Tolerance  0.1
        Strategy   0
        Type,Algo  Minuit2,Migrad
>>> method used is MultiDimFit
>>> random number generator seed is 123456
Set Default Value of Parameter r To : 1
Computing results starting from expected outcome (a-priori)

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
   tau_ratio :    +1.000   -0.038/+0.040 (68%)
Done in 0.69 min (cpu), 0.69 min (real)
[olek@fermi02 fitting]$ 



reset

norm_tt                 extArg                   1.         [0.6,1.4]
norm_dy                 extArg                   1.         [0.6,1.4]
dy_ratio                extArg                   1.         [0.7,1.3]
tau_ratio               extArg                   1.         [0.7,1.3]

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 1 --doInitialFit --name RatioMore
combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.2 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 1 --doInitialFit --name RatioMore

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
   tau_ratio :    +1.000   -0.043/+0.047 (68%)

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
   tau_ratio :    +1.000   -0.038/+0.040 (68%)



lumi_mult=1.3

Computing results starting from expected outcome (a-priori)
Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
   tau_ratio :    +1.000   -0.035/+0.300 (68%)



combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.4 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 1 --doInitialFit --name RatioMore

Error: minimization failed at tau_ratio = 1
Error: minimization failed at tau_ratio = 1

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.300/+0.300 (68%)


combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.4,tau_ratio=1.0,dy_ratio=1.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 1 --doInitialFit --name RatioMore


combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.4,tau_ratio=1.0,dy_ratio=1.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 1 --doInitialFit --name RatioMore --cminDefaultMinimizerTolerance 0.5





#### running raw combine

combine -M FitDiagnostics fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -t -1 --setParameters r=1.0,lumi_mult=1.3 --freezeParameters r --redefineSignalPOIs tau_ratio

 --- FitDiagnostics ---
Fit failed.



combine -M FitDiagnostics fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -t -1 --setParameters r=1.0,lumi_mult=1.3 --freezeParameters r --redefineSignalPOIs tau_ratio --cminDefaultMinimizerTolerance 0.5

[WARNING]: Unable to determine uncertainties on all fit parameters in s+b fit. Have a look at https://cms-hcomb.gitbooks.io/combine/content/part3/nonstandard.html#fit-parameter-uncertainties for more information.

 --- FitDiagnostics ---
Best fit tau_ratio: 1  -0.3/+0.0258025  (68% CL)


combine -M FitDiagnostics fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -t -1 --setParameters r=1.0,lumi_mult=1.5 --freezeParameters r --redefineSignalPOIs tau_ratio --cminDefaultMinimizerTolerance 0.5

Computing results starting from expected outcome (a-priori)
[WARNING]: Unable to determine uncertainties on all fit parameters in s+b fit. Have a look at https://cms-hcomb.gitbooks.io/combine/content/part3/nonstandard.html#fit-parameter-uncertainties for more information.

 --- FitDiagnostics ---
Best fit tau_ratio: 1  -0.3/+0.0223692  (68% CL)
Done in 0.11 min (cpu), 0.12 min (real)


combine -M FitDiagnostics fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio --cminDefaultMinimizerTolerance 0.5

Computing results starting from expected outcome (a-priori)
[WARNING]: Unable to determine uncertainties on all fit parameters in s+b fit. Have a look at https://cms-hcomb.gitbooks.io/combine/content/part3/nonstandard.html#fit-parameter-uncertainties for more information.

 --- FitDiagnostics ---
Best fit tau_ratio: 1  -0.3/+0.0159817  (68% CL)

combine -M FitDiagnostics fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r,lumi_13TeV --redefineSignalPOIs tau_ratio --cminDefaultMinimizerTolerance 0.5



#### getting the half-convergance into impacts?

combine -M FitDiagnostics fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio --cminDefaultMinimizerTolerance 0.2

Best fit tau_ratio: 1  -0.4/+0.0157326  (68% CL)

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 1 --doInitialFit --name RatioMore --cminDefaultMinimizerTolerance 0.2

 ---------------------------

 WARNING: MultiDimFit failed

 ---------------------------

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 0 --doInitialFit --name RatioMore --cminDefaultMinimizerTolerance 0.2

 ---------------------------

 WARNING: MultiDimFit failed

 ---------------------------


combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 1 --doInitialFit --name RatioMore --cminDefaultMinimizerTolerance 0.2


combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.5 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 1 --doInitialFit --name RatioMore --cminDefaultMinimizerTolerance 0.2

Error: minimization failed at tau_ratio = 1.02755
Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.400/+0.400 (68%)

norm_tt                 extArg                   1.         [0.3,1.7]
norm_dy                 extArg                   1.         [0.3,1.7]
dy_ratio                extArg                   1.         [0.5,1.5]
tau_ratio               extArg                   1.         [0.6,1.4]

to

norm_tt                 extArg                   1.         [0.1,1.9]
norm_dy                 extArg                   1.         [0.1,1.9]
dy_ratio                extArg                   1.         [0.1,1.9]
tau_ratio               extArg                   1.         [0.1,1.9]

text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.txt

best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.900/+0.900 (68%)


combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.5 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 1 --doInitialFit --name RatioMore --cminDefaultMinimizerTolerance 1.

Error: closed range without finding crossing.
Error: minimization failed at tau_ratio = 0.968968

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.900/+0.900 (68%)



combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=1.5 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 1 --doInitialFit --name RatioMore --cminDefaultMinimizerTolerance 5.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
   tau_ratio :    +1.000   -0.031/+0.034 (68%)


combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.5 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 1 --doInitialFit --name RatioMore --cminDefaultMinimizerTolerance 5.

Error: closed range without finding crossing.
Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.900/+0.900 (68%)

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.5 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 1 --doInitialFit --name RatioMore --cminDefaultMinimizerTolerance 10.

Error: minimization failed at tau_ratio = 1.01835
Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.900/+0.900 (68%)


tolerance 20

Error: closed range without finding crossing.
Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.900/+0.900 (68%)

50

Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.900/+0.025 (68%)

100

Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.900/+0.900 (68%)

40

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.5 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 1 --doInitialFit --name RatioMore --cminDefaultMinimizerTolerance 40

Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.900/+0.025 (68%)


combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=3.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 1 --doInitialFit --name RatioMore --cminDefaultMinimizerTolerance 40

Error: minimization failed at tau_ratio = 1.00051
Error: minimization failed at tau_ratio = 0.983648

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.900/+0.900 (68%)



1000

Error: minimization failed at tau_ratio = 1.01471
Error: minimization failed at tau_ratio = 0.988236

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.900/+0.900 (68%)




#### some impacts

$ combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --robustFit 1 --doInitialFit --name RatioMore --cminDefaultMinimizerTolerance 10.
Have POIs: ['tau_ratio']
>> combine -M MultiDimFit -n _initialFit_RatioMore --algo singles --redefineSignalPOIs tau_ratio -t -1 --freezeParameters r --robustFit 1 --cminDefaultMinimizerTolerance 10. -m 125 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root --setParameters r=1.0,lumi_mult=2.0
 <<< Combine >>> 
>>> including systematics
   Options for Robust Minimizer :: 
        Tolerance  10
        Strategy   0
        Type,Algo  Minuit2,Migrad
>>> method used is MultiDimFit
>>> random number generator seed is 123456
Set Default Value of Parameter r To : 1
Set Default Value of Parameter lumi_mult To : 2
Computing results starting from expected outcome (a-priori)


 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
   tau_ratio :    +1.000   -0.025/+0.027 (68%)

is it something?


let's see impacts

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --cminDefaultMinimizerTolerance 10. --robustFit 1 --doInitialFit --name RatioMore

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --cminDefaultMinimizerTolerance 10. --robustFit 1 --doFits --parallel 5   --name RatioMore
combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.root -m 125 --cminDefaultMinimizerTolerance 10. -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp_mult2_more.json  --name RatioMore
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp_mult2_more.json -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp_mult2_more



##### and let's add fakes back

cp  fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2.txt  fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.txt

tau_fakes               lnN       -            1.5          1.5          -            1.5          -            1.5          1.5          -            -            -            -            -            -            1.5          1.5          -            1.5          -            1.5          1.5          -            -            -            -            -


text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.txt

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --cminDefaultMinimizerTolerance 10. --robustFit 1 --doInitialFit --name RatioMFakes

Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.900/+0.035 (68%)



combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakes --cminDefaultMinimizerTolerance 20.

Error: closed range without finding crossing.
Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.900/+0.900 (68%)



combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakes --cminDefaultMinimizerTolerance 5.

Error: minimization failed at tau_ratio = 0.972848

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.900/+0.035 (68%)



lnU

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakes --cminDefaultMinimizerTolerance 5.

5

Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.900/+0.036 (68%)

10

Error: minimization failed at tau_ratio = 0.967365

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.900/+0.036 (68%)

50.

Error: closed range without finding crossing.
Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.900/+0.900 (68%)

0.01

 ---------------------------

 WARNING: MultiDimFit failed

 ---------------------------


100.

Error: closed range without finding crossing.
Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.900/+0.900 (68%)



--cminDefaultMinimizerTolerance 100.
combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakes --cminDefaultMinimizerTolerance 100.

Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
   tau_ratio :    +1.000   -0.033/+0.100 (68%)

--stepSize 0.1

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakes --cminDefaultMinimizerTolerance 100. --stepSize 0.01

Error: minimization failed at tau_ratio = 1.00427
Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.100/+0.100 (68%)


combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakes --cminDefaultMinimizerTolerance 10. --stepSize 0.0001

Error: closed range without finding crossing.
Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.100/+0.100 (68%)


combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakes --cminDefaultMinimizerTolerance 10. --stepSize 0.0001



combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakes --cminDefaultMinimizerTolerance 50. --stepSize 0.0001

a lot of
[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!

Info in <Minuit2>: Minuit2Minimizer::Minimize : Minimization did NOT converge, Edm is above max
[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!



text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.txt

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakes --cminDefaultMinimizerTolerance 50. --stepSize 0.0001


combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakes --cminDefaultMinimizerTolerance 50. --stepSize 0.001
Error: closed range without finding crossing.
Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.050/+0.050 (68%)

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakes --cminDefaultMinimizerTolerance 50. --stepSize 0.001





#### hal-side fits with fakes

fakes lnU 1.5

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakes --cminDefaultMinimizerTolerance 10.

Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
   tau_ratio :    +1.000   -0.034/+0.100 (68%)

100

Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
   tau_ratio :    +1.000   -0.033/+0.100 (68%)


#### the one that works on both sides !!!!!!!!!!!!!!

5

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakes --cminDefaultMinimizerTolerance 5.

   tau_ratio :    +1.000   -0.034/+0.036 (68%)

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!111

combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --cminDefaultMinimizerTolerance 5. --robustFit 1 --doFits --parallel 5   --name RatioMFakes
combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --cminDefaultMinimizerTolerance 5. -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp_mult2_fakes5.json  --name RatioMFakes
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp_mult2_fakes5.json -o latest_toys_asimov_impacts_ratio_94v5_processing1_fit1_higgsCombine1_four_channels_temp_mult2_fakes5

-- asymmetric, but not too bad



combineTool.py -M Impacts -t -1 --setParameters r=1.0,lumi_mult=3.0 --freezeParameters r --redefineSignalPOIs tau_ratio -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root -m 125 --robustFit 1 --doInitialFit --name RatioMFakesMore --cminDefaultMinimizerTolerance 5.




#### 100 tests

foreach tolerance ( `seq 1 100` )
combine -M MultiDimFit -n _initialFit_RatioMFakesMore --algo singles --redefineSignalPOIs tau_ratio -t -1 --freezeParameters r --robustFit 1 --cminDefaultMinimizerTolerance $tolerance -m 125 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root --setParameters r=1.0,lumi_mult=3.0
end

>> combine -M MultiDimFit -n _initialFit_RatioMFakesMore --algo singles --redefineSignalPOIs tau_ratio -t -1 --freezeParameters r --robustFit 1 --cminDefaultMinimizerTolerance 55 -m 125 -d fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult2_fakes.root --setParameters r=1.0,lumi_mult=3.0
 <<< Combine >>> 
>>> including systematics
   Options for Robust Minimizer :: 
        Tolerance  55
        Strategy   0
        Type,Algo  Minuit2,Migrad
>>> method used is MultiDimFit
>>> random number generator seed is 123456
Set Default Value of Parameter r To : 1
Set Default Value of Parameter lumi_mult To : 3
Computing results starting from expected outcome (a-priori)
Error: minimization failed at tau_ratio = 1.02502
Error: minimization failed at tau_ratio = 0.989687

-- half with tolerance < 48-55 did not converge on 1.02502
   the other half failed on 0.989687

also

        Tolerance  33
        Strategy   0
        Type,Algo  Minuit2,Migrad
>>> method used is MultiDimFit
>>> random number generator seed is 123456
Set Default Value of Parameter r To : 1
Set Default Value of Parameter lumi_mult To : 3
Computing results starting from expected outcome (a-priori)
Error: minimization failed at tau_ratio = 1.02133
Error: minimization failed at tau_ratio = 0.999375

some fail at 0.999375

small tolerance just
Error: closed range without finding crossing.
Error: closed range without finding crossing.





#### el_sel in ttbar

text2workspace.py fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult3.txt

combine -M FitDiagnostics fit-stuff/datacard_ratio_four_channels_94v5_processing1_fit1_higgsCombine1_temp_mult3.root -t -1 --setParameters r=1.0,lumi_mult=2.0 --freezeParameters r,lumi_13TeV --redefineSignalPOIs tau_ratio --cminDefaultMinimizerTolerance 0.5


[WARNING]: Unable to determine uncertainties on all fit parameters in s+b fit. Have a look at https://cms-hcomb.gitbooks.io/combine/content/part3/nonstandard.html#fit-parameter-uncertainties for more information.

 --- FitDiagnostics ---
Best fit tau_ratio: 1  -1e+30/+0.017467  (68% CL)


TAUID                   shape     1.0          -            -            1.0          -            1.0          -            -            -            -            -            -            -            1.0          -            -            1.0          -            1.0          -            -            -            -            -            -            - 


[WARNING]: Unable to determine uncertainties on all fit parameters in s+b fit. Have a look at https://cms-hcomb.gitbooks.io/combine/content/part3/nonstandard.html#fit-parameter-uncertainties for more information.

 --- FitDiagnostics ---
Best fit tau_ratio: 1  -1e+30/+0.0188999  (68% CL)






# implementing the default shapes for processes without some systematics

a datacard with all tt modeling systematics:
fit-stuff/datacard_ratio_mu_94v3_processing1_mc_2.txt

cp fit-stuff/datacard_ratio_mu_94v3_processing1_mc_3_removed_autonorm.txt fit-stuff/datacard_ratio_mu_94v3_processing1_mc_3_testModeling_autonorm.txt

vim -p fit-stuff/datacard_ratio_mu_94v3_processing1_mc_3_testModeling_autonorm.txt fit-stuff/datacard_ratio_mu_94v3_processing1_mc_2.txt

text2workspace.py fit-stuff/datacard_ratio_mu_94v3_processing1_mc_3_testModeling_autonorm.txt

combineTool.py -M Impacts  -t -1 --expectSignal 1 --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_mu_94v3_processing1_mc_3_testModeling_autonorm.root -m 125 --robustFit 1 --doInitialFit          --name RatioMuShapes

-- with Frag uncertainty it strangely works!
   no! Frag was already there! but it is only in tt! strange
   lets add pdfs

let's try all uncertainties and ratio fit

cp fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_3_removed_autonorm.txt fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_3_testModeling_autonorm.txt





vim -p fit-stuff/datacard_ratio_mu_94v3_processing1_mc_3_testModeling_autonorm.txt fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_3_testModeling_autonorm.txt

text2workspace.py fit-stuff/datacard_ratio_mu_94v3_processing1_mc_3_testModeling_autonorm.txt
text2workspace.py fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_3_testModeling_autonorm.txt


combineCards.py mu=fit-stuff/datacard_ratio_mu_94v3_processing1_mc_3_testModeling_autonorm.txt elmu=fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_3_testModeling_autonorm.txt > fit-stuff/datacard_ratio_both_94v3_processing1_mc_3_testModeling_autonorm.txt

vim fit-stuff/datacard_ratio_both_94v3_processing1_mc_3_testModeling_autonorm.txt

text2workspace.py fit-stuff/datacard_ratio_both_94v3_processing1_mc_3_testModeling_autonorm.txt


combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu,tt_other --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_3_testModeling_autonorm.root -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu,tt_other --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_3_testModeling_autonorm.root -m 125 --robustFit 1 --doFits --parallel 5   --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu,tt_other --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_3_testModeling_autonorm.root -m 125 -o latest_toys_asimov_impacts_ratio_94v3_processing1_mc_3_testModeling_autonorm.json  --name RatioElMuShapes
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v3_processing1_mc_3_testModeling_autonorm.json -o latest_toys_asimov_impacts_ratio_94v3_processing1_mc_3_testModeling_autonorm

all ok!

and add lep IDs!
and correct bSF!

no LepSFs
   tau_ratio :    +1.000   -0.056/+0.061 (68%)

with LepSFs
   tau_ratio :    +1.000   -0.056/+0.062 (68%)

with bSF shape instead of 3% flat uncertainty
   tau_ratio :    +1.000   -0.062/+0.069 (68%)

damn! very large bSF uncertainty

with new TAUID
   tau_ratio :    +1.000   -0.063/+0.074 (68%)







# preliminary ratio fit in tt only, ntuples 2017 systematics

scp otoldaie@lxplus.cern.ch:~/work/public/CMSSW_10_3_3/src/UserCode/proc/jobsums/distrs//distrs_94v4_processing3_fit1.root fit-stuff/

cp fit-stuff/datacard_ratio_mu_94v3_processing1_mc_2_removed.txt   fit-stuff/datacard_ratio_mu_94v3_processing1_mc_3_removed.txt
cp fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2_removed.txt fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_3_removed.txt

cp fit-stuff/datacard_ratio_mu_94v3_processing1_mc_3_removed.txt   fit-stuff/datacard_ratio_mu_94v3_processing1_mc_3_removed_autonorm.txt
cp fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_3_removed.txt fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_3_removed_autonorm.txt

vim -p fit-stuff/datacard_ratio_mu_94v3_processing1_mc_3_removed_autonorm.txt fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_3_removed_autonorm.txt


text2workspace.py fit-stuff/datacard_ratio_mu_94v3_processing1_mc_3_removed_autonorm.txt
text2workspace.py fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_3_removed_autonorm.txt

remove them altogether
combineCards.py mu=fit-stuff/datacard_ratio_mu_94v3_processing1_mc_3_removed_autonorm.txt elmu=fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_3_removed_autonorm.txt > fit-stuff/datacard_ratio_both_94v3_processing1_mc_3_removed_autonorm.txt

text2workspace.py fit-stuff/datacard_ratio_both_94v3_processing1_mc_3_removed_autonorm.txt


dilep_norm              extArg                   1.         [0.8,1.2]
tau_ratio               extArg                   1.         [0.9,1.1]
rate_elmu               rateParam  elmu tt_elmu  (@0)    dilep_norm
rate_mutau              rateParam  mu   tt_mutau (@0*@1) dilep_norm,tau_ratio


combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu,tt_other --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_3_removed_autonorm.root -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu,tt_other --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_3_removed_autonorm.root -m 125 --robustFit 1 --doFits --parallel 5   --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu,tt_other --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_3_removed_autonorm.root -m 125 -o latest_toys_asimov_impacts_ratio_94v3_processing1_mc_3_removed_autonorm.json  --name RatioElMuShapes
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v3_processing1_mc_3_removed_autonorm.json -o latest_toys_asimov_impacts_ratio_94v3_processing1_mc_3_removed_autonorm

old tau ID SF:

   tau_ratio :    +1.000   -0.055/+0.059 (68%)

new:

   tau_ratio :    +1.000   -0.057/+0.065 (68%)






# preliminary ratio fit in tt only

shapes data_obs  mu_sel     fit-stuff/distrs_94v3_processing1_mc_1.root mu_sel/data/NOMINAL/mu_sel_data_NOMINAL_Mt_lep_met_c                  mu_sel/data/$SYSTEMATIC/mu_sel_data_$SYSTEMATIC_Mt_lep_met_c

text2workspace.py fit-stuff/datacard_ratio_mu_94v3_processing1_mc_1.txt
text2workspace.py fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_1.txt

combineCards.py mu=fit-stuff/datacard_ratio_mu_94v3_processing1_mc_1.txt elmu=fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_1.txt > fit-stuff/datacard_ratio_both_94v3_processing1_mc_1.txt

usual ratio:

dilep_norm              extArg                   1.         [0.8,1.2]
tau_ratio               extArg                   1.         [0.9,1.1]
rate_elmu               rateParam  elmu tt_elmu  (@0)    dilep_norm
rate_mutau              rateParam  mu   tt_mutau (@0*@1) dilep_norm,tau_ratio

with the issue of lj events I need to propagate this to tt_other in elmu:

dilep_norm              extArg                   1.         [0.8,1.2]
tau_ratio               extArg                   1.         [0.9,1.1]
rate_elmu               rateParam  elmu tt_elmu  (@0)    dilep_norm
rate_elmu_other         rateParam  elmu tt_other (@0)    dilep_norm
rate_mutau              rateParam  mu   tt_mutau (@0*@1) dilep_norm,tau_ratio

correct the filenames of the datafiles

RuntimeError: Error reading line 16 of file fit-stuff/datacard_ratio_both_94v3_processing1_mc_1.txt: Process tt_other is declared as signal in some bin and as background in some other bin

damn, with the lj error it must be a signal in elmu!!



text2workspace.py fit-stuff/datacard_ratio_both_94v3_processing1_mc_1.txt

separate fits:

combine -M MultiDimFit fit-stuff/datacard_ratio_mu_94v3_processing1_mc_1.root   --algo grid --points 100 -t -1 --expectSignal 1 --rMin 0.5 --rMax 1.5 --name MuShapes
combine -M MultiDimFit fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_1.root --algo grid --points 100 -t -1 --expectSignal 1 --rMin 0.5 --rMax 1.5 --name ElMuShapes

-- mu is ok, elmu does not converse with various errors

root -l higgsCombineMuShapes.MultiDimFit.mH120.root
limit->Draw("2*deltaNLL:r", "deltaNLL>0 && 2*deltaNLL<10", "L")

-- somehow the distribution is wider than usual

root -l higgsCombineElMuShapes.MultiDimFit.mH120.root
limit->Draw("2*deltaNLL:r", "deltaNLL>0 && 2*deltaNLL<10", "L")

-- not too bad actually, no jumps

made tt_other a signal there
similar errors, the NLL curve has jumps


impacts:

combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_mu_94v3_processing1_mc_1.root -m 125 --robustFit 1 --doInitialFit           --name MuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_mu_94v3_processing1_mc_1.root -m 125 --robustFit 1 --doFits --parallel 5    --name MuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_mu_94v3_processing1_mc_1.root -m 125 -o latest_toys_asimov_impacts_mu_94v3_processing1_mc_1.json  --name MuShapes
plotImpacts_my.py -i latest_toys_asimov_impacts_mu_94v3_processing1_mc_1.json -o latest_toys_asimov_impacts_mu_94v3_processing1_mc_1

plotImpacts.py -i latest_toys_asimov_impacts_mu_94v3_processing1_mc_1.json -o latest_toys_asimov_impacts_mu_94v3_processing1_mc_1

-- something is wrong, overall the uncertainty is huge, +-0.4?
   tau fakes are not constrained
   scale parameters are huge, Mf, Mr, Mfr, also some PDFs, Frag, Semilep etc
   PU somehow is huge

combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_1.root -m 125 --robustFit 1 --doInitialFit           --name ElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_1.root -m 125 --robustFit 1 --doFits --parallel 5    --name ElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_1.root -m 125 -o latest_toys_asimov_impacts_elmu_94v3_processing1_mc_1.json  --name ElMuShapes
plotImpacts.py -i latest_toys_asimov_impacts_elmu_94v3_processing1_mc_1.json -o latest_toys_asimov_impacts_elmu_94v3_processing1_mc_1

-- also weird, large JER, TES? what TES is doing here? etc


## checking syst variations

python mc_per_sys.py distrs/distrs_94v3_processing1_mc_1.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s PUUp,PUDown

-- more than 10%, but linear

python mc_per_sys.py distrs/distrs_94v3_processing1_mc_1.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s FragUp,FragDown
python mc_per_sys.py distrs/distrs_94v3_processing1_mc_1.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s SemilepBRUp,SemilepBRDown

Frag is way more than 10%
Semilep is asymmetric and large

python mc_per_sys.py distrs/distrs_94v3_processing1_mc_1.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s TESUp,TESDown

ok, but "down" is somewhat random

python mc_per_sys.py distrs/distrs_94v3_processing1_mc_1.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s JERUp,JERDown
python mc_per_sys.py distrs/distrs_94v3_processing1_mc_1.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s JESUp,JESDown

JER is random, often asymmetric
JES is somewhat more reasonable
both are small

python mc_per_sys.py distrs/distrs_94v3_processing1_mc_1.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s bSFUp,bSFDown

very smooth, linear, and small correction

python mc_per_sys.py distrs/distrs_94v3_processing1_mc_1.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s TOPPTUp,TOPPTDown

-- small reasonable effect



fit with only experimental systematics

combine -M MultiDimFit fit-stuff/datacard_ratio_mu_94v3_processing1_mc_1.root   --algo grid --points 100 -t -1 --expectSignal 1 --rMin 0.5 --rMax 1.5 --name MuShapes --freezeNuisanceGroup tt_th_pdf,tt_th_frag,tt_th_match

-- mu is ok, elmu does not converse with various errors

root -l higgsCombineMuShapes.MultiDimFit.mH120.root
limit->Draw("2*deltaNLL:r", "deltaNLL>0 && 2*deltaNLL<10", "L")

looks OK, though somewhat big?

combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_mu_94v3_processing1_mc_1.root -m 125 --robustFit 1 --doInitialFit         --freezeNuisanceGroup tt_th_pdf,tt_th_frag,tt_th_match  --name MuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_mu_94v3_processing1_mc_1.root -m 125 --robustFit 1 --doFits --parallel 5  --freezeNuisanceGroup tt_th_pdf,tt_th_frag,tt_th_match  --name MuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_mu_94v3_processing1_mc_1.root -m 125 -o latest_toys_asimov_impacts_mu_94v3_processing1_mc_1.json  --freezeNuisanceGroup tt_th_pdf,tt_th_frag,tt_th_match  --name MuShapes
plotImpacts.py -i latest_toys_asimov_impacts_mu_94v3_processing1_mc_1.json -o latest_toys_asimov_impacts_mu_94v3_processing1_mc_1

   r :    +1.000   -0.116/+0.133 (68%)

probably very large PU?
yep, PU is the first impact

combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_mu_94v3_processing1_mc_1.root -m 125 --robustFit 1 --doInitialFit   --freezeParameters PU  --freezeNuisanceGroup tt_th_pdf,tt_th_frag,tt_th_match  --name MuShapes

   r :    +1.000   -0.073/+0.084 (68%)

OK



## normalizations for PU and theoretical systematics

python syst_rates.py gstore_outdirs/94v3/TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v3_MC2017legacy_Fall17_TTTo2L2Nu*/*/*/*root

python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s PUUp,PUDown

-- (was) more than 10%, but linear
   ok now

python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s FragUp,FragDown
python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s SemilepBRUp,SemilepBRDown

was Frag is way more than 10%
    Semilep is asymmetric and large

ok, but SemilepBR is asymmetric??

python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s TESUp,TESDown

ok, but "down" is somewhat random

python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s JERUp,JERDown
python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s JESUp,JESDown

JER is random, often asymmetric
JES is somewhat more reasonable
both are small

python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s bSFUp,bSFDown

very smooth, linear, and small correction

python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s TOPPTUp,TOPPTDown


python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s PUUp,PUDown

-- more than 10%, but linear

python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s FragUp,FragDown
python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s SemilepBRUp,SemilepBRDown

Frag is way more than 10%
Semilep is asymmetric and large

python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s TESUp,TESDown

ok, but "down" is somewhat random

python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s JERUp,JERDown
python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s JESUp,JESDown

JER is random, often asymmetric
JES is somewhat more reasonable
both are small

python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s bSFUp,bSFDown

very smooth, linear, and small correction

python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_mutau -c mu_sel -d Mt_lep_met_c --y-range 0,2000 -r -s TOPPTUp,TOPPTDown



## and fit again

text2workspace.py fit-stuff/datacard_ratio_mu_94v3_processing1_mc_2.txt
text2workspace.py fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2.txt

combine -M MultiDimFit fit-stuff/datacard_ratio_mu_94v3_processing1_mc_2.root   --algo grid --points 100 -t -1 --expectSignal 1 --rMin 0.5 --rMax 1.5 --name MuShapes

-- smooth line, but again large variation

   fixed PU normalization: same?


combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_mu_94v3_processing1_mc_2.root -m 125 --robustFit 1 --doInitialFit           --name MuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_mu_94v3_processing1_mc_2.root -m 125 --robustFit 1 --doFits --parallel 5    --name MuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_mu_94v3_processing1_mc_2.root -m 125 -o latest_toys_asimov_impacts_mu_94v3_processing1_mc_2.json  --name MuShapes
plotImpacts.py -i latest_toys_asimov_impacts_mu_94v3_processing1_mc_2.json -o latest_toys_asimov_impacts_mu_94v3_processing1_mc_2

   r :    +1.000   -0.208/+0.300 (68%)

-- yep! the normalization in PU again,
   plus a bunch of PDFs are off

   fixed PU normalization:

   r :    +1.000   -0.208/+0.300 (68%)

   Pu looks exactly the same!

rechecked, reproduced the workspace:

   r :    +1.000   -0.139/+0.301 (68%)

ok!

now, 4 strange PDF-s 1,2,3,4
and others are also strange


check elmu

combine -M MultiDimFit fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2.root --algo grid --points 100 -t -1 --expectSignal 1 --rMin 0.5 --rMax 1.5 --name ElMuShapes

-- every point has a problem with the minimum
   but NLL is smooth, symetric, somewhat narrower than mutau

combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2.root -m 125 --robustFit 1 --doInitialFit           --name ElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2.root -m 125 --robustFit 1 --doFits --parallel 5    --name ElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2.root -m 125 -o latest_toys_asimov_impacts_elmu_94v3_processing1_mc_2.json  --name ElMuShapes
plotImpacts.py -i latest_toys_asimov_impacts_elmu_94v3_processing1_mc_2.json -o latest_toys_asimov_impacts_elmu_94v3_processing1_mc_2

--- ????
    PDFs are small
    TOPPT is weirdly large, 15%
    LEPmuTRG too
    JER, JES, Mr, Peterson, Mfr, PU


python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_elmu -c tt_elmu -d Mt_lep_met_c  -r -s JERUp,JERDown
python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_elmu -c tt_elmu -d Mt_lep_met_c  -r -s JESUp,JESDown

-- negligible variations

python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_other -c tt_elmu -d Mt_lep_met_c  -r -s JERUp,JERDown
python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_other -c tt_elmu -d Mt_lep_met_c  -r -s JESUp,JESDown

same

python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_other -c tt_elmu -d Mt_lep_met_c  -r -s PUUp,PUDown
python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_other -c tt_elmu -d Mt_lep_met_c  -r -s MrUp,MrDown
python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_other -c tt_elmu -d Mt_lep_met_c  -r -s MfrUp,MfrDown
python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_other -c tt_elmu -d Mt_lep_met_c  -r -s PetersonUp,PetersonDown
python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_other -c tt_elmu -d Mt_lep_met_c  -r -s TOPPTUp,TOPPTDown

-- all very small and reasonable

python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_other -c tt_elmu -d Mt_lep_met_c  -r -s LEPmuTRGUp,LEPmuTRGDown

-- both way off

python mc_per_sys.py distrs/distrs_94v3_processing1_mc_2.root -p tt_other -c tt_elmu -d Mt_lep_met_c  -r -s LEPmuIDUp,LEPmuIDDown

-- same behavior

combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2.root -m 125 --robustFit 1 --doInitialFit           --name ElMuShapes --freezeParameters LEPmuID,LEPmuTRG
combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2.root -m 125 --robustFit 1 --doFits --parallel 5    --name ElMuShapes --freezeParameters LEPmuID,LEPmuTRG
combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2.root -m 125 -o latest_toys_asimov_impacts_elmu_94v3_processing1_mc_2.json  --name ElMuShapes --freezeParameters LEPmuID,LEPmuTRG
plotImpacts.py -i latest_toys_asimov_impacts_elmu_94v3_processing1_mc_2.json -o latest_toys_asimov_impacts_elmu_94v3_processing1_mc_2

   r :    +1.000   -0.146/+0.140 (68%)

still weird toppt and others???
maybe that's because "other" is not signal?

with it as a signal:

   r :    +1.000   -0.120/+0.224 (68%)

damn


maybe try without pdfs?

combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2.root -m 125 --robustFit 1 --doInitialFit           --name ElMuShapes  --freezeNuisanceGroup tt_th_pdf
combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2.root -m 125 --robustFit 1 --doFits --parallel 5    --name ElMuShapes  --freezeNuisanceGroup tt_th_pdf
combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2.root -m 125 -o latest_toys_asimov_impacts_elmu_94v3_processing1_mc_2.json  --name ElMuShapes  --freezeNuisanceGroup tt_th_pdf
plotImpacts.py -i latest_toys_asimov_impacts_elmu_94v3_processing1_mc_2.json -o latest_toys_asimov_impacts_elmu_94v3_processing1_mc_2

   r :    +1.000   -0.072/+0.050 (68%)

LEPmu are weird, others are OK
-- they are incorrectly calculated in stage2!!!

no pdf scan:

combine -M MultiDimFit fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2.root --algo grid --points 100 -t -1 --expectSignal 1 --rMin 0.5 --rMax 1.5 --name ElMuShapes  --freezeNuisanceGroup tt_th_pdf


combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2.root -m 125 --robustFit 1 --doInitialFit           --name ElMuShapes  --freezeNuisanceGroup tt_th_pdf --freezeParameters LEPmuTRG,LEPmuID
combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2.root -m 125 --robustFit 1 --doFits --parallel 5    --name ElMuShapes  --freezeNuisanceGroup tt_th_pdf --freezeParameters LEPmuTRG,LEPmuID
combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2.root -m 125 -o latest_toys_asimov_impacts_elmu_94v3_processing1_mc_2.json  --name ElMuShapes  --freezeNuisanceGroup tt_th_pdf --freezeParameters LEPmuTRG,LEPmuID
plotImpacts.py -i latest_toys_asimov_impacts_elmu_94v3_processing1_mc_2.json -o latest_toys_asimov_impacts_elmu_94v3_processing1_mc_2

   r :    +1.000   -0.045/+0.048 (68%)

ok

combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2_removed.root -m 125 --robustFit 1 --doInitialFit           --name ElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2_removed.root -m 125 --robustFit 1 --doFits --parallel 5    --name ElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2_removed.root -m 125 -o latest_toys_asimov_impacts_elmu_94v3_processing1_mc_2.json  --name ElMuShapes
plotImpacts.py -i latest_toys_asimov_impacts_elmu_94v3_processing1_mc_2.json -o latest_toys_asimov_impacts_elmu_94v3_processing1_mc_2

   r :    +1.000   -0.045/+0.048 (68%)

-- impacts look small here

combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_mu_94v3_processing1_mc_2_removed.root -m 125 --robustFit 1 --doInitialFit           --name ElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_mu_94v3_processing1_mc_2_removed.root -m 125 --robustFit 1 --doFits --parallel 5    --name ElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_mu_94v3_processing1_mc_2_removed.root -m 125 -o latest_toys_asimov_impacts_mu_94v3_processing1_mc_2.json  --name ElMuShapes
plotImpacts.py -i latest_toys_asimov_impacts_mu_94v3_processing1_mc_2.json -o latest_toys_asimov_impacts_mu_94v3_processing1_mc_2

   r :    +1.000   -0.073/+0.088 (68%)

-- they look natural, like usual
   tau ID at 5 %

remake elmu with an inclusive tt_elmu



## inclusive elmu, noratio both

text2workspace.py fit-stuff/datacard_ratio_both_94v3_processing1_mc_2_removed.txt
text2workspace.py fit-stuff/datacard_ratio_both_94v3_processing1_mc_2_removed_noratio.txt


combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2_removed_noratio.root -m 125 --robustFit 1 --doInitialFit           --name ElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2_removed_noratio.root -m 125 --robustFit 1 --doFits --parallel 5    --name ElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1  --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2_removed_noratio.root -m 125 -o latest_toys_asimov_impacts_both_94v3_processing1_mc_2_noratio.json  --name ElMuShapes
plotImpacts.py -i latest_toys_asimov_impacts_both_94v3_processing1_mc_2_noratio.json -o latest_toys_asimov_impacts_both_94v3_processing1_mc_2_noratio

-- fakes are the largest
   tau ID is constrained

combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0  -t -1 -d ttxsec/v27dilep2_ratio_6_100fb_all.root -m 125 --robustFit 1 --doInitialFit                      -n RatioAllShapesExpect6noSV_100fb

combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0  -t -1 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2_removed.root -m 125 --robustFit 1 --doInitialFit           --name ElMuShapes
combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0  -t -1 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2_removed.root -m 125 --robustFit 1 --doFits --parallel 5    --name ElMuShapes
combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0  -t -1 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2_removed.root -m 125 -o latest_toys_asimov_impacts_both_94v3_processing1_mc_2.json  --name ElMuShapes
plotImpacts.py -i latest_toys_asimov_impacts_both_94v3_processing1_mc_2.json -o latest_toys_asimov_impacts_both_94v3_processing1_mc_2

   tau_ratio :    +1.000   -1000000000000000019884624838656.000/+1000000000000000019884624838656.000 (68%)

Error: minimization failed at tau_ratio = 6.25e+27
WARNING: underflow to -1.16212e+32 in pdf_binmu_obsOnly for bin 0, weight 2791.86
[#0] ERROR:Eval -- RooAbsReal::logEvalError(mu) evaluation error, 

tau_ratio is defined [0.9, 1.1] ???????????!!!!

dilep_norm              extArg                   1.         [0.8,1.2]
tau_ratio               extArg                   1.         [0.9,1.1]
rate_elmu               rateParam  elmu tt_elmu  (@0)    dilep_norm
rate_mutau              rateParam  mu   tt_mutau (@0*@1) dilep_norm,tau_ratio






## ratio fits

without pdfs and LEPmu (LEPel are not in!)

combineCards.py mu=fit-stuff/datacard_ratio_mu_94v3_processing1_mc_2.txt elmu=fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2.txt > fit-stuff/datacard_ratio_both_94v3_processing1_mc_2.txt

with the issue of lj events I need to propagate this to tt_other in elmu:

dilep_norm              extArg                   1.         [0.8,1.2]
tau_ratio               extArg                   1.         [0.9,1.1]
rate_elmu               rateParam  elmu tt_elmu  (@0)    dilep_norm
rate_elmu_other         rateParam  elmu tt_other (@0)    dilep_norm
rate_mutau              rateParam  mu   tt_mutau (@0*@1) dilep_norm,tau_ratio

tt_other is set to 6, background
it does not matter, because we redefine the signal for ratio anyway

text2workspace.py fit-stuff/datacard_ratio_both_94v3_processing1_mc_2.txt



combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu,tt_other,LEPmuTRG,LEPmuID --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2.root -m 125 --robustFit 1 --doInitialFit           --name RatioElMuShapes   --freezeNuisanceGroup tt_th_pdf
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu,tt_other,LEPmuTRG,LEPmuID --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2.root -m 125 --robustFit 1 --doFits --parallel 5    --name RatioElMuShapes   --freezeNuisanceGroup tt_th_pdf
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu,tt_other,LEPmuTRG,LEPmuID --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2.root -m 125 -o latest_toys_asimov_impacts_ratio_94v3_processing1_mc_2.json  --name RatioElMuShapes   --freezeNuisanceGroup tt_th_pdf
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v3_processing1_mc_2.json -o latest_toys_asimov_impacts_ratio_94v3_processing1_mc_2



combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu,tt_other --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2.root -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu,tt_other --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2.root -m 125 --robustFit 1 --doFits --parallel 5   --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu,tt_other --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2.root -m 125 -o latest_toys_asimov_impacts_ratio_94v3_processing1_mc_2.json  --name RatioElMuShapes
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v3_processing1_mc_2.json -o latest_toys_asimov_impacts_ratio_94v3_processing1_mc_2



no PDF uncertainties:

cp fit-stuff/datacard_ratio_mu_94v3_processing1_mc_2.txt   fit-stuff/datacard_ratio_mu_94v3_processing1_mc_2_removed.txt
cp fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2.txt fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2_removed.txt

text2workspace.py fit-stuff/datacard_ratio_mu_94v3_processing1_mc_2_removed.txt
text2workspace.py fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2_removed.txt


remove them altogether
combineCards.py mu=fit-stuff/datacard_ratio_mu_94v3_processing1_mc_2_removed.txt elmu=fit-stuff/datacard_ratio_elmu_94v3_processing1_mc_2_removed.txt > fit-stuff/datacard_ratio_both_94v3_processing1_mc_2_removed.txt

text2workspace.py fit-stuff/datacard_ratio_both_94v3_processing1_mc_2_removed.txt


combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu,tt_other --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2_removed.root -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu,tt_other --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2_removed.root -m 125 --robustFit 1 --doFits --parallel 5   --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu,tt_other --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2_removed.root -m 125 -o latest_toys_asimov_impacts_ratio_94v3_processing1_mc_2_removed.json  --name RatioElMuShapes
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v3_processing1_mc_2_removed.json -o latest_toys_asimov_impacts_ratio_94v3_processing1_mc_2_removed

   tau_ratio :    +1.000   -1000000000000000019884624838656.000/+1000000000000000019884624838656.000 (68%)

something is totally wrong

-- on NCG it is fine!
   tau_ratio :    +1.000   -0.060/+0.065 (68%)

and the figure looks fine



just signal:

combineTool.py -M Impacts  -t -1 --expectSignal 1 --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2_removed.root -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes

   r :    +1.000   -0.149/+0.139 (68%)

-- something is bad

combineTool.py -M Impacts  -t -1 --expectSignal 1 --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2.root -m 125 --robustFit 1 --doInitialFit           --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2.root -m 125 --robustFit 1 --doFits --parallel 5    --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2.root -m 125 -o latest_toys_asimov_impacts_ratio_94v3_processing1_mc_2.json  --name RatioElMuShapes
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v3_processing1_mc_2.json -o latest_toys_asimov_impacts_ratio_94v3_processing1_mc_2

   r :    +1.000   -0.207/+0.161 (68%)

combineTool.py -M Impacts  -t -1 --expectSignal 1 --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2_removed.root -m 125 --robustFit 1 --doInitialFit           --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2_removed.root -m 125 --robustFit 1 --doFits --parallel 5    --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --expectSignal 1 --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2_removed.root -m 125 -o latest_toys_asimov_impacts_ratio_94v3_processing1_mc_2.json  --name RatioElMuShapes
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v3_processing1_mc_2.json -o latest_toys_asimov_impacts_ratio_94v3_processing1_mc_2

   r :    +1.000   -0.149/+0.139 (68%)

-- all elmu impacts propagated, TOPPT about 7%, PU, Mr, JER, Mfr, JES 
   why are they large in elmu???


oh! correct ratio freeze

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6_100fb_all.root -m 125 --robustFit 1 --doInitialFit                      -n RatioAllShapesExpect6noSV_100fb


combineTool.py -M Impacts  -t -1 --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2_removed.root -m 125 --robustFit 1 --doInitialFit          --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2_removed.root -m 125 --robustFit 1 --doFits --parallel 5   --name RatioElMuShapes
combineTool.py -M Impacts  -t -1 --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_2_removed.root -m 125 -o latest_toys_asimov_impacts_ratio_94v3_processing1_mc_2_removed.json  --name RatioElMuShapes
plotImpacts.py -i latest_toys_asimov_impacts_ratio_94v3_processing1_mc_2_removed.json -o latest_toys_asimov_impacts_ratio_94v3_processing1_mc_2_removed

   tau_ratio :    +1.000   -1000000000000000019884624838656.000/+1000000000000000019884624838656.000 (68%)
   tau_ratio :    +1.000   -1000000000000000019884624838656.000/+1000000000000000019884624838656.000 (68%)

same crap




combine -M MultiDimFit ttxsec/fit-stuff/ratio_both_1.txt --algo grid --points 100 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu --rMin 0.5 --rMax 1.5 --name RatioElMuShapes

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/datacard_AN_v2_mu.root -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/datacard_AN_v2_mu.root -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/datacard_AN_v2_mu.root -m 125 -o latest_mu_toys_asimov_impacts.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts.json -o latest_mu_toys_asimov_impacts

to these:

combine -M MultiDimFit fit-stuff/datacard_ratio_both_94v3_processing1_mc_1.root --algo grid --points 100 -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu,tt_other --rMin 0.5 --rMax 1.5 --name RatioElMuShapes

-- the fit crashes everywhere

root -l higgsCombineRatioElMuShapes.MultiDimFit.mH120.root
limit->Draw("2*deltaNLL:r", "deltaNLL>0 && 2*deltaNLL<10", "L")


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu,tt_other --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_1.root -m 125 --robustFit 1 --doInitialFit           --name RatioElMuShapes
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu,tt_other --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_1.root -m 125 --robustFit 1 --doFits --parallel 5    --name RatioElMuShapes
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts  -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters tt_mutau,tt_elmu,tt_other --rMin 0.5 --rMax 1.5 -d fit-stuff/datacard_ratio_both_94v3_processing1_mc_1.root -m 125 -o latest_toys_asimov_impacts_ratio_94v3_processing1_mc_1.json  --name RatioElMuShapes
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_toys_asimov_impacts_ratio_94v3_processing1_mc_1.json -o latest_toys_asimov_impacts_ratio_94v3_processing1_mc_1







# the isolation parameters in genuine taus and fakes

generator ID of the reco tau

python sumup_ttree_draw.py "tau_matching_gen[0]" --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2" --output test_tau_gen_id_tt_dilep.root   --histo-name tau_gen_id_tt_dilep   gstore_outdirs/94v2/TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTTo2L2Nu/191003_153054/0000/*root   &

python sumup_ttree_draw.py "tau_matching_gen[0]" --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2" --output test_tau_gen_id_tt_semilep.root --histo-name tau_gen_id_tt_semilep gstore_outdirs/94v2/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTToSemiLeptonic_v2/191003_153243/0000/MC2017legacy_Fall17_TTToSemiLeptonic_v2_*root   &

hadd -f test_all_tau_gen_id.root test_tau_gen_id_*root
root -l test_all_tau_gen_id.root

tau_gen_id_tt_dilep  ->Scale(1./tau_gen_id_tt_dilep  ->Integral())
tau_gen_id_tt_semilep->Scale(1./tau_gen_id_tt_semilep->Integral())

tau_gen_id_tt_semilep->SetLineColor(kRed)

tau_gen_id_tt_dilep->Draw()
tau_gen_id_tt_semilep->Draw("same")


WARNING: strangely large number of 5, 6 gen id in dileptons!

2, 3 are true taus (1ch and 3ch)

5 - w
6 - b

add target requirements: OS and SV sign > 3.
and plot all iso params for 3 types of tau: genuine, w, b

check iso parameters that are != 0

((TTree*) ntupler->Get("reduced_ttree"))->Scan(" tau_n_isolationCands[0]: tau_n_isolationChargedHadrCands[0]: tau_n_isolationGammaCands[0]: tau_n_isolationNeutrHadrCands[0]: tau_n_signalCands[0]: tau_n_signalChargedHadrCands[0]: tau_n_signalGammaCands[0]: tau_n_signalNeutrHadrCands[0]")

tau_n_signalNeutrHadrCands seems = 0

python sumup_ttree_draw.py "tau_matching_gen[0]" --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3." --output test_tau_gen_id_tt_dilep_full_sel.root   --histo-name tau_gen_id_tt_dilep_full_sel   gstore_outdirs/94v2/TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTTo2L2Nu/191003_153054/0000/*root

WARNING: 15k events, mostly 3, still some 5 and 6 !!!


genuine taus:

python sumup_ttree_draw.py "tau_n_isolationCands[0]"            --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 3" --output test_tt_dilep_full_sel_isoparams_tau_n_isolationCands.root             --histo-name  tt_dilep_full_sel_isoparams_tau_n_isolationCands             gstore_outdirs/94v2/TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTTo2L2Nu/191003_153054/0000/*root   &
python sumup_ttree_draw.py "tau_n_isolationChargedHadrCands[0]" --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 3" --output test_tt_dilep_full_sel_isoparams_tau_n_isolationChargedHadrCands.root  --histo-name  tt_dilep_full_sel_isoparams_tau_n_isolationChargedHadrCand   gstore_outdirs/94v2/TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTTo2L2Nu/191003_153054/0000/*root   &
python sumup_ttree_draw.py "tau_n_isolationGammaCands[0]"       --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 3" --output test_tt_dilep_full_sel_isoparams_tau_n_isolationGammaCands.root        --histo-name  tt_dilep_full_sel_isoparams_tau_n_isolationGammaCands        gstore_outdirs/94v2/TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTTo2L2Nu/191003_153054/0000/*root   &
python sumup_ttree_draw.py "tau_n_isolationNeutrHadrCands[0]"   --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 3" --output test_tt_dilep_full_sel_isoparams_tau_n_isolationNeutrHadrCands.root    --histo-name  tt_dilep_full_sel_isoparams_tau_n_isolationNeutrHadrCands    gstore_outdirs/94v2/TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTTo2L2Nu/191003_153054/0000/*root   &

python sumup_ttree_draw.py "tau_n_signalCands[0]"            --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 3" --output test_tt_dilep_full_sel_isoparams_tau_n_signalCands.root             --histo-name  tt_dilep_full_sel_isoparams_tau_n_signalCands             gstore_outdirs/94v2/TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTTo2L2Nu/191003_153054/0000/*root   &
python sumup_ttree_draw.py "tau_n_signalChargedHadrCands[0]" --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 3" --output test_tt_dilep_full_sel_isoparams_tau_n_signalChargedHadrCands.root  --histo-name  tt_dilep_full_sel_isoparams_tau_n_signalChargedHadrCand   gstore_outdirs/94v2/TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTTo2L2Nu/191003_153054/0000/*root   &
python sumup_ttree_draw.py "tau_n_signalGammaCands[0]"       --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 3" --output test_tt_dilep_full_sel_isoparams_tau_n_signalGammaCands.root        --histo-name  tt_dilep_full_sel_isoparams_tau_n_signalGammaCands        gstore_outdirs/94v2/TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTTo2L2Nu/191003_153054/0000/*root   &
python sumup_ttree_draw.py "tau_n_signalNeutrHadrCands[0]"   --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 3" --output test_tt_dilep_full_sel_isoparams_tau_n_signalNeutrHadrCands.root    --histo-name  tt_dilep_full_sel_isoparams_tau_n_signalNeutrHadrCands    gstore_outdirs/94v2/TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTTo2L2Nu/191003_153054/0000/*root   &


w fakes

python sumup_ttree_draw.py "tau_n_isolationCands[0]"            --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 5" --output test_tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationCands.root             --histo-name  tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationCands             gstore_outdirs/94v2/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTToSemiLeptonic_v2/191003_153243/0000/MC2017legacy_Fall17_TTToSemiLeptonic_v2_*root   &
python sumup_ttree_draw.py "tau_n_isolationChargedHadrCands[0]" --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 5" --output test_tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationChargedHadrCands.root  --histo-name  tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationChargedHadrCand   gstore_outdirs/94v2/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTToSemiLeptonic_v2/191003_153243/0000/MC2017legacy_Fall17_TTToSemiLeptonic_v2_*root   &
python sumup_ttree_draw.py "tau_n_isolationGammaCands[0]"       --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 5" --output test_tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationGammaCands.root        --histo-name  tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationGammaCands        gstore_outdirs/94v2/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTToSemiLeptonic_v2/191003_153243/0000/MC2017legacy_Fall17_TTToSemiLeptonic_v2_*root   &
python sumup_ttree_draw.py "tau_n_isolationNeutrHadrCands[0]"   --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 5" --output test_tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationNeutrHadrCands.root    --histo-name  tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationNeutrHadrCands    gstore_outdirs/94v2/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTToSemiLeptonic_v2/191003_153243/0000/MC2017legacy_Fall17_TTToSemiLeptonic_v2_*root   &

python sumup_ttree_draw.py "tau_n_signalCands[0]"            --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 5" --output test_tt_dilep_full_sel_isoparams_wfakes_tau_n_signalCands.root             --histo-name  tt_dilep_full_sel_isoparams_wfakes_tau_n_signalCands             gstore_outdirs/94v2/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTToSemiLeptonic_v2/191003_153243/0000/MC2017legacy_Fall17_TTToSemiLeptonic_v2_*root   &
python sumup_ttree_draw.py "tau_n_signalChargedHadrCands[0]" --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 5" --output test_tt_dilep_full_sel_isoparams_wfakes_tau_n_signalChargedHadrCands.root  --histo-name  tt_dilep_full_sel_isoparams_wfakes_tau_n_signalChargedHadrCand   gstore_outdirs/94v2/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTToSemiLeptonic_v2/191003_153243/0000/MC2017legacy_Fall17_TTToSemiLeptonic_v2_*root   &
python sumup_ttree_draw.py "tau_n_signalGammaCands[0]"       --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 5" --output test_tt_dilep_full_sel_isoparams_wfakes_tau_n_signalGammaCands.root        --histo-name  tt_dilep_full_sel_isoparams_wfakes_tau_n_signalGammaCands        gstore_outdirs/94v2/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTToSemiLeptonic_v2/191003_153243/0000/MC2017legacy_Fall17_TTToSemiLeptonic_v2_*root   &
python sumup_ttree_draw.py "tau_n_signalNeutrHadrCands[0]"   --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 5" --output test_tt_dilep_full_sel_isoparams_wfakes_tau_n_signalNeutrHadrCands.root    --histo-name  tt_dilep_full_sel_isoparams_wfakes_tau_n_signalNeutrHadrCands    gstore_outdirs/94v2/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTToSemiLeptonic_v2/191003_153243/0000/MC2017legacy_Fall17_TTToSemiLeptonic_v2_*root   &


b fakes

python sumup_ttree_draw.py "tau_n_isolationCands[0]"            --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 6" --output test_tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationCands.root             --histo-name  tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationCands             gstore_outdirs/94v2/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTToSemiLeptonic_v2/191003_153243/0000/MC2017legacy_Fall17_TTToSemiLeptonic_v2_*root   &
python sumup_ttree_draw.py "tau_n_isolationChargedHadrCands[0]" --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 6" --output test_tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationChargedHadrCands.root  --histo-name  tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationChargedHadrCand   gstore_outdirs/94v2/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTToSemiLeptonic_v2/191003_153243/0000/MC2017legacy_Fall17_TTToSemiLeptonic_v2_*root   &
python sumup_ttree_draw.py "tau_n_isolationGammaCands[0]"       --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 6" --output test_tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationGammaCands.root        --histo-name  tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationGammaCands        gstore_outdirs/94v2/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTToSemiLeptonic_v2/191003_153243/0000/MC2017legacy_Fall17_TTToSemiLeptonic_v2_*root   &
python sumup_ttree_draw.py "tau_n_isolationNeutrHadrCands[0]"   --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 6" --output test_tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationNeutrHadrCands.root    --histo-name  tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationNeutrHadrCands    gstore_outdirs/94v2/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTToSemiLeptonic_v2/191003_153243/0000/MC2017legacy_Fall17_TTToSemiLeptonic_v2_*root   &

python sumup_ttree_draw.py "tau_n_signalCands[0]"            --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 6" --output test_tt_dilep_full_sel_isoparams_bfakes_tau_n_signalCands.root             --histo-name  tt_dilep_full_sel_isoparams_bfakes_tau_n_signalCands             gstore_outdirs/94v2/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTToSemiLeptonic_v2/191003_153243/0000/MC2017legacy_Fall17_TTToSemiLeptonic_v2_*root   &
python sumup_ttree_draw.py "tau_n_signalChargedHadrCands[0]" --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 6" --output test_tt_dilep_full_sel_isoparams_bfakes_tau_n_signalChargedHadrCands.root  --histo-name  tt_dilep_full_sel_isoparams_bfakes_tau_n_signalChargedHadrCand   gstore_outdirs/94v2/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTToSemiLeptonic_v2/191003_153243/0000/MC2017legacy_Fall17_TTToSemiLeptonic_v2_*root   &
python sumup_ttree_draw.py "tau_n_signalGammaCands[0]"       --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 6" --output test_tt_dilep_full_sel_isoparams_bfakes_tau_n_signalGammaCands.root        --histo-name  tt_dilep_full_sel_isoparams_bfakes_tau_n_signalGammaCands        gstore_outdirs/94v2/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTToSemiLeptonic_v2/191003_153243/0000/MC2017legacy_Fall17_TTToSemiLeptonic_v2_*root   &
python sumup_ttree_draw.py "tau_n_signalNeutrHadrCands[0]"   --histo-range 20,-10,10   --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && (HLT_el || HLT_mu) && lep_matched_HLT[0] && tau_IDlev[0]>2 && tau_id[0]*lep_id[0] < 0 && tau_refited_index[0]>-1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 3. && abs(tau_matching_gen[0]) == 6" --output test_tt_dilep_full_sel_isoparams_bfakes_tau_n_signalNeutrHadrCands.root    --histo-name  tt_dilep_full_sel_isoparams_bfakes_tau_n_signalNeutrHadrCands    gstore_outdirs/94v2/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/Ntupler_94v2_MC2017legacy_Fall17_TTToSemiLeptonic_v2/191003_153243/0000/MC2017legacy_Fall17_TTToSemiLeptonic_v2_*root   &


hadd -f test_tt_dilep_full_sel_all_isoparams.root test_tt_dilep_full_sel_isoparams_*root
root -l test_tt_dilep_full_sel_all_isoparams.root

tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationCands             ->SetLineColor(kGreen)
tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationChargedHadrCand   ->SetLineColor(kGreen)
tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationGammaCands        ->SetLineColor(kGreen)
tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationNeutrHadrCands    ->SetLineColor(kGreen)
tt_dilep_full_sel_isoparams_bfakes_tau_n_signalCands                ->SetLineColor(kGreen)
tt_dilep_full_sel_isoparams_bfakes_tau_n_signalChargedHadrCand      ->SetLineColor(kGreen)
tt_dilep_full_sel_isoparams_bfakes_tau_n_signalGammaCands           ->SetLineColor(kGreen)
tt_dilep_full_sel_isoparams_bfakes_tau_n_signalNeutrHadrCands       ->SetLineColor(kGreen)

tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationCands             ->SetLineColor(kRed)
tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationChargedHadrCand   ->SetLineColor(kRed)
tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationGammaCands        ->SetLineColor(kRed)
tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationNeutrHadrCands    ->SetLineColor(kRed)
tt_dilep_full_sel_isoparams_wfakes_tau_n_signalCands                ->SetLineColor(kRed)
tt_dilep_full_sel_isoparams_wfakes_tau_n_signalChargedHadrCand      ->SetLineColor(kRed)
tt_dilep_full_sel_isoparams_wfakes_tau_n_signalGammaCands           ->SetLineColor(kRed)
tt_dilep_full_sel_isoparams_wfakes_tau_n_signalNeutrHadrCands       ->SetLineColor(kRed)

tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationCands             ->Scale(1./tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationCands           ->Integral())
tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationChargedHadrCand   ->Scale(1./tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationChargedHadrCand ->Integral())
tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationGammaCands        ->Scale(1./tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationGammaCands      ->Integral())
tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationNeutrHadrCands    ->Scale(1./tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationNeutrHadrCands  ->Integral())
tt_dilep_full_sel_isoparams_wfakes_tau_n_signalCands                ->Scale(1./tt_dilep_full_sel_isoparams_wfakes_tau_n_signalCands              ->Integral())
tt_dilep_full_sel_isoparams_wfakes_tau_n_signalChargedHadrCand      ->Scale(1./tt_dilep_full_sel_isoparams_wfakes_tau_n_signalChargedHadrCand    ->Integral())
tt_dilep_full_sel_isoparams_wfakes_tau_n_signalGammaCands           ->Scale(1./tt_dilep_full_sel_isoparams_wfakes_tau_n_signalGammaCands         ->Integral())
tt_dilep_full_sel_isoparams_wfakes_tau_n_signalNeutrHadrCands       ->Scale(1./tt_dilep_full_sel_isoparams_wfakes_tau_n_signalNeutrHadrCands     ->Integral())

tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationCands             ->Scale(1./tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationCands           ->Integral())
tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationChargedHadrCand   ->Scale(1./tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationChargedHadrCand ->Integral())
tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationGammaCands        ->Scale(1./tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationGammaCands      ->Integral())
tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationNeutrHadrCands    ->Scale(1./tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationNeutrHadrCands  ->Integral())
tt_dilep_full_sel_isoparams_bfakes_tau_n_signalCands                ->Scale(1./tt_dilep_full_sel_isoparams_bfakes_tau_n_signalCands              ->Integral())
tt_dilep_full_sel_isoparams_bfakes_tau_n_signalChargedHadrCand      ->Scale(1./tt_dilep_full_sel_isoparams_bfakes_tau_n_signalChargedHadrCand    ->Integral())
tt_dilep_full_sel_isoparams_bfakes_tau_n_signalGammaCands           ->Scale(1./tt_dilep_full_sel_isoparams_bfakes_tau_n_signalGammaCands         ->Integral())
tt_dilep_full_sel_isoparams_bfakes_tau_n_signalNeutrHadrCands       ->Scale(1./tt_dilep_full_sel_isoparams_bfakes_tau_n_signalNeutrHadrCands     ->Integral())

tt_dilep_full_sel_isoparams_tau_n_isolationCands            ->Scale(1./tt_dilep_full_sel_isoparams_tau_n_isolationCands           ->Integral())
tt_dilep_full_sel_isoparams_tau_n_isolationChargedHadrCand  ->Scale(1./tt_dilep_full_sel_isoparams_tau_n_isolationChargedHadrCand ->Integral())
tt_dilep_full_sel_isoparams_tau_n_isolationGammaCands       ->Scale(1./tt_dilep_full_sel_isoparams_tau_n_isolationGammaCands      ->Integral())
tt_dilep_full_sel_isoparams_tau_n_isolationNeutrHadrCands   ->Scale(1./tt_dilep_full_sel_isoparams_tau_n_isolationNeutrHadrCands  ->Integral())
tt_dilep_full_sel_isoparams_tau_n_signalCands               ->Scale(1./tt_dilep_full_sel_isoparams_tau_n_signalCands              ->Integral())
tt_dilep_full_sel_isoparams_tau_n_signalChargedHadrCand     ->Scale(1./tt_dilep_full_sel_isoparams_tau_n_signalChargedHadrCand    ->Integral())
tt_dilep_full_sel_isoparams_tau_n_signalGammaCands          ->Scale(1./tt_dilep_full_sel_isoparams_tau_n_signalGammaCands         ->Integral())
tt_dilep_full_sel_isoparams_tau_n_signalNeutrHadrCands      ->Scale(1./tt_dilep_full_sel_isoparams_tau_n_signalNeutrHadrCands     ->Integral())


       tt_dilep_full_sel_isoparams_tau_n_isolationCands     ->Draw()
tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationCands     ->Draw("same")
tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationCands     ->Draw("same")
c1->SaveAs("isoparams_isolationCands.png")

       tt_dilep_full_sel_isoparams_tau_n_isolationChargedHadrCand     ->Draw()
tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationChargedHadrCand     ->Draw("same")
tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationChargedHadrCand     ->Draw("same")
c1->SaveAs("isoparams_isolationChargedHadrCand.png")

       tt_dilep_full_sel_isoparams_tau_n_isolationNeutrHadrCands     ->Draw()
tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationNeutrHadrCands     ->Draw("same")
tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationNeutrHadrCands     ->Draw("same")
c1->SaveAs("isoparams_isolationNeutrHadrCands.png")

       tt_dilep_full_sel_isoparams_tau_n_isolationGammaCands     ->Draw()
tt_dilep_full_sel_isoparams_wfakes_tau_n_isolationGammaCands     ->Draw("same")
tt_dilep_full_sel_isoparams_bfakes_tau_n_isolationGammaCands     ->Draw("same")
c1->SaveAs("isoparams_isolationGammaCands.png")



       tt_dilep_full_sel_isoparams_tau_n_signalCands     ->Draw()
tt_dilep_full_sel_isoparams_wfakes_tau_n_signalCands     ->Draw("same")
tt_dilep_full_sel_isoparams_bfakes_tau_n_signalCands     ->Draw("same")
c1->SaveAs("isoparams_signalCands.png")

       tt_dilep_full_sel_isoparams_tau_n_signalChargedHadrCand     ->Draw()
tt_dilep_full_sel_isoparams_wfakes_tau_n_signalChargedHadrCand     ->Draw("same")
tt_dilep_full_sel_isoparams_bfakes_tau_n_signalChargedHadrCand     ->Draw("same")
c1->SaveAs("isoparams_signalChargedHadrCand.png")

       tt_dilep_full_sel_isoparams_tau_n_signalNeutrHadrCands     ->Draw()
tt_dilep_full_sel_isoparams_wfakes_tau_n_signalNeutrHadrCands     ->Draw("same")
tt_dilep_full_sel_isoparams_bfakes_tau_n_signalNeutrHadrCands     ->Draw("same")
c1->SaveAs("isoparams_signalNeutrHadrCands.png")

       tt_dilep_full_sel_isoparams_tau_n_signalGammaCands     ->Draw()
tt_dilep_full_sel_isoparams_wfakes_tau_n_signalGammaCands     ->Draw("same")
tt_dilep_full_sel_isoparams_bfakes_tau_n_signalGammaCands     ->Draw("same")
c1->SaveAs("isoparams_signalGammaCands.png")



-- the candidates in the signal cone are the same everywhere
   the genuine taus have less candidates in the isolation cone, but not terrifically much less

one possibility could be to get the momenta of the isolation particles and calculate the mass of the system -- is it close to D or B mesons or not?


