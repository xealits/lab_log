# [[Sijin Qian][https://cds.cern.ch/record/2686265?ln=en]]

 In general

(1) Throughout the paper (including in Tables, etc.), (a) the "branching ratio" is used on L246 and L302, while (b) the "branching fraction" is used on L30 and Table 2 (the header column and the theoretical uncertainties block),

I'm not sure whether they should be consistent, i.e.

either all with (a) or all with (b) instead of a mixture.

(2) In all Figures (the axis labels, plot labels and legends) and Tables (header rows and header columns), the 1st letter of each line should be capital, e.g.

(a) Figs.1 and 3's legends:

"data ... ... single top W+jets Drell-Yan dibosons multijet uncertainty" -->

"Data ... ... Single top W+jets Drell-Yan Dibosons Multijet Uncertainty"

(b) Table 1's header row: (the 3rd line)

"background-like | signal-like | background-like | signal-like" --> "Background-like | Signal-like | Background-like | Signal-like"

(c) The other places where should be changed similarly are

Fig.2's legend, Table 1's header column (some rows), Fig.3's plot labels (at the upper-right corner of each plot), Table 2's header row (the 2nd line) and header column (some rows), and Fig.4 (the legend and the horizontal axis label).

Pages 1-4

(3) L30, L81, L95, L97, L111-112, L127, L140 and L142-143. These lines may be shortened from

(a) L30: (as the "h" has been explained on L29)

"branching fractions B(tauh -> hadrons + nutau)" --> "branching fractions B(tauh -> h + nutau)"

(b) L81: (as the NLO has been introduced on L62; also, the number of adjectives before the "cross section" seems a little too many, so two words of "At the" and a comma may be better to be added around the 1st word)

"The next-to-next-to-leading-order (NNLO) expected SM ttbar pair production cross section of" -->

"At the next-to-NLO (NNLO), the expected SM ttbar pair production cross section of"

(c) L95: "with a particle-flow (PF) algorithm [28]. The PF algorithm ..." --> "with a particle-flow (PF) algorithm [28]. This algorithm ..."

(d) L97: "namely charged hadrons, photons, neutral hadrons, muons," --> "namely charged and neutral hadrons, photons, muons,"

(e) L111-112: (two places)

"if Irel > 0.0588 in the barrel and Irel > 0.0571 in the endcaps. The muon candidate is rejected if Irel > 0.15 in both the barrel and the endcaps." -->

"if Irel > 0.0588 (0.0571) in the barrel (endcaps). The muon candidate is rejected if Irel > 0.15 in both the barrel and endcaps."

(f) L127: "is taken as the sum of the charges of the charged hadrons (prongs) in ..." --> "is taken as the charge sum of the charged hadrons (prongs) in ..."

(g) L140: (as the "phi" and "eta" have already been explained on L46-47)

"> 0.4, where phi is the azimuthal angle and eta is the pseudorapidity." --> "> 0.4."

(h) L142-143: "if Irel < 0.0994 in the barrel and Irel < 0.107 in the endcaps." --> "if Irel < 0.0994 (0.107) in the barrel (endcaps)."

(4) L33, it'll be looked and sound better if a comma is added, i.e.

"In this measurement l does not include leptons from ..." --> "In this measurement, l does not include leptons from ..."

(5) L62, to be consistent in this paper (e.g. L161, etc.), two spaces should be added before and after the symbol "=", i.e.

"mt=172.5 GeV." --> "mt = 172.5 GeV."

(6) L69, to be consistent in this paper (e.g. L68, etc.) and with all other CMS papers, a hyphen should be added between the "s channel", i.e.

"The single top quark s channel is produced" --> "The single top quark s-channel is produced"

(7) L74, L100 and L135-136. The "ME" and "pT" should be explained at their 1st appearances in text on L74 and L100 instead of L135-136 for "pT", i.e.

(a) L74: (as the "ME" has been used later in this paper)

"for in the matrix-element calculations." --> "for in the matrix-element (ME) calculations."

(b) L100: "vectorial sum of transverse momenta of all reconstructed" --> "vectorial sum of transverse momenta (pT) of all reconstructed"

(c) L135-136: (then can be shortened correspondingly)

"with transverse momentum pT > 30 (26) GeV and ..." --> "with pT > 30 (26) GeV and ..."

(8) L146, the expression of "a b tagging efficiency" is looked quite odd similar as "a b c d xxxx". It may be improved by following the good examples in this paper (e.g. L158-159, L162, L164 and L315, etc.) to add a hyphen between "b tagging", i.e.

"in a b tagging efficiency of about 66% with" --> "in a b-tagging efficiency of about 66% with"

(9) L153-154, I've not figured out what the "(MT in the following)" is used for in this sentence yet. If it would not be too meaningful here, then whether it can be removed?

Pages 7-8

(10) L258 and L283, as the "PS" has been used on L260, it should be explained at its 1st appearance in text on L258, i.e.

(a) L258: "in parton showering simulation of ..." --> "in parton showering (PS) simulation of ..."

(b) L283: (then, can be shortened by using "PS")

"and parton shower modeling" --> "and PS modeling"

(11) L258-259, L268 and Table 1's caption (the 3rd line) may be shortened from

(a) L258-259: "of final-state and initial-state radiation," --> "of final- and initial-state radiation,"

(b) L268: "as described in the Section 6," --> "as described in Section 6,"

(c) Table 1's caption (the 3rd line):

"in the background-like and signal-like event categories." --> "in the background- and signal-like event categories."

(12) L276, to be consistent in this paper, the font of electron "e" should be changed from

"as a function of the cross section in the e(italic)tauh and ..." --> "as a function of the cross section in the e(non-italic)tauh and ..."

Page 11

(13) L289-290, I'm not sure whether the "acceptance" should be plural, i.e.

"is the product of the geometrical and kinematic acceptance," --> "is the product of the geometrical and kinematic acceptances,"

Page 12

(14) L325, per the PubComm guidelines, some acronyms and variables (e.g. "SM", etc.) in the Summary Section may should be explained (or spelled out if it would not be used again in the Section at their 1st appearances in the Section, since some readers may only read the Summary Section instead of whole paper, i.e.

"in agreement with SM expectations." --> "in agreement with Standard Model expectations."

Pages 13-16, in the References Section

(15) L351, in [1], I'm not sure whether three words in the article title should be in the lower case, i.e.

"Test of Lepton Flavor Universality by the measurement of the" --> "Test of lepton flavor universality by the measurement of the"

Other ones which also need to be similarly modified are [3] (for the 2nd word "Anatomy") and [43] (for the last word "Pole").

(16) L434, in [30], to be consistent with all other CMS papers, the document name should be changed from

"Technical Report CMS-DP-2017-004, 2017." --> "CMS Detector Performance Report CMS-DP-2017-004, 2017."

(17) L469, in [42], to be consistent in this Section, the Erratum should be changed from "[Erratum: Phys. Rev. D 66, 079905 (2002)]." --> "[Erratum: Phys. Rev. D 66 (2002) 079905].

(18) L478, in [46], this is a Collaboration paper, so that the individual name should be removed from the author part, i.e.

"[46] Particle Data Group, M. Tanabashi et al.," --> "[46] Particle Data Group," 



# [[Theodor Christian Herwig][https://cds.cern.ch/record/2686258?ln=en]]

## Physics comments (Type B)

 In addition, there are two points in particular that we would like to see addressed by the analysis team, first regarding the presentation of the extracted cross section values, and second regarding the fit construction and interpretation of results.

In Section 8 ("Results"), a single "acceptance" factor is reported that related the "visible" and "total" cross sections for the ttbar process. The quoted "acceptance" appears to include both the purely geometric acceptance factor (e.g. due to kinematic selections on reconstructed objects) as well as the detector-specific efficiency (e.g. from lepton and tau ID, trigger, etc.). It would be useful to separate these two contributions into "acceptance" and "efficiency" corrections and to quote an efficiency-corrected visible cross section. This would allow for a comparison of these results with those from other experiments and with the correction factors predicted by other theory models.

The treatment of decay channels involving tau leptons that are not considered as a part of the signal process would benefit from a more detailed discussion and comes up in several of the physics comments below. This measurement is motivated in the paper by its ability to probe anomalous tau lepton production in top decays, which in addition to the "e/mu+hadronic tau" signal considered here would also affect ttbar channels involving (a) one fully leptonic tau decay, (b) two fully leptonic tau decays, (c) one hadronic and one fully leptonic tau decay, and (d) two hadronic tau decays. In this analysis, each of these processes is treated as a background. Both (a) and (b) are included in the signal definition of Ref.[7] and (c) is treated as a background here despite having an experimental signature identical to the signal process. This treatment could lead to a scenario where anomalously large tau production is present in nature, but would increase the size of both signal and background in this analysis, so that a signal strength consistent with the SM is still observed. Similarly, the contribution of tau production to both the numerator and denominator of the ratio R_Gamma (L306) implies that a measurement might be consistent with the SM value, despite the presence of real sources of anomalous tau production in top decays.

It should be clarified in the text whether the signal strength modifier is also applied to background processes involving taus from top decays. If not, consider modifying the fit setup to coherently treat all top decays involving taus. In the introduction of the ratios R_ltau/ll (L298) and R_Gamma (L306), the effect of processes involving taus from top decays that are not considered as signal in this analysis should be explicitly discussed. This is necessary for the reader to properly interpret the results in terms of limits on anomalous tau production and lepton universality.

Best, Christian Herwig and Zoltan Gecse, for the Fermilab / LPC group

## Type B Comments ###############

Abstract: Indicate here why the result is significant (e.g., first measurement at 13 TeV that explicitly includes a tau lepton in the final state).

Introduction: Add a Feynman diagram, which is generally useful to improve the clarity of the paper.

6-9: State already here whether you consider tt > (tau nu b)(tau nu b) with one hadronic and one fully leptonic decay as a part of your signal. Also the abstract directly talks about tau_h, while this is more general, just saying tau. It would improve the clarity to discuss the signal in more explicit terms.

8: “5/81” and “4/81” - better elaborate on your “81” (at least). The fractions 5/81 and 4/81 (slightly) confuse channel fractions with branching fractions. Also, the sentence has to be read carefully to understand that the numerators refer to dilepton decays whereas the denominators refer to all decays. And the argument that 5/81>4/81 is misleading since, as explained in the fourth paragraph, the tau decays are restricted to the hadronic channel (and 1/81 corresponds to tau tau).

11: The “this” in “In this final state” should be spelled out since it refers back to the preceding paragraph.

14: How would the anomalous tau production manifest itself? As there are existing high-precision ttbar measurements involving tau decays, would these other decay modes be modified enough to already see the effects to which you are sensitive? For example, the measurement in the e+mu- channel would be affected.

33: The statement as written here begs the question: if prompt leptons are difficult to distinguish from leptonic tau leptons, why do you choose to exclude this process from your signal selection, including "prompt" leptons and not the ones from tau lepton decays?

42: Use the latest version of the “CMS detector” material as there have been a few changes since the form used in the paper was released.

54: momentum balance, instead of energy. (This may be fixed in the newer detector reference.)

65: State how many jets are included in the LO matrix element calculation for W/Z+jets.

68: How is the interference with ttbar treated in the tW simulation? Is a theoretical uncertainty assessed by comparing the diagram removal and subtraction schemes (https://arxiv.org/abs/0805.3067)?

72: Strictly speaking, there is more to the “event tune” than CUETP8M2T4, which is the “underlying event tune”.

79: It’s not clear how the 69.2 mb fits into the pileup weighting. If it is used to create a pre-distribution of PVs per event, then it has only an indirect role in the weighting process. And since many of the quantities are “pileup safe” it’s not clear why the reader needs to know this number. There are other numbers such as the PDG value for the top quark mass or the uncertainty in the cross section due to the top quark mass that would seem to be much more relevant.

82: Consider also stating the uncertainty due to the top quark mass assumption. It is appropriate for a 'measurement' paper and the uncertainty is larger than that due to scale variations.

92: This section might be improved by better organization. For example, you define in l.104ff the electron/muon isolation, including the cut values for tight leptons, and then multiple paragraphs later (l.142) the values for veto leptons. It would be clearer to first discuss all of the object-level selections (e.g. loose and tight leptons) before the event selection.

111-112 (142,...): The “magic” numbers should be explained or referenced : “0.0588”, “0.0571”, “0.15” too ; there are some others on other lines (142, …, 260-261, ...) If these correspond to some fixed signal efficiency (e.g. in Z->ll events), please quote it.

126: Please clarify that “genuine tau leptons” here refers specifically to the hadronic tau decay. Suggest changing tau to tau_h.

140: “where phi is …, and eta is ...” - those are already defined on line 46-47, so no need to declare them again. (But the standard practice is to provide a reference as part of the detector section and not to give a formula for eta.)

142: For electrons and muons that exceed the reconstructed pt thresholds the “loose” definition also includes lower bounds, e.g. 0.15< Irel < 0.25 for muons, as otherwise they would simply be “isolated”. Also, the “rejected” on lines 111 and 112 is too harsh as some of those muons could have been still considered as “loose” candidates...Clarify whether “loose” and “isolated” are inclusive or exclusive. (See also the above comment on L92)

149: It would be instructive to explicitly quote the signal purity after the full event selection here, plus perhaps also the contamination from the remaining ttbar decay channels.

Sec 4.: Are the leptons matched to the triggered objects?

153: Logically it should be “M_T(\vec{p}^l_T,\vec{p}_T^\text{miss} ...)” /not M_T(l,...). This should also be made consistent between the text and in the Figures (axis labels).

158: You might explicitly discuss the background from ttbar where it is not the b from t → bqq’ that has been b-tagged. (You require only ≥1 b-tagged jet, and that one could be the one from the t → blnu decay). The "wrong-tag" events presumably are the dominant ttbar contribution to your signal-rich region?

165-166: This sentence is a bit confusing. How can the cut choice on Djjbmin maximize both the signal and background-like event category yields? The cut decides one or the other, i.e. if changing Djjbmin leads to one category becoming larger, and conversely the other becoming smaller. Describe the (presumably MC-based) optimization that was done in order to select the 60 GeV value.

168: It’s never explicitly stated why mT is a good choice of observable to fit -- the signal may pass the W mass endpoint due to the two-neutrino final state whereas the dominant tt->lep+jets process cannot. It would be helpful to include this motivation in the ‘fit procedure’ section and perhaps also in the caption of Fig. 2.

169: Define a “bin” here, explicitly giving their sizes and the range of values to be used in the fit.

169-172: This sentence is quite long and would be improved by separating the signal strength definition into a shorter, self-contained sentence. Also, the present definition seems to suggest different signal strengths are considered for each bin of mT and lepton flavor (but are held in common for both signal categories?). You may break this into two sentences: one explicitly defining the signal strength used in the fit, and another detailing the categories, NPs, and so on.

173: This statement doesn’t seem strictly true, since the tau pT contributes to the missing-pT and thus the transverse mass.

185: How exactly do you treat the tt → tau_l tau_h bbbar background - it seems that this one should be discussed separately. In many aspects any measurement different from SM should also affect this background. E.g. If you measure a higher “signal” cross section, than this “signal” is also larger. If you observe anomalous tau coupling (as mentioned in l.13), than this process is even more affected.

193: Have you checked to quantify the “independence” of mT from the tau lepton pT? One could check the size of the effect by re-weighting the tau pT by the non-closure observed in Fig1 (~20% at high pt). (See also comment on L173)

196: Only changes to the normalization of the background templates are discussed here, but presumably the shapes are also allowed to vary (e.g. due to theory uncertainties).

200: To pass the signal selection, both the lepton and tau must be incorrectly identified. It would be helpful to state the dominant origin of these events (e.g. conversions, heavy flavor decays...)? The origin affects whether the fake contribution is expected to be charge-symmetric.

203-207: Is is unclear whether f_OS/SS is (A) a ratio of data events in OS and SS regions, or if it is (B) the double ratio comparing this quantity to the same one predicted by the MC. Put another way, does f_OS/SS=1 tell us that the same number of OS and SS events are expected, or that the ratio (which may NOT be 1) is well-described by the MC? L203 suggests (A), but ‘scale factor’ (L206) typically refers to data/MC comparisons suggesting (B). An explicit equation defining f_OS/SS would be useful here.

218: “is estimated to be” - how is it estimated?

224-228: After the 50% uncertainty on tau mis-ID is significantly constrained, are the mentioned differences in kinematic properties still covered? For example, does the profiled uncertainty cover data/MC differences in the reconstructed tau pT spectrum for a background-like selection? In Tab. 2 is this uncertainty included in the dominant “tau jet ID” entry? If so, it would be beneficial to separate them and explicitly show that the uncertainty is small. Otherwise it is hard to know whether to worry about the strong profiling. The sentence L227-228 calls it “not dominant” while the sentence L281-282 calls it “dominant”, so the situation here should be clarified.

236: Did you consider that the events in “standard” Z->ll are much cleaner than your events and the correction factors may be biased (in particular isolation related)? Did you check with MC events for instance?

237-238: Suggest removing the part of the sentence starting with “... selected by … ” (to the end of the sentence) - this is an unnecessary detail, and there is a reference anyway.

241-243: The sentence “The pileup is ...” seems to contradict lines 79-80. Either provide more details or follow similar wording (relying on the reference given).

247: In Fig.1 there is a trend towards softer-than-predicted tau leptons, of up to 20%. Does the trend persist after top pT re-weighting? If not, can you check the impact of re-weighting in tau lepton pT? (This could be done with the signal-rich selection, to disentangle effects from mis-identified taus.)

254: Theory uncertainties are also included in the extraction of the visible cross section presumably, so it is not clear why they are introduced here only in the context of the acceptance extrapolation. We suggest explicitly mentioning their effect on the visible cross section (a la L262-264) before describing each source of uncertainty.

257: State whether the scales are varied independently, coherently, or both. The determination of the uncertainty as the ‘envelope’ is clear for the case of the acceptance, but what is the treatment for the visible cross section extraction? Are shape variations considered for all combinations of scale choices, and how many nuisance parameters are included in the fit corresponding to the scale variations? Does the “ttbar ME” entry in Tab. 2 correspond to a combination of all renormalization, factorization, and hdamp scale variations?

264: The decision to ignore correlations here should be justified.

265: Are theory/shape uncertainties considered on the non-ttbar background?

265: Have you checked the dependence of the extracted cross section on the top mass assumption?

270 / Tab. 1: Regarding “The observed… expectation”, it is impossible to tell that the data/prediction agreement is good from the table, as the full uncertainties are not included. For example, the background muon channel shows a 4.2 sigma (!) discrepancy, just including the MC + data statistical uncertainties (and the difference is >2 sigma for 3 of 4 channels). The presentation here should be reconsidered, or an appropriate comment made in the text.

Fig. 3: In the first sentence of the caption, specify the e or mu lepton in the mT definition (i.e. the "lepton" is not the tau lepton).

277: It would be useful to include the post-fit normalization for each of the background processes here. (Have the post-fit estimates for these processes been cross-checked using orthogonal data selections, i.e. "validation regions"?) Also consider including a goodness-of-fit parameter (e.g. chi2/nDOF) to demonstrate the fit quality.

Table 1, caption, last sentence: Not clear what the meaning is : “uncertainty in … multijet contributions includes … uncertainty of the data … and … uncertainty of … THE OTHER processes.” (which other processes, what is the relation to multijets) Capitalize firsts words.

Tab. 2: Which process(es) does the “ME-PS matching” uncertainty correspond to? Matching schemes don’t appear to be described in the section describing MC samples.

Tab. 2: Suggest quoting the total uncertainty for each of the experimental, theoretical, and extrapolation categories.

288: Please add further explanation that the quoted cross sections here correspond to the full ttbar production process (not just the hadronic tau decay channels). The assumptions should be explicitly stated that allow you to extrapolate from e-tau_h and mu-tau_h decay channels to the full cross section (dividing by the SM branching fraction to those channels). Also consider instead reporting the cross section times branching ratio to each of the three channels, so that ell-tau_h is the sum of the other two channels.

288: Why are the electron and muon estimates so similar, considering the differences in acceptance and efficiency that have not been taken into account at this point (but are apparently included in the acceptance factor).

289-290: Here the acceptance seems to include all of the efficiencies in addition to the purely geometric acceptance effects. On one hand this suggests the visible cross-sections reported contain no efficiency corrections, limiting the use of these numbers. On the other hand, why is the acceptance defined to include efficiency - in this way the acceptance (generally a property of a physical process) becomes also a property of the detector and time, including its uncertainties? How is it possible that the acceptance as defined by you includes only “modeling” uncertainties but not efficiency uncertainties? It would improve the presentation if the efficiency factors for trigger, lepton and overall reconstruction are removed from the acceptance definition and treated as a separate correction, with a corresponding change to the visible cross section definition. Ideally the result would be cast as a limit on BR(top --> tau nu b) so that the various decay modes are properly correlated.

298: Exactly how have you constructed this ratio? Ref.7 explicitly mentioned that tau → lnunu are considered as signal, so any non-SM modification of your result with that result would be very correlated. This issue should be addressed in the discussion here.

299: As discussed above, anomalous tau production could also lead to a value or R consistent with the SM expectation (1.0).

306: “... includes the correlations… The estimate … 0.0071 (syst)...”. Your cross-section syst. error is 62/781 ~ 8% (last line on page 11). Then your table reports that most of the uncertainties are fully correlated with the ones in the dilepton channel. Yet for the ratio you arrive at 71/1050 ~ 7% systematic uncertainty which is about the same you started with, how come? How do you “include” the correlations?

320-321: The message of this sentence (“In the fit… tau lepton”) is unclear.

321: Taus from top decays were included through their fully-leptonic decays in previous measurements by both experiments at 13 TeV in the e-mu channel (e.g. https://arxiv.org/abs/1510.05302 and https://arxiv.org/abs/1606.02699). Suggest rephrasing to ‘requiring hadronic tau decays’ or similar. 





# [[Koushik Mandal][https://cds.cern.ch/record/2686257?ln=en]]

## Physics comments (Type B)

 Abstract:

Why do you use () to present ttbar decay?

It would be nice to mention the result on lepton flavor universality in abstract too.

Event categories and fit procedure:

Its mentioned that events are grouped into two categories based on b-jet and trijet kinematic criteria in order to get better discrimination over the background. But it seems like the PLR fit is done in both categories. Is the final result extracted from both event category? If so, then how does this event categorization improve your result over no categorization?

Figure 3:

Looks like ttbar -> other is a huge background. I understand that you are constraining this background by the fit. But it would be nice to add some words on how that fitted output differs from MC prediction and how precise is the background uncertainty.

Line-by-line comments:

L8-9: No explanation or reference for the numbers 5/81 and 4/81.

L31: What is meant by distinct signature here?

L108: The factor 0.5 is used as a rule of thumb or there is any other explanation?

L110-112: This is a bit difficult to follow. It would better to rephrase rejected as selected or identified with inverting the Irel conditions as I guess these are the isolation conditions used for the electron or muon selection in the analysis. Then it would be relevant to L135. Also, you provide the misidentification probability in the following line, so sentence with selection or identification would be better.

L121: What is meant by hadron plus a strip/ two strip?

L128: This charge refers to the individual hadron or total tau charge?

L132: What is a generic hadronic jets?

L132: The misidentification rate is less than 1%. Could you please explain if this rate is so low, then how can ttbar lepton + jets where one jet is misidentified as tau jet be your dominant background (L181-183) and also could you provide a quantitative value of tau misidentification obtained from the fit as mentioned in L223?

L167-168: Could you explain how does this provide the additional constraint on the background?

L200: What are the other processes considered here?

L219: How is the charge uncertainty added to the identification uncertainty?

L249: Is this pT reweighting scale factor computed by the analyzers or taken from another source? 






# [[Lea Michaela Caminada][https://cds.cern.ch/record/2686165?ln=en]]

## Physics comments (Type B)

 Abstract:

"ttbar > (l nu_l)(tau_h nu_tau)bbbar" is a not a production process, but a decay. Rephrase, or at least add „pp> ttbar > (l nu_l)(tau_h nu_tau)bbbar“

In Introduction, Results and Summary three results are presented: cross section, R_(ltau_h/ll) and R_width, while the abstract only mentions two of them > suggest to add R_(ltau_h/ll) also to abstract

Introduction:

L7-9: The argument about the higher branching ratio for ttbar decays with at least one tau decay in the final state being higher compared to ee/mumu/emu does not really seem to be appropriate in the context of this analysis, since final state with two taus are not considered.

L27: What is meant by „complementing earlier measurements“?

Event simulation:

L61-80: Might consider having a table instead of the second paragraph as this would be easier to read.

L82: used for the estimation of the number of ttbar events in the simulation > used for the normalization of the number of ttbar events in simulation

L85: „The proton structure is described…“ It is not clear that this sentence refers to. Is it the cross section value? If yes, is it relevant to have this statement?

Event reconstruction and selection

L105: Can you add a motivation (or reference) for the choice of the definition of I_rel. In particular, why is there a factor 0.5 for E_ch^PU? The sentence on L108/109 is unclear. Please rephrase.

L111: are these standard cut values? If yes, add a reference.

L125: „Additional requirements…“ > it is not clear what this statement refers to as in the following there is only one additional requirement mentioned, namely the charge of the tau.

L127: „the signal cone“ has not been defined.

L136: can one of the two selected jets be the tau_h candidate or is a tau_h candidate required in addition to the two jets?

L140: phi and theta have already been introduced in Section 2 > remove definition here.

Figure 1 caption: „The pre-fit tau_h p_T distributions“ > „The tau_h p_T distributions“ (at this stage the fit has not yet been discussed)

Figure 1 caption: „to the SM predicted values“ > „to the SM predicted cross sections"

Event categories and fit procedure

L152 vs L155: the use of the term „two event categories“ is confusing in this section as it is both used to refer to the „e tau_h/mu tau_h“ categories and the „signal-like/background-like“ categories. Please review and rephrase.

L163: The statement of „less than two not b-tagged jets“ is not clear: This means zero or one not b-tagged jets? But zero is not possible, since there is always a tau_h candidate? Wouldn’t then „one not b-tagged jet“ be more appropriate?

L167: „maximization of yields in the two categories“: It is not clear what this refers to. e tau_h/mu tau_h or signal-like/background-like?

L167: „The categories proved an additional constrain“ > „Performing a simultaneous fit in two categories provides an additional constraint“ (or similar, it is not the „categories“ that provide the constraint, but the fact that you do the fit in two categories)

L173: What does it mean that „The fitted variables are not tied to the kinematic properties of the tau lepton“? > Rephrase

Background estimate

L203: Justify why f_OS/SS measured in the control region can also be applied in the signal region. Did you check this in simulation?

Systematical uncertainties

L224: Why is the misidentification probability varied around the expected value and not around the measured value?

L241: „The pileup is estimated…“ How is this information then used in your analysis to obtain a systematic uncertainty?

Results

L285: The definition of the visible cross section should be written explicitly. Are the isolation cuts included in the definition?

Before L288: In L286 it says „the visible cross section is defined in the fiducial region satisfying the kinematical cuts described earlier“. From this we understand that the pt cut is different for e and mu. How is sigma(l tau_h) then defined?

Before L296: State in the text how is sigma_tt (l tau_h) obtained from sigma_tt (e tau_h) and sigma_tt (mu tau_h)

L298: How are the correlations in systematic uncertainties treated when obtaining the ratio R_(ltau_h/ll)? 





# [[Thorsten Chwalek][https://cds.cern.ch/record/2685313?ln=en]]

## Physics comments (Type B)

 (1) In the abstract you say twice that the cross section is measured, once for the hadronic tau final state and once for the inclusive production cross section. but in fact you only measure it in the fiducial phase space and then extrapolate it the full phase space based on acceptance taken from simulation. I think it is worthwhile to mention the fiducial measurement already in the abstract, since it is a selling point of this analysis.

(2) Why is the integrated luminosity 35.8 fb-1 instead of the more common value of 35.9 fb-1? Is it due to the chosen trigger paths?

%BLUE% >> It was an error with rounding, corrected it in the text and in the figures.

(3) I believe the description of the CMS detector is outdated, at least in conflicts with some mandatory statements from the twiki page.

(4) Whenever there is discussion about pileup, i.e. for the total inelastic pp cross section or the uncertainty on that, you cite Ref. 20. but this reference is for the ATLAS measurement of the pp cross section, which neither supports the nominal value used in CMS (69.2 mb), nor the uncertainty of 4.6% on that value when estimating the systematic uncertainty.

(5) Is it really necessary to quote the cuts on the electron isolation up to this many digits? I know, you were just copying it from the table in the twiki, but what relevance does this have to the reader (it might also trigger the question why the values for electron and muons differ and then you have to go into explaining that you actually select electrons based on the cut-based ID and so on ...)

(6) In the determination of the f_{OS/SS} scale factor, how large is the individual contribution of statistical uncertainty and the combined systematic uncertainties to the total uncertainty of 0.05?

(7) Is there any particular selection or ordering of the sources of uncertainties in the first paragraph of the systematic uncertainties section?

(8) What exactly is the 'p_T^miss scale' uncertainty? is it the propagation of the JES uncertainty to p_T^miss or are you referring to the unclustered energy uncertainty, which varies the energy of all unclustered particles in the determination of p_T^miss.

(9) The impact of a specific systematic uncertainties is evaluated by a likelihood scan and fixing all other nuisance parameters to their post-fit values. maybe clarify that you are referring to the post-fit values of the nominal fit results.

(10) Is there a good explanation why there is a significant impact for the jet energy resolution in both channel independently, but not in the combined result?

(11) What exactly is the 'ttbar background', 'Drell-Yan background', etc. uncertainty in Table 2? is it just a log normal nuisance parameter for the initial normalization? if so, please rephrase to 'ttbar background normalization'

%BLUE% >> The names correspond to the uncertainties in the TOP-17-001 measurement. Here, "ttbar background" corresponds to the tauh misidentification in other ttbar processes, "W+jets background" and "multijet background" include the normalization and the uncertainties of tauh misidentification.  "DY background" is only normalization. We can separate the tauh misidentification and normalization systematics.

Line-by-line comments:

- l.10: renewed interest in what, processes with tau leptons?

- l.23: speaking about the invariant mass between two objects is jargon, better refers to the invariant mass computed from the lepton momentum and p_T^miss.

- l.24: tau_h not yet defined, suggest to move paragraph starting in L29 before paragraph of L16

- l.27: be more explicit: total decay width of the top quark

%BLUE% >> Corrected.

- l. 61: The Reference for the ttbar production with POWHEG is missing (JHEP 0709 (2007) 126, arXiv:0707.3088)

%BLUE% >> Added this reference. Also I have added J. M. Campbell, R. K. Ellis, P. Nason, and E. Re, “Top-Pair Production and Decay at NLO Matched with Parton Showers”, JHEP 04 (2015) 114, arXiv:1412.1828.

- l. 64: I believe that the correct (default) version of MG5_aMC@NLO is 2.2.2 (instead of 2.3.3). Can you please check for all MG5_aMC@NLO simulation samples used in the analysis?

- l. 68: The Reference for the t-channel single top production with POWHEG is missing (JHEP 0909 (2009) 111, arXiv:0907.4076)

%BLUE% >> Added.

- l. 71: I think, in at least some cases, Pythia 8.212 instead of 8.219 has been used, please check.

- l. 72: Tune CUETP8M2T4 has been only used for ttbar to improve the modeling in the jet multiplicity, all other processes are generated with Tune CUETP8M1, which was the default in 2016

- l.91: Please provide the version number of MCFM.

%BLUE% >> Added.

- l.111: although correct int he meaning, the sentence on l.111 'The electron candidate is considered to be non-isolated and is rejected if I_rel > 0.0588...' is in this construction hard to understand for uniformed reader. I suggest to rephrase it to something like 'Electron candidates with I_rel > ... are considered to be nonisolated and are rejected'

- l.111/112: a single candidate can be either in the barrel or the endcap, so: I_rel>0.0588 in the barrel *or*… “I_rel > 0.15 in *either( the barrel...

%BLUE% >> Corrected.











- l.125: the tau lifetime information

%BLUE% >> Added "the \tauh lifetime information".

- l.140: redundant, pseudorapidity already defined in l.47

%BLUE% >> Corrected.

- l.142: barrel or

%BLUE% >> Corrected.

- l.154: you are using a different variant of the symbol \phi compared to l.139-140

%BLUE% >> Corrected.

- l.194: determined separately ist misleading here, as (I assume) it is still the same fit in which the background normalizations are determined. It is also unclear if the normalizations are nuisance parameters with constraints or free fit parameters.

- l. 207: Which systematic uncertainties are considered for the scale factor? All uncertainty sources of Section 7 or only specific ones? Please provide a bit more information.

- l.209: the wording separate parameter is a little clearer, if you explain the role of these parameters in l.194

- l. 257: Did you avoid drastic muR, muF variations (i.e. 0.5,2.0 and 2.0,0.5)?

%BLUE% >> 

- Figure 1: please increase the width of the overflow bin to match the size of the remaining bins, otherwise you would also have to include horizontal error bars due to nonequidistant binning, also then y-axis label 'Events / X GeV'; align the 'lumi (sqrt(s))' to the right side (also for Figure 3) ; in my opinion the term 'lumped' in the caption is not very scientific (also for Figure 3); suggest tau_h p_T -> p_T(tau_h) (makes it more clear what the variable is and what the particle); shaded areas look very light when printed; colors for W+jets and diboson contributions look very similar when printed

- Figure 2: change the y axis label from 'a.u.' to a proper meaning, e.g. 'norm to unity' or 'probability density'; also include a overflow bin in this figure

- Figure 3: y axis label: use format "GeV>", uncertainty band is hard to see in printed version; caption 5th line (e tau_h) -> e not italic

- Figure 4: x axis label: cross section -> ttbar cross section; caption: describe what is actually shown here. It cannot be the likelihood, which should have a maximum at 800 pb. Is it the profile likelihood ratio, with the cross section profiled?

- Table 1 caption: suggest to clarify what of the other processes refers to, the processes that get subtracted from the data in the determination of the multijet shape

- Table 2: is 'sample size' in Table 2 simply the statistical uncertainty of the data set?; in Table 2,the experimental uncertainties seems to ordered according to their impact on the combined results. how is the ordering for the other categories chosen? ; also there is some inconsistency in Table 2 for the usage of abbreviations (ttbar, tW, ME, PS, ISR, FSR) and nonabbreviated terms (Drell-Yan, jet energy scale, jet energy resolution); is the last column just a yes/no, or the correlation factor that is assumed? In the latter case, 100% may be clearer than just 1, remove the vertical line

%BLUE% >> Yes, "sample size" is the statistical uncertainty. Other categories are ordered similar to the uncertainties in TOP-17-001 for easy comparison. THe last column is the correlation factor.

- l.269: do these categories refer to the definition of D_jjb in Section 5? If so: please refer to that section here

%BLUE% >> Yes. Added a reference.

- l.300: The extraction of R_\Gamma is not explained very clearly, and also the papers you refer to do not have the formulas that are needed explicitly. Why is R_\gamma not called the branching fraction B(t → tau nu_tau b)? It is not obvious, how R_\Gamma is computed

- l.323: is it possible to quantify by how much the previous measurements have been improved?

- l.328: maybe mention, which total width you are referring to: [...] the partial to the total top quark decay width [...]

%BLUE% >> Added.

- is reference 35 (muon performance at 7 TeV) really necessary, as you also quote reference 31 (muon performance at 13 TeV)?

%BLUE% >> Removed Ref.35.

- Is Reference 37 needed, when you are also using Reference 33 for the b-jet identification? If not, remove Ref. 37, as Ref. 33 is the most recent b tag paper.

%BLUE% >> Removed reference 37. It provides enough information about the b-tagging algorithm (CSVv2). And its' first citation if Ref.33.

- Ref. 35: Replace it with the Run 2 muon reconstruction and performance paper (JINST 13 (2018) P06015) 

%BLUE% >> Replaced.



### checks

#### The strange JES and JER in "both" fit

make impacts    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp.root   nn=v37_test172BIN1_el_test2_expMu2_Thorsten1   freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make impacts    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp.root   nn=v37_test172BIN1_mu_test2_expMu2_Thorsten1   freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make impacts    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_exp.root nn=v37_test172BIN1_both_test2_expMu2_Thorsten1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &

python new_impact_table.py --merge-pdf latest_impacts_v37_test172BIN1_el_test2_expMu2_Thorsten1.json latest_impacts_v37_test172BIN1_mu_test2_expMu2_Thorsten1.json latest_impacts_v37_test172BIN1_both_test2_expMu2_Thorsten1.json

         jet energy scale  &  0.1 &  0.2 &  0.4 \\
    jet energy resolution  &  0.5 &  0.3 &  0.2 \\

-- same effect

make impacts    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp.root   nn=v37_test172BIN1_el_test2_expMu2_Thorsten2   freeze="--freezeParameters lumi_13TeV,JES" points=100 min=0.5 max=1.5    &
make impacts    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp.root   nn=v37_test172BIN1_mu_test2_expMu2_Thorsten2   freeze="--freezeParameters lumi_13TeV,JES" points=100 min=0.5 max=1.5    &
make impacts    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_exp.root nn=v37_test172BIN1_both_test2_expMu2_Thorsten2 freeze="--freezeParameters lumi_13TeV,JES" points=100 min=0.5 max=1.5    &

make impacts    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp.root   nn=v37_test172BIN1_el_test2_expMu2_Thorsten3   freeze="--freezeParameters lumi_13TeV,JER" points=100 min=0.5 max=1.5    &
make impacts    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp.root   nn=v37_test172BIN1_mu_test2_expMu2_Thorsten3   freeze="--freezeParameters lumi_13TeV,JER" points=100 min=0.5 max=1.5    &
make impacts    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_exp.root nn=v37_test172BIN1_both_test2_expMu2_Thorsten3 freeze="--freezeParameters lumi_13TeV,JER" points=100 min=0.5 max=1.5    &

python new_impact_table.py --merge-pdf latest_impacts_v37_test172BIN1_el_test2_expMu2_Thorsten2.json latest_impacts_v37_test172BIN1_mu_test2_expMu2_Thorsten2.json latest_impacts_v37_test172BIN1_both_test2_expMu2_Thorsten2.json

    jet energy resolution  &  0.5 &  0.4 &  0.2 \\

python new_impact_table.py --merge-pdf latest_impacts_v37_test172BIN1_el_test2_expMu2_Thorsten3.json latest_impacts_v37_test172BIN1_mu_test2_expMu2_Thorsten3.json latest_impacts_v37_test172BIN1_both_test2_expMu2_Thorsten3.json

         jet energy scale  &  0.1 &  0.3 &  0.5 \\

-- so, they are not related


check their correlation/covariance?

combine -M FitDiagnostics ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp.root   --plots --saveShapes --saveWithUncertainties --name Shapes_v37_test172BIN1_el_test2_expMu2_Thorsten1   --freezeParameters lumi_13TeV  &
combine -M FitDiagnostics ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp.root   --plots --saveShapes --saveWithUncertainties --name Shapes_v37_test172BIN1_mu_test2_expMu2_Thorsten1   --freezeParameters lumi_13TeV  &
combine -M FitDiagnostics ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_exp.root --plots --saveShapes --saveWithUncertainties --name Shapes_v37_test172BIN1_both_test2_expMu2_Thorsten1 --freezeParameters lumi_13TeV  &




#### check the asymmetry in the impact of the scale systematics

the paper tables:

postfit_both_impacts.pdf -> latest_impacts_v37_test172BIN1_both_test2_expMu2.pdf
postfit_el_impacts.pdf -> latest_impacts_v37_test172BIN1_el_test2.pdf
postfit_mu_impacts.pdf -> latest_impacts_v37_test172BIN1_mu_test2_expMu2.pdf

in the directory:

v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_both_test1.json         
v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_both_test1_expMu2.json  
v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_both_test2_expMu2.json  
v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_el_test1.json
v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_mu_test1.json
v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_mu_test1_expMu2.json
v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_mu_test2_expMu2.json

in v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_both_test2_expMu2.json

    {
      "fit": [
        -0.9576138854026794,
        -0.09727603942155838,
        0.7979814410209656
      ],
      "groups": [
        "tt_th_pdf"
      ],
      "impact_r": 0.007975339889526367,
      "name": "Mfr",
      "prefit": [
        -1.0,
        0.0,
        1.0
      ],
      "r": [
        0.9488188624382019,
        0.9408435225486755,
        0.9352219700813293
      ],
      "type": "Gaussian"
    },

-- anti-correlated

0.9488188624382019 - 0.9408435225486755, 0.9408435225486755 - 0.9352219700813293
(0.007975339889526367, 0.005621552467346191)

0.007975339889526367 / 0.005621552467346191
1.4187077210170282

    { 
      "fit": [
        -0.7009338736534119,
        0.1872674971818924,
        1.1209135055541992
      ],
      "groups": [
        "tt_th_pdf"
      ],
      "impact_r": 0.0006325244903564453,
      "name": "Mf",
      "prefit": [
        -1.0,
        0.0,
        1.0
      ],
      "r": [
        0.9403622150421143,
        0.940843939781189,
        0.9414764642715454
      ],
      "type": "Gaussian"
    },

-- positive correlation


    {
      "fit": [
        -1.1342897415161133,
        -0.19106613099575043,
        0.7147330045700073
      ],
      "groups": [
        "tt_th_pdf"
      ],
      "impact_r": 0.007677316665649414,
      "name": "Mr",
      "prefit": [
        -1.0,
        0.0,
        1.0
      ],
      "r": [
        0.9485242962837219,
        0.9408469796180725,
        0.9354045391082764
      ],
      "type": "Gaussian"
    },

-- anti-correlation, and very similar to Mfr

the scale in the table:



#### figures

label \nu_\mu in the legend
lumi alignment

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc_withTauSys.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root     --output-type pdf -o plots/v37_test172_paper_plots/ --data-nick data_other --overwrite --ratio-range 0.55 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35900 -c mu_sel -x mu_selVloose -d tau_pt --wjet 1.4 --qcd 1.05 --title "" --title-x "#tau_{h} #font[12]{p}_{T} [GeV]" --title-y "Events" --draw-overflows 5 --legend-shift 0.05 --drop-bin 29. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --y-range 0,7500 --x-range 30,100 --font-size-axes-titles 40 --font-size-axes-labels 30 --margin-y 0.14 --offset-y 1.2 --margin-x 0.4 --offset-x 3. --no-horizontal-error-bars




# [[Kevin Stenson][https://cds.cern.ch/record/2685275?ln=en]]

## Physics (Type B)

 Type B (physics) comments:

I think that every use of "multijet" should be changed to "QCD multijet". I think that you are explicitly considering just QCD multijet so it should be made clear. For example, a W+jets event where the W decays to quarks can very reasonably be called a multijet event. I think that this is NOT included in your "simulation of multijet events" and is NOT included in your estimation of the multijet background because you use simulation to subtract out all of the non-QCD background. If I am mistaken, then this should be clarified.

%BLUE% >>

L7-9: I don't see the point of this sentence. Why compare the branching ratio with the light dilepton? If you are trying to make the case that you can expect more events, this is obviously not true for two reasons. First, your analysis only considers hadronically decaying taus so only 65% of the 5/81 are targeted. Also, the tau_h efficiency is much lower than the muon and electron efficiencies. So it seems disingenous to point out that the tau BR is higher when there are important factors you don't mention here. Suggest removing the sentence.

%BLUE% >> Removed it.

L13-14: Is the new physics t-> H^+b -> tau nu b? I would suggest explicitly writing this. Given this justification, is there any way to use your final results to set a limiton new physics contributions?

%BLUE% >>

L23-4, L152: The way these two sentences are worded, I initially understood that the two event categories referred to muons and electrons. It wasn't until ~L169 that I figured out what the two event categories meant. Here are some possible solutions. For L23-4: "The cross section is measured from a profile likelihood ratio (PLR) fit of four transverse mass distributions, corresponding to a division by the lepton final state (electron or muon) and kinematic properties of the jets (signal-like or background-like)." Note that missing transvsere momentum has not yet been defined so defining the transvsere mass in terms of this quantity is problematic. One could also remove the sentence entirely. For L152: "...PLR fit [34] of four binned distributions of the transverse mass of the light-lepton and \ptmiss corresponding to a division by the lepton flavor (electron or muon) and by a division of the events into signal-like and background-like event categories." One could also move the first two sentences to the end of Section 5. This may make more sense since at the end you will have fully defined the event categories.

%BLUE% >>

L70, L90: You generate QCD events with MG5_aMC@NLO but then normalize to results from Pythia8. Why? Both are LO but I would tend to trust the MadGraph results more than the Pythia ones. Do they give different results?

%BLUE% >> It is a mistake, QCD simulation is normalized to the cross section from MG5_aMC@NLO.
But the QCD simulation is used only in the Analysis Note to verify the data-based method for QCD estimation.
The paper does not mention the QCD simulation, therefore we have removed these lines.

L106: I suspect that E_ch is composed just of tracks that originate from the primary vertex, while E_nh and E_ph are composed of all neutral particles. That is the only way the I_rel equation makes sense to me. If so, I think this information needs to be included. One would need to add text about how the primary vertex is selected (likely in the previous paragraph) and rewrite this sentence to make it clear how E_ch, E_nh, and E_ph are calculated.

%BLUE% >> Added the sentence about the primary vertex in the previous paragraph.
TODO: tracks/all particles?

Figures 1 and 3: - The colors assigned for single top and W+jets are nearly indistinguishable. This does not work since they are adjacent. You could swap the colors of single top and ttbar->other to make it easy to distinguish. - Why do you change colors for the electron and muon signal channels? You don't change any of the background colors even though they also have different leptons in them. I would suggest using the same color for both. - In the signal legend for the muon mode has a problem. The subscript muon for the muon neutrino is spaced strangely. The tau subscript seems fine so I don't think it is an issue for all Greek letters. Can you see about fixing it? One alternative to simplify things is to remove the subscripts on all of the neutrinos or even remove the neutrinos entirely.

%BLUE% >>

Suggest switching the order of Sections 5 and 6. It seems like Section 6 provides a good motivation for Section 5. One might even move Section 5 to after Section 7. Here are some issues it resolves. - Currently, L156-158 (Section 5) mentions a background from "misidentified tau_h from the ttbar lepton+jets process" but it is not explained how this is a background. In L182-3 (Section 6) it is clarified that a jet fakes a tau_h. - In L191-193 (Section 6) a justification is given for using M_T. This justification would seem to be more natural if it occurs before stating that M_T is used in the fit (Section 5). Note that a switch to the order would require changing where M_T is defined and maybe some other minor changes. If this is not done, then the two issues above should still be addressed.

%BLUE% >>

L156-168: The text here needs to better explain and justify what is done. Some specific suggestions: - L157-8: I don't think it is correct to say that constraints are used. I would suggest that kinematic features are used. When people talk about constraints with the top quark and W boson mass, I assume they are talking about actually setting quantities equal to these masses, usually to obtain the neutrino momentum. - It would be very useful to show a plot of D_jjb or D^min_jjb for signal and background (ttbar lepton+jets) events so that one can see there is a difference and a cut at 60 GeV is reasonable. I think this plot would be much more useful than Figure 4 (which seems pointless) and at least as useful as Figure 2 (which is redundant with Figure 3). - Can you quantify the improvement in the analysis by splitting into two event categories? This could be an all MC study or fitting the data with a simplified fit putting all events into the same category. Does the total uncertainty improve? If so, by how much? I think this would be useful to add to the text to justify the event category splitting (assuming the uncertainty does, in fact, improve).

%BLUE% >>

%BLUE% The event categories based on kinematic parameters of jets serve as independent constraint in addition to the MT shape. In an older MC study we saw that typically the misidentification uncertainty is reduced: from 25%, without categories and without a shape fit, to 5% with only categories, to 2.5% with the shape, and to 2% with the categories and the shape.

L173-4: I have no idea what this sentence means. The only fitted variable is M_T, right? So are you saying that M_T is independent of the tau kinematics? Is this the same information as given in L192-193?

%BLUE% >> Yes, only M_T is fitted, it is independed from tau kinematics and the kinematics of misidentified taus.
This information is the same, but it is considered in two different contexts:
in the discussion of the fit at L173-4 we notice that the fit is model-independent with respect to the tau branch of the decay;
in L192-193 we discuss how it works to constrain the uncertainty about the probability to misidentify taus.

L187: Does "lepton identification" correspond to both light leptons and tau leptons? Does it imply both efficiency and misidentification rate? Needs to be clarified in the text.

%BLUE% >> It corresponds to the identification efficiency of electrons and muons. The misidentification rate is negligibly small. The identification of tau leptons corresponds to the "tauh jet identification" uncertainty.

L190-196: I do not understand the point of this paragraph and I am confused by it. I think the point of the paragraph is that, in contrast to the quantities described in L187-8, the tau_h misidentification rate is extracted from the fit to the data. Is that right? But then in L224-227, it seems like the misidentification probability is an input with a 50% uncertainty. This sentence also mentions differences between the expected and observed misidentification probability. Is the expected simulation and the observed data? Is the data the same sample you are using or something else? Like I said, I am very confused. I think that L190-6 and L223-228 should be rewritten. Some other questions/comments. Are you simply putting in the tau_h misid rate as a nuisance and the post-fit uncertainty is much smaller than the pre-fit uncertainty? Is that what you mean by measuring it in the fit? Is it implemented any different than the trigger efficiency, lepton ID efficiency, JER, etc.?

%BLUE% >> The uncertainties in the quantities in L187-8 are measured in seprate studies. We use them as an external input for our measurement. But the uncertainty in the tau misidentification probability (L190-96) is handled within our measurement, for our particular event selection, because it depends significantly on the kind of jets selected in the events. The uncertainty of tau misidentification enters the fit with large variation of +-50% from the expected value in MC. This variation covers the usual Data-MC disagreement in the tau misidentification probability, which is on order of 20-30%. The more conservative 50% also cover possible effects from the dependence of the misidentification probability on the kinematic parameters of fake taus. The reduction of the pre-fit variation to 20% changes the overall uncertainty by about 0.1%. Therefore we have decided to use the more conservative magnitude of the variation. The fit constrains the pre-fit misidentification probability giving the post-fit "observed" misidentification probability and the variation of the misidentification probability, which we shortly descrive as "to measure in the fit". L224 "the misidentification probability is varied within +-50% of the expected values" -- the "expected values" are the values in MC. The nuisance parameters can vary either just the number of events expected in a process or also the shape of the distribution in the process. Tau misidentification probability varies just the number of events. The trigger efficiency, lepton ID efficiency, JER have effect of the shape of MT distribution. Therefore in the fit they are included as "shape" variations, i.e. they vary both the number of events and the shape of the distribution.

L228, L281-2, Table 2: This is related to the above. In L228 it is stated that tau_h misid is NOT the dominant uncertainty. In L281-2 it is stated that tau_h identification and misidentification is one of the dominant experimental uncertainties. In Table 2 it appears that these two systematic uncertainties are combined into one value called tau_h jet identification. Is that correct? If tau_h misid is truly measured in the fit, then there should be a separate nuisance for it. So why don't you have separate lines in Table 2 for efficiency and misid rate? If you can add this, please do. Hopefully it will show that the efficiency is ~4.5% and the misid rate is much less. Then, you can be more precise about the dominant experimental uncertainties as being just the tau_h identification efficiency and the statement in L228 will not be in doubt.

%BLUE% >> In L228 we notice that the uncertainty from the misidentification is radically constrained, instead of 10-20% we get about 2.5% in the final result (listed in Table 2 as "ttbar background"). It is still one of the largest uncertainties in the final result. But it is noticeably smaller than the uncertainty in tau ID, and it is on the same level as the other large uncertainties (pileup and modeling).

%BLUE% In the Table 2 the misidentification uncertainty is embedded in the uncertainty of the background process which produces the fake taus: "ttbar background", "W+jets background" and "multijet background". We chose this representation of nuisances to correspond to the measurement in dilepton final state (TOP-17-001), which is used in the estimation of the ratio between two final states. However, since these systematics are not correlated in the two measurements, we can split them into separate lines.

%BLUE% Corrected L281-2 to use "the largest experimental/theoretical uncertainties" insted of "the dominant".

Figure 2: It would be useful to have the processes in the legend. So, "signal" could be "Signal: ttbar -> l nu tau_h nu b bbar" and "background" could be "Background: ttbar -> l nu q qbar' b bbar". It would also be good to have an overflow bin as in Figure 3 (or simply include the overflow in the last bin from 160-250). If the overflow bin is added, the information needs to be added to the caption.

%BLUE% >>







L217: You write that a 5% uncertainty is applied to all processes with a true tau_h. Is this really by process and not by event? I can imagine there are some W+jets with a true tau_h and without a true tau_h. So do you apply the 5% to all events in this sample, regardless of whether there is an actual tau_h in the acceptance? If so, then I think you need to specify which processes get the 5% uncertainty. If, in fact, you apply this based on each event, you need to reword the sentence accordingly.

%BLUE% >> The sub-processes, like W+jets with true tau_h or DY with tau_h, are handled separately. So, effectively it is applied on per-event basis. In the paper we present inclusive contributions of these processes (in the Table of event yields and in the Figures) to keep the focus of the reader on main factors in the measurement.

L244-247: It is not clear how these uncertainties are actually incorporated.

%BLUE% >> They are implemented with per-event weights and corresponding shape templates. Corrected the paragraph to state it clearly.

L275-277: I don't think this paragraph or Figure 4 add anything useful to the paper. It also seems weird that the first time we can figure out the result is by reading off this plot and the number only appears in print much later. You could replace the paragraph with a sentence that simply states that separate fits are performed to the electron channel, muon channel, and combined channel. If you keep it, please specify that the "cross section" in L276 is the full phase space cross section.

%BLUE% >> Rephrased and moved this paragraph to the discussion of the results at the end of the section.

Table 2: What does "sample size" mean? Is this the same as the statistical uncertainty that appears in the results? If so, then the Table 2 caption is not quite accurate as it says these are the systematic uncertainties. You could change the caption to "Systematic and statistical uncertainties" or else remove the line from the table.

%BLUE% >> Yes, it is the statistical uncertainty in the measurement.

L294-5: Is it true that the uncertainties for the full phase space are obtained by simple error propagation of the visible phase space and the acceptance uncertainties assuming no correlation? I tried it and I get uncertainties that are larger than what is reported. Can you check these numbers (with full precision) to be sure they are accurate. If it is not simple error propagation, should I be able to understand what is done from what is written in the paper?

%BLUE% >> TODO: 1) the rounding is important here, 2) there is an error in final result in eltau 789.34024 [11.05076336 70.5550516962668 19.733506000000002] -- the systematic must be 71, 3) there is an error in the estimation of uncertainties in the fiducial xsec, it is a relative uncertainty and the cross section values must be calculated w.r.t the fitted fiducial xsec, but they are calculated w.r.t expected fiducial xsec. However, it seems the 3) does not propagate to the full xsec.

L296: The scale uncertainty shows a large asymmetry which doesn't seem to be reflected in the scale uncertainties in Table 2. Is this consistent?

%BLUE% >>

L320-1: I don't understand what this sentence is saying or why it needs to be stated. Can it be removed? 

%BLUE% >> It notifies that the construction of the fit is model-independent with respect to the tau branch of the ttbar decay.



### corrections

Figure 2: It would be useful to have the processes in the legend. So, "signal" could be "Signal: ttbar -> l nu tau_h nu b bbar" and "background" could be "Background: ttbar -> l nu q qbar' b bbar". It would also be good to have an overflow bin as in Figure 3 (or simply include the overflow in the last bin from 160-250). If the overflow bin is added, the information needs to be added to the caption.





# [[Greg Landsberg][https://cds.cern.ch/record/2685260?ln=en]]

Congratulations on completing the dilepton tt¯ cross section measurement in the τ

channel and a well-written paper! Please, find my detailed comments below, split in the physics and style categories.

## PHYSICS COMMENTS:

- LL7-9: the comparison is not very fair, as once you take into account the τ→τh
branching fraction and the fact that you exclude decays into two τ's, the advantage is completely erased.
I'd therefore drop this sentence altogether.

%BLUE% >> Removed.

- LL10-11: first of all, here you should really do the proper referencing of the R (D/D∗) measurements,
which come from LHCb, BaBar, and Belle, not just LHCb.
Similarly, you should cite all three R(K/K∗) LHCb papers, not just the last one.
Finally, the text doesn't read well as is; suggest rephrasing it as follows:
"Recent hints of lepton flavour universality violation [xx-yy] sparked a renewed interest to measurements involving τ leptons. The t→(τντ)b decay ..."

%BLUE% >> Added a citation to a recent review paper. TODO: add the papers from experiments.
Corrected the text.

- L18: the absolute majority of our 2016 data papers cite an integrated luminosity of 35.9 fb−1;
why your uses only 35.8 fb−1 despite being based on standard single-lepton triggers that were exposed to full integrated luminosity?

%BLUE% >> It is a mistake in the rounding (35.86). It was also noticed in the PAS and corrected for the future update of the paper.

- L25 and further in the paper: the standard notation for "visible cross section" is "fiducial cross section", and it's used by theorists and ATLAS. I strongly suggest switching to this terms throughout the paper [see also detailed style comments]: "... in the fiducial and full phase space are performed."

%BLUE% >> Corrected.

- LL33-34: the sentence is not quite accurate as you do not include light leptons from τ
lepton decays in the definition of signal, but you account for those in the background.
Suggest modifying the sentence saying exactly that.

%BLUE% >> Corrected.

- L55: give a  reference to our recent trigger paper here.

%BLUE% >> Added (Khachatryan:2016bia 1609.02366).

- L91: give the MCFM version here (7.0 ?).

%BLUE% >> Yes, added.

- LL100-101: are you sure that the b tagging discriminators use PF objects, and not directly tracks? Please, double-check.

%BLUE% >> The CSV discriminator uses the tracks associated with the jet clustered from PF objects and the SV of the jet.
Moved b tagging discriminators to a separate sentence:
"Parameters of jets and the tracks associated with jets provide input variables for \cPqb tagging discriminators."

- LL113-114: the muon charge misidentification rate can't be measured with the Z(μμ) events in data as if the charged is misidentified, it's almost guaranteed that the momentum is grossly mismeasured and therefore the event is not within the Z peak any longer; the muon misidentification rate is therefore determined from Z(μμ) simulation, unlike the electron one. Please, correct the sentence.

%BLUE% >> Corrected.

- L131: give a reference to our first W/Z cross section paper for the tag-and-probe method.

%BLUE% >> Added.

- Figures 1, 3: single top -> single t [or single top quark] in the legends.

%BLUE% >> Corrected, "single top quark" everywhere.

- L161: cite the PDG here.

%BLUE% >> Added the citation.

- LL207-208: drop "within statistical uncertainties" - you already gave the number with the uncertainties and claimed that it's consistent with the expectation from simulation, which is self-explanatory.

%BLUE% >> Removed.

- Table 2: it's odd to see the third part of the table not having a subtitle, unlike the other three; suggest "Normalization uncertainties".

%BLUE% >> Added.


## STYLE COMMENTS:

Abstract, LL3-4: and was collected in proton-proton collisions at s√=13

TeV in 2016 with the CMS detector.

Introduction:

L2: proton-proton (pp) collisions;
LL7-8: τ
lepton produced is [τ

lepton is not a final-state particle!];
L9: light-dilepton channels;
L12: third-generation leptons;
LL12-13: to beyond the standard model (SM) contributions [see physics comments on LL10-11];
L16: in pp collisions;
LL17-18: in 2016 with the CMS detector at the LHC and corresponds to;
L20: at 7 and 8 TeV [5,6]. This is achieved;
L21: thus better constraining;
L23: between the light lepton and the missing transverse momentum;
L36: are given in Section 3;

The CMS detector:

L45: Charged-particle trajectories;
L48: anticlockwise-beam direction.
L50: calorimetry, and a brass and scintillator hadron;
L53: steel flux-return yoke of the solenoid.
LL55-56: most interesting pp collision events for further analysis.

Event simulation:

L57: suggest "Simulated event samples";
L58: add a comma before "as well";
L59: delete "in the final state" [τ
is not a final-state particle!];
LL61-62: next-to-leading order (NLO);
L62: mt=172.5 GeV [let LaTex to do the spacing!];
LL64,70: suggest using standard CMS \MGvATNLO symbol to typeset the generator name;
L66: leading order (LO) accuracy;
L68: of t channel [cf. L69];
LL69-70: s channel production is simulated with;
LL71,75,90: suggest dropping "8" from Pythia8;
L74: matrix element (ME) calculations. [You use the acronym ME later without ever defining it; also note that compound modifiers made of two nouns generally do not require hyphenation.]
L75: NNPDF Collaboration; end the line with a comma;
L78: pp interactions in the same or nearby bunch crossings (pileup, PU) are;
L79: the PU distribution;
L81: The next-to-next-to-leading order (NNLO) SM tt¯ production cross section;
LL82-83: is used for the normalization of the simulated signal samples.
L86: with the corresponding; The W+jets and DY+jets backgrounds [cf. LL65-66];
L87: The t

channel single;
L90: is normalized directly to the LO cross section calculation obtained with \PYTHIA.

Event reconstruction and selection:

L93: two b quark jets;
L96: subdetectors;
L99: add a comma before "such as"l
LL100-101: of all reconstructed PF objects, leptons;
L109: from PU vertices;
L110: from PU; pT
is;
L111: nonisolated [CMS Style];
L113: than 0.5 and 0.1\%;
L114: is measured using Z boson decays [30,31].
L115: Hadronic τ lepton decays;
L118: along the track bending direction to;
L127: The τ lepton charge;
L129: with same-sign (SS) μ and τh

.
L144: (``b tagged").
L147: light-flavour jets [UK English];
LL148-149: as shown in Fig, 1;
Fig, 1 caption, L2: (filled circles) are compared with simulation (solid histograms). L5: processes combined together, single top quark production (mainly tW); L6: diboson, and multijet production. L7: on the data points indicate;

Event categories and fit procedure:

L150: suggest "Event categories and cross section measurement";
L155: properties of jets;
LL159,162,163-164: non-b-tagged jets;
L159: add a comma before "including";
L164: superscript "min" in Roman;
L178: The effect of the systematic uncertainties in the;

Background estimate:

L182: jets, dominated by the lepton+jets tt¯
process, where;
L192: (as shown in Fig. 2) [don't tell a reader what to do!];
L194: with a misidentified τh

are;
LL199-200: candidates of SS. [The acronym is now introduced on L129.]
L201: within the uncertainties;
L205: where the multijet production is;

Systematical uncertainties:

L210: Systematic uncertainties;
L211: The main sources of the uncertainty are due to the τh
identification;
L212: PU description, jet energy scale (JES), and jet energy resolution (JER).
L213: and the estimate;
L216: The uncertainty in the;
L217: with genuine τh.
L219: uncertainty in the τh identification efficiency.
L222: mainly lepton+jets tt¯, W+jets, and multijet production.
L223: misidentification probability and;
L225: with a jet falsely identified as the τh candidate.
L226: misidentification probabilities and;
L228: source of the uncertainty;
L230: (light-flavour quarks);
L231: light-flavour jets;
L223: in the JES;
L234: The uncertainty in the JES;
LL237-238: an OS lepton pair with the invariant mass;
L239: are corrected with the; The uncertainties in the;
L240: The PU is;
L244: the uncertainty in the;
L245: parametrizations [UK English];
L246: uncertainties in the semileptonic branching fractions, according;
LL252-253: in the fiducial phase space of the detector. The fiducial cross section;
L255: and factorization scales, and PDFs, including the effect of alphaS variation.
L256: in the ME calculations are;
L257: factors of 0.5 and 2.0 from their nominal values;
L258: parton showering (PS) [you use the acronym later without defining it];
LL260-262: delete ⋅

in three spaces [not allowed by the CMS Style];
L263: in the fiducial phase space;

Results:

L267: from the signal and the backgrounds;
L268: is estimated using control samples in data, as described;
L269: all the selections are summarized;
L274: obtained from simulation.
Table 1 caption, L2: delete "for an ... 35.8 fb−1
" - this is implied throughout the paper. L5: of the data sample and; L6: of the simulation for other processes.
L277: with the SM expectations.
L278: uncertainties in the;
LL285-286: The fiducial cross section; is defined in the acceptance region satisfying the kinematic selections defined earlier.
LL286-287: in the fiducial phase space;
Fig. 3 caption, L2: (upper) and background-like (lower) event categories; LL3-4: (filled circles) are compared with simulation (solid histograms). L5: to the SM predictions. LL5-6: (eτh [Roman!] and μτh

final states); L8: on the data points indicate; L10: uncertainties in all simulated samples.
Table 2 caption, L2: and their combination. L3: The uncertainties in the; L7: data taking period;
Table 2 body, first column: swap the "muon momentum scale" and "electron momentum scale" rows to follow the natural order you use throughout the paper; diboson background; simulated sample size; data sample size;
L298: data taking period;
L299: as expected from the lepton flavour universality.
L301: of the partial widths, the;
L302: by the branching fraction;
L304: data taking period; the uncertainty in the;
L308: While in Ref. [9] the;

Summary:

L313: of 38.5 fb−1

obtained in;
L325: with the SM expectation.

Acknowledgements:

Please, use a longer version appropriate for regular papers.

References:

Ref. [34]: add the Erratum [as a doi reference].
Ref. [42]: typeset the Erratum as a doi reference.

That's all. Good luck with the remaining editorial work and timely submission!



# Thomas' fixes

1. DONE Check the main corrections -- are there any more questionable ones?
2. DONE Apply the rest on the branch.
3. DONE Make the diff pdf.


## Good points

using mT instead of MT
modelling instead of modeling

"is used to estimate" instead of "is used for the estimation of"

subdetectors instead of sub-detectors

substitute Opposite Sign (OS) by Opposite Charge (OC)
and Same Sign (SS) to Same Charge (SC)

branching fractions instead of branching ratios


## Questionable corrections

abstract "remove 2016 by":
collected in 2016 by the CMS detector
->
collected in the CMS detector

L19, replace “and it” with “, which”; delete “relative”; and replace “with respect” by “relative”.

%BLUE% >> Here we are trying to stress that we compare the relative precision of our measurement with the relative precisions in 7 and 8 TeV.
We have had misunderstandings in the comparisons of the absolute and relative precisions.
And we would like to keep "improves the relative precision with respect to 7 and 8 TeV" to make the point clear.

L19, replace “and it” with “, which”; delete “relative”; and replace “with respect” by “relative”.

-- replacing "and it" does not make sense:
"The measurement is extended to a higher energy and it improves"
->
"The measurement is extended to a higher energy, which improves"

-- the higher energy does not improve the precision, the new measurement method does

L22, replace “by performing” with “through a fit to”; put profile into quotation marks: “profile”; and replace “fit of” with “[Ref. for PLR] to”.

-- this way we get "the cross section is measured through a fit to a 'profile' likelihood ratio (PLR) to the transverse mass..."
I am not sure this is correct.

L319, replace “, in” with “system in our”; delete “according”.

-- this way we get
"The background is constrained ... in our two event categories, constructed according to the kinematic properties of the jets..."
->
"The background is constrained ... in our two event categories, according to the kinematic properties of the jets..."

which seems wrong.



## The main body of corrections

### Questionable

L58 The analysis makes use of simulated samples of tt events as well as other processes that result in τ leptons in the final state.

-- does not make sense to remove "samples of tt"

L59 "used to design the event selection, to calculate the acceptance..."
--> "used to design the event selections to calculate the acceptance..."

L100 "of the transverse momenta of any or all reconstructed particles," -- what is "any or all"?

L105 "pT_{ch}" insted of "E_{ch}" -- it is a definition, and it uses E? -- No! we use ET, so change it for pT

L138 substitute Opposite Sign (OS) by Opposite Charge (OC)

L143 endcaps -> end sectors, but at L112 endcaps -> end detectors

L186 "All processes, except multijet, are estimated from simulation"
-> "All, except multijet, events are estimated from simulation"

L191 "misidentification is determined...as a funtion of mT" -- it is not a function of mT, it is orthogonal to mT, that is why we can estimate it as a normalization parameter!

Figure 2: change the X and Y axes titles?

L253-254 "is extrapolated...by correcting the acceptance of the signal in ttbar data"???

L254 "acceptance includes the modelling of uncertainties" -- is this correct?

Table 1 "capitalize first letters of each set of words"
-- then the table will disagree with the text and the legends in figures

L267 (first sentece of "Results") using "number of events" instead of "event yields"?

L277 "<The observed and expected NLL>...in the e-tauh and mu-tauh final states combined are shown"
-> "... final states are shown combined"?

using "change" instead of "variation" for systematic uncertainties?

saying "fit to PLR" instead of "PLR fit"?


## The diff script

The `latexdiff` is complicated, it plugs many different commands to marks the changes in the text.
These commands are not standard, therefore special packages must be included in the CMS tdr system
to process them. More than that, they have some not trivial syntaxis and are not simply grep-able.

    latexdiff versions_TOP-18-005_CADI-BuildTag_2019-07-27_08-54-14.tex TOP-18-005.tex > TOP-18-005_revision_latexdiff.tex

The unified `diff` is much simpler and can work.
The only downside is it marks the whole line where a change appeared.

    diff -U 2000 versions_TOP-18-005_CADI-BuildTag_2019-07-27_08-54-14.tex TOP-18-005.tex > TOP-18-005_revision_diff-u.tex


Remove the first character space:

    :% s,^ ,,

Remove the differences in comments:

    :% s,^[+-][ \t]*%,%,

Clear up the comments:

    :% s,\([^\\]\{3}\)%,\1\r%,

Add the closing braces:

    :% g/^[-+]/ s/$/}/

Insert the openings:

    :% s,^-,\\textcolor{red}{,
    :% s,^+,\\textcolor{blue}{,


### with wdiff

wdiff -w "\textcolor{red}{" -x "}" -y "\textcolor{blue}{" -z "}" versions_TOP-18-005_CADI-BuildTag_2019-07-27_08-54-14.tex TOP-18-005.tex > TOP-18-005_revision_wdiff.tex

comments are a big problem
-- strip comments first?

sed -e '/^[ ]*%/d' -e 's,\([^\\]\)%.*$,\1,g' versions_TOP-18-005_CADI-BuildTag_2019-07-27_08-54-14.tex > versions_TOP-18-005_CADI-BuildTag_2019-07-27_08-54-14_nocomments.tex
sed -e '/^[ ]*%/d' -e 's,\([^\\]\)%.*$,\1,g' TOP-18-005.tex > versions_TOP-18-005_nocomments.rex

wdiff -w "\textcolor{red}{" -x "}" -y "\textcolor{blue}{" -z "}" versions_TOP-18-005_CADI-BuildTag_2019-07-27_08-54-14_nocomments.tex versions_TOP-18-005_nocomments.rex > TOP-18-005_revision_wdiff_nocomments.tex

make word_diff file_from=TOP-18-005.tex file_to=versions_TOP-18-005_at_corrections-Albert1-Alexandre1.tex

make word_diff file_from=versions_TOP-18-005_at_corrections-Albert1-Alexandre1.tex file_to=TOP-18-005.tex

it works!



# remaining questions TODO:

from Albert De Roeck

DONE
- line 90 Why is the multi-jet simulation normalised to Pythia? Surely Madgraph has its
    own normalisation. Is that one not ok?
    If that is done for a physics reason it may be useful to spell that out
    in 1/2 sentence here.

%BLUE% >> Indeed, the normalization comes from the generator, ie Madgraph, as discussed on [[https://twiki.cern.ch/twiki/bin/viewauth/CMS/SummaryTable1G25ns#QCD][the summary]] and [[https://twiki.cern.ch/twiki/bin/view/CMS/HowToGenXSecAnalyzer][the tool]] twikies, and also [[https://hypernews.cern.ch/HyperNews/CMS/get/susy-interpretations/196/1/1/1.html][in this thread]].
The sentence was just forgotten because the simulated multijet events are not mentioned in the paper.
The simulated multijet events are used only for the verification of the data-driven method in the Analysis Note.
Therefore, I remove this line about the normalization of MC multijet altogether.

DONE
- line 200: Using the "same charge" sample: is that a good background estimator? We have a non-negligable charge misidentification, ie real signal event that will end up as an (SS) event. What is the contamination of real events, which became SS, compared to the total you select for this background estimator? if small then it is ok of course. 

%BLUE% >> In the SS selection the signal events comprize about 4.5% of events. But the effect of the signal events on the extraction of the QCD contribution is smaller than that, because the shapes of QCD and the signal are different.
The distribution of QCD events is concentrated at lower values of the transverse mass, up to 100GeV (150GeV) in muon-tau (electron-tau) final state.
And the signal is more smeared across the spectrum, with a peak at about 80-90GeV.
More specifically, in the Same Sign muon-tau selection the fraction of signal events is about 3-4% in the mT bins up to 80 GeV.
And the fraction of QCD events is about 10%.
Therefore, the variation of the signal contribution due to the uncertainty in the tauh charge misidentification does not affect significantly the shape of the QCD estimated in the Same Sign selection.

in principle, the good part is that QCD and signal are in different parts of the mT distribution.

mis-charge signal in mu selection: 176.57732241801028

data-driven multijet in the table: 122 + 231 = 353

the sum in SS
INFO:root:data       =     3905.000000      229.437170
INFO:root:mc sum     =     3565.270126     3565.270126

176.57732241801028 / 3905.000000
0.04521826438361339

per bin

distrs/v37_test15_bunchFULLFIT1/SingleMuon.root
distrs/v37_test15_bunchFULLFIT1_mc_1.root
histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats.root

root [4] ((TH1D*) mu_sel_ss->Get("data_other/NOMINAL/mu_sel_ss_data_other_NOMINAL_Mt_lep_met_c"))->GetBinContent(1)
(Double_t) 496.000
root [5] ((TH1D*) mu_sel_ss->Get("data_other/NOMINAL/mu_sel_ss_data_other_NOMINAL_Mt_lep_met_c"))->GetBinContent(2)
(Double_t) 513.000
root [6] ((TH1D*) mu_sel_ss->Get("data_other/NOMINAL/mu_sel_ss_data_other_NOMINAL_Mt_lep_met_c"))->GetBinContent(3)
(Double_t) 724.000
root [7] ((TH1D*) mu_sel_ss->Get("data_other/NOMINAL/mu_sel_ss_data_other_NOMINAL_Mt_lep_met_c"))->GetBinContent(4)
(Double_t) 880.000
root [8] ((TH1D*) mu_sel_ss->Get("data_other/NOMINAL/mu_sel_ss_data_other_NOMINAL_Mt_lep_met_c"))->GetBinContent(5)
(Double_t) 661.000
root [9] ((TH1D*) mu_sel_ss->Get("data_other/NOMINAL/mu_sel_ss_data_other_NOMINAL_Mt_lep_met_c"))->GetBinContent(6)
(Double_t) 434.000
root [10] ((TH1D*) mu_sel_ss->Get("data_other/NOMINAL/mu_sel_ss_data_other_NOMINAL_Mt_lep_met_c"))->GetBinContent(7)
(Double_t) 111.000

root [7] ((TH1D*) mu_sel_ss->Get("tt_mutau/NOMINAL/mu_sel_ss_tt_mutau_NOMINAL_Mt_lep_met_c"))->GetBinContent(1) * 35900
(double) 18.4494
root [8] ((TH1D*) mu_sel_ss->Get("tt_mutau/NOMINAL/mu_sel_ss_tt_mutau_NOMINAL_Mt_lep_met_c"))->GetBinContent(2) * 35900
(double) 19.6502
root [9] ((TH1D*) mu_sel_ss->Get("tt_mutau/NOMINAL/mu_sel_ss_tt_mutau_NOMINAL_Mt_lep_met_c"))->GetBinContent(3) * 35900
(double) 20.5049
root [10] ((TH1D*) mu_sel_ss->Get("tt_mutau/NOMINAL/mu_sel_ss_tt_mutau_NOMINAL_Mt_lep_met_c"))->GetBinContent(4) * 35900
(double) 23.0711
root [11] ((TH1D*) mu_sel_ss->Get("tt_mutau/NOMINAL/mu_sel_ss_tt_mutau_NOMINAL_Mt_lep_met_c"))->GetBinContent(5) * 35900
(double) 26.8025
root [12] ((TH1D*) mu_sel_ss->Get("tt_mutau/NOMINAL/mu_sel_ss_tt_mutau_NOMINAL_Mt_lep_met_c"))->GetBinContent(6) * 35900
(double) 33.9440
root [13] ((TH1D*) mu_sel_ss->Get("tt_mutau/NOMINAL/mu_sel_ss_tt_mutau_NOMINAL_Mt_lep_met_c"))->GetBinContent(7) * 35900
(double) 19.1332

root [3] ((TH1D*) mu_sel->Get("qcd_other/NOMINAL/mu_sel_qcd_NOMINAL_Mt_lep_met_c"))->GetBinContent(1)
(Double_t) 60.4974
root [4] ((TH1D*) mu_sel->Get("qcd_other/NOMINAL/mu_sel_qcd_NOMINAL_Mt_lep_met_c"))->GetBinContent(2)
(Double_t) 54.9846
root [5] ((TH1D*) mu_sel->Get("qcd_other/NOMINAL/mu_sel_qcd_NOMINAL_Mt_lep_met_c"))->GetBinContent(3)
(Double_t) 61.8442
root [6] ((TH1D*) mu_sel->Get("qcd_other/NOMINAL/mu_sel_qcd_NOMINAL_Mt_lep_met_c"))->GetBinContent(4)
(Double_t) 90.0294
root [7] ((TH1D*) mu_sel->Get("qcd_other/NOMINAL/mu_sel_qcd_NOMINAL_Mt_lep_met_c"))->GetBinContent(5)
(Double_t) 47.1595
root [8] ((TH1D*) mu_sel->Get("qcd_other/NOMINAL/mu_sel_qcd_NOMINAL_Mt_lep_met_c"))->GetBinContent(6)
(Double_t) 21.9071
root [9] ((TH1D*) mu_sel->Get("qcd_other/NOMINAL/mu_sel_qcd_NOMINAL_Mt_lep_met_c"))->GetBinContent(7)
(Double_t) 7.51175

 60.4974 / 496.000
 54.9846 / 513.000
 61.8442 / 724.000
 90.0294 / 880.000
 47.1595 / 661.000
 21.9071 / 434.000
 7.51175 / 111.000

 18.4494 / 496.000
 19.6502 / 513.000
 20.5049 / 724.000
 23.0711 / 880.000
 26.8025 / 661.000
 33.9440 / 434.000
 19.1332 / 111.000

(double) 0.121971
(double) 0.107182
(double) 0.0854202
(double) 0.102306
(double) 0.0713457
(double) 0.0504772
(double) 0.0676734

(double) 0.0371964
(double) 0.0383045
(double) 0.0283217
(double) 0.0262172
(double) 0.0405484
(double) 0.0782120
(double) 0.172371


............

check the SS distribution? how much of the signal is in the QCD region?

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc_withTauSys.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root     --output-type pdf -o plots/v37_test172_paper_plots/ --data-nick data_other --overwrite --ratio-range 0.55 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35900 -c mu_sel_ss -x mu_selVloose_ss -d Mt_lep_met_f --wjet 1.4  --title "" --title-x "##font[12]{m}_{T} [GeV]" --title-y "Events" --draw-overflows 2 --legend-shift 0.05     --font-size-axes-titles 40 --font-size-axes-labels 30 --margin-y 0.14 --offset-y 1.2 --margin-x 0.4 --offset-x 3. --no-horizontal-error-bars

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc_withTauSys.root distrs/v37_test172_bunchCONTROLS1/SingleElectron.root --output-type pdf -o plots/v37_test172_paper_plots/ --data-nick data_other --overwrite --ratio-range 0.55 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35900 -c el_sel_ss -x el_selVloose_ss -d Mt_lep_met_f --wjet 1.4  --title "" --title-x "##font[12]{m}_{T} [GeV]" --title-y "Events" --draw-overflows 2 --legend-shift 0.05     --font-size-axes-titles 40 --font-size-axes-labels 30 --margin-y 0.14 --offset-y 1.2 --margin-x 0.4 --offset-x 3. --no-horizontal-error-bars





Sasha

DONE
lines 13-14  There are both CMS and ATLS H+ -> tau nu analyses with 13 TeV, 2016 data. Why do not cite them at this point ?

%BLUE% >> In order to avoid detailed overview of the results of the searches in various final states, we limited the references to the theory and phenomenology of the charged Higgs.
But I've added two references to the recent searches of H+->tau nu.

DONE
line 89-90 QCD multijet events were generated with aMC@NLO. What is the reason to normalize it on PYTHIA8 LO
cross-section ?

%BLUE% >> Indeed, the normalization comes from the generator, ie Madgraph, as discussed on [[https://twiki.cern.ch/twiki/bin/viewauth/CMS/SummaryTable1G25ns#QCD][the summary]] and [[https://twiki.cern.ch/twiki/bin/view/CMS/HowToGenXSecAnalyzer][the tool]] twikies, and also [[https://hypernews.cern.ch/HyperNews/CMS/get/susy-interpretations/196/1/1/1.html][in this thread]].
The sentence was just forgotten because the simulated multijet events are not mentioned in the paper.
The simulated multijet events are used only for the verification of the data-driven method in the Analysis Note.
Therefore, I remove this line about the normalization of MC multijet altogether.

DONE
Table 1  please, add  contribution from tt -> (tau_l nu_tau) (tau_h nu_tau) b b_bar as a separate line

%BLUE% >> We would like to avoid adding a separate line for this final state in the table in order to keep the table in sync with the figures.





From Thomas:

And I must confess that L252--265 seem somewnat crazy!
You are not "varying" anything when you make the changes by the specified factors.
I think I understand what you mean, but not because you have been helpful.
You repeat the old ways this has been stated in the past, which I find very much wanting.

TODO: this ^^^

And I hope that you can make your results quantitatively clearer in the Summary – e.g., by stating things in terms of how much you have improved on previous measurements.
Finally, you keep talking about cross sections and ratios of widths, but you often seem to not maintain clarity what these widths and cross sections mean. For example, the mu, e, and ell values can be similar only if ell is either mu or e, or the mean of mu and e. And you don't specify which widths you are discussing. I am not sure if the “total” width is that of the top quark or that for all the dileptons states? And also I am not sure whether you have identified the 781pb with the total t\tbar cross section (all channels).

TODO: this ^^^



DONE: do not forget to change mT in figures!




# CWR comment from Thomas Ferbel   (https://cds.cern.ch/record/2684836)

You seem often to be tripping over your own words, and thereby writing things difficult to follow. Some places contain extra, unneeded words. Several symbols appear to be from a previous generation of usage, which indicates that the authors and the CLE have not looked at a recent version of our PubCom guidelines. I hope to have caught most of your transgressions in our standard nomenclature, and trust that my corrections will be entered into the text with care. 

We no longer use a dot to signify multiplication but recommend using nothing or \times if that is essential; we now use the symbols pT and no longer those such as ET; we also recommend the use of "subdetector", "nonisolated" and "semileptonic" and not their hyphenated spellings. In addition, our terms for any mass usually use a lower-case m, thus transverse mass would be written as mT and not as MT. We don’t use branching “ratio” but “fraction”. Since you seem to have chosen UK English as your writing style, be aware that you should use "modelling" and not "modeling" in your draft. And I must confess that L252--265 seem somewnat crazy! You are not "varying" anything when you make the changes by the specified factors. I think I understand what you mean, but not because you have been helpful. You repeat the old ways this has been stated in the past, which I find very much wanting. Your term "visible" should be changed to "fiducial", as there is nothing visible about it. Why do you add the extra "al" to "kinematic" and "systematic"? And I hope that you can make your results quantitatively clearer in the Summary – e.g., by stating things in terms of how much you have improved on previous measurements. Finally, you keep talking about cross sections and ratios of widths, but you often seem to not maintain clarity what these widths and cross sections mean. For example, the mu, e, and ell values can be similar only if ell is either mu or e, or the mean of mu and e. And you don't specify which widths you are discussing. I am not sure if the “total” width is that of the top quark or that for all the dileptons states? And also I am not sure whether you have identified the 781pb with the total t\tbar cross section (all channels).

Nevertheless, you have put together an excellent analysis, and presented the reader with a manuscript that can be fixed without much trouble. Of course, you may not agree with my recommendations, but I urge you not to reject them out of hand and check with your colleagues about my changes. Also check out my comments on the captions and figures. 

I have added below in .doc format questions for sections that are usually discussed at the FR, but I provide recommendations for the entire draft using standard Adobe Acrobat tools for editing PDF files. Hope that you can consider both possibilities.

                                                                 Good luck with your next draft, Tom.

Title:

L2, replace “including” with “that contains one”

L3, replace “proton-proton” with “pp”. [This is overkill. Surely, anyone reading this will not be confused by the use of the simpler “pp”.]

 

Abstract:

L1,  replace “of the” with “for”; replace “process” with “is measured in the”; insert “final state” after “\bbar”; and delete “is mea-”.

L2, delete “sured,”; delete the first “the”; replace “hadronic decays of the” with “all-hadron final state of the decayed; replace “=” with “is either an”; and replace “,” with “or a”.

L3, delete “sample” and “and was”.

L4, delete “2016 by”; and replace “proton-proton” with “pp”.

L5, replace “. The” with “and the”.

L6, clarify which “widths” you mean by inserting information (all top quark or just all ell-ell channels).

Introduction:

L2, delete “mostly”; insert “mainly” before second “in”; and replace “with” by “and”.

L3, delete the first “the”; change “subsequent” to “subsequently”.

L5, insert “wise consider” before final “the”.

L6, delete “is considered”; and insert “either” after “into”.

L8, replace “is approximately 6% (” with “corresponds to \approx”; delete “)”; and replace “higher” with “larger”.

L10, replace “measurements” with “checks”; and delete “due to”.

L11, replace “some tensions with” by “in the possibility of violations of”; delete “this final state,”; and insert “particular,” before “the”.

L12, delete “exclusively”; insert a hyphen after “third”; and replace “, which” with “that because of their large masses”

L13, delete “due to their large masses”.

L14, delete “directly”; and replace “observable” with “observed”.

L16, insert “, in fact,” after “is”; and change “proton-proton” to “pp”.

L17, delete “sample was” and “2016 by”.

L18, delete “and it”.

L19, replace “and it” with “, which”; delete “relative”; and replace “with respect” by “relative”.

L20, delete the first “the”; replace “improved” with “higher”; and replace “by using” with “through”.

L21, delete “shape”; replace “properties” with “distributions”; replace “thus” by “that”; and change “constraining” to “constrain”.

L22, replace “by performing” with “through a fit to”; put profile into quotation marks: “profile”; and replace “fit of” with “[Ref. # for PLR] to”.

L23, replace “between” with “of the system containing the”; insert “the” after “and”; and insert “in the event, separately” after “momentum”; and delete “, in two categories of selected events”.

L24, delete “, separately” and “experimental”.

L25, insert “are performed” after “sections”; replace “visible” with “chosen fiducial”; and delete “are performed”.

L27, change “earlier” to “the previous”. [And also add something after “width,” e.g., “of all the dilepton states” or “of the top quark”.] 

L29, change “Experimentally, the” to “The”; and replace “by” with “through”.

L30, replace the “approx/equal” with “\approx”.

L31, replace the “approx/equal” with “\approx”; replace “In the first case, the” with “The”; and replace “produces” with “decays into”.

L32, replace “in the case of” with “but its”; replace “, the distinction” with “are difficult to distinguish”; and delete “is ex-“.

L33, delete “perimentally difficult”; replace “ell” by “we therefore”; change “does” to “do”; and insert “consider the” after “only”.

L34, replace “hadronically are considered” with “to hadrons and \nu\tau.

L35, after “2” replace the comma by a semicolon.

L36, replace “of” by “about”; insert “event” before “samples”; and delete the second “the”.

L37, delete “event”; change the comma after “4” to a semicolon.

L39, delete the first “the”.

L40, delete “both”; replace “width” with “their  partial widths relative to their total values” [And decide whether anything else is needed after “widths”.]; insert “and” before “the”; and insert “briefly” before “in”.

Summary:

L313, insert “where“ before first “ell”;  replace “= e,” by “is either an e or a”; replace “using a data sample with” with “by CMS in pp collisions at the LHC, corresponding to”; and delete “in”. 

L314, delete “proton-proton collisions”.

L315, remove the hyphen in “b tagged”.

L316, delete “hadronically decaying”; replace “, “  with “decaying to hadrons (“; and insert “)” and a neutrino" after “h“ [This whole part becomes “identified as a \tau lepton decaying to hadrons (\tauh) and a neutrino.”]; and change “comes” to “arises”.

L318, replace “of” with “in”; and replace “between” with “of the”. 

L319, replace “, in” with “system in our”; delete “according”.

L320, replace “In the fit, the” with “The”.

L323, delete “relative”; replace “with respect” with “relative”.

L324, insert “by \approx X%” before “[“; insert “total t\tbar” before “cross”.

L326, replace “divided by” with “”to”.

L328, insert “of the top quark” after “width”?

L329, replace “with respect to” with “through”.



# same two last comments

Thomas https://cds.cern.ch/record/2684836
Sasha  https://cds.cern.ch/record/2685067?ln=en

## Sasha

DONE
lines 13-14  There are both CMS and ATLS H+ -> tau nu analyses with 13 TeV, 2016 data. Why do not cite them at this point ?

DONE
line 89-90 QCD multijet events were generated with aMC@NLO. What is the reason to normalize it on PYTHIA8 LO
cross-section ?

DONE
Table 1  please, add  contribution from tt -> (tau_l nu_tau) (tau_h nu_tau) b b_bar as a separate line




Please, find below comments of Type B.

lines 8-9  I do not understand 5/81 and 4/81. I understand 5 (etau, mutau,
taue, taumu, tautau), but what is 81 ? The total number of ll' combinations
is 9, no ?

%BLUE% >> Indeed, we could just focus on the combinatorics between leptons and the comparison between final states with taus and without.
But in order to provide a context to the reader we consider all W decays, their "naive" branching fractions: 1/9 for each leptonic final state and 6/9 for the quark final states.

lines 13-14  There are both CMS and ATLS H+ -> tau nu analyses with 13 TeV, 2016 data. Why do not cite them at this point ?

%BLUE% >> In order to avoid detailed overview of the results of the searches in various final states, we limited the references to the theory and phenomenology of the charged Higgs.
I've added two references to the recent searches of H+->tau nu.


line 23 add after lepton "(electron or muon)", othrwise one could think about tau lepton (tau_h)

%BLUE% >> Added.

lines 24-25 one can not measure "directly"  cross-section in the "full space". You measure the visible cross-section and go to the total cross-section using MC.

%BLUE% >> Corrected.

line 81 mention that this tt~ cross-section is for mt = 172.5 GeV if it is the case.

%BLUE% >> Added.

line 89-90 QCD multijet events were generated with aMC@NLO. What is the reason to normalize it on PYTHIA8 LO
cross-section ?

%BLUE% >> Indeed, the normalization comes from the generator, ie Madgraph, as discussed on [[https://twiki.cern.ch/twiki/bin/viewauth/CMS/SummaryTable1G25ns#QCD][the summary]] and [[https://twiki.cern.ch/twiki/bin/view/CMS/HowToGenXSecAnalyzer][the tool]] twikies, and also [[https://hypernews.cern.ch/HyperNews/CMS/get/susy-interpretations/196/1/1/1.html][in this thread]].
The sentence was just forgotten because the simulated multijet events are not mentioned in the paper.
The simulated multijet events are used only for the verification of the data-driven method in the Analysis Note.
Therefore, I remove this line about the normalization of MC multijet altogether.

line 97  Please replace "produced in the collision" by "in the event".  For example brem. photons or e+e- from
gamma conversions are not produced in the pp collision, but produced after that in the tracker material.

%BLUE% >> Corrected.

In Section 6 it is not quite clear about background evaluation from the fit. Do you use the normalization and shapes
from MC (except QCD) and you vary normalization within uncertainties in the fit ? If yes, mention it more clear.

%BLUE% >> Added an explanation.




line 223  I do not undertand this sentence about the measurement of tau missID from the fit. Is this 50 % uncertainty
value recommended in tau ID paper at 13 TeV that you have cited ?

%BLUE% >> The tau ID paper does not recommend a specific treatment of misidentified taus, but it demonstrates the typical behaviour of the misidentification in several selections of events.
In these selections the Data-MC disagreement for the misidentification probability varies around 20-30%, depending on pT, eta and the kind of jets you have in the given selection.
So, the pre-fit variation of 50% is a conservative value. But reducing it to 20% reduces the overal uncertainty by only about 0.1%.
Therefore, we have decided to stick with the conservative magnitude of the prefit variation.
Also, we had considered using a free parameter for the tau misidentification in the fit, but discarded it due to issues in the fitting software.

Line 282-284  I do not understand this sentence "The effect of these uncertainties on final state objects ..."
How QCD scale and PDF uncertainty can make an effect on the final state objects like jet, muon, electron ?

%BLUE% >> It still can affect their kinematic distribution within the fiducial space of the detector.

Table 1  please, add  contribution from tt -> (tau_l nu_tau) (tau_h nu_tau) b b_bar as a separate line

%BLUE% >> We would like to avoid adding a separate line for this final state in the table in order to keep the table in sync with the figures.

line 289  Does acceptance A include BR (W->tau nu) ? It looks like it is, since you get the total cross-section
as sigma_tot = sigma_vis / A.  In that sence I do not understand R_gamma evaluation (line 301). You just multiply your sigma_tot
by BR(W->tau nu).

%BLUE% >> The BR(W->tau nu) is included in the fiducial cross section, the acceptance is just the fraction of signal events passing in the fiducial space of the detector.
Indeed, R_gamma is calculated with sigma_tot multiplied by BR(W->tau nu), which cancels out the BR(W->tau nu) included in the sigma_tot.
Therefore, R_gamma includes only the BR(W-> e/mu) that is included in the measurement in dilepton channels.



## Thomas

You seem often to be tripping over your own words, and thereby writing things difficult to follow. Some places contain extra, unneeded words. Several symbols appear to be from a previous generation of usage, which indicates that the authors and the CLE have not looked at a recent version of our PubCom guidelines. I hope to have caught most of your transgressions in our standard nomenclature, and trust that my corrections will be entered into the text with care. 

We no longer use a dot to signify multiplication but recommend using nothing or \times if that is essential;
we now use the symbols pT and no longer those such as ET;
we also recommend the use of "subdetector", "nonisolated" and "semileptonic" and not their hyphenated spellings.
In addition, our terms for any mass usually use a lower-case m, thus transverse mass would be written as mT and not as MT.


We don’t use branching “ratio” but “fraction”.
Since you seem to have chosen UK English as your writing style, be aware that you should use "modelling" and not "modeling" in your draft.

And I must confess that L252--265 seem somewnat crazy!
You are not "varying" anything when you make the changes by the specified factors.
I think I understand what you mean, but not because you have been helpful.
You repeat the old ways this has been stated in the past, which I find very much wanting.

TODO: this ^^^

Your term "visible" should be changed to "fiducial", as there is nothing visible about it.
Why do you add the extra "al" to "kinematic" and "systematic"?

And I hope that you can make your results quantitatively clearer in the Summary – e.g., by stating things in terms of how much you have improved on previous measurements.
Finally, you keep talking about cross sections and ratios of widths, but you often seem to not maintain clarity what these widths and cross sections mean. For example, the mu, e, and ell values can be similar only if ell is either mu or e, or the mean of mu and e. And you don't specify which widths you are discussing. I am not sure if the “total” width is that of the top quark or that for all the dileptons states? And also I am not sure whether you have identified the 781pb with the total t\tbar cross section (all channels).

TODO: this ^^^

Nevertheless, you have put together an excellent analysis, and presented the reader with a manuscript that can be fixed without much trouble. Of course, you may not agree with my recommendations, but I urge you not to reject them out of hand and check with your colleagues about my changes. Also check out my comments on the captions and figures. 

I have added below in .doc format questions for sections that are usually discussed at the FR, but I provide recommendations for the entire draft using standard Adobe Acrobat tools for editing PDF files. Hope that you can consider both possibilities.

                                                                 Good luck with your next draft, Tom.

Title:

L2, replace “including” with “that contains one”

L3, replace “proton-proton” with “pp”. [This is overkill. Surely, anyone reading this will not be confused by the use of the simpler “pp”.]

 

Abstract:

L1,  replace “of the” with “for”; replace “process” with “is measured in the”; insert “final state” after “\bbar”; and delete “is mea-”.

L2, delete “sured,”; delete the first “the”; replace “hadronic decays of the” with “all-hadron final state of the decayed; replace “=” with “is either an”; and replace “,” with “or a”.

L3, delete “sample” and “and was”.

L4, delete “2016 by”; and replace “proton-proton” with “pp”.

TODO: why delete "2016 by"? "collected in 2016 by CMS detector"

L5, replace “. The” with “and the”.

L6, clarify which “widths” you mean by inserting information (all top quark or just all ell-ell channels).




Introduction:

L2, delete “mostly”; insert “mainly” before second “in”; and replace “with” by “and”.

L3, delete the first “the”; change “subsequent” to “subsequently”.

L5, insert “wise consider” before final “the”.

L6, delete “is considered”; and insert “either” after “into”.

L8, replace “is approximately 6% (” with “corresponds to \approx”; delete “)”; and replace “higher” with “larger”.

L10, replace “measurements” with “checks”; and delete “due to”.

L11, replace “some tensions with” by “in the possibility of violations of”; delete “this final state,”; and insert “particular,” before “the”.

L12, delete “exclusively”; insert a hyphen after “third”; and replace “, which” with “that because of their large masses”

L13, delete “due to their large masses”.

L14, delete “directly”; and replace “observable” with “observed”.

L16, insert “, in fact,” after “is”; and change “proton-proton” to “pp”.

L17, delete “sample was” and “2016 by”.

L18, delete “and it”.



L19, replace “and it” with “, which”; delete “relative”; and replace “with respect” by “relative”.

%BLUE% >> here we are trying to stress that we compare the relative precision of our measurement with the relative precisions in 7 and 8 TeV.
We would like to leave "improves the relative precision with respect to 7 and 8 TeV" to keep it clear.

%BLUE% >> Here we are trying to stress that we compare the relative precision of our measurement with the relative precisions in 7 and 8 TeV.
We have had misunderstandings in the comparisons of the absolute and relative precisions.
And we would like to keep "improves the relative precision with respect to 7 and 8 TeV" to make the point clear.

L20, delete the first “the”; replace “improved” with “higher”; and replace “by using” with “through”.

L21, delete “shape”; replace “properties” with “distributions”; replace “thus” by “that”; and change “constraining” to “constrain”.

L22, replace “by performing” with “through a fit to”; put profile into quotation marks: “profile”; and replace “fit of” with “[Ref. # for PLR] to”.

L23, replace “between” with “of the system containing the”; insert “the” after “and”; and insert “in the event, separately” after “momentum”; and delete “, in two categories of selected events”.

L24, delete “, separately” and “experimental”.



L25, insert “are performed” after “sections”; replace “visible” with “chosen fiducial”; and delete “are performed”.

L27, change “earlier” to “the previous”. [And also add something after “width,” e.g., “of all the dilepton states” or “of the top quark”.] 

L29, change “Experimentally, the” to “The”; and replace “by” with “through”.

L30, replace the “approx/equal” with “\approx”.

L31, replace the “approx/equal” with “\approx”; replace “In the first case, the” with “The”; and replace “produces” with “decays into”.

L32, replace “in the case of” with “but its”; replace “, the distinction” with “are difficult to distinguish”; and delete “is ex-“.

L33, delete “perimentally difficult”; replace “ell” by “we therefore”; change “does” to “do”; and insert “consider the” after “only”.

L34, replace “hadronically are considered” with “to hadrons and \nu\tau.

L35, after “2” replace the comma by a semicolon.

L36, replace “of” by “about”; insert “event” before “samples”; and delete the second “the”.

L37, delete “event”; change the comma after “4” to a semicolon.

L39, delete the first “the”.

L40, delete “both”; replace “width” with “their  partial widths relative to their total values” [And decide whether anything else is needed after “widths”.]; insert “and” before “the”; and insert “briefly” before “in”.






Summary:

L313, insert “where“ before first “ell”;  replace “= e,” by “is either an e or a”; replace “using a data sample with” with “by CMS in pp collisions at the LHC, corresponding to”; and delete “in”. 

L314, delete “proton-proton collisions”.

L315, remove the hyphen in “b tagged”.

L316, delete “hadronically decaying”; replace “, “  with “decaying to hadrons (“; and insert “)” and a neutrino" after “h“ [This whole part becomes “identified as a \tau lepton decaying to hadrons (\tauh) and a neutrino.”]; and change “comes” to “arises”.

L318, replace “of” with “in”; and replace “between” with “of the”. 

L319, replace “, in” with “system in our”; delete “according”.

L320, replace “In the fit, the” with “The”.

L323, delete “relative”; replace “with respect” with “relative”.

%BLUE% >> here we are trying to stress that we compare the relative precision of our measurement with the relative precisions in 7 and 8 TeV.
We would like to leave "improves the relative precision with respect to 7 and 8 TeV" to keep it clear.

%BLUE% >> Here we are trying to stress that we compare the relative precision of our measurement with the relative precisions in 7 and 8 TeV.
We have had misunderstandings in the comparisons of the absolute and relative precisions.
And we would like to keep "improves the relative precision with respect to 7 and 8 TeV" to make the point clear.                                                                                                                                                               

L324, insert “by \approx X%” before “[“; insert “total t\tbar” before “cross”.

L326, replace “divided by” with “”to”.

L328, insert “of the top quark” after “width”?

L329, replace “with respect to” with “through”.

DONE these..





# CWR comment from Albert De Roeck (https://cds.cern.ch/record/2684497)

 - line 27: "complementing earlier measurements". You mean complementary in the sense that
   we are the first measurement of this channel at 13 TeV? For the ratios I assume our 
   measurements are more precise than eg the ATLAS ones or our own CMS ones at 7 and 8 
   TeV? If so I believe we are underselling the value of work in this paper.  
   I did not check by how much we actually improve the 
   precision here but we could comment on that in the results section.
   I have the same comment for line 309/310 where we use the same phrasing.

%BLUE% >> Changed it to "expanding earlier measurements in terms of precision and centre of mass energy of collisions."
The relative precision is improved by about 1.5% with respect to the measurements from hadron colliders (CDF and ATLAS):
from slightly more than 8% in the result by ATLAS, to slightly less than 7% in our measurement.
Since the uncertainty is still of the same order of magnitude, and also the results from LEP have much higher precision (3%),
we decided to avoid a discussion of the improvement of the precision.

- line 74: Traditionally we give (for the record here) also the matching schemes used
    ie MLM/FXFX../ as appropriate. This sounds trivial but there are other options, 
    so it is good to keep the tradition to keep mentioning them... so we remember in
    some years from now.  :)

%BLUE% >> Specified and added citations.

- line 90 Why is the multi-jet simulation normalised to Pythia? Surely Madgraph has its 
    own normalisation. Is that one not ok?
    If that is done for a physics reason it may be useful to spell that out 
    in 1/2 sentence here.

%BLUE% >> Indeed, the normalization comes from the generator, ie Madgraph, as discussed on [[https://twiki.cern.ch/twiki/bin/viewauth/CMS/SummaryTable1G25ns#QCD][the summary]] and [[https://twiki.cern.ch/twiki/bin/view/CMS/HowToGenXSecAnalyzer][the tool]] twikies, and also [[https://hypernews.cern.ch/HyperNews/CMS/get/susy-interpretations/196/1/1/1.html][in this thread]].
The sentence was just forgotten because the simulated multijet events are not mentioned in the paper.
The simulated multijet events are used only for the verification of the data-driven method in the Analysis Note.
Therefore, I remove this line about the normalization of MC multijet altogether.

- line 104: Do we require the leptons to come from the primary vertex. Please say that in   
    the text

%BLUE% >> Added the sentence on PV in previous paragraph and mentioned that leptons must originate from PV.

- line 104: ...And somewhere before we should define the primary vertex anyway, eg in the 
    paragraph just above this one?

%BLUE% >> Added the sentence on PV.

- line 106 E_CH: These hadron are required to come from the primary vertex right?
     (add that, and the primary vertex definition as requested above)

%BLUE% >> Yes, corrected.

- line 125: It is not clear to the non-CMS reader here what lifetime information you mean 
   and where does it come from (detector or information-wise), from the discussion so far. 

%BLUE% >> Added an explanation.








- line 140: the pseudo-rapidity variable was already introduced in line 47.

%BLUE% >> I have moved the definition of DeltaR up, to the "E_CH is ... deposited ... within a cone of $\Delta R = \sqrt{(\Delta\varphi)^2 + (\Delta\eta)^2} = 0.4$".
And skipped the explanation of the phi and the pseudo-rapidity here, since they are described in the description of the detector, at line 47.

- line 162: So the two categories are a 'signal-like' and a 'background-like' category,
    right? I somehow did not find that 100% clear, but this is how I interpreted the text.  
    If that is wrong, it needs more clarification.

%BLUE% >> This is correct. I have added quotation marks, which should make it clear:
"The event is assigned to the ``signal-like'' category if..." and "Otherwise, it is assigned to the ``background-like'' event category."
In the following I use these names without the quotation marks.

- line 200: Using the "same charge" sample: is that a good background estimator?
    We have a non-negligable charge misidentification, ie real signal event that will end
    up as an (SS) event. 
    What is the contamination of real events, which became SS, compared to the 
    total you select for this background estimator? if small then it is ok of course.

%BLUE% >> 

- reference 38 This is pointing to a paper for JES corrections 8 TeV/run-1. We do 
    not have a reference for the 13 TeV data yet?  I thought I saw that being used in 
    other papers already. please check.

%BLUE% >> I am afraid the 8 TeV reference is correct, since it correcponds to [[https://hypernews.cern.ch/HyperNews/CMS/get/jes/648/1/1/1.html][Summer16 corrections which were used]].
We decided to stick with the original 2016 corrections, since this way we are in sync with the measurement in dileptons and can profit from the correlations in systematics.

- line 244-247: say why this is of particular importance to this analysis?
    We have many analyses published using b-tagging where we do not particularly spell 
    this out. Here it seems to be more important when looking at table 2...

%BLUE% >> Indeed, the b quark fragmentation is one of the largest modeling uncertainties, as evident from Table 2.
Also we would like to keep these sentences in the style of the rest of the section,
where each source of systematic uncertainty has a brief description.

- check 47,48: Is taking the full difference taken as the uncertainty not too pessimistic?  (what about half?)

%BLUE% >> The results of the papers on top pT re-weighting are further summarized in [[https://twiki.cern.ch/twiki/bin/view/CMS/TopPtReweighting][the prescriptions]] for the re-weighting from the Top PAG group.
We estimate this effect according to the prescriptions. They consider both the measurements in Run1 and Run2.
The variation is measured from the distributions of kinematic parameters, so that the full magnitude covers the difference in the distributions.

- line 257: In the scale variations, are the combinations like (0.5,2) for the independent
  variations of the two scales also included? This is generally considered to be too 
  pessimistic and these combinations shouldn't be included in the systematic uncertainty.

%BLUE% >> Yes, the independent variations of the scales are included.
Together with the simultaneous variation of both scales they form an envelope of the scale variation.
This procedure follows [[https://twiki.cern.ch/twiki/bin/viewauth/CMS/TopSystematics#Factorization_and_renormalizatio][the prescriptions]] from the Top PAG group.

- line 250: FSR/ISR: seems the scale variation with a factor two is too large.
    I believe for one of these (FSR?) the recommended maximum variation is to use 
    sqrt{2}; Please check with some other recent papers where we vary the ISR/FSR scale 
    as a systematic uncertainty

%BLUE% >> The dileptons measurement (TOP-17-001) does vary ISR and FSR by 2.









- line 262: Please add a reference to where these UE uncertainties are discussed.

%BLUE% >> Added.

- line 265: Is there no "model uncertainty" in this full phase space extrapolation?
     I assume here you base yourself on POWHEG alone, by just varying its parameters?

%BLUE% >> Yes. The aMCatNLO alternative as one of the systematics was not considered as it was not recommended.

- line 265: somehow I expected that you would crefer here to table 2 with a summary of 
    all the systematic considered

%BLUE% >> Added a sentence.

- table 1: predictions and observation don't really match well: from the four results we 
   have 1  where the two agree (signal-like in the mu-tau) but for the other 
   3 ones the prediction is significantly higher than the observation. Not a worry?

%BLUE% >>
 The ratio between the bservation and the predictions is about 0.95, which corresponds to what we get in the fit.
 The table does not show the expected variation in systematics, which covers the difference.
 In principle, we could add the systematic uncertainties.
 But they might confuse the reader:
 the table of event yields will show only the magnitude of the uncertainty,
 when the shape plays a role in the fit as well,
 therefore the final impact of the systematics on the signal strength differs from the magnitude of the variation of event yields with the variation of systematics.

- line 286: for clarity I recommend you repeat/give again the fiducial cuts again here.

%BLUE% >> Added.

- line 309/310: Not sure I get the point here. We measure both here and in [9] the   
   hadronic tau decay channel only, right?  We only convert the tau_h result to a full tau 
   measurements by using the tau BR. 
   So it looks to me that it is just a presentation of the number we measure. 
   Or is it something more and am I missing something?
   Btw we write "tau's and taus" in this sentence. Guess we should use "taus"

%BLUE% >> You are correct. And since the uncertainty of tau BR is so small, it can be considered as just a presentation of the number.
But since the other paper does not use it, we have to mention the difference.

%BLUE% Corrected the difference with taus, but left the apostrophe since it was preferred before in the review.



## Same Charge question -- what's signal contamination due to mischarge there?

tt_mutau in mu_sel
TH1.Print Name  = mu_sel_tt_mutau_NOMINAL_tau_eta, Entries= 40066, Total sum= 0.388414
in mu_sel_ss
TH1.Print Name  = mu_sel_ss_tt_mutau_NOMINAL_tau_eta, Entries= 543, Total sum= 0.00512907

in table: 5137 + 7892 = 13029

(13029. / 40066) * 543.

176.57732241801028

(0.00512907 / 0.388414) * 13029.
172.05006263934877

data-driven multijet in the table: 122 + 231 = 353





# pre-CWR questions

andrea castro castro@bo.infn.it via cern.onmicrosoft.com 
	
10:54 (10 hours ago)
	
to hn-cms-TOP-18-005

*** Discussion title: Review of TOP-18-005

Dear authors

see below a few suggestion on your draft, whose implementation might be
useful before the start of the CWR, to avoid repeated comments.

Best regards

Andrea





 Abstract, first sentence: I suppose it would read better as "... where
tau_h refers to the hadronic decays of the \tau lepton, and \ell=e,mu."

%BLUE% >> Corrected.

Abstract: last sentence: "all top quark decays" is not equal to
"Gamma_tot", so I suggest "The ratio of the partial width Gamma(t->tau
nutau b) to the total width is measured to be 0.1050 +- ... (syst)."

%BLUE% >> Corrected.

L2: we do not define LHC any more, so "... at the CERN LHC are mostly ..."

%BLUE% >> Corrected.

L3: "... in pairs (t\bar t) with ..." to define here t\bar t rather than later at L5

%BLUE% >> Corrected.

L5: "top quark pair (t\bar t) decay " ==> "t\bar t pair decay"

%BLUE% >> Corrected.

L6-8: I believe this sentence would read better as "In this paper, the
process t\bar t-> (\ell nu_\ell)(\tau \nu_\tau)b\bar b is considered,
where one W boson decays into enue or munum, and the other into
taunutau."

%BLUE% >> Corrected.

L18: is this the "first" for CMS or the first in absolute? In the former case you should say so

%BLUE% >> According to PDG it is the first at 13TeV and the first by CMS. The measurements by ATLAS and CDF were not performed at 13TeV collisions.

L20: here "it" is supposed to refer to two sentences earlier (the
measurement and not the data). To avoid ambiguities I suggest to write
"The measurement is extended to a higher energy and it improves ..."

%BLUE% >> Corrected.

L23: "kinematics" is a discipline, so I suggest "kinematics" ==>
"kinematic properties"

%BLUE% >> Corrected.

L25: strike "M_T" since it is defined (more appropriately) later

%BLUE% >> Corrected.

L26: use penname for "e" in "e\tau_h"

%BLUE% >> Corrected.

L28" "tau" ==> "\tau"

%BLUE% >> Corrected.

L32: rather than using the symbol "BR" you might use "\cal B" (so it
would be one letter)

%BLUE% >> Corrected.

L33: the subscript "h" of "\tau_h" should be in roman font

%BLUE% >> Corrected.

L50: I assume you are using British English, since at L12 you wrote
"flavour". In this case "counter clockwise" ==> "anticlockwise" is
preferred

%BLUE% >> Corrected.

L63-64: since you are referring to "accuracy", there should be an
additional hyphen before "order"

%BLUE% >> Corrected.











L68: since you are referring to "accuracy", there should be an
additional hyphen before "order"

%BLUE% >> Corrected.

L71: "top s-channel" ==> "top quark s channel" (with no hyphen,
according to guidelines)

%BLUE% >> Corrected.

L83: since you are referring to "expected xsec", there should be an
additional hyphen before "order"

%BLUE% >> Corrected.

L83: try to avoid the line overflow

%BLUE% >> Added "\ttbar pair" to move the value to the next line.

L105: anti-kT is not a cone algorithm so the distance parameter is "R"
and not "DeltaR" ==> "... with a distance parameter R=0.4."

%BLUE% >> Indeed, corrected.

L118: no need to use upper-case intitials, and also I believe it's
better to hyphenize ==> "hadron-plus-strip (HPS) algorithm"

%BLUE% >> Corrected.

L128: "kinematics" ==> "kinematic properties"

%BLUE% >> Corrected.

L142: now it would be appropriate to define here "Delta R" since it has
been removed from L105

%BLUE% >> Added the deinition.

L150: "Figure 1" ==> "Fig. 1"

%BLUE% >> Corrected.

Caption of fig. 1: "selected with the requirements described in Section
4" is not needed, since this figure has been quoted in section 4; use
penname for "e" in "e\tau_h"; add "quark" after "top"

%BLUE% >> Corrected.

L154: use penname for "e" in "e\tau_h"

%BLUE% >> Corrected.

L157: "kinematics" ==> "kinematic properties"

%BLUE% >> Corrected.

L159: add a comma after "process"

%BLUE% >> Added.

L162: remove the colon after "as"

%BLUE% >> Removed.

L170: "kinematics of the M_T distribution" ==> "details of the M_T
distributions"

%BLUE% >> Corrected.

L175: "The kinematics of the fitted variables are not tied to the
kinematics of the tau lepton" ==> "The fitter variables are not tied to
the kinematic properties of the tau lepton"

%BLUE% >> Corrected.








L185: not sure, but I believe it's better to write "\tau_h's"

%BLUE% >> OK, corrected.

L187: "single-top" ==> "single top quark"

%BLUE% >> Corrected.

L189: you have already defined "pileup", so "The pileup, trigger and
lepton identification efficiencies, ..."

%BLUE% >> Ok, corrected.

L190: no hyphen in "b-tagging", according to guidelines

%BLUE% >> Corrected.

Caption of fig. 2: "M_T" has already been defined, no need to use here
both the symbol and its description

%BLUE% >> Removed the symbol to keep the Figure more self-sufficient.

L244: you have already defined "pileup", so "The pileup is estimated
from the measured instantaneous luminosity ..."

%BLUE% >> Ok, corrected.

L249: use a dash in "Bowler--Lund"

%BLUE% >> Corrected.

L258: "dataset" ==> "data set", according to guidelines

%BLUE% >> Corrected.

L262: "final-state (FSR) and initial-state radiation (ISR)", with
hyphens according to guidelines

%BLUE% >> Corrected.

L273: use penname for "e" in "e\tau_h"

%BLUE% >> Corrected.

Caption of table 1: use penname for "e" in "e\tau_h"; strike "defined by
the kinematics of the jets in the event as described in Section 5",
since that is redundant at this point; the sentences "The multijet
process ... Section 6" and ""the observed ... expectations" belong to
the main text and not to the table caption

%BLUE% >> Corrected.

Table 1: use a dash in "Drell--Yan"

%BLUE% >> Added.

L278: use penname for "e" in "e\tau_h"

%BLUE% >> Corrected.

Caption of fig. 3: use penname for "e" in "e\tau_h"; "top" ==> "top
quark"; strike "gray" (not referring to colors)

%BLUE% >> Corrected.









Caption of table 2: use penname for "e" in "e\tau_h"

%BLUE% >> Corrected

Table 2: use a dash in "Drell--Yan" (twice); do not use "statistics" to
mean "sample size" or "statistical uncertainty"

%BLUE% >> Corrected.

L289+1: use penname for "e" in "e\tau_h"

%BLUE% >> Corrected.

L293+1: use penname for "e" in "e\tau_h"

%BLUE% >> Corrected.

L293+1,+2,+3: is is "tau" or should it be instead "tau_h" ?

%BLUE% >> Yes, corrected.

L297+1: use penname for "e" in "e\tau_h"

%BLUE% >> Corrected.

L309: "systematical" ==> "systematic"

%BLUE% >> Corrected.

L311: not sure, but I believe it's better to write "\tau's"

%BLUE% >> OK. (Now the vote favors the apostrophe.)

L320: "M_T" definition not needed here

%BLUE% >> Corrected.

L321, 322: "kinematics" ==> "kinematic properties" (or something
equivalent)

%BLUE% >> Corrected.

L327: "tau" ==> "\tau"

%BLUE% >> Corrected with "\ell\tau final state" instead of lepton-\tau.

L332: the inclusion of the Acknowledgement section is mandatory (also for CWR)

%BLUE% >> Added the acknowledgement of a [[https://twiki.cern.ch/twiki/bin/viewauth/CMS/Internal/PubAcknow]["short letter"]].
Can I also add an acknowledgement for my grant?
The grant comes from the Portuguese FCT agency via IDPASC program -- I would like to mention this.
Also can I add an acknowledgement for the local computing resources of the lab in addition to "we gratefully acknowledge the computing centres and personnel of the Worldwide LHC Computing Grid"?

L416: remove ", CERN"

%BLUE% >> Removed.

Ref. 46: Use the following BibTeX form to get the 2018 Particle Data Group reference:
@article{PDG2018,
      author         = "{Particle Data Group} and M. Tanabashi and others",
      title          = "Review of particle physics",
      journal        = "Phys. Rev. D",
      volume         = "98",
      pages          = "030001",
      doi            = "10.1103/PhysRevD.98.030001",
      year           = "2018",
}

%BLUE% >> Corrected.


## on "tauh" in cross section and acceptance

the formula is:

sigma(tot) = N / (L * eff * B(fin.state) * A(fin.state))
and
sigma(vis) = N / (L * eff * B(fin.state))

in our case B includes B(W->tau)*B(tau->tauh)

so "fin.state" is just an indication where it is measured.

    modified:   TOP-18-005.tex






# paper figures

output was in plots/v37_test172_paper_plots/

tau_pt

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc_withTauSys.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root     --output-type pdf -o plots/v37_test172_paper_plots1/ --data-nick data_other --overwrite --ratio-range 0.55 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35900 -c mu_sel -x mu_selVloose -d tau_pt --wjet 1.4 --qcd 1.05 --title "" --title-x "#font[12]{p}_{T}(#tau_{h}) [GeV]" --title-y "Events" --draw-overflows 5 --legend-shift 0.05 --drop-bin 29. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --y-range 0,7500 --x-range 30,100 --font-size-axes-titles 40 --font-size-axes-labels 30 --margin-y 0.14 --offset-y 1.2 --margin-x 0.4 --offset-x 3. --no-horizontal-error-bars
python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc_withTauSys.root distrs/v37_test172_bunchCONTROLS1/SingleElectron.root --output-type pdf -o plots/v37_test172_paper_plots1/ --data-nick data_other --overwrite --ratio-range 0.55 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35900 -c el_sel -x el_selVloose -d tau_pt --wjet 1.4 --qcd 1.05 --title "" --title-x "#font[12]{p}_{T}(#tau_{h}) [GeV]" --title-y "Events" --draw-overflows 5 --legend-shift 0.05 --drop-bin 29. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --y-range 0,7500 --x-range 30,100 --font-size-axes-titles 40 --font-size-axes-labels 30 --margin-y 0.14 --offset-y 1.2 --margin-x 0.4 --offset-x 3. --no-horizontal-error-bars



mT prefit

python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/v37_test172_paper_plots1/ --data-nick data_other --overwrite -p -r -c el_sel_ljout -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "#font[12]{m}_{T}(e, #font[12]{p}^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.04 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,100. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --lumi-label 35.9 --output-type pdf --ratio-range 0.55 --font-size-axes-labels 30 --font-size-axes-titles 40 --margin-y 0.11 --offset-y 0.9 --margin-x 0.4 --offset-x 2.8  --label "signal-like"
python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/v37_test172_paper_plots1/ --data-nick data_other --overwrite -p -r -c el_sel_lj    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "#font[12]{m}_{T}(e, #font[12]{p}^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.04 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,100. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --lumi-label 35.9 --output-type pdf --ratio-range 0.55 --font-size-axes-labels 30 --font-size-axes-titles 40 --margin-y 0.11 --offset-y 0.9 --margin-x 0.4 --offset-x 2.8  --label "background-like"


python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/v37_test172_paper_plots1/ --data-nick data_other --overwrite -p -r -c mu_sel_ljout -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "#font[12]{m}_{T}(#mu, #font[12]{p}^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.04 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,150. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --lumi-label 35.9 --output-type pdf --ratio-range 0.55 --font-size-axes-labels 30 --font-size-axes-titles 40 --margin-y 0.11 --offset-y 0.9 --margin-x 0.4 --offset-x 2.8  --label "signal-like"
python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/v37_test172_paper_plots1/ --data-nick data_other --overwrite -p -r -c mu_sel_lj    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "#font[12]{m}_{T}(#mu, #font[12]{p}^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.04 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,150. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --lumi-label 35.9 --output-type pdf --ratio-range 0.55 --font-size-axes-labels 30 --font-size-axes-titles 40 --margin-y 0.11 --offset-y 0.9 --margin-x 0.4 --offset-x 2.8  --label "background-like"



signal-background

python get_shapes.py --x-title "#font[12]{m}_{T}(#font[12]{l}, #font[12]{p}^{miss}_{T}) [GeV]" --y-title "a.u." --norm-binwidth --formula "background,black,2:signal,red" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "signal":../studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_mutau_Mt_inclusive "background":../studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_inclusive --y-range 0,0.0159 --output-type pdf --no-std-path --fonts1 133 --fonts1-size 32 --left-title "CMS #font[52]{Simulation}"

python get_shapes.py --x-title "#font[12]{m}_{T}(#font[12]{l}, #font[12]{p}^{miss}_{T}) [GeV]" --y-title "probability density" --norm-binwidth --formula "background,black,2:signal,red" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "signal":../studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_mutau_Mt_inclusive "background":../studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_inclusive --y-range 0,0.159 --output-type pdf --no-std-path --fonts1 133 --fonts1-size 32 --left-title "CMS #font[52]{Simulation}" --draw-overflows 5 --norm-formulas

python get_shapes.py --x-title "#font[12]{m}_{T}(#font[12]{l}, #font[12]{p}^{miss}_{T}) [GeV]" --y-title "probability density" --norm-binwidth --formula "background,black,2:signal,red" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "signal":../studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_mutau_Mt_inclusive "background":../studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_inclusive --y-range 0,0.159 --output-type pdf --no-std-path --fonts1 133 --fonts1-size 32 --left-title "CMS #font[52]{Simulation}" --draw-overflows 5 --norm-formulas

cp ./compare_mu_selVloose_tt_lj_NOMINAL_Mt_lep_met_c_signal,background_formula.pdf plots/v37_test172_paper_plots1/


nll NLL plot with lumi

python ttxsec/fit-stuff/plot_uncertainty_scans.py v37_test172BIN1_test2 --xsec-scale 831.76 --title-x "cross section [pb]" --output-type pdf --font-size 30 --canvas-size 600 --offset-y 0.8 --offset-x 0.8 --left-title "CMS #font[52]{Preliminary}" --left-title-below

ln -s distrs,v37_test172_bunchCONTROLS1_mc_withTauSys_distrs,v37_test172_bunchCONTROLS1,SingleElectron_tau_pt_el_sel_NOMINAL_stack_ratio_x_el_selVloose_dataqcd.pdf   prefit_el_sel_tau_pt.pdf
ln -s distrs,v37_test172_bunchCONTROLS1_mc_withTauSys_distrs,v37_test172_bunchCONTROLS1,SingleMuon_tau_pt_mu_sel_NOMINAL_stack_ratio_x_mu_selVloose_dataqcd.pdf       prefit_mu_sel_tau_pt.pdf
ln -s histosels,datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys_histosels,datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys_Mt_lep_met_c_el_sel_lj_NOMINAL_stack_ratio.pdf      prefit_el_Mt_lj.pdf
ln -s histosels,datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys_histosels,datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys_Mt_lep_met_c_el_sel_ljout_NOMINAL_stack_ratio.pdf   prefit_el_Mt_ljout.pdf
ln -s histosels,datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys_histosels,datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys_Mt_lep_met_c_mu_sel_lj_NOMINAL_stack_ratio.pdf      prefit_mu_Mt_lj.pdf
ln -s histosels,datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys_histosels,datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys_Mt_lep_met_c_mu_sel_ljout_NOMINAL_stack_ratio.pdf   prefit_mu_Mt_ljout.pdf










# plots with "CMS Preliminary" for PAS

tau_pt

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc_withTauSys.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root     --output-type pdf -o plots/v37_test172_PAS_preliminary_plots/ --data-nick data_other --overwrite --ratio-range 0.55 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35900 -c mu_sel -x mu_selVloose -d tau_pt --wjet 1.4 --qcd 1.05 --title "" --title-x "#tau_{h} #font[12]{p}_{T} [GeV]" --title-y "Events" --draw-overflows 2 --legend-shift 0.05 --drop-bin 29. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --y-range 0,7500 --x-range 30,100 --font-size-axes-titles 40 --font-size-axes-labels 30 --margin-y 0.14 --offset-y 1.2 --margin-x 0.4 --offset-x 3. --no-horizontal-error-bars  --left-title "CMS #font[52]{Preliminary}"
python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc_withTauSys.root distrs/v37_test172_bunchCONTROLS1/SingleElectron.root --output-type pdf -o plots/v37_test172_PAS_preliminary_plots/ --data-nick data_other --overwrite --ratio-range 0.55 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35900 -c el_sel -x el_selVloose -d tau_pt --wjet 1.4 --qcd 1.05 --title "" --title-x "#tau_{h} #font[12]{p}_{T} [GeV]" --title-y "Events" --draw-overflows 2 --legend-shift 0.05 --drop-bin 29. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --y-range 0,7500 --x-range 30,100 --font-size-axes-titles 40 --font-size-axes-labels 30 --margin-y 0.14 --offset-y 1.2 --margin-x 0.4 --offset-x 3. --no-horizontal-error-bars  --left-title "CMS #font[52]{Preliminary}"



mT prefit

python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/v37_test172_PAS_preliminary_plots/ --data-nick data_other --overwrite -p -r -c el_sel_ljout -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "#font[12]{M}_{T}(e, #font[12]{p}^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,100. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --lumi-label 35.9 --output-type pdf --ratio-range 0.55 --font-size-axes-labels 30 --font-size-axes-titles 40 --margin-y 0.11 --offset-y 0.9 --margin-x 0.4 --offset-x 2.8  --label "signal-like"  --left-title "CMS #font[52]{Preliminary}"
python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/v37_test172_PAS_preliminary_plots/ --data-nick data_other --overwrite -p -r -c el_sel_lj    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "#font[12]{M}_{T}(e, #font[12]{p}^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,100. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --lumi-label 35.9 --output-type pdf --ratio-range 0.55 --font-size-axes-labels 30 --font-size-axes-titles 40 --margin-y 0.11 --offset-y 0.9 --margin-x 0.4 --offset-x 2.8  --label "background-like" --left-title "CMS #font[52]{Preliminary}"


python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/v37_test172_PAS_preliminary_plots/ --data-nick data_other --overwrite -p -r -c mu_sel_ljout -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "#font[12]{M}_{T}(#mu, #font[12]{p}^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,150. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --lumi-label 35.9 --output-type pdf --ratio-range 0.55 --font-size-axes-labels 30 --font-size-axes-titles 40 --margin-y 0.11 --offset-y 0.9 --margin-x 0.4 --offset-x 2.8  --label "signal-like" --left-title "CMS #font[52]{Preliminary}"
python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/v37_test172_PAS_preliminary_plots/ --data-nick data_other --overwrite -p -r -c mu_sel_lj    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "#font[12]{M}_{T}(#mu, #font[12]{p}^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,150. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --lumi-label 35.9 --output-type pdf --ratio-range 0.55 --font-size-axes-labels 30 --font-size-axes-titles 40 --margin-y 0.11 --offset-y 0.9 --margin-x 0.4 --offset-x 2.8  --label "background-like" --left-title "CMS #font[52]{Preliminary}"



signal-background

python get_shapes.py --x-title "#font[12]{M}_{T}(#font[12]{l}, #font[12]{p}^{miss}_{T}) [GeV]" --y-title "a.u." --norm-binwidth --formula "background,black,2:signal,red" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "signal":../studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_mutau_Mt_inclusive "background":../studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_inclusive --y-range 0,0.0159 --output-type pdf --no-std-path --fonts1 133 --fonts1-size 32

python get_shapes.py --x-title "#font[12]{M}_{T}(#font[12]{l}, #font[12]{p}^{miss}_{T}) [GeV]" --y-title "a.u." --norm-binwidth --formula "background,black,2:signal,red" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "signal":../studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_mutau_Mt_inclusive "background":../studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_inclusive --y-range 0,0.0159 --output-type pdf --no-std-path --fonts1 133 --fonts1-size 32 --left-title "CMS #font[52]{Simulation Preliminary}"

cp ./compare_mu_selVloose_tt_lj_NOMINAL_Mt_lep_met_c_signal,background_formula.pdf plots/v37_test172_PAS_preliminary_plots/


nll NLL plot with lumi

python ttxsec/fit-stuff/plot_uncertainty_scans.py v37_test172BIN1_test2 --xsec-scale 831.76 --title-x "cross section [pb]" --output-type pdf --font-size 30 --canvas-size 600 --offset-y 0.8 --offset-x 0.8 --left-title "CMS #font[52]{Preliminary}" --left-title-below









# tau pT data points with no horizontal lines?

what is going on? why ep does not work?

X0 works

Draw("X0ep")




# check the magnitude of electron eff impact in the fit to both channels in the v14 table -- it is too small?

0.2 is too small, shouldn't it be 0.4?

what's in the ratio calculation?

0.4

muon eff 1.1

trigger 0.72


check it in AN too




# the extrapolation uncertainties in the ratio to dileptons

1) check if the values in the table are correct
   leptau values OK
   dilep  values NOT correct
   check them in the calculation -- they are not included there!
   the uncertainties in the calculation are the old ones from AN, which randomly match to dileptons paper!!
   -- corrected them, returned to old magnitude of uncertainty in the ratio: 7%

2) how are they symetrized? can we asymmetrize our uncertainties?

3) is the sum in quadrature correct in case of PDFs?

4) top quark pT is missing?

if we asymetrize, how is the ratio calculated?

how to make a Down variation in PDFs or top quark pT?

in my case PDFs do not have up or down, each varies in separate direction?

tt ME scale     ∓ 0.3 0.1
PDF             ± 0.8 0.6
Top quark pT    ∓ 0.5 < 0.1
tt ISR scale    ∓ 0.1 < 0.1
tt FSR scale    ± 0.1 < 0.1
UE tune         < 0.1

they are all uncorrelated! so no need to worry, I'm just adding them in quadrature at the end

-- 1) add both variations in qudrature
   2) corrected the table

both in quadrature:
tt ME scale         0.1   0.316227766
PDF                 1     1
top quark pT        0.25  0.5
tt ISR              0.01  0.1
tt FSR              0.01  0.1
UE tune             0.04  0.04
no ME-PS matching in accptance!!!			0








test on ratio:


0.071 / 0.939


check all uncertainties of visible xsec are in the table --- DONE
check extrapolation uncertainties, copy from sheet       --- DONE
check values of extrapolation unc in leptau              --- DONE
descibe the averages                                     --- DONE
and groupings                                            --- DONE
add top pT in extrapolation                              --- DONE
check the extrapolation uncertainty in xsec              --- DONE
update ratio uncertainties everywhere                    --- DONE

the ME-PS in extrapolation:
ME-PS matching                & 0.8 & 1.0 & 0.9 & 0.2    & 0 \\                                                                                                                                                    



## top pt on acceptance

updated the script to process all the files

    time python signal_acceptance.py --only-signal temp/acceptance_with_toppt/ gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v34_MC2016_Summer16_TTJets_powheg/180717_001103/0000/MC2016_Summer16_TTJets_powheg_*.root

root -l temp/acceptance_with_toppt/MC2016_Summer16_TTJets_powheg.root

accept_nom   = cut_ev_mutau->GetBinContent(1+0)       / all_ev_mutau->GetBinContent(1+0)
accept_toppt = cut_toppt_ev_mutau->GetBinContent(1+1) / all_toppt_ev_mutau->GetBinContent(1+1)

(accept_toppt - accept_nom) / accept_nom

0.183190
0.180383

-0.0153233

accept_nom   = cut_ev_eltau->GetBinContent(1+0)       / all_ev_eltau->GetBinContent(1+0)
accept_toppt = cut_toppt_ev_eltau->GetBinContent(1+1) / all_toppt_ev_eltau->GetBinContent(1+1)

(accept_toppt - accept_nom) / accept_nom

0.161626
0.158811
-0.0174169

cut_ev_eltau->Add(cut_ev_mutau)
all_ev_eltau->Add(all_ev_mutau)

cut_toppt_ev_eltau->Add(cut_toppt_ev_mutau)
all_toppt_ev_eltau->Add(all_toppt_ev_mutau)


accept_nom   = cut_ev_eltau->GetBinContent(1+0)       / all_ev_eltau->GetBinContent(1+0)
accept_toppt = cut_toppt_ev_eltau->GetBinContent(1+1) / all_toppt_ev_eltau->GetBinContent(1+1)

(accept_toppt - accept_nom) / accept_nom

0.172412    -> 1.
0.169600    -> 1.126
-0.0163117  -> 1.146

2 strange things:
the variation is anti-correlated?
it is about 1.5%, not 0.5%?


with top pT in extrapolation:

[133.162 1.96445 11.5061 3.50795]
[135.249 1.60663 10.6622 3.65143]
[134.492 1.28906 10.1693 3.58073]
789.34024 [11.0508 70.5551 19.7335]
770.2097600000001 [8.47231 62.9902 19.2552]
781.0226399999999 [7.0292 62.2099 19.5256]

-- final reported value in "both" does not change
   only the rounded systematic in full phase space muon-tau changes to 63


ratio:
0.9726027397	unc	0.06621467076	0.0085

partial width:
0.1050410959		0.007151184442	0.000918

the reported acceptance uncertainties!






# [[https://hypernews.cern.ch/HyperNews/CMS/get/TOP-18-005/58/1.html][Re: EP comments on paper draft v13]]

 l87: ptmiss was already defined in l23

>> It was already clarified earlier. In l23 ptmiss is introduced, and at L87 we give the precise definition, i.e. it is a negative sum of the momenta of all visible particles.

--> ok, then I suggest to remove the symbol in l23.

%BLUE% >> We´d prefer to keep it, as it does no harm, but OK.

- l168: "Such misidentified τ h also come" --> "Such misidentified τ h also comes"

>> This is plural as it refers to taus in different processes.

--> As it is, it looks singular. Maybe "tau_h's"?

%BLUE% >> No apostrophe. OK.


- l227: PU was already defined in l97, please remove.

>> We keep PU only in the formula (approximately L99), in the text we use "pileup" everywhere, for clarity.

--> this I still do not understand. If you define PU, as you do in l102, why not using the acronym instead of "pileup" in l103, 204, 273

%BLUE% >> It is clearer to spell it out.

[2]

- l56: define alpha_s and specify which scale is that

%BLUE% >> Clarified.

- l83: cross-section --> cross section

%BLUE% >> OK.

- l178, 234: remove "(pileup)"

%BLUE% >> We think it is clearer to keep it, as it gives a direct link to the Table.

- Table 2: pileup uncertainty --> pileup

%BLUE% >> OK.

[3]

 - Table 2: it would be good to clarify in the text and caption how you are treating the uncertainties from TOP-17-001, i.e, how you are grouping them to match the same categories in your analysis, and that you are symmetrizing the asymmetric extrapolation uncertainties.

%BLUE% >> Uncertainties are not grouped. They are treated as individual lines, as in Table 2.

- Figure 3: if you want to keep it, please add luminosity info to the plot 

%BLUE% >> Added.



# more comments from Yuta

> L125: please write that, HPS tau can overlap with the jet (otherwise it will lead huge confusion)

>> At this selection stage there is no confusion: one tauh candidate and at least 2 jets are separate objects, and all events have a tauh candidate by the definition of the selection.

But then, L135 (in v14) is very confusing; it sounds like you don't remove overlap with tauh. Also, the categorization based on the jet kinematics L 151 (in v14), you say "all jets in the event includin the tauh candidate". So, these are all very confusing as it is now.

%BLUE% >> Removed "Among the jets separated from the τh by ∆R > 0.4,". It was confusing and unnecessary.

> L153: what do you mean by "maximization of the yields in the two categories" ? All events just falls into one of 2 categories and the total number of events in the signal-like plus BG-like won't change ...

>> Maximization in each category separately. Rephrased it.

I still don't get what you want to say by "maximization of the yields in each of the two cateogries". "yields" means, number of signal events? Having categories won't increase the signal yield, isn't it ? It is just categorization and sum of the two categories will leave the signal yield unchanged.

%BLUE% >> "maximize the number of events in each category", ie not too many in any of the two. We prefer "maximize".

%BLUE% The overall yields do not change, but the fractions of events in event categories do.
The event yields in the event categories are:
N(all events in signal-like) = N(signal events|signal-like) + N(background events|signal-like);
N(background-like) = N(signal|background-like) + N(background|background-like).
We maximize N(signal-like) and N(background-like) to have less statistical uncertainty in each category.
And we maximize N(signal|signal-like)/N(signal|background-like) with N(background|background-like)/N(background|signal-like) to separate signal and background events.

> L154: Can you write the gain by spliting the catogires into 2 ? (I made the same comment before ...)

>> In MC toys performing a fit without MT shape we see that the event categories alone constrain the uncertainty due to the background of misidentified taus from 25% to 5%. A fit to MT shape without event categories constrains this uncertainty from 25% to 2.5%. And the fit to MT shape with event categories we arrive at about 2% uncertainty from misidentified taus. The event categories provide an additional constrain on the background in an independent method.

Why don't you write this explicitly in the paper ? I still don't see any description in v14.

%BLUE% >> We think it is too much detail to write it in the paper. Added the concluding sentence in Sec. 5.

> L205: tau charge mis-ID does not correlate wtih tau ID SF uncertainty. No ?

>> No, they are not correlated.

Then, I thnk you should note use "including".

%BLUE% >> Rephrased it.

> before L280: Can you add SM theoretical prediction? you wrote in the summary that it is in agreement with SM, but you never write theoretical value.

>> We think it is not necessary.

Hmm, but then, How we can convince readers that your mreasurement is consistent with SM prediction (summary). If you don't write this number, I would remove corresponding sentence in summary. 

%BLUE% >> It is written in the summary that the results are consistent with the SM. That is the relevant place where to specify it. To write it earlier (for ex. at approx. L280), it would be an unnecessary repetition.




# questions

- general: "stat." --> "stat" , "syst." --> "syst", "lumi." --> "lumi"

%BLUE% >> Corrected.

- general: not sure \ttbar is defined anywhere

%BLUE% >> It is defined at L3 (Introduction). We made it clearer by adding a direct definition at L5.

- abstract: tau_h is not used, so please remove ", tau_h,"

%BLUE% >> tau_h is used in the line 1 of the abstract, so we think it is clear as it is.

- l6: including a tau --< including a tau lñepton (as in line 9 and 11)

%BLUE% >> Corrected.

- l13: remove ", l = e, mu". Already mentioned in l8

%BLUE% >> Corrected.

- l14: tau_h --> \tau_h

%BLUE% >> Corrected.

- l28: i suggest to introduce this paragraph with something like "This paper is organized as follows: "

%BLUE% >> Rephrased the paragraph according to your suggestion.

- l38: either "where the pseudorapidity is defined as η = − ln [ tan ( θ/2 )]" or 2where the pseudorapidity η is defined as − ln [ tan ( θ/2 )]"

%BLUE% >> Corrected.

- l62-78: "Leading" --> "leading", "Order" --> "order",....

%BLUE% >> Corrected.

- l87: ptmiss was already defined in l23

%BLUE% >> It was already clarified earlier. In l23 ptmiss is introduced, and at L87 we give the precise definition, i.e. it is a negative sum of the momenta of all visible particles.

- l90: is it "Delta phi²" or "(Delta phi)²"? The same for eta.

%BLUE% >> Added the parentheses.

- l116: is it clear what a "same sign... event" is?

%BLUE% >> Corrected.

- l118: that pT refers to which object? i suggest to be specific.

%BLUE% >> We think it is clear as it is. There is no possible misinterpretation, as it is in the same sentence.

- Fig. 1:

- remove the horizonl error bar in data (since all bins have the same width)

%BLUE% >> We will adopt the standard CMS format.

- enlarge the size of the legends and axis titles

%BLUE% >>

- subindex "h" missing in the x-axis title?

%BLUE% >> It is clarified in the caption.

- p should be italic in x-axis title

%BLUE% >>

- points --> dots

%BLUE% >> Replaced it with "full circle", we think it is more precise.

- Drell-Yan --> DY

%BLUE% >> We prefer to spell it out in the figure, it is clear from the caption.

- observed points --> data

%BLUE% >> Corrected.












- l48: "are the masses of the top quark and of the W boson" --> "are, respectively, the masses of the top quark and of the W boson"

%BLUE% >> Corrected.

- l168: "Such misidentified τ h also come" --> "Such misidentified τ h also comes"

%BLUE% >> This is plural as it refers to taus in different processes.

- l173: PU was already defined in l97, please remove.

%BLUE% >> Rephrased. Moved the definition to the Section 2 (event simulation).

- l186: move the definition of SS to l116 and use it here.

%BLUE% >> We prefer to keep the definition here, as it is closer to the place where it is used, avoiding confusion. If needed we can reformulate it in CWR.

- l193: is that uncertainty stat only? Please specify.

%BLUE% >> It includes systematic uncertainties.

- Fig. 2:

- use different type of line for one histogram so it can be distinguisehd in b&w versions.

%BLUE% >> Corrected.

- remove the dot in the legend (it is not shown in the histograms)

%BLUE% >> Corrected.

- use the same types of font for M_T as the ones used in the text

%BLUE% >> 


- l216: is TES used somewhere? If not, please remove.

%BLUE% >> Removed.

- l227: PU was already defined in l97, please remove.

%BLUE% >> We keep PU only in the formula (approximately L99), in the text we use "pileup" everywhere, for clarity.

- l240: "the renormalization and factorization scale, α_S" this is not correct, alpha_s is another thing

%BLUE% >> Rephrased it.

- l241: "parton distribution function" --> PDF

%BLUE% >> Corrected.

Table 1:

- it was discussed in the approval the goal of this table and decided that signal-like and background-like should be defined in the caption. Otherwise, it is confusing to have signal in the background like and vice-versa.

%BLUE% >> It is clearly stated in the L3-4 of the table caption. The reader is referred to Section 5 where the exact definition is given.

- "The observed event yields in data shows" --> "The observed event yields in data show"

%BLUE% >> Corrected.



Fig. 2:

- enlarge the size of the legends and axis titles

%BLUE% >> 

- fonts in x-Axis title should match the ones in the text

%BLUE% >> 

- points --> dots

%BLUE% >> Corrected.

- Drell-Yan --> DY

%BLUE% >> We prefer to spell it out in the legend.

- observed points --> data

%BLUE% >> Corrected.

- add a label in the plot for signal-like and backgorund-like

%BLUE% >> 

- why not all the uncertainties are included?

%BLUE% >> Corrected, all systematic uncertainties are included.



Table 2:

- PU is already defined, please use either the test or the acronym

%BLUE% >> Corrected, "pileup" is used.

- is ME-PS matching defined somewhere in the text?

%BLUE% >> Added the reference in Section 7 on systematic uncertainties.

- Fig. 4: enlarge axis titles

%BLUE% >> Corrected.

- l302: tau --> \tau

%BLUE% >> Corrected.

- l306: the value quoted here does not match the one in l281

%BLUE% >> Corrected.




## post-aproval follow up

- In general, and as already stated, the paper lacks the motivation for the measurements, particularly for reporting R. Also concerning CDF and ATLAS results, explicit comparisons should be made in the introduction and summary, in particular on the precision reached here. The summary could also benefit from adding "compatible with lepton universality" there.

%BLUE% >> Included the note on lepton universality in the summary. But we would like to limit the summary section to the results of the paper. We give the reader the description of our result and corresponding references to other measurements, where the details can be found for possible comparison.
As for the different value measured in our paper versus the paper by ATLAS, we give the exact definition of what is measured and prefer not to go into detailed comparison. However, if you have a specific suggestion we would try to include it in CWR. For example, in the Results section we can add a sentence like the following:

%BLUE% While in~\cite{Aad:2015dya} the partial width is estimated for hadronic $\tau$s,
here $R_\Gamma$ is measured for all $\tau$s by using the $\mathrm{BR}(\tau\rightarrow\tauh\nu_\tau)$
that is determined with negligible uncertainty~\cite{Tanabashi:2018oca}.

- Concerning the numbers, particulary the R_gamma, check everywhere in the paper and make sure correct values are reported. For example what you report in the Result section is different from AN and has a typo.

%BLUE% >> Corrected. The AN numbers are correct, the numbers which were added to the paper are outdated.

- Abstract: R definition: remove "pair" in The ratio of the partial width to all top quark pair decays

%BLUE% >> Corrected.

- L23: Detector does not have the full phase space "visible and full phase spaces of the detector" --> "visible phase spaces of the detector and the full phase space"

%BLUE% >> Corrected.

- L27: "contributing to the previous measurements [4, 5]" is misleading. You need to mention explicitly what was measured in CDF and ATLAS where the latter is different from yours. Substitute this with sth like: This measurement is complementary to similar quantities measured in other hadron collider experiments [4,5]. Then in the measurement or summary section specify the difference with ATLAS.

%BLUE% >> Changed the sentence in the Introduction: "complementing the previous measurements [4, 5]". And rephrased the paragraph in Results to make it clear the \Gamme(top->tau) is estimated instead of \Gamma(top->tauh). If necessary, in Results we could add an explicit statement, as in the answer to the first question.

- L284 and the text around: The R you quote is not correct. It should be the one as in AN. Also you say "divided by Br" which is incorrect. You have the correct statement in the AN. Please modify the paper.

%BLUE% >> Corrected.

- Table 2: it would be good to clarify in the text and caption how you are treating the uncertainties from TOP-17-001, i.e, how you are grouping them to match the same categories in your analysis, and that you are symmetrizing the asymmetric extrapolation uncertainties.

%BLUE% >>

- L305:Add a sentence saying the what is different/similar with the results of CDF and ATLAS

%BLUE% >> We specify exactly what is done in the paper and refer to other papers with other results.

- Figure 3: if you want to keep it, please add luminosity info to the plot

%BLUE% >>




## Yuta's questions

 L8: "... does not include leptons from tau decay" cannot come first before you explain tau decay (L11).

%BLUE% >> Moved the sentence to the end of the paragraph.

L10: i.e. higiher than ... -> so what ?? (I made the same comment before ...)

%BLUE% >> This gives the reader the order of magnitude of the BR. As we stated before, we prefer to keep it as there is no harm from this sentence.

L14: tau -> \tau_\text{h}

%BLUE% >> Corrected.

L15: "prompt" needs some explanation

%BLUE% >> We think it is clear as it is.

L24: for "each final state" -> you should explicitly write, what "each"
means.

%BLUE% >> Corrected.

I agree with Abideh, that, physics motivation should be much more
strengthened.

%BLUE% >> We added the references and we state clearly what is measured in the paper.

L54: alphaS -> \alpha_S

%BLUE% >> Corrected.

L71: The multijet -> The QCD multijet (and also in Figure 1 legends)

%BLUE% >> We removed "QCD" following the suggestion of the LE.

L125: please write that, HPS tau can overlap with the jet (otherwise it will lead huge confusion)

%BLUE% >> At this selection stage there is no confusion: one tauh candidate and at least 2 jets are separate objects, and all events have a tauh candidate by the definition of the selection.
There can confusion with comparison to AN, where a "preselction" control region is defined, which requires at least 3 jets, whether or not they overlap with tauh candidate.

Figure1 caption L3: compared with simulation (histograms).

%BLUE% >> Corrected.

L144: The sentence is too long. I would suggest to break the sentence
here and start the new one.

%BLUE% >> Corrected.

L146: Why you include the tauh for jet triplet considration !? I didn't
notice before, but isn't it just degrade your discrimnation rather than
helping ?

%BLUE% >> In case of the background process tt->l(qq)(bb) the misidentified tauh can come from any of the jets from the hard process.
Notice that the event categories target the background process, not the signal.

L153: what do you mean by "maximization of the yields in the two
categories" ? All events just falls into one of 2 categories and the
total number of events in the signal-like plus BG-like won't change ...

%BLUE% >> Maximization in each category separately. Rephrased it.

L154: Can you write the gain by spliting the catogires into 2 ? (I made the same comment before ...)

%BLUE% >> In MC toys performing a fit without MT shape we see that the event categories alone constrain the uncertainty due to the background of misidentified taus from 25% to 5%.
A fit to MT shape without event categories constrains this uncertainty from 25% to 2.5%.
And the fit to MT shape with event categories we arrive at about 2% uncertainty from misidentified taus.
The event categories provide an additional constrain on the background in an independent method.

L161: global maximum of the likelhood function -> vague

%BLUE% >> We think it is clear as it is. We could implement specific suggestions during CWR.

L162: shouldn't be also the same for other methods ?

%BLUE% >> Rephrased.

L168: first time to use W+jets (define beforehand, possibly in section3)

%BLUE% >> Added the definition in parentheses.

L170: no need to write "(leptonic and hadronica tau decays)", as you already defined in L12,

%BLUE% >> Removed.

L173: PU is not a abbreviation at all. You better define pile-up (PU), if you want to do that.

%BLUE% >> Rephrased.












L176-L182: This paragraph does not mention anything about "BG estimate".  You should move this to appropriate place.

%BLUE% >> Here we discuss the estimation of the background of the misidentified tauh, which is measured directly in the fit.

L179: jet composition is unclear for outside readers.

%BLUE% >> Rephrased.

L194: not clear what you mean

%BLUE% >> We think it is clear as it is.

L205: tau charge mis-ID does _not_ correlate wtih tau ID SF uncertainty.  No ?

%BLUE% >> No, they are not correlated.

L207: visible mass of what ?

%BLUE% >> Added \tauh.

L214: no longer the dominant... -> what do you mean ?

%BLUE% >> Rephrased.

L217: "corresponding variations in the fit" -> vague

%BLUE% >> Rephrased.

L227: you already define PU.

%BLUE% >> Rephrased.

section7: what about the uncertainty related to MC generator ? (Herwig v.s. Powheg ?) did you consider this too ?

%BLUE% >> No, it is not considered (as in TOP-17-001).

L261: As already brought up in the approval, I'm not sure How meaningful
this plot is. I would remove this.

%BLUE% >> We prefer to keep it.

Table2: As already brought up in the approval, I don't understand why, e.g. electron efficiencies got constarined in "combined" (0.2) even if
it is 1.8 in e-tauh only channel. Can you explain ? (Muon efficiencies 0.6% -> 0.6% looks reasonable)

%BLUE% >> The constrain on electron efficiency indirectly comes from the small variation of muon efficiencies. For example, increasing pre-fit variation of muon efficiencies produces proportional increase in the impact of electron efficiencies. This was described in the earlier answer.

%BLUE% The impact of the uncertainty of electrons is significantly reduced in the simultaneous fit in both channels comparing to the impact in the fit to only electron-tau final state. It indirectly comes from the constraints in muon-tau final state and results in two effects, which effectively reduce the effect of variations in electron systematics on the signal strength to the magnitudes of the same effects from muon systematics. One is the constraint on the variation of the nuisance parameters of the electron systematics: the post-fit variation of the nuisance parameter is about 0.7-0.8 of the prefit value. In addition the electron systematics correlate less with the signal strength in the simultaneous fit to both final states than in the fit to electron-tau final state separately, which corresponds to the rest of the suppression of the impact of electron systematics. The best way to look at this effect is to consider the simultaneous fit to both final states as a fit to electron-tau final state + additional constraints from the muon-tau final state: 1) the Poissonian constraints in the bins of Mt distributions in muon-tau events and 2) the constraints on the nuisance parameters of muon ID and trigger. Both of them can be represented as constraints directly onto the parameter of signal strength in the electron-tau final state. These constraints (statistical uncertainty in muon-tau final state, muon ID and trigger) have small 1-sigma deviation of about 1% comparing to the constraint of electron systematics of about 2% (1.8% electron ID and 2.3% electron trigger in the fit in the electron-tau final state). As the result, in the PLR scans of the signal strength and of the impact of the nuisance parameters of electron systematics the signal strength is varied less with respect to the nuisance parameters of electrons. The variation of signal strength is closer to the variation in the fit to only muon-tau final state. The case of the systematics of muons is opposite: the statistical uncertainty + electron systematics are larger than the muon systematics and do not impose significant constraint on the signal strength. Therefore the variation of signal strength with respect to muon systematics is the same in the fits to muon-tau final state and in the simultaneous fit to both final states, which is reflected in the impacts.

before L280: Can you add SM theoretical prediction? you wrote in the
summary that it is in agreement with SM, but you never write theoretical
value.

%BLUE% >> We think it is not necessary.

L297 and everywhere: use same notation; tau or tau lepton or tau-lepton
? (to me, tau-lepton is the best but i leave up to LE).

%BLUE% >> We follow the suggestion of the LE.

L299: transfer -> transverse

%BLUE% >> Corrected.

L301: "in the largest background process" -> not clear what you mean

%BLUE% >> Rephrased.

L301: "In the fit ... tau lepton" -> very vague, and not clear. Also you should use \tau if you want.

%BLUE% >> We prefer to keep it in the Summary. We added a clarification in the Section 5 "Event categories and fit procedure":
In the fit, the signal enters as a free parameter without constraining the kinematics of the $\tau$ lepton.
The kinematics of the fitted variables are not tied to the specific \ttbar signal model considered here, i.e. $\ttbar\rightarrow (\ell\nu_{\ell})(\tauh\nu_{\tau})\cPqb\cPaqb$.                                    







# the corrections to figures


comparison sig-bckg

python jobsums/get_shapes.py --x-title "M_{T}(l, p^{miss}_{T}) [GeV]" --y-title "a.u." --norm-binwidth --formula "background,red,2:signal" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "signal":./studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_mutau_Mt_inclusive "background":./studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_inclusive --y-range 0,0.0159 --output-type pdf --left-title --no-std-path

text font?

python jobsums/get_shapes.py --x-title "M_{T}(l, p^{miss}_{T}) [GeV]" --y-title "a.u." --norm-binwidth --formula "background,red,2:signal" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "signal":./studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_mutau_Mt_inclusive "background":./studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_inclusive --y-range 0,0.0159 --output-type pdf --left-title --no-std-path --fonts1 133

python jobsums/get_shapes.py --x-title "#font[12]{M}_{T}(#font[12]{l}, #font[12]{p}^{miss}_{T}) [GeV]" --y-title "a.u." --norm-binwidth --formula "background,red,2:signal" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "signal":./studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_mutau_Mt_inclusive "background":./studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_inclusive --y-range 0,0.0159 --output-type pdf --left-title --no-std-path --fonts1 133


TODO: mathematical ell:

python jobsums/get_shapes.py --x-title "#font[12]{M}_{T}(#font[12]{#ell}, #font[12]{p}^{miss}_{T}) [GeV]" --y-title "a.u." --norm-binwidth --formula "background,red,2:signal" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "signal":./studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_mutau_Mt_inclusive "background":./studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_inclusive --y-range 0,0.0159 --output-type pdf --left-title --no-std-path --fonts1 133

python jobsums/get_shapes.py --x-title "#ell" --y-title "a.u." --norm-binwidth --formula "background,red,2:signal" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "signal":./studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_mutau_Mt_inclusive "background":./studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_inclusive --y-range 0,0.0159 --output-type pdf --left-title --no-std-path --fonts1 133


font sizes in legends and axis titles = text

scales:
stack distrs                    0.45  ~ 3
comparison & uncert scans NLL   0.6   ~ 4

now labels are 20, titles are 24

what if change to 18 and 24 and just 24/0.6 = 40
18 = 0.75*24

24 / 0.48 = 50



final MT Mt mT signal-backgroun comparison:

python jobsums/get_shapes.py --x-title "#font[12]{M}_{T}(#font[12]{l}, #font[12]{p}^{miss}_{T}) [GeV]" --y-title "a.u." --norm-binwidth --formula "background,black,2:signal,red" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "signal":./studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_mutau_Mt_inclusive "background":./studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_inclusive --y-range 0,0.0159 --output-type pdf --left-title --no-std-path --fonts1 133 --fonts1-size 32

trying to get the \ell work:

python jobsums/get_shapes.py --x-title '#font[12]{M}_{T}(\ell, #font[12]{p}^{miss}_{T}) [GeV]' --y-title "a.u." --norm-binwidth --formula "background,black,2:signal,red" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "signal":./studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_mutau_Mt_inclusive "background":./studies/mt-per-tau-pt-in-new-bins/v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_inclusive --y-range 0,0.0159 --output-type pdf --left-title --no-std-path --fonts1 133 --fonts1-size 32

there is no \ell in pdf of root:
https://root-forum.cern.ch/t/tmathtext-ell-in-pdf/32189

and producing png takes ages on ncg right now...



0.48 / 0.6 = 0.8

32 * / 0.8
= 40
40 * 0.75 = 30

prefit tau pt and Mt

tau pt

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc_withTauSys.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root     --output-type pdf -o plots/v37_test172_bunchCONTROLS1_tau_pt_with_allsys/ --data-nick data_other --overwrite --ratio-range 0.55  --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d tau_pt  --wjet 1.4 --qcd 1.05 --title "" --title-x "#tau p_{T} [GeV]"  --title-y "Events" --draw-overflows 2 --legend-shift 0.02 --drop-bin 29. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --y-range 0,7500 --x-range 30,100 --font-size-axes-titles 40 --font-size-axes-labels 30 --margin-y 0.15 --margin-x 0.34 --offset-x 1.4

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc_withTauSys.root distrs/v37_test172_bunchCONTROLS1/SingleElectron.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_tau_pt_with_allsys/ --data-nick data_other --overwrite --ratio-range 0.55  --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c el_sel    -x el_selVloose    -d tau_pt  --wjet 1.4 --qcd 1.05 --title "" --title-x "#tau p_{T} [GeV]"  --title-y "Events" --draw-overflows 2 --legend-shift 0.02 --drop-bin 29. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --y-range 0,7500 --x-range 30,100 --font-size-axes-titles 40 --font-size-axes-labels 30



final:

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc_withTauSys.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root     --output-type pdf -o plots/v37_test172_bunchCONTROLS1_tau_pt_with_allsys/ --data-nick data_other --overwrite --ratio-range 0.55 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c mu_sel -x mu_selVloose -d tau_pt --wjet 1.4 --qcd 1.05 --title "" --title-x "#tau_{h} #font[12]{p}_{T} [GeV]" --title-y "Events" --draw-overflows 2 --legend-shift 0.05 --drop-bin 29. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --y-range 0,7500 --x-range 30,100 --font-size-axes-titles 40 --font-size-axes-labels 30 --margin-y 0.14 --offset-y 1.2 --margin-x 0.4 --offset-x 3. --no-horizontal-error-bars
python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc_withTauSys.root distrs/v37_test172_bunchCONTROLS1/SingleElectron.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_tau_pt_with_allsys/ --data-nick data_other --overwrite --ratio-range 0.55 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c el_sel -x el_selVloose -d tau_pt --wjet 1.4 --qcd 1.05 --title "" --title-x "#tau_{h} #font[12]{p}_{T} [GeV]" --title-y "Events" --draw-overflows 2 --legend-shift 0.05 --drop-bin 29. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --y-range 0,7500 --x-range 30,100 --font-size-axes-titles 40 --font-size-axes-labels 30 --margin-y 0.14 --offset-y 1.2 --margin-x 0.4 --offset-x 3. --no-horizontal-error-bars


prefit mt

python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/update-v11-v12-approval_plot_with_sys/paper-std/ --data-nick data_other --overwrite -p -r -c el_sel_ljout -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "#font[12]{M}_{T}(e, #font[12]{p}^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,120. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --font-size-axes-labels 30 --font-size-axes-titles 40 --margin-y 0.12 --offset-y 1. --margin-x 0.4 --offset-x 2.8
python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/update-v11-v12-approval_plot_with_sys/paper-std/ --data-nick data_other --overwrite -p -r -c mu_sel_ljout -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "#font[12]{M}_{T}(#mu, #font[12]{p}^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,150. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --font-size-axes-labels 30 --font-size-axes-titles 40 --margin-y 0.12 --offset-y 1. --margin-x 0.4 --offset-x 2.8


python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/update-v11-v12-approval_plot_with_sys/paper-std/ --data-nick data_other --overwrite -p -r -c el_sel_ljout -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "#font[12]{M}_{T}(e, #font[12]{p}^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,100. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --font-size-axes-labels 30 --font-size-axes-titles 40 --margin-y 0.11 --offset-y 0.9 --margin-x 0.4 --offset-x 2.8  --label "signal-like"
python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/update-v11-v12-approval_plot_with_sys/paper-std/ --data-nick data_other --overwrite -p -r -c el_sel_lj    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "#font[12]{M}_{T}(e, #font[12]{p}^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,100. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --font-size-axes-labels 30 --font-size-axes-titles 40 --margin-y 0.11 --offset-y 0.9 --margin-x 0.4 --offset-x 2.8  --label "background-like"

python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/update-v11-v12-approval_plot_with_sys/paper-std/ --data-nick data_other --overwrite -p -r -c mu_sel_ljout -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "#font[12]{M}_{T}(#mu, #font[12]{p}^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,150. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --font-size-axes-labels 30 --font-size-axes-titles 40 --margin-y 0.11 --offset-y 0.9 --margin-x 0.4 --offset-x 2.8  --label "signal-like"
python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/update-v11-v12-approval_plot_with_sys/paper-std/ --data-nick data_other --overwrite -p -r -c mu_sel_lj    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "#font[12]{M}_{T}(#mu, #font[12]{p}^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,150. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --font-size-axes-labels 30 --font-size-axes-titles 40 --margin-y 0.11 --offset-y 0.9 --margin-x 0.4 --offset-x 2.8  --label "background-like"



nll NLL plot with lumi

python ttxsec/fit-stuff/plot_uncertainty_scans.py v37_test172BIN1_test2 --xsec-scale 831.76 --title-x "cross section [pb]" --output-type pdf --font-size 30 --canvas-size 400

python ttxsec/fit-stuff/plot_uncertainty_scans.py v37_test172BIN1_test2 --xsec-scale 831.76 --title-x "cross section [pb]" --output-type pdf --font-size 30 --canvas-size 600 --offset-y 0.8 --offset-x 0.8



# the question of ratio, to leave it or drop it

The ratio of the cross sec-
tions in the lepton-tau and the dilepton [3] final states σ tt (` τ h ) /σ tt (``) , and the ratio of the
partial to the total width Γ ( t → τ h τν τ b ) /Γ total are also evaluated, contributing to the previous
measurements [4, 5].

-- remove the "ratio"

The ratio of the cross sec-
tions in the lepton-tau and the dilepton [3] final states σ tt (` τ h ) /σ tt (``) , and

The ratio of the partial to the total width Γ( t → τ ν_{τ} b )/Γ_{total} is evaluated
with respect to the measurement in the dilepton final state[3],
complementing the previous measurements [4, 5].


# remaining questions and updates

the approval questions -> paper

* mention CDF and Atlas -- how? say something about precisions?

* Why is the systematic uncertainty related to the electron trigger so much larger than the muon trigger ? Do you understand how the combined value is lower than both ? 

    still not clear why electrons are so much constrained by muons

    the value in both can be lower

    CHECK: the MORE CONSERVATIVE muon recommendations (x2 uncertainty)???
    x2 uncertainty is closer to dileptons

* event yield table, add descrription in the caption

    "Table 1: the definition of bkg-like region needs to be included in the caption. (Is this separation really needed?) Make it clear and mention numbers are prefit "

    add systematic uncertainties??? to say "the agreement is good within the systematic uncertainties"

    OK for now

* systematics table, merge with dilepton systematics

    Table 2 and 4 reduce to 1, remove redundancy; move "MC stat" out of the theoretical uncertainties
    "MC stat" must be separate from modeling

    -- FIRST, update the numbers!

    OK

* remove NLL

    what did Michele say?
    > I think the NLL plot is nice to show. It does not add much but why not including it.

    or improve it?

    let's just add the Y axis title for now

* add tau pT? close to the yields table as an example of good Data-Prediction agreement at main selection

  where?
  at the same place also mention good agreement in pre-fit MT?
  --- it's the beginning of "Results", next to the table with event categories, everything is about event categories there
  at the event selection?
  let's try

  OK

* "improve the systematics description"

    check all the references to the systematics section and clarify these

    in:

      + "Background Estimate", in the general paragraph and about mis-ID taus, and about the normalization of the multijet
      + and about the sys uncertainty of the acceptance

    remove the normalization of the multijet and mention the processes explicitly in the Systematics
    --- did not remove, expanded saying "As one of the processes with mis-ID taus,.."

    OK for now

* "R needs to a better explanation and justification"

    clarify that we divide on BR(tau->tauh) to get to the tau! <-- it is inexplicitly mentioned "by dividing BR(W->tauh)
    like this: "In the ratio, the correlated uncertainties cancel out."

    is it also about calculating R?

    can BLUE be applied to a ratio?
    BLUE is basically a sum, it calculates (x1 + x2)/2, we need the same for ratio, but what's the citation then?

* add somewhere pT plots with TOPPT Up: MET and b jet pT

    to AN, right after control plots

* check propagation to qcd

* update numbers:

    vis cross section
    full cross section
    ratio
    Gamma

    DONE

    anything else?


update the presentation

update AN

add the objects review questions to the twiki


## also questions

unclustered MET uncertainty, from Yuta
-- check if dileptons paper has it
   check the old recommendation
   check possible factor for implementation

TOP PT variation effect on pT distributions: lep pT, MET, tau pT, b jet pT
-- add to AN


## the questions from the Mac, notes from approval

All assets of the paper! table 1 etc

Lepton charge mis-id uncertainty
— state that it is negligible
Also check the values? 5% charge uncertainty that’s way too much???

B-tag jets are found from jets separated from tau
— explicitly clarify in the paper

Mention Atlas result, discuss it
— check their tau ID uncertainty

Tau ID uncertainty is much smaller In legacy rereco
2%
Refit and see the effect of it

MET unclustered
— can fix the MET

pT plots with TOPPT re-weighting
— to see the pT trends fixed

Muon uncertainty is too small?

Electron trigger uncertainty is too large?

Mention in paper how systematics are propagated to QCD

Mention explicitly which processes have the tau mis-ID systematic: QCD, W+jets and tau mis-ID parameters.

Table1: explanation to the table?
Caption on «tt signal» — what it means?
— we over-simplified the table???

Separate line for MC statistics in the table?
— check

Combine tables on systematics from dileptons and ours

Data/Mc -> Data/Expectation or Data/Prediction
Because there is data-driven QCD

Mt in event categories instead of inclusive

NLL plot has no value — either add separation of uncertainties or remove





## conservative muon systematics

the last fit (the approval presentation)

                         eτ h μτ h both
τ h identification        4.7  4.5  4.5
τ h mis-identification    2.2  2.3  2.3
PU uncertainty            2.5  2.2  2.3
b-tagging efficiency      1.1  1.2  0.9
TES                       0.7  0.8  0.8
muon ID efficiency          -  0.6  0.6
DY normalization          0.4  0.4  0.6

PDF     1.5 1.5 1.6
MC stat 2.0 1.6 1.6

python new_impact_table.py --quote-dileps --merge-pdf  v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_el_test1.json v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_mu_test1.json v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_both_test1.json

-- correct

python new_impact_table.py --merge-pdf  latest_impacts_v37_test172BIN1_el_test2.json  latest_impacts_v37_test172BIN1_mu_test2.json latest_impacts_v37_test172BIN1_both_test2.json

-- practically the same

v37_test172BIN1_test1/impacts_table_expMu2

-- only muon eff-s are larger than test1, the rest is practically the same, difference is in the rounding

was made like this:

python new_impact_table.py --merge-pdf  v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_el_test1.json v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_mu_test1_expMu2.json v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_both_test1_expMu2.json  > v37_test172BIN1_test1/impacts_table_expMu2

-- with test1

cp v37_test172BIN1_test1/impacts_table v37_test172BIN1_test1/impacts_table_merge_expMu2
vim -p v37_test172BIN1_test1/impacts_table_merge v37_test172BIN1_test1/impacts_table_expMu2

$\tauh$ jet identification  &  4.7 &  4.5 &  4.4 \\
           PU uncertainty  &  2.8 &  2.8 &  2.5 \\
$\tauh$ misidentification background  &  1.9 &  2.2 &  2.4 \\
       muon ID efficiency  &  1.2 &  1.1 \\
     b-tagging efficiency  &  1.1 &  1.1 &  0.9 \\
                      TES  &  0.7 &  0.8 &  0.8 \\
electron trigger efficiency  &  2.3 &  0.6 \\
         DY normalization  &  0.4 &  0.4 &  0.6 \\
 Single Top normalization  &  0.6 &  0.5 &  0.5 \\
     W+jets normalization  &  0.1 &  0.4 &  0.4 \\
                      JES  &  0.1 &  0.3 &  0.4 \\
   electron ID efficiency  &  1.8 &  0.4 \\
  muon trigger efficiency  &  0.6 &  0.4 \\
        QCD normalization  &  0.1 &  0.5 &  0.4 \\
                      JER  &  0.6 &  0.3 &  0.1 \\
   Dibosons normalization  &  0.0 &  0.0 &  0.0 \\
               Luminosity  &  0.0 &  0.0 &  0.0 \\
          b fragmentation  &  2.3 &  2.0 &  2.4 \\
        top quark $p_{T}$  &  2.7 &  2.3 &  2.2 \\
  final   state radiation  &  1.7 &  1.9 &  1.7 \\
  initial state radiation  &  1.7 &  1.5 &  1.5 \\
                ME scales  &  1.1 &  1.2 &  1.1 \\
semi-leptonic b-hadron BRs  &  0.8 &  0.6 &  0.7 \\
underlying event (Pythia tune)  &  0.5 &  0.5 &  0.5 \\
   ME-PS matching (hdamp)  &  0.4 &  0.4 &  0.5 \\
                      PDF  &  1.5 &  1.5 &  1.6 \\
            MC statistics  &  2.0 &  1.7 &  1.7 \\

trigger: sqrt(0.4**2 + 0.6**2)
0.72

get overall uncertainty in this fit!

make fit_unc         workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_expMu2.root   nn=v37_test172BIN1_mu_test1_expMu2   freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make fit_unc         workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_expMu2.root nn=v37_test172BIN1_both_test1_expMu2 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &

mu
0.926 +0.080-0.072
+0.022-0.019
+0.077-0.069
+0.011-0.011

both
0.939 +0.076-0.069
+0.021-0.019
+0.073-0.066
+0.009-0.009

[133.162 1.96445 11.5061 3.50795]
[135.249 1.60663 10.6622 3.65143]
[134.492 1.28906 10.1693 3.58073]
789.34024 [11.0508 70.1052 19.7335]
770.2097600000001 [8.47231 62.4364 19.2552]
781.0226399999999 [7.0292 61.6101 19.5256]

their	803				
our	781		sys	stat	lumi
ratio	0.9726027397	unc	0.06209053232	0.008941	0.000036
the BR	0.108				
	0.1050410959		0.006705777491	0.000965628	0.000003888


make impacts    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp.root   nn=v37_test172BIN1_el_test2   freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make impacts    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp.root   nn=v37_test172BIN1_mu_test2   freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &

cp ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp.txt ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp_expMu2.txt
vim ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp_expMu2.txt
make workspace datacard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp_expMu2

make both mucard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp_expMu2 elcard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp bothcard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_exp_expMu2
make workspace datacard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_exp_expMu2

make impacts    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp_expMu2.root   nn=v37_test172BIN1_mu_test2_expMu2   freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make impacts    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_exp_expMu2.root nn=v37_test172BIN1_both_test2_expMu2 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &


pulls

head -n -3 ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp.txt        > ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp_noMC.txt
head -n -3 ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp_expMu2.txt > ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp_expMu2_noMC.txt

make both mucard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp_expMu2_noMC elcard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp_noMC bothcard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_exp_expMu2_noMC

make workspace datacard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp_noMC
make workspace datacard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp_expMu2_noMC
make workspace datacard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_exp_expMu2_noMC


make pre_pulls       workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp.root        nn=v37_test172BIN1_el_test2 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make pre_pulls       workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp_expMu2.root        nn=v37_test172BIN1_mu_test2 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make pre_pulls       workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_exp_expMu2.root        nn=v37_test172BIN1_both_test2 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &

make pre_pulls_short workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp_noMC.root   nn=v37_test172BIN1_el_test2 freeze="--freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf_only" points=100 min=0.5 max=1.5    &
make pre_pulls_short workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp_expMu2_noMC.root   nn=v37_test172BIN1_mu_test2 freeze="--freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf_only" points=100 min=0.5 max=1.5    &
make pre_pulls_short workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_exp_expMu2_noMC.root   nn=v37_test172BIN1_both_test2 freeze="--freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf_only" points=100 min=0.5 max=1.5    &

root -l pulls_of_nuisances_v37_test172BIN1_both_test2_shape.root
root -l pulls_of_nuisances_v37_test172BIN1_el_test2_shape.root
root -l pulls_of_nuisances_v37_test172BIN1_mu_test2_shape.root

root -l pulls_of_nuisances_v37_test172BIN1_both_test2_shapeshort.root
root -l pulls_of_nuisances_v37_test172BIN1_el_test2_shapeshort.root
root -l pulls_of_nuisances_v37_test172BIN1_mu_test2_shapeshort.root

gStyle->SetOptStat(0)
nuisancs->Draw()

TPaveText *pt = new TPaveText(.5, 1.5, 3.5, 2.5)
pt->AddText("electron-tau channel")
pt->Draw("same")

nuisancs->SaveAs("postfit_el_nuisances.pdf")
nuisancs->SaveAs("postfit_el_nuisances_lessparams.pdf")

TPaveText *pt = new TPaveText(.5, 1.5, 3.5, 2.5)
pt->AddText("muon-tau channel")
pt->Draw("same")

nuisancs->SaveAs("postfit_mu_nuisances.pdf")
nuisancs->SaveAs("postfit_mu_nuisances_lessparams.pdf")

gStyle->SetOptStat(0)
nuisancs->Draw()

TPaveText *pt = new TPaveText(.5, 1.5, 3.5, 2.5)
pt->AddText("both channels")
pt->Draw("same")

nuisancs->SaveAs("postfit_both_nuisances.pdf")
nuisancs->SaveAs("postfit_both_nuisances_lessparams.pdf")

nll-s?

make fit_unc         workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp.root   nn=v37_test172BIN1_test2_el freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make fit_unc_toys    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp.root   nn=v37_test172BIN1_test2_el freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &

make fit_unc         workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp_expMu2.root   nn=v37_test172BIN1_test2_mu freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make fit_unc_toys    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp_expMu2.root   nn=v37_test172BIN1_test2_mu freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &

make fit_unc         workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_exp_expMu2.root nn=v37_test172BIN1_test2_both freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make fit_unc_toys    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_exp_expMu2.root nn=v37_test172BIN1_test2_both freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &

python ttxsec/fit-stuff/plot_uncertainty_scans.py v37_test172BIN1_test2
python ttxsec/fit-stuff/plot_uncertainty_scans.py v37_test172BIN1_test2 --xsec-scale 831.76 --title-x "cross section [pb]" --output-type pdf




## TOPPT variations of pT distributions

lep, met, tau and b jet

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_pt_per_toppt/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d tau_pt  --wjet 1.4 --qcd 1.05 --title-x "#tau p_{T} [GeV]"   --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --drop-bin 29. --x-range 30,100 --title ""
python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_pt_per_toppt/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d tau_pt  --wjet 1.4 --qcd 1.05 --title-x "#tau p_{T} [GeV]"   --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --drop-bin 29. --x-range 30,100 -s TOPPTUp --title "top p_{T} Up"

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_pt_per_toppt/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d lep_pt  --wjet 1.4 --qcd 1.05 --title-x "#mu p_{T} [GeV]"    --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --title ""
python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_pt_per_toppt/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d lep_pt  --wjet 1.4 --qcd 1.05 --title-x "#mu p_{T} [GeV]"    --title-y "Events" --draw-overflows 5 --legend-shift 0.02 -s TOPPTUp --title "top p_{T} Up"

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_pt_per_toppt/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c mu_sel        -d bjet_pt --wjet 1.4 --qcd 1.05 --title-x "leading b jet p_{T} [GeV]"    --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --title ""
python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_pt_per_toppt/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c mu_sel        -d bjet_pt --wjet 1.4 --qcd 1.05 --title-x "leading b jet p_{T} [GeV]"    --title-y "Events" --draw-overflows 5 --legend-shift 0.02 -s TOPPTUp --title "top p_{T} Up"

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_pt_per_toppt/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d met_f  --wjet 1.4 --qcd 1.05 --title-x "p^{miss}_{T} [GeV]"  --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --title ""
python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_pt_per_toppt/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d met_f  --wjet 1.4 --qcd 1.05 --title-x "p^{miss}_{T} [GeV]"  --title-y "Events" --draw-overflows 5 --legend-shift 0.02 -s TOPPTUp --title "top p_{T} Up"

electrons

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleElectron.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_pt_per_toppt/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c el_sel    -x el_selVloose    -d tau_pt  --wjet 1.4 --qcd 1.05 --title-x "#tau p_{T} [GeV]"   --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --drop-bin 29. --x-range 30,100 --title ""
python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleElectron.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_pt_per_toppt/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c el_sel    -x el_selVloose    -d tau_pt  --wjet 1.4 --qcd 1.05 --title-x "#tau p_{T} [GeV]"   --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --drop-bin 29. --x-range 30,100 -s TOPPTUp --title "top p_{T} Up"

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleElectron.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_pt_per_toppt/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c el_sel    -x el_selVloose    -d lep_pt  --wjet 1.4 --qcd 1.05 --title-x "e p_{T} [GeV]"    --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --title ""
python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleElectron.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_pt_per_toppt/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c el_sel    -x el_selVloose    -d lep_pt  --wjet 1.4 --qcd 1.05 --title-x "e p_{T} [GeV]"    --title-y "Events" --draw-overflows 5 --legend-shift 0.02 -s TOPPTUp --title "top p_{T} Up"

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleElectron.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_pt_per_toppt/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c el_sel        -d bjet_pt --wjet 1.4 --qcd 1.05 --title-x "leading b jet p_{T} [GeV]"    --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --title ""
python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleElectron.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_pt_per_toppt/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c el_sel        -d bjet_pt --wjet 1.4 --qcd 1.05 --title-x "leading b jet p_{T} [GeV]"    --title-y "Events" --draw-overflows 5 --legend-shift 0.02 -s TOPPTUp --title "top p_{T} Up"

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleElectron.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_pt_per_toppt/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c el_sel    -x el_selVloose    -d met_f  --wjet 1.4 --qcd 1.05 --title-x "p^{miss}_{T} [GeV]"  --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --title ""
python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleElectron.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_pt_per_toppt/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c el_sel    -x el_selVloose    -d met_f  --wjet 1.4 --qcd 1.05 --title-x "p^{miss}_{T} [GeV]"  --title-y "Events" --draw-overflows 5 --legend-shift 0.02 -s TOPPTUp --title "top p_{T} Up"

ln -s *Electron_lep_pt*NOMINAL*  el_sel_lep_pt_NOMINAL.pdf
ln -s *Electron_tau_pt*NOMINAL*  el_sel_tau_pt_NOMINAL.pdf
ln -s *Electron_bjet_pt*NOMINAL* el_sel_bjet_pt_NOMINAL.pdf
ln -s *Electron_met*NOMINAL*     el_sel_met_NOMINAL.pdf

ln -s *Electron_lep_pt*TOPPTUp*  el_sel_lep_pt_TOPPTUp.pdf
ln -s *Electron_tau_pt*TOPPTUp*  el_sel_tau_pt_TOPPTUp.pdf
ln -s *Electron_bjet_pt*TOPPTUp* el_sel_bjet_pt_TOPPTUp.pdf
ln -s *Electron_met*TOPPTUp*     el_sel_met_TOPPTUp.pdf


ln -s *Muon_lep_pt*NOMINAL*  mu_sel_lep_pt_NOMINAL.pdf
ln -s *Muon_tau_pt*NOMINAL*  mu_sel_tau_pt_NOMINAL.pdf
ln -s *Muon_bjet_pt*NOMINAL* mu_sel_bjet_pt_NOMINAL.pdf
ln -s *Muon_met*NOMINAL*     mu_sel_met_NOMINAL.pdf

ln -s *Muon_lep_pt*TOPPTUp*  mu_sel_lep_pt_TOPPTUp.pdf
ln -s *Muon_tau_pt*TOPPTUp*  mu_sel_tau_pt_TOPPTUp.pdf
ln -s *Muon_bjet_pt*TOPPTUp* mu_sel_bjet_pt_TOPPTUp.pdf
ln -s *Muon_met*TOPPTUp*     mu_sel_met_TOPPTUp.pdf





## improving the NLL plot

add the Y axis title for now, then maybe add the brazil-colors for 1-2sigma

python ttxsec/fit-stuff/plot_uncertainty_scans_mixed.py v37_test172BIN1_test1 --xsec-scale 831.76 --title-x "cross section [pb]" --nll-limit 5.

python ttxsec/fit-stuff/plot_uncertainty_scans_mixed.py v37_test172BIN1_test1 --xsec-scale 831.76 --title-x "cross section [pb]" --nll-limit 5. --output-type pdf --only-both



## investigation of strong constraint on the impact of LEPel in fit to "both"

the problem:

LEPelID impact is 1.8 in el-only fit
but it is 0.2 in both fit
when LEPmuID is 0.6 in both

       muon ID efficiency    &  0.6 &  0.6 & 0 & 0 \\
  muon trigger efficiency    &  0.3 &  0.2 & 0 & 0 \\

   electron ID efficiency    &  1.8 &  0.2 & 0 & 0 \\
electron trigger efficiency  &  2.3 &  0.2 & 0 & 0 \\

for reference dileptons:

trigger efficiency     & 0.3 & 0 \\
electron efficiencies  & 1.5 & 1 \\
muon efficiencies      & 1.3 & 1 \\


how el ID can be constraned to 0.2 if the impact of muons is still 0.6?

1) the el variation is constrained, but by only about 0.7-0.8 of magnitude
   it seems not enough to explain this difference in signal strength?

2) is there some additional dumping of the impact of LEPel on the signal strength?
   check by plotting r VS LEPelID in el-only fit and both fit

make nll workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   nn=v37_test172_bunchFULLFITBIN1_el_constr   options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff,LEPelID,LEPelTRG --freezeNuisanceGroup tt_th_pdf_only" freeze="--freezeParameters lumi_13TeV" &
make nll workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root nn=v37_test172_bunchFULLFITBIN1_both_constr options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff,LEPelID,LEPelTRG --freezeNuisanceGroup tt_th_pdf_only" freeze="--freezeParameters lumi_13TeV" &

limit->Draw("2*deltaNLL:TOPPT",     "deltaNLL>0 && 2*deltaNLL<10", "L")

limit->Draw("2*deltaNLL:LEPelID",     "deltaNLL>0 && 2*deltaNLL<10", "L")
limit->Draw("2*deltaNLL:LEPelTRG",    "deltaNLL>0 && 2*deltaNLL<10", "L")

-- they are constrained even in el fit?  --- not in impacts plot!
   and in both they are pulled and constrained?

limit->Draw("r:LEPelID",     "deltaNLL>0 && 2*deltaNLL<10", "L")
limit->Draw("r:LEPelTRG",    "deltaNLL>0 && 2*deltaNLL<10", "L")

-- in both cases, el and both, the lines are linear

limit->Scan("r:LEPelID",     "deltaNLL>0 && 2*deltaNLL<10", "L")
limit->Scan("r:LEPelTRG",    "deltaNLL>0 && 2*deltaNLL<10", "L")

root -l higgsCombinev37_test172_bunchFULLFITBIN1_el_constr.MultiDimFit.mH120.root

*    Row   *         r *   LEPelID *
*       23 * 0.7250000 * 0.6556418 *
*       75 *     1.245 * -0.686390 *

*    Row   *         r *  LEPelTRG *
************************************
*       23 * 0.7250000 * 0.8503066 *
*       75 *     1.245 * -0.874708 *

root -l higgsCombinev37_test172_bunchFULLFITBIN1_both_constr.MultiDimFit.mH120.root

*    Row   *         r *   LEPelID *
************************************
*       24 * 0.7549999 * -0.129323 *
*       67 * 1.1849999 * -0.288905 *

*    Row   *         r *  LEPelTRG *
************************************
*       24 * 0.7549999 * -0.224410 *
*       67 * 1.1849999 * -0.374716 *


(-0.686390 - 0.6556418) / (1.245 - 0.7250000)
(-0.874708 - 0.8503066) / (1.245 - 0.7250000)

-2.580830384615384
-3.317335769230769

(-0.288905 - (-0.129323)) / (1.1849999 - 0.7549999)
(-0.374716 - (-0.224410)) / (1.1849999 - 0.7549999)

-0.37112093023255815
-0.3495488372093023

so, definitely there is a dumping...
it must be comming from muons?



does it happen in toys or is it a coinsidance in observed data?

make impacts_toys    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   nn=v37_test172BIN1_el_test_elconstr   freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make impacts_toys    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root nn=v37_test172BIN1_both_test_elconstr freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make impacts_toys    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   nn=v37_test172BIN1_mu_test_elconstr   freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &

python new_impact_table.py --merge-pdf   ./latest_impacts_v37_test172BIN1_el_test_elconstr_toys.json ./latest_impacts_v37_test172BIN1_mu_test_elconstr_toys.json  ./latest_impacts_v37_test172BIN1_both_test_elconstr_toys.json

$\tauh$ jet identification  &  5.0 &  4.9 &  4.9 \\
  pileup (PU) uncertainty  &  2.8 &  2.9 &  2.9 \\
        \ttbar background  &  2.4 &  2.1 &  2.2 \\
 \cPqb tagging efficiency  &  1.2 &  1.2 &  1.0 \\
       muon ID efficiency  &  0.7 &  0.6 \\
     $\tauh$ energy scale  &  0.8 &  0.6 &  0.6 \\
            tW background  &  0.6 &  0.5 &  0.5 \\
            DY background  &  0.3 &  0.4 &  0.5 \\
      multijet background  &  0.1 &  0.6 &  0.5 \\
electron trigger efficiency  &  2.4 &  0.4 \\
         jet energy scale  &  0.2 &  0.1 &  0.3 \\
   electron ID efficiency  &  1.9 &  0.3 \\
    jet energy resolution  &  0.4 &  0.4 &  0.3 \\
  muon trigger efficiency  &  0.3 &  0.3 \\
        W+jets background  &  0.1 &  0.1 &  0.1 \\
      dibosons background  &  0.0 &  0.0 &  0.0 \\
top quark $p_{T}$ modeling  &  2.8 &  2.5 &  2.3 \\
          b fragmentation  &  2.3 &  2.1 &  2.3 \\
         \ttbar FSR scale  &  1.9 &  2.0 &  2.0 \\
         \ttbar ISR scale  &  1.8 &  1.7 &  1.7 \\
          \ttbar ME scale  &  1.2 &  1.5 \\
semi-leptonic b-hadron branching fraction  &  0.7 &  0.7 &  0.7 \\
           ME-PS matching  &  0.4 &  0.5 &  0.6 \\
         underlying event  &  0.4 &  0.5 &  0.5 \\
               lumi_13TeV  &  0.0 &  0.0 &  0.0 \\
                      PDF  &  1.6 &  1.6 &  1.6 \\
            MC statistics  &  2.0 &  1.7 &  1.6 \\

  muon trigger efficiency  &  0.3 &  0.3 \\
       muon ID efficiency  &  0.7 &  0.6 \\

electron trigger efficiency  &  2.4 &  0.4 \\
   electron ID efficiency  &  1.9 &  0.3 \\

the same constraint

no dumping in muons??

let's see it in the correlation to signal strength


make nll workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   nn=v37_test172_bunchFULLFITBIN1_mu_constr_toys   options="--toys -1 --expectSignal 1. --saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff,LEPmuID,LEPmuTRG --freezeNuisanceGroup tt_th_pdf_only" freeze="--freezeParameters lumi_13TeV" &
make nll workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root nn=v37_test172_bunchFULLFITBIN1_both_constr_toys options="--toys -1 --expectSignal 1. --saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff,LEPelID,LEPelTRG,LEPmuID,LEPmuTRG --freezeNuisanceGroup tt_th_pdf_only" freeze="--freezeParameters lumi_13TeV" &

root -l higgsCombinev37_test172_bunchFULLFITBIN1_mu_constr_toys.MultiDimFit.mH120.root
root -l higgsCombinev37_test172_bunchFULLFITBIN1_both_constr_toys.MultiDimFit.mH120.root

limit->Draw("2*deltaNLL:LEPmuID",     "deltaNLL>0 && 2*deltaNLL<10", "L")
limit->Draw("2*deltaNLL:LEPmuTRG",    "deltaNLL>0 && 2*deltaNLL<10", "L")

limit->Draw("r:LEPmuID",     "deltaNLL>0 && 2*deltaNLL<10", "L")
limit->Draw("r:LEPmuTRG",    "deltaNLL>0 && 2*deltaNLL<10", "L")

limit->Scan("r:LEPmuID",     "deltaNLL>0 && 2*deltaNLL<10", "L")
limit->Scan("r:LEPmuTRG",    "deltaNLL>0 && 2*deltaNLL<10", "L")

*    Row   *         r *   LEPmuID *
************************************
*       31 * 0.8050000 * 0.2786468 *
*       78 * 1.2749999 * -0.263019 *

-- practically 1 to 1

*    Row   *         r *  LEPmuTRG *
************************************
*       31 * 0.8050000 * 0.1399287 *
*       78 * 1.2749999 * -0.117619 *

-- less than 1 to 1

both:

*    Row   *         r *   LEPmuID *
************************************
*       32 * 0.8149999 * 0.2692489 *
*       77 * 1.2649999 * -0.268289 *

*    Row   *         r *  LEPmuTRG *
************************************
*       32 * 0.8149999 * 0.1147791 *
*       77 * 1.2649999 * -0.100326 *


no dumping!

limit->Draw("LEPmuTRG:LEPmuID",     "deltaNLL>0 && 2*deltaNLL<10", "L")
limit->Draw("LEPelTRG:LEPelID",     "deltaNLL>0 && 2*deltaNLL<10", "L")

limit->Draw("LEPelID:LEPmuID",     "deltaNLL>0 && 2*deltaNLL<10", "L")
limit->Draw("LEPelTRG:LEPmuTRG",   "deltaNLL>0 && 2*deltaNLL<10", "L")

limit->Draw("LEPelID*LEPelID + LEPelTRG*LEPelTRG:LEPmuID*LEPmuID + LEPmuTRG*LEPmuTRG",     "deltaNLL>0 && 2*deltaNLL<10", "L")

limit->Draw("r:LEPmuTRG",    "deltaNLL>0 && 2*deltaNLL<10", "L")



## tau pT plot at main selection

which histosel contains main selection, tau pT and all systematics? None, tau pT is not a fitted param, it's CONTROL
all systematics without PDF?

distrs/distrs_v37_test172_bunchCONTROLS1_mc1.root

ok good

make --dry-run plot_sel_1  nt=v37 proc=test172 distrs=bunchCONTROLS1 lumi=35800 chan_tag=mu datafile=SingleMuon     title_lep=muon      output_type=pdf merge_procs="--merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other." options="--data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend" &

mkdir plots/v37_test172_bunchCONTROLS1_tau_pt_with_allsys/

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_tau_pt_with_allsys/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d tau_pt  --wjet 1.4 --qcd 1.05 --bin-norm --title "" --title-x "#tau p_{T} [GeV]"  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --drop-bin 29.

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_tau_pt_with_allsys/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d tau_pt  --wjet 1.4 --qcd 1.05 --bin-norm --title "" --title-x "#tau p_{T} [GeV]"  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --drop-bin 29. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID

-- ok

let's add the tau systematics

mkdir distrs/v37_test172_bunchCONTROLS1_tau_pt_with_allsys/

foreach tausys ( "--rename-sys TauMisIDDown --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj:0.5" "--rename-sys TauMisIDUp   --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj:1.5" "--rename-sys TauIDDown --factor-rate-systematic tt_eltau,tt_eltau,tt_taultauh,s_top_eltau,s_top_eltau,s_top_other,dy_tautau,dibosons_other:0.95" "--rename-sys TauIDUp   --factor-rate-systematic tt_eltau,tt_eltau,tt_taultauh,s_top_eltau,s_top_eltau,s_top_other,dy_tautau,dibosons_other:1.05")
python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root     --do-not-reweight -o distrs/v37_test172_bunchCONTROLS1_tau_pt_with_allsys/ --data-nick data_other --lumi 35800 -c mu_sel  -x mu_selVloose   -d tau_pt   $tausys
python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleElectron.root --do-not-reweight -o distrs/v37_test172_bunchCONTROLS1_tau_pt_with_allsys/ --data-nick data_other --lumi 35800 -c el_sel  -x el_selVloose   -d tau_pt   $tausys
end

hadd -f distrs/v37_test172_bunchCONTROLS1_mc_withTauSys.root distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1_tau_pt_with_allsys/*root

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc_withTauSys.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root     --output-type pdf -o plots/v37_test172_bunchCONTROLS1_tau_pt_with_allsys/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d tau_pt  --wjet 1.4 --qcd 1.05 --title "" --title-x "#tau p_{T} [GeV]"  --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --drop-bin 29. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --y-range 0,10000
python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc_withTauSys.root distrs/v37_test172_bunchCONTROLS1/SingleElectron.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_tau_pt_with_allsys/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c el_sel    -x el_selVloose    -d tau_pt  --wjet 1.4 --qcd 1.05 --title "" --title-x "#tau p_{T} [GeV]"  --title-y "Events" --draw-overflows 5 --legend-shift 0.02 --drop-bin 29. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --y-range 0,10000

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc_withTauSys.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root     --output-type pdf -o plots/v37_test172_bunchCONTROLS1_tau_pt_with_allsys/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d tau_pt  --wjet 1.4 --qcd 1.05 --title "" --title-x "#tau p_{T} [GeV]"  --title-y "Events" --draw-overflows 2 --legend-shift 0.02 --drop-bin 29. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --y-range 0,7500 --x-range 25,100
python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc_withTauSys.root distrs/v37_test172_bunchCONTROLS1/SingleElectron.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_tau_pt_with_allsys/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c el_sel    -x el_selVloose    -d tau_pt  --wjet 1.4 --qcd 1.05 --title "" --title-x "#tau p_{T} [GeV]"  --title-y "Events" --draw-overflows 2 --legend-shift 0.02 --drop-bin 29. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --y-range 0,7500 --x-range 25,100

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc_withTauSys.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root     --output-type pdf -o plots/v37_test172_bunchCONTROLS1_tau_pt_with_allsys/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d tau_pt  --wjet 1.4 --qcd 1.05 --title "" --title-x "#tau p_{T} [GeV]"  --title-y "Events" --draw-overflows 2 --legend-shift 0.02 --drop-bin 29. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --y-range 0,7500 --x-range 30,100
python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc_withTauSys.root distrs/v37_test172_bunchCONTROLS1/SingleElectron.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1_tau_pt_with_allsys/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c el_sel    -x el_selVloose    -d tau_pt  --wjet 1.4 --qcd 1.05 --title "" --title-x "#tau p_{T} [GeV]"  --title-y "Events" --draw-overflows 2 --legend-shift 0.02 --drop-bin 29. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --y-range 0,7500 --x-range 30,100








## merge systematics tables

this one

v37_test172BIN1_test1/impacts_table

$\tauh$ jet identification  &  4.7 &  4.5 &  4.5 \\
           PU uncertainty  &  2.8 &  2.8 &  2.5 \\
$\tauh$ misidentification background  &  1.9 &  2.1 &  2.3 \\
     b-tagging efficiency  &  1.1 &  1.2 &  0.9 \\
                      TES  &  0.7 &  0.8 &  0.8 \\
       muon ID efficiency  &  0.6 &  0.6 \\
         DY normalization  &  0.4 &  0.4 &  0.6 \\
 Single Top normalization  &  0.6 &  0.5 &  0.5 \\
     W+jets normalization  &  0.1 &  0.4 &  0.5 \\
        QCD normalization  &  0.1 &  0.5 &  0.4 \\
                      JES  &  0.1 &  0.2 &  0.4 \\
  muon trigger efficiency  &  0.3 &  0.2 \\
electron trigger efficiency  &  2.3 &  0.2 \\
   electron ID efficiency  &  1.8 &  0.2 \\

                      JER  &  0.6 &  0.3 &  0.1 \\
   Dibosons normalization  &  0.0 &  0.0 &  0.0 \\
               Luminosity  &  0.0 &  0.0 &  0.0 \\
          b fragmentation  &  2.3 &  2.0 &  2.4 \\
        top quark $p_{T}$  &  2.7 &  2.3 &  2.2 \\
  final   state radiation  &  1.7 &  1.9 &  1.7 \\

  initial state radiation  &  1.7 &  1.6 &  1.5 \\
                ME scales  &  1.1 &  1.2 &  1.1 \\
semi-leptonic b-hadron BRs  &  0.8 &  0.6 &  0.7 \\
underlying event (Pythia tune)  &  0.5 &  0.5 &  0.6 \\
   ME-PS matching (hdamp)  &  0.4 &  0.4 &  0.5 \\
                      PDF  &  1.5 &  1.5 &  1.6 \\
            MC statistics  &  2.0 &  1.6 &  1.6 \\


and the dileptons...
add the dileptons to printing?

python new_impact_table.py --merge-pdf  v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_el_test1.json v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_mu_test1.json v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_both_test1.json  > v37_test172BIN1_test1/impacts_table

python new_impact_table.py --quote-dileps --merge-pdf  v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_el_test1.json v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_mu_test1.json v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_both_test1.json

choose on the names
and add the dileptons to the printing
+ print the missing systematics as <0.1%

"tt background" ???
-- mis-ID and WJets and multijet this way



$\tauh$ jet identification &  4.7 &  4.5 &  4.5 \\
           PU uncertainty  &  2.8 &  2.8 &  2.5 \\
\ttbar background          &  1.9 &  2.1 &  2.3 \\
     b-tagging efficiency  &  1.1 &  1.2 &  0.9 \\
     $\tauh$ energy scale  &  0.7 &  0.8 &  0.8 \\




  initial state radiation  &  1.7 &  1.5 &  1.5 \\
                ME scales  &  1.1 &  1.2 &  1.1 \\
semi-leptonic b-hadron BRs  &  0.8 &  0.6 &  0.7 \\
underlying event (Pythia tune)  &  0.5 &  0.5 &  0.5 \\
   ME-PS matching (hdamp)  &  0.4 &  0.4 &  0.5 \\
                      PDF  &  1.5 &  1.5 &  1.6 \\
            MC statistics  &  2.0 &  1.7 &  1.7 \\

cat v37_test172BIN1_test1/impacts_table
$\tauh$ jet identification  &  4.7 &  4.5 &  4.5 \\
           PU uncertainty  &  2.8 &  2.8 &  2.5 \\
$\tauh$ misidentification background  &  1.9 &  2.1 &  2.3 \\
     b-tagging efficiency  &  1.1 &  1.2 &  0.9 \\
                      TES  &  0.7 &  0.8 &  0.8 \\

       muon ID efficiency  &  0.6 &  0.6 \\
         DY normalization  &  0.4 &  0.4 &  0.6 \\
 Single Top normalization  &  0.6 &  0.5 &  0.5 \\
     W+jets normalization  &  0.1 &  0.4 &  0.5 \\
        QCD normalization  &  0.1 &  0.5 &  0.4 \\
                      JES  &  0.1 &  0.2 &  0.4 \\
  muon trigger efficiency  &  0.3 &  0.2 \\
electron trigger efficiency  &  2.3 &  0.2 \\
   electron ID efficiency  &  1.8 &  0.2 \\
                      JER  &  0.6 &  0.3 &  0.1 \\
   Dibosons normalization  &  0.0 &  0.0 &  0.0 \\
               Luminosity  &  0.0 &  0.0 &  0.0 \\
          b fragmentation  &  2.3 &  2.0 &  2.4 \\
        top quark $p_{T}$  &  2.7 &  2.3 &  2.2 \\
  final   state radiation  &  1.7 &  1.9 &  1.7 \\
  initial state radiation  &  1.7 &  1.6 &  1.5 \\
                ME scales  &  1.1 &  1.2 &  1.1 \\
semi-leptonic b-hadron BRs  &  0.8 &  0.6 &  0.7 \\
underlying event (Pythia tune)  &  0.5 &  0.5 &  0.6 \\
   ME-PS matching (hdamp)  &  0.4 &  0.4 &  0.5 \\
                      PDF  &  1.5 &  1.5 &  1.6 \\
            MC statistics  &  2.0 &  1.6 &  1.6 \\

$\tauh$ identification                      & 0.0 & 4.4  & 0  \\

\cPqb tagging efficiency            & 0.4 & 0.9  & 1  \\
jet energy scale                    & 0.4 & 1.1  & 1  \\
jet energy resolution               & 0.4 & 0.1  & 1  \\
$\tauh$ energy scale                & 0.0 & 0.7  & 0  \\
pileup (PU)                         & 0.1 & 2.3  & 1  \\

\ttbar background                   & 0.2 & 2.3  & 0  \\
DY background                       & 0.9 & 0.6  & 1  \\
tW background                       & 1.1 & 0.5  & 1  \\
diboson background                  & 0.2 & $<0.1$ & 1  \\
W+jets background                   & 0.2 & 0.7  & 1  \\

top quark \pt modeling                    & 0.5 & 2.3  & 1  \\
\cPqb quark fragmentation                 & 0.7 & 2.0  & 1  \\
semi-leptonic b-hadron branching fraction & 0.1 & 0.6  & 1  \\

\ttbar ME scale                         & 0.2 & 1.1  & 1  \\
\ttbar FSR scale                        & 0.8 & 1.6  & 1  \\
\ttbar ISR scale                        & 0.4 & 1.6  & 1  \\

ME-PS matching                      & 0.2 & 0.4  & 1  \\
underlying event                    & 0.3 & 0.5  & 1  \\



PDF is calculated on the fly!

PDF                                     & 1.1 & 1.5  & 1  \\


trigger efficiency                      & 0.3 & 0.3  & 0  \\
lepton identification and isolation     & 2.0 & 0.6  & 1  \\

-- will have to post-process


missing systematics:

electron efficiencies & $<0.1$ & $<0.1$ & $<0.1$ & 1.5 & 1 \\
muon efficiencies & $<0.1$ & $<0.1$ & $<0.1$ & 1.3 & 1 \\

muon momentum scale             & 0.1 & $<0.1$ & 1  \\
electron momentum scale         & 0.1 & $<0.1$ & 1  \\

tW ME scale                         & 0.2 & $<0.1$ & 1  \\
DY ME scale                         & 0.1 & $<0.1$ & 1  \\

tW ISR scale                        & 0.1 & $<0.1$ & 1  \\
tW FSR scale                        & 0.1 & $<0.1$ & 1  \\

colour reconnection                 & 0.3 & $<0.1$ & 1  \\

integrated luminosity               & 2.5 & 2.5  & 1  \\
-- ??

MC statistics                           & 1.1 & 1.7  & 0  \\
\hline

\multicolumn{3}{c}{Extrapolation uncertainties:} \\
\ttbar ME scale         & 0.3 & 0.3  & 0 \\
PDF                     & 0.8 & 1.3  & 0 \\
top quark \pt modeling  & 0.5 & 0.1  & 0 \\
\ttbar ISR scale        & 0.1 & 0.4  & 0 \\
\ttbar FSR scale        & 0.1 & 1.9  & 0 \\
underlying event        & 0.1 & 0.3  & 0 \\


add this one manually!

statistical                             & 0.2 & 0.9  & 0  \\

el_sig  = 0.949
el_sys  = 0.082
el_stat = 0.014

mu_sig  = 0.926
mu_sys  = 0.072
mu_stat = 0.011

bt_sig  = 0.942
bt_sys  = 0.070
bt_stat = 0.009

0.014 / 0.949
0.011 / 0.926
0.009 / 0.942

0.014752370916754479
0.011879049676025917
0.009554140127388535

$\tauh$ jet identification  &  4.7 &  4.5 &  4.5 & 0.0 & 0 \\
  pileup (PU) uncertainty  &  2.8 &  2.8 &  2.5 & 0.1 & 1 \\
        \ttbar background  &  1.9 &  2.1 &  2.3 & 0.2 & 0 \\
 \cPqb tagging efficiency  &  1.1 &  1.2 &  0.9 & 0.4 & 1 \\
     $\tauh$ energy scale  &  0.7 &  0.8 &  0.8 & 0.0 & 0 \\
       muon ID efficiency  &  0.6 &  0.6 & 0 & 0 \\
            DY background  &  0.4 &  0.4 &  0.6 & 0.9 & 1 \\
            tW background  &  0.6 &  0.5 &  0.5 & 1.1 & 1 \\
        W+jets background  &  0.1 &  0.4 &  0.5 & 0.2 & 0 \\
      multijet background  &  0.1 &  0.5 &  0.4 & $<0.1$ & 0 \\
         jet energy scale  &  0.1 &  0.2 &  0.4 & 0.4 & 1 \\
  muon trigger efficiency  &  0.3 &  0.2 & 0 & 0 \\
electron trigger efficiency  &  2.3 &  0.2 & 0 & 0 \\
   electron ID efficiency  &  1.8 &  0.2 & 0 & 0 \\
    jet energy resolution  &  0.6 &  0.3 &  0.1 & 0.4 & 1 \\
      dibosons background  &  0.0 &  0.0 &  0.0 & 0.2 & 1 \\
          b fragmentation  &  2.3 &  2.0 &  2.4 & 0.7 & 1 \\
top quark $p_{T}$ modeling  &  2.7 &  2.3 &  2.2 & 0.5 & 1 \\
         \ttbar FSR scale  &  1.7 &  1.9 &  1.7 & 0.8 & 1 \\
         \ttbar ISR scale  &  1.7 &  1.6 &  1.5 & 0.4 & 1 \\
         \ttbar ME scales  &  1.1 &  1.2 &  1.1 & 0.2 & 1 \\
semi-leptonic b-hadron branching fraction  &  0.8 &  0.6 &  0.7 & 0.1 & 1 \\
         underlying event  &  0.5 &  0.5 &  0.6 & 0.3 & 1 \\
           ME-PS matching  &  0.4 &  0.4 &  0.5 & 0.2 & 1 \\
               lumi_13TeV  &  0.0 &  0.0 &  0.0 \\
                      PDF  &  1.5 &  1.5 &  1.6 \\
            MC statistics  &  2.0 &  1.6 &  1.6 \\

trigger efficiency & $<0.1$ & $<0.1$ & $<0.1$ & 0.3 & 0 \\
electron efficiencies & $<0.1$ & $<0.1$ & $<0.1$ & 1.5 & 1 \\
muon efficiencies & $<0.1$ & $<0.1$ & $<0.1$ & 1.3 & 1 \\

muon momentum scale & $<0.1$ & $<0.1$ & $<0.1$ & 0.1 & 1 \\
electron momentum scale & $<0.1$ & $<0.1$ & $<0.1$ & 0.1 & 1 \\
tW ME scale & $<0.1$ & $<0.1$ & $<0.1$ & 0.2 & 1 \\
DY ME scale & $<0.1$ & $<0.1$ & $<0.1$ & 0.1 & 1 \\
tW ISR scale & $<0.1$ & $<0.1$ & $<0.1$ & 0.1 & 1 \\
tW FSR scale & $<0.1$ & $<0.1$ & $<0.1$ & 0.1 & 1 \\
colour reconnection & $<0.1$ & $<0.1$ & $<0.1$ & 0.3 & 1 \\
PDF dilep & $<0.1$ & $<0.1$ & $<0.1$ & 1.1 & 1 \\
MC statistics & $<0.1$ & $<0.1$ & $<0.1$ & 1.1 & 0 \\

integrated luminosity & 2.5 & 2.5 & 2.5 & 2.5 & 1 \\
statistics & 1.4 & 1.1 & 0.9 & 0.2 & 0 \\

\ttbar ME scales & 0.3 & 0.4 & 0.3 & 0.2 & 0 \\
PDF & 1.2 & 1.4 & 1.3 & 0.2 & 0 \\
underlying event & 0.3 & 0.2 & 0.2 & 0.3 & 0 \\
ME-PS matching & 0.8 & 1.0 & 0.9 & 0.2 & 0 \\
\ttbar ISR scale & 0.5 & 0.3 & 0.3 & 0.4 & 0 \\
\ttbar FSR scale & 1.9 & 2.0 & 1.9 & 0.8 & 0 \\







## lepton charge mis-identification?

lep_matching_gen_collection

not present in stage2

python sumup_ttree_draw.py "lep_matching_gen[0]" --histo-range 20,-10,10   --cond-com "leps_ID == -11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0]>2 && njets >2" --output v37_mischarge_electron.root      --histo-name mischarge_electron       gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root    &
python sumup_ttree_draw.py "lep_matching_gen[0]" --histo-range 20,-10,10   --cond-com "leps_ID ==  11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0]>2 && njets >2" --output v37_mischarge_electron_anti.root --histo-name mischarge_electron_anti  gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root    &

python sumup_ttree_draw.py "lep_matching_gen[0]" --histo-range 20,-10,10   --cond-com "leps_ID == -13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0]>2 && njets >2" --output v37_mischarge_muon.root          --histo-name mischarge_muon           gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root    &
python sumup_ttree_draw.py "lep_matching_gen[0]" --histo-range 20,-10,10   --cond-com "leps_ID ==  13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0]>2 && njets >2" --output v37_mischarge_muon_anti.root     --histo-name mischarge_muon_anti      gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root    &

python sumup_ttree_draw.py "lep_matching_gen[0]" --histo-range 20,-10,10   --cond-com "leps_ID == -11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0]>2 && njets >2 && abs(lep_p4[0].eta()) < 1.5" --output v37_mischarge_electron_barrel.root      --histo-name mischarge_electron_barrel       gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root    &
python sumup_ttree_draw.py "lep_matching_gen[0]" --histo-range 20,-10,10   --cond-com "leps_ID ==  11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0]>2 && njets >2 && abs(lep_p4[0].eta()) < 1.5" --output v37_mischarge_electron_barrel_anti.root --histo-name mischarge_electron_barrel_anti  gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root    &

python sumup_ttree_draw.py "lep_matching_gen[0]" --histo-range 20,-10,10   --cond-com "leps_ID == -11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0]>2 && njets >2 && abs(lep_p4[0].eta()) > 1.5" --output v37_mischarge_electron_endcap.root      --histo-name mischarge_electron_endcap       gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root    &
python sumup_ttree_draw.py "lep_matching_gen[0]" --histo-range 20,-10,10   --cond-com "leps_ID ==  11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0]>2 && njets >2 && abs(lep_p4[0].eta()) > 1.5" --output v37_mischarge_electron_endcap_anti.root --histo-name mischarge_electron_endcap_anti  gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root    &

rm v37_mischarge_electron.root v37_mischarge_electron_anti.root v37_mischarge_muon.root v37_mischarge_muon_anti.root

hadd -f v37_mischarging_leptons_all.root v37_mischarge_electron.root v37_mischarge_electron_anti.root v37_mischarge_muon.root v37_mischarge_muon_anti.root

root -l v37_mischarging_leptons_all.root

mischarge_electron->Draw()

all leptons in bins -1, -4 (lep tau) and very few in 1

mischarge_electron->FindBin(-4)
(Int_t) 7
mischarge_electron->GetBinContent(7)
(Double_t) 3034.00
mischarge_electron->GetBinContent(8)
(Double_t) 0.00000
mischarge_electron->GetBinContent(9)
(Double_t) 24.0000
mischarge_electron->GetBinContent(10)
(Double_t) 53092.0

mischarge_electron->GetBinContent(11)
(Double_t) 10.0000
mischarge_electron->GetBinContent(12)
(Double_t) 254.000
mischarge_electron->GetBinContent(13)
(Double_t) 4.00000
mischarge_electron->GetBinContent(14)
(Double_t) 1.00000

mischarge_electron->GetBinContent(15)
(Double_t) 8.00000
mischarge_electron->GetBinContent(16)
(Double_t) 8.00000
mischarge_electron->GetBinContent(17)
(Double_t) 6.00000


mischarge_electron->Integral()
(Double_t) 56474.0

(mischarge_electron->GetBinContent(7) + mischarge_electron->GetBinContent(10)) / mischarge_electron->Integral()
0.993838

(mischarge_electron->GetBinContent(12)) / mischarge_electron->Integral()
0.00449764

(mischarge_electron->GetBinContent(12) + mischarge_electron_anti->GetBinContent(12)) / (mischarge_electron->Integral() + mischarge_electron_anti->Integral())


(mischarge_muon->GetBinContent(7) + mischarge_muon->GetBinContent(10)) / mischarge_muon->Integral()
(double) 0.996624

(mischarge_muon->GetBinContent(12)) / mischarge_muon->Integral()
(double) 0.00000

mischarge_muon->GetBinContent(10)
mischarge_muon->GetBinContent(11)
mischarge_muon->GetBinContent(12)
mischarge_muon->GetBinContent(13)
mischarge_muon->GetBinContent(14)
mischarge_muon->GetBinContent(15)
mischarge_muon->GetBinContent(16)
mischarge_muon->GetBinContent(17)

(Double_t) 81737.0
(Double_t) 3.00000
(Double_t) 0.00000
(Double_t) 0.00000
(Double_t) 1.00000
(Double_t) 0.00000
(Double_t) 25.0000
(Double_t) 59.0000

-- some from b hadrons...


### uncertainties of the charge misidentification

%BLUE% >> CORRECTION The charge misidentification probability is <0.45% for electrons, but the uncertainty is much smaller and is included in the ID uncertainty.
For muons the charge misidentification and its' auncertainty are even smaller.
But there is no solid reference within EGamma documentation:
[[https://arxiv.org/pdf/1502.02701.pdf][Run1 EGamma performance (page 16)]]
[[https://cds.cern.ch/record/2320638/files/DP2018_017.pdf][Run2 report]]
[[http://cms.cern.ch/iCMS/analysisadmin/cadilines?line=EGM-17-001][Run2 performance paper]] (and [[https://gitlab.cern.ch/tdr/papers/EGM-17-001][gitlab]])
-- the average probability of charge misidentification is 0.2% with a negligible uncertainty on order 0.05%, but it is not clearey stated for the performance in Run2.
One good reference is that TOP-17-001 does not mention the uncertainty of the charge misidentification either.



## are uncertainties taken from impacts actually correct?

is it correct that:
sum of quadratures of impacts ~= estimation of the overal uncertainty,
since each impact is profiled separately?

then is it correct to use these impacts in the ratio?

or must each systematic uncertainty be obtained fin the pilling-off procedure?


## Why is the systematic uncertainty related to the electron trigger so much larger than the muon trigger ? Do you understand how the combined value is lower than both ? 

-- in the simultaneous fit the electrons are constrained by the muon final state,
   1) muons have more events and
   2) different kinematics with more events at hight MT? CHECK -- NO, it does not have more signal events at large MT
   3) and the LEP mu variation is smaller

but the ratio of el/mu at large MT is only about 0.7-0.8
and the fraction of signal is about 0.6-0.85
the impact of electron LEP falls by a factor of 4..

it seems the constrain on electrons in both does come from muons:
fitting x2 larger variation of muon LEP systematics leads to x2 el impacts


## btw check pulls and constrains

LEPel TRG and IF are not constrained in el
in both they are *slightly* constrained: TRG to 0.75 and ID to 0.8
but their impact is much smaller
and muon LEP are not constrained in both

can there be some dumping effect?
I do not see how: even when fitting both
the muons do not dump in el channels!


### check the magnitudes and correlations between ID and TRG in el and mu -- close magnitudes and opposite correlations lead to no impact on signal strength

and correlations between el and mu -- mu dumps el?


### any shape in the variation of mu or el LEP?



### CHECK if muon-tau has more signal at large Mt (better signal separation per MT)

NO, it does not:

((TH1D*) el_sel_lj->Get("tt_eltau/NOMINAL/el_sel_lj_tt_eltau_NOMINAL_Mt_lep_met_c"))->GetBinContent(11) / ((TH1D*) el_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(11)
((TH1D*) el_sel_lj->Get("tt_eltau/NOMINAL/el_sel_lj_tt_eltau_NOMINAL_Mt_lep_met_c"))->GetBinContent(12) / ((TH1D*) el_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(12)
((TH1D*) el_sel_lj->Get("tt_eltau/NOMINAL/el_sel_lj_tt_eltau_NOMINAL_Mt_lep_met_c"))->GetBinContent(13) / ((TH1D*) el_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(13)
((TH1D*) el_sel_lj->Get("tt_eltau/NOMINAL/el_sel_lj_tt_eltau_NOMINAL_Mt_lep_met_c"))->GetBinContent(14) / ((TH1D*) el_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(14)

(double) 0.580637
(double) 0.681279
(double) 0.767242
(double) 0.854280

((TH1D*) el_sel_ljout->Get("tt_eltau/NOMINAL/el_sel_ljout_tt_eltau_NOMINAL_Mt_lep_met_c"))->GetBinContent(11) / ((TH1D*) el_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(11)
((TH1D*) el_sel_ljout->Get("tt_eltau/NOMINAL/el_sel_ljout_tt_eltau_NOMINAL_Mt_lep_met_c"))->GetBinContent(12) / ((TH1D*) el_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(12)
((TH1D*) el_sel_ljout->Get("tt_eltau/NOMINAL/el_sel_ljout_tt_eltau_NOMINAL_Mt_lep_met_c"))->GetBinContent(13) / ((TH1D*) el_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(13)
((TH1D*) el_sel_ljout->Get("tt_eltau/NOMINAL/el_sel_ljout_tt_eltau_NOMINAL_Mt_lep_met_c"))->GetBinContent(14) / ((TH1D*) el_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(14)

(double) 0.689072
(double) 0.745005
(double) 0.810931
(double) 0.861755


((TH1D*) mu_sel_lj->Get("tt_mutau/NOMINAL/mu_sel_lj_tt_mutau_NOMINAL_Mt_lep_met_c"))->GetBinContent(11) / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(11)
((TH1D*) mu_sel_lj->Get("tt_mutau/NOMINAL/mu_sel_lj_tt_mutau_NOMINAL_Mt_lep_met_c"))->GetBinContent(12) / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(12)
((TH1D*) mu_sel_lj->Get("tt_mutau/NOMINAL/mu_sel_lj_tt_mutau_NOMINAL_Mt_lep_met_c"))->GetBinContent(13) / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(13)
((TH1D*) mu_sel_lj->Get("tt_mutau/NOMINAL/mu_sel_lj_tt_mutau_NOMINAL_Mt_lep_met_c"))->GetBinContent(14) / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(14)

(double) 0.597553
(double) 0.693096
(double) 0.796686
(double) 0.860921

((TH1D*) mu_sel_ljout->Get("tt_mutau/NOMINAL/mu_sel_ljout_tt_mutau_NOMINAL_Mt_lep_met_c"))->GetBinContent(11) / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(11)
((TH1D*) mu_sel_ljout->Get("tt_mutau/NOMINAL/mu_sel_ljout_tt_mutau_NOMINAL_Mt_lep_met_c"))->GetBinContent(12) / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(12)
((TH1D*) mu_sel_ljout->Get("tt_mutau/NOMINAL/mu_sel_ljout_tt_mutau_NOMINAL_Mt_lep_met_c"))->GetBinContent(13) / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(13)
((TH1D*) mu_sel_ljout->Get("tt_mutau/NOMINAL/mu_sel_ljout_tt_mutau_NOMINAL_Mt_lep_met_c"))->GetBinContent(14) / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(14)

(double) 0.710337
(double) 0.771717
(double) 0.827277
(double) 0.864113

--barely 1% more signal....


### but how much more events overall?

((TH1D*) el_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(11) / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(11)
((TH1D*) el_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(12) / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(12)
((TH1D*) el_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(13) / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(13)
((TH1D*) el_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(14) / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(14)

((TH1D*) el_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(11) / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(11)
((TH1D*) el_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(12) / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(12)
((TH1D*) el_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(13) / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(13)
((TH1D*) el_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(14) / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(14)

(double) 0.716273
(double) 0.773809
(double) 0.826996
(double) 0.815067

(double) 0.724549
(double) 0.705970
(double) 0.774931
(double) 0.868142

aha, so this should be the ratio of the constraint?
and 2.4% electrin trigger should become 0.7-0.8 * 2.4%?
no, what's the logic of this?

The signal varies by 2.4% with el TRG in el channels.
It varies the same in muon channels in the simultaneous fit.
And which uncertainties damn it? Only MC stat and stat?

https://github.com/cms-analysis/HiggsAnalysis-CombinedLimit/wiki/nonstandard#nuisance-parameter-impacts

> The impact of a nuisance parameter (NP) θ on a parameter of interest (POI) μ is defined as
> the shift Δμ that is induced as θ is fixed and brought to its +1σ or −1σ post-fit values, with all other parameters profiled as normal.
> 
> This is effectively a measure of the correlation between the NP and the POI, and is useful for determining which NPs have the largest effect on the POI uncertainty.

-- what's the post-fit values?
And "with all other parameters profiled as normal," means they are varied.



### fit more conservative muon efficiencies

cp ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.txt ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_expMu2.txt
make both mucard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_expMu2 elcard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el bothcard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_expMu2

make workspace datacard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_expMu2
make workspace datacard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_expMu2

make impacts   workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_expMu2.root   nn=v37_test172BIN1_mu_test1_expMu2   freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5  &
make impacts   workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_expMu2.root nn=v37_test172BIN1_both_test1_expMu2 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5  &

python new_impact_table.py --merge-pdf  v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_el_test1.json v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_mu_test1_expMu2.json v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_both_test1_expMu2.json  > v37_test172BIN1_test1/impacts_table_expMu2

cat v37_test172BIN1_test1/impacts_table_expMu2
$\tauh$ jet identification  &  4.7 &  4.5 &  4.4 \\
           PU uncertainty  &  2.8 &  2.8 &  2.5 \\
$\tauh$ misidentification background  &  1.9 &  2.2 &  2.4 \\
       muon ID efficiency  &  1.2 &  1.1 \\
     b-tagging efficiency  &  1.1 &  1.1 &  0.9 \\
                      TES  &  0.7 &  0.8 &  0.8 \\
electron trigger efficiency  &  2.3 &  0.6 \\
         DY normalization  &  0.4 &  0.4 &  0.6 \\
 Single Top normalization  &  0.6 &  0.5 &  0.5 \\
     W+jets normalization  &  0.1 &  0.4 &  0.4 \\
                      JES  &  0.1 &  0.3 &  0.4 \\
   electron ID efficiency  &  1.8 &  0.4 \\
  muon trigger efficiency  &  0.6 &  0.4 \\
        QCD normalization  &  0.1 &  0.5 &  0.4 \\

-- muons just doubled
   and it seems the impact of electrons exactly doubled in both!

combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_expMu2.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_exp.root

Best fit r: 0.939362  -0.0689353/+0.0758681  (68% CL)
Best fit r: 0.94178   -0.0684634/+0.0753474  (68% CL)
-- 3rd meaningfull digit
Best fit r: 0.943077  -0.0667657/+0.0745019  (68% CL)

















# check new datasets

from https://twiki.cern.ch/twiki/bin/viewauth/CMS/PdmVAnalysisSummaryTable
2016
release 9_4_X
17Jul2018

from tau ID
https://twiki.cern.ch/twiki/bin/viewauth/CMS/TauIDRecommendation13TeV#Tau_ID_efficiency

SF(Data/MC) for Run 2 for 2016 ReminiAOD in CMSSW9_4_X, 2017 and 2018: See table below. 

table:
        ID 	Working Point 	2016 ReminiAOD 	2017 ReReco 	2018
MVA 2017v2 	VVLoose     	0.90 ± 0.03 	0.89 ± 0.03 	0.86 ± 0.04
MVA 2017v2 	VLoose      	0.90 ± 0.03 	0.88 ± 0.03 	0.90 ± 0.03
MVA 2017v2 	Loose       	0.86 ± 0.02 	0.89 ± 0.03 	0.90 ± 0.03
MVA 2017v2 	Medium      	0.88 ± 0.02 	0.89 ± 0.03 	0.90 ± 0.02
MVA 2017v2 	Tight          	0.87 ± 0.02 	0.89 ± 0.03 	0.90 ± 0.02
MVA 2017v2 	VTight      	0.86 ± 0.02 	0.86 ± 0.03 	0.89 ± 0.02
MVA 2017v2 	VVTight     	0.86 ± 0.02 	0.84 ± 0.03 	0.89 ± 0.02 

-- 0.02 indeed


$ das_client --limit 0 --query="dataset=/SingleElectron/*17Jul2018*/MINIAOD"
/SingleElectron/Run2016B-17Jul2018_ver1-v1/MINIAOD
/SingleElectron/Run2016B-17Jul2018_ver2-v1/MINIAOD
/SingleElectron/Run2016C-17Jul2018-v1/MINIAOD
/SingleElectron/Run2016D-17Jul2018-v1/MINIAOD
/SingleElectron/Run2016E-17Jul2018-v1/MINIAOD
/SingleElectron/Run2016F-17Jul2018-v1/MINIAOD
/SingleElectron/Run2016G-17Jul2018-v1/MINIAOD
/SingleElectron/Run2016H-17Jul2018-v1/MINIAOD
0 otoldaie @lxplus707 master ~/work/private/16/CMSSW_8_0_29/src/UserCode/NtuplerAnalyzer/proc/jobsums
$ das_client --limit 0 --query="dataset=/SingleMuon/*17Jul2018*/MINIAOD"
/SingleMuon/Run2016B-17Jul2018_ver1-v1/MINIAOD
/SingleMuon/Run2016B-17Jul2018_ver2-v1/MINIAOD
/SingleMuon/Run2016C-17Jul2018-v1/MINIAOD
/SingleMuon/Run2016D-17Jul2018-v1/MINIAOD
/SingleMuon/Run2016E-17Jul2018-v1/MINIAOD
/SingleMuon/Run2016F-17Jul2018-v1/MINIAOD
/SingleMuon/Run2016G-17Jul2018-v1/MINIAOD
/SingleMuon/Run2016H-17Jul2018-v1/MINIAOD


## what's needed in ntupler?

which release?
data and MC in 9_4_9
can some correction require something newer?
1) probably no, since this is old stable data
2) if it is required I'll stumble at it during implementation and will update the release

MC weights and gen tree processing

b frag weights
PDFs
-- DONE






MET filters
-- CHECK they are ON for 2017 and 2016 legacy
   they are applied, but it is not clear whether they work
DONE




HLT
and HLT objects
-- triggers work and match
   in Data OK
   in TT   OK
DONE





MUONs ELECTRONs
ID and ISO
muons:     Muon selectors (Since 9_4_X) (ID and ISO)
electrons: electronID(ID) -- the ID includes ISO

pat::Electron: the ID cutBasedElectronID-Fall17-94X-V2-tight can't be found in this pat::Electron.
The available IDs are: 'cutBasedElectronID-Fall17-94X-V1-loose' 'cutBasedElectronID-Fall17-94X-V1-medium' 'cutBasedElectronID-Fall17-94X-V1-tight' 'cutBasedElectronID-Fall17-94X-V1-veto' 'cutBasedElectronID-PHYS14-PU20bx25-V2-standalone-loose' 'cutBasedElectronID-PHYS14-PU20bx25-V2-standalone-medium' 'cutBasedElectronID-PHYS14-PU20bx25-V2-standalone-tight' 'cutBasedElectronID-PHYS14-PU20bx25-V2-standalone-veto' 'cutBasedElectronID-Spring15-25ns-V1-standalone-loose' 'cutBasedElectronID-Spring15-25ns-V1-standalone-medium' 'cutBasedElectronID-Spring15-25ns-V1-standalone-tight' 'cutBasedElectronID-Spring15-25ns-V1-standalone-veto' 'cutBasedElectronID-Spring15-50ns-V2-standalone-loose' 'cutBasedElectronID-Spring15-50ns-V2-standalone-medium' 'cutBasedElectronID-Spring15-50ns-V2-standalone-tight' 'cutBasedElectronID-Spring15-50ns-V2-standalone-veto' 'cutBasedElectronID-Summer16-80X-V1-loose' 'cutBasedElectronID-Summer16-80X-V1-medium' 'cutBasedElectronID-Summer16-80X-V1-tight' 'cutBasedElectronID-Summer16-80X-V1-veto' 'eidLoose' 'eidRobustHighEnergy' 'eidRobustLoose' 'eidRobustTight' 'eidTight' 'heepElectronID-HEEPV60' 'heepElectronID-HEEPV70' 'mvaEleID-Fall17-iso-V1-wp80' 'mvaEleID-Fall17-iso-V1-wp90' 'mvaEleID-Fall17-iso-V1-wpLoose' 'mvaEleID-Fall17-noIso-V1-wp80' 'mvaEleID-Fall17-noIso-V1-wp90' 'mvaEleID-Fall17-noIso-V1-wpLoose' 'mvaEleID-Spring15-25ns-Trig-V1-wp80' 'mvaEleID-Spring15-25ns-Trig-V1-wp90' 'mvaEleID-Spring15-25ns-nonTrig-V1-wp80' 'mvaEleID-Spring15-25ns-nonTrig-V1-wp90' 'mvaEleID-Spring15-25ns-nonTrig-V1-wpLoose' 'mvaEleID-Spring15-50ns-Trig-V1-wp80' 'mvaEleID-Spring15-50ns-Trig-V1-wp90' 'mvaEleID-Spring16-GeneralPurpose-V1-wp80' 'mvaEleID-Spring16-GeneralPurpose-V1-wp90' 'mvaEleID-Spring16-HZZ-V1-wpLoose' .

-- V1 ID should be fine!

FIXME: the ID includes relIso, so the anti-iso region for QCD does not work anymore!

lep ID and ISO
DONE






TODO: Lepton energy scale?
-- did not figure out how to run their one-number-producing software
   it requires R9 for electrons, which is stored already
-- ele scale must be precomputed in legacy
   https://twiki.cern.ch/twiki/bin/view/CMS/EgammaMiniAODV2#Accessing_the_MiniAOD_V2
   > For E/gamma, the miniAOD V2 simply adds the ID and energy scale & smearing information to the pat::Photon/Electrons.

https://twiki.cern.ch/twiki/bin/view/CMS/EgammaMiniAODV2#Energy_Scale_and_Smearing

> E/gamma provides residual corrections to scale the data to the MC
> and smear the MC to the resolution matched in data.
> The resulting energies and the correction values are stored
> now in the pat::Electron/pat::Photon along with the systematic values.
> These are accessed by user floats.

https://twiki.cern.ch/twiki/bin/view/CMS/EgammaMiniAODV2#Applying_the_Energy_Scale_and_sm

> For electrons the recommended nominal p4 is obtained by
> 
> auto corrP4  = pat::Electron::p4() * pat::Electron::userFloat("ecalTrkEnergyPostCorr") / pat::Electron::energy();

-- has only the correct Scale in Data and Smear in MC

> One thing of note, there is an inflection in the energy scale at ~45 GeV in the 2016 legacy.
> If you are using templates and have an energy range that crosses 45 GeV,
> you will constrain the energy scale to which ever side you have more data (likely <45 GeV) and this will cause incorrect pulls.
> Therefore you should use also "ScaleEt" as a systematic template as well.
> This template is an estimate of the energy uncertainty and the sign switches around ~45GeV so the template is correctly constrained.
> Finally as a warning if any constraint (larger than 90%) is observed in pre(post)-fit results concerning electron/photons energy scale, please contact EGamma/ECAL DPG.

> If you are not sufficiently sensitive to the energy scale and you are just using them as a per bin uncorrelated error for simplicity over correctness,
> then you can just use the overall values, "ScaleUp", "ScaleDown", "SigmaUp","SigmaDown". 

OK






Tau ID, discriminants
CHECK
damn!
https://twiki.cern.ch/twiki/bin/viewauth/CMS/TauIDRecommendation13TeV#Isolation
MiniAOD: 2016 94X reprocessing (RunIISummer16MiniAODv3)
requires reprocessing of tau ID
Tau IDs are MVA 2017v2

pat::Tau: the ID byVTightIsolationMVArun2017v2DBoldDMwLT2017 can't be found in this pat::Tau.
The available IDs are: 'againstElectronLooseMVA6' 'againstElectronMVA6Raw' 'againstElectronMVA6category' 'againstElectronMediumMVA6' 'againstElectronTightMVA6' 'againstElectronVLooseMVA6' 'againstElectronVTightMVA6' 'againstMuonLoose3' 'againstMuonTight3' 'byCombinedIsolationDeltaBetaCorrRaw3Hits' 'byIsolationMVArun2v1DBdR03oldDMwLTraw' 'byIsolationMVArun2v1DBnewDMwLTraw' 'byIsolationMVArun2v1DBoldDMwLTraw' 'byIsolationMVArun2v1PWdR03oldDMwLTraw' 'byIsolationMVArun2v1PWnewDMwLTraw' 'byIsolationMVArun2v1PWoldDMwLTraw' 'byLooseCombinedIsolationDeltaBetaCorr3Hits' 'byLooseIsolationMVArun2v1DBdR03oldDMwLT' 'byLooseIsolationMVArun2v1DBnewDMwLT' 'byLooseIsolationMVArun2v1DBoldDMwLT' 'byLooseIsolationMVArun2v1PWdR03oldDMwLT' 'byLooseIsolationMVArun2v1PWnewDMwLT' 'byLooseIsolationMVArun2v1PWoldDMwLT' 'byMediumCombinedIsolationDeltaBetaCorr3Hits' 'byMediumIsolationMVArun2v1DBdR03oldDMwLT' 'byMediumIsolationMVArun2v1DBnewDMwLT' 'byMediumIsolationMVArun2v1DBoldDMwLT' 'byMediumIsolationMVArun2v1PWdR03oldDMwLT' 'byMediumIsolationMVArun2v1PWnewDMwLT' 'byMediumIsolationMVArun2v1PWoldDMwLT' 'byPhotonPtSumOutsideSignalCone' 'byTightCombinedIsolationDeltaBetaCorr3Hits' 'byTightIsolationMVArun2v1DBdR03oldDMwLT' 'byTightIsolationMVArun2v1DBnewDMwLT' 'byTightIsolationMVArun2v1DBoldDMwLT' 'byTightIsolationMVArun2v1PWdR03oldDMwLT' 'byTightIsolationMVArun2v1PWnewDMwLT' 'byTightIsolationMVArun2v1PWoldDMwLT' 'byVLooseIsolationMVArun2v1DBdR03oldDMwLT' 'byVLooseIsolationMVArun2v1DBnewDMwLT' 'byVLooseIsolationMVArun2v1DBoldDMwLT' 'byVLooseIsolationMVArun2v1PWdR03oldDMwLT' 'byVLooseIsolationMVArun2v1PWnewDMwLT' 'byVLooseIsolationMVArun2v1PWoldDMwLT'
'byVTightIsolationMVArun2v1DBdR03oldDMwLT'
'byVTightIsolationMVArun2v1DBnewDMwLT'
'byVTightIsolationMVArun2v1DBoldDMwLT'
'byVTightIsolationMVArun2v1PWdR03oldDMwLT'
'byVTightIsolationMVArun2v1PWnewDMwLT'
'byVTightIsolationMVArun2v1PWoldDMwLT'
'byVVLooseIsolationMVArun2v1DBoldDMwLT'
'byVVTightIsolationMVArun2v1DBdR03oldDMwLT' 'byVVTightIsolationMVArun2v1DBnewDMwLT' 'byVVTightIsolationMVArun2v1DBoldDMwLT' 'byVVTightIsolationMVArun2v1PWdR03oldDMwLT' 'byVVTightIsolationMVArun2v1PWnewDMwLT' 'byVVTightIsolationMVArun2v1PWoldDMwLT' 'chargedIsoPtSum' 'chargedIsoPtSumdR03' 'decayModeFinding' 'decayModeFindingNewDMs' 'footprintCorrection' 'footprintCorrectiondR03' 'neutralIsoPtSum' 'neutralIsoPtSumWeight' 'neutralIsoPtSumWeightdR03' 'neutralIsoPtSumdR03' 'photonPtSumOutsideSignalCone' 'photonPtSumOutsideSignalConedR03' 'puCorrPtSum' .
DONE







CHECK the TES per decay mode -- there are more decay modes now!
-- it's in stage2
DONE







MET? systematics? unclustered?

shiftedP4(systematic_uncertainty, correction_level)

  152       enum METUncertainty {
  153     JetResUp=0, JetResDown=1, JetEnUp=2, JetEnDown=3,
  154         MuonEnUp=4, MuonEnDown=5, ElectronEnUp=6, ElectronEnDown=7,
  155     TauEnUp=8, TauEnDown=9, UnclusteredEnUp=10, UnclusteredEnDown=11,
  156     PhotonEnUp=12, PhotonEnDown=13, NoShift=14, METUncertaintySize=15,
  157     JetResUpSmear=16, JetResDownSmear=17, METFullUncertaintySize=18
  158       };

Exception Message:
MET uncertainty does not exist 

in 9_4_10:

  152        JetResUp=0, JetResDown=1, JetEnUp=2, JetEnDown=3,
  153        MuonEnUp=4, MuonEnDown=5, ElectronEnUp=6, ElectronEnDown=7,
  154        TauEnUp=8, TauEnDown=9, UnclusteredEnUp=10, UnclusteredEnDown=11,
  155        PhotonEnUp=12, PhotonEnDown=13, NoShift=14, METUncertaintySize=15,
  156        JetResUpSmear=16, JetResDownSmear=17, METFullUncertaintySize=18

-- same

these don't exist:

JetResUpSmear
JetResDownSmear

the rest are saved





JETS

JEC: JES is re-applied for control, JER is stored, both variations are calculated and stores
ADDED new JEC, checked on Data & TT 1 file

JES files DONE

JER efficiency table
-- in files
DONE

JET PF ID ?????? where????? which????
-- 2017 is significantly different, efficiency of >99% everywhere, so there is no Loose ID
use 80X recommendation!
DONE





b-tagging?
-- in the preliminary calculation of number of bjets the WP cut is used!

only DeepCSV
not clear name

here:
https://cmssdt.cern.ch/lxr/source/RecoBTag/Combined/test/testDeepCSV_cfg.py
they define
0025    btagDiscriminators = [
0026       'pfCombinedSecondaryVertexV2BJetTags',
0027 
0028       'pfDeepCSVJetTags:probudsg', 
0029       'pfDeepCSVJetTags:probb', 
0030       'pfDeepCSVJetTags:probc', 
0031       'pfDeepCSVJetTags:probbb', 
0032       ## probcc was merged with probc

and in the table they say to sum:

pfDeepCSVJetTags:probb + pfDeepCSVJetTags:probbb

so let's do this

added 2 new bDiscriminants in the ntuples
ok the sum is between 0 and 1, looks OK

DONE



beamspot...

tracks for tau SV

and record...



systematics are applied to control their affect on MC weight
is PU the same?
-- also check if the calculation for N vtx is the same?



## check 2016 legacy rereco jet corrections

the 2018 datasets are miniaod of 2017 -- the corrections did not change!

what's needed in ntupler?
the JEC files and all?

DONE


## check what's needed for unlustered MET -- recompute ntuples?

is it just one of the METs?
save all MET corrections they have in MINIAOD

added


## check electron and muon energy scale -- the electron needed R9, which is implemented, what else?

added


## check el scale and mets

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_energy_SmearUp[0]/lep_p4[0].energy()",   "abs(leps_ID) == 11")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_energy_SmearDown[0]/lep_p4[0].energy()", "abs(leps_ID) == 11")

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_energy_ScaleUp[0]/lep_p4[0].energy()",   "abs(leps_ID) == 11")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_energy_ScaleDown[0]/lep_p4[0].energy()", "abs(leps_ID) == 11")

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_energy_ScaleEtDown[0]-lep_energy_ScaleEtUp[0]:lep_p4[0].energy()>>h(100,0,100,100,-1,1)", "abs(leps_ID) == 11", "col")

all work
no Smear in Data though, as expected

((TTree*) ntupler->Get("reduced_ttree"))->Draw("met_init_shift_UnclusteredEnUp   .pt() / met_init.pt() ")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("met_init_shift_UnclusteredEnDown .pt() / met_init.pt() ")

((TTree*) ntupler->Get("reduced_ttree"))->Draw("met_init_shift_JetEnUp           .pt() / met_init.pt() ")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("met_init_shift_JetEnDown         .pt() / met_init.pt() ")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("met_init_shift_JetResUp          .pt() / met_init.pt() ")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("met_init_shift_JetResDown        .pt() / met_init.pt() ")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("met_init_shift_MuonEnUp          .pt() / met_init.pt() ")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("met_init_shift_MuonEnDown        .pt() / met_init.pt() ")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("met_init_shift_ElectronEnUp      .pt() / met_init.pt() ")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("met_init_shift_ElectronEnDown    .pt() / met_init.pt() ")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("met_init_shift_TauEnUp           .pt() / met_init.pt() ")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("met_init_shift_TauEnDown         .pt() / met_init.pt() ")

-- unclustered does have a significant influence, up to 0.3-0.5 difference

JetEn is up to 0.1
JerRes is more like unclustered (?)
MuonEn within 0.07-0.08
ElEn is 0.012 (smaller than muon?)
TauEn within 0.055

OK



## submit ntuples

get data

for dsets_file in `ls dsets_ext_wjets_dyjets dsets_all_usual_mc`
do
for c in `cut -f2 -d/ $dsets_file`
do
das_client --limit 0 --query="dataset=/$c/RunIISummer16MiniAODv3*/MINIAODSIM"
done | tee ${dsets_file}_2016legacy
done


add MC to dsets_info.py

dsets_ext_wjets_dyjets_2016legacy
dsets_all_usual_mc_2016legacy

/WZTo3LNu_TuneCUETP8M1_13TeV-powheg-pythia8/RunIISummer16MiniAODv2-PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/MINIAODSIM : {LumiMask: '', dtag: MC2016_Summer16_WZTo3LNu_powheg, isMC: true, xsec: 4.4296499999999996}





## check the rest of corrections for stage2






# checking lumi

brilcalc lumi -i /afs/cern.ch/work/o/otoldaie/public/Cert_271036-284044_13TeV_23Sep2016ReReco_Collisions16_JSON.txt --normtag /cvmfs/cms-bril.cern.ch/cms-lumi-pog/Normtags/normtag_DATACERT.json -u /pb

#Summary: 
+-------+------+--------+--------+-------------------+------------------+
| nfill | nrun | nls    | ncms   | totdelivered(/pb) | totrecorded(/pb) |
+-------+------+--------+--------+-------------------+------------------+
| 144   | 393  | 232259 | 232241 | 37381.753         | 35863.818        |
+-------+------+--------+--------+-------------------+------------------+
#Check JSON:
#(run,ls) in json but not in results: []


brilcalc lumi -i /afs/cern.ch/work/o/otoldaie/public/Cert_271036-284044_13TeV_23Sep2016ReReco_Collisions16_JSON.txt --normtag /cvmfs/cms-bril.cern.ch/cms-lumi-pog/Normtags/normtag_DATACERT.json -u /pb -b "STABLE BEAMS"

#Summary: 
+-------+------+--------+--------+-------------------+------------------+
| nfill | nrun | nls    | ncms   | totdelivered(/pb) | totrecorded(/pb) |
+-------+------+--------+--------+-------------------+------------------+
| 144   | 393  | 232259 | 232241 | 37381.753         | 35863.818        |
+-------+------+--------+--------+-------------------+------------------+
#Check JSON:
#(run,ls) in json but not in results: []


-- same

and rounding should be 35863.818 -> 35900




### unclustered MET





# plots for the approval

update the control plots with latest formats -- from the ones in AN
+ move nvtx to the backup -- since cannot make a new format plot of it -- no nvtx in stage2!!!
+ add more control plots? (etas?)

   but without full uncertainty
   full uncertainty is only in Mt plots

-- I've got controls in test172! only hadd and plot them
   ! check if all njets etc are there !
   -- met_c is the wide distr

3x2 for each channel
lep pt, lep eta, met, cosine phi, Mt, +???

4x3 for both channels?
tau pt, tau eta, bjet pt, rjet pt, njets, nbjets

- skip bjet eta and rjet eta

-- check latest bins in jet and bjet eta!

let's hadd and plot everything



+ add prefit Mt with full uncertainty
DONE

+ remake the Mt per tau pT with new binning for better stats?
+ remake signal-background plot in the new binning?
DONE




## control plots in test172

check all plots are produced

make check_job_output out=jobsums/distrs/v37_test172_bunchCONTROLS1
find jobsums/distrs/v37_test172_bunchCONTROLS1 -name "*root" -size -10k | wc -l
0
find jobsums/distrs/v37_test172_bunchCONTROLS1 -name "*root"            | wc -l
40305

python loop_selections.py --options " --wjets-nup-cut " --nt v37 --proc test172 --distrs bunchCONTROLS1 --chan-groups tt_leptau,tt_leptau_lj,tt_leptau_ljout,tt_leptau_Vloose,tt_leptau_Vloose_lj,tt_leptau_Vloose_ljout,tt_presel_cands,tt_presel_cands_lj,tt_presel_cands_ljout,wjets,wjets_ss,dy_leptau,dy_leptau_ss,tt_dileptons,dy_dileptons
2687

grep "^time" batch_jobs/j_Data13TeV_SingleElectron2016B_03Feb2017_ver2_103.root | wc -l
15

>>> 15 * 2687
40305

perfect



hadd and norm

make multihadd2_distrs_all_dtags nt=v37 proc=test172 distrs=bunchCONTROLS1 max_procs=14

-- the directory is 6.6G... let's wait for local hadding
   and make the other thing

dilep_mass
cos_phi_met_lep
phi_met_lep
bjet_eta
bjet_pt
rjet_lead_eta
rjet_lead_pt
lep_eta
lep_pt
tau_eta
tau_pt
met_c
met_f
nbjets
nrjets

last plots:

python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c el_sel -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,250. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend
python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c mu_sel -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,375. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend

make --dry-run plot_sel_1  nt=v37 proc=test172 distrs=bunchCONTROLS1 lumi=35800 chan_tag=mu datafile=SingleMuon     title_lep=muon      output_type=pdf merge_procs="--merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other." options="--data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend"

mkdir -p plots/v37_test172_bunchCONTROLS1/

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d lep_pt  --wjet 1.4 --qcd 1.05 --ratio-range 0.5 --bin-norm --title "" --title-x "muon p_{T} [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02


make -k plot_sel_1  nt=v37 proc=test172 distrs=bunchCONTROLS1 lumi=35800 chan_tag=mu datafile=SingleMuon     title_lep=muon      output_type=pdf merge_procs="--merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other." options="--data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 " &
make -k plot_sel_1  nt=v37 proc=test172 distrs=bunchCONTROLS1 lumi=35800 chan_tag=el datafile=SingleElectron title_lep=electron  output_type=pdf merge_procs="--merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other." options="--data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 " &


python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root     --output-type pdf -o plots/v37_test172_bunchCONTROLS1/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c mu_sel                                -d cos_phi_met_lep --wjet 1.4 --qcd 1.05   --title "" --title-x "cos(#Delta#phi(#mu, p^{miss}_{T}))" --title-y "Events" --top-legend --leg-n-columns 3
python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleElectron.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c el_sel                                -d cos_phi_met_lep --wjet 1.4 --qcd 1.05   --title "" --title-x "cos(#Delta#phi(e, p^{miss}_{T}))"   --title-y "Events" --top-legend --leg-n-columns 3



renames:

mkdir renames
cd renames

for chan in Electron Muon
    for distr in lep_pt lep_eta met_f cos_phi_met_lep Mt_lep_met_c Mt_lep_met_f dilep_mass nrjets nbjets tau_pt tau_eta bjet_pt rjet_lead_pt
        ln -s ../distrs,*"$chan"_"$distr"*pdf "$chan"_"$distr".pdf
    end
end

for chan in Electron Muon
    for distr in Mt_lep_met_f
        ln -s distrs,*"$chan"_"$distr"*pdf "$chan"_"$distr".pdf
    end
end

omit the strange tau bin:

make --dry-run plot_sel_1  nt=v37 proc=test172 distrs=bunchCONTROLS1 lumi=35800 chan_tag=mu datafile=SingleMuon     title_lep=muon      output_type=pdf merge_procs="--merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other." options="--data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 " | grep tau_pt
make --dry-run plot_sel_1  nt=v37 proc=test172 distrs=bunchCONTROLS1 lumi=35800 chan_tag=el datafile=SingleElectron title_lep=electron  output_type=pdf merge_procs="--merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other." options="--data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 " | grep tau_pt

python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleMuon.root     --output-type pdf -o plots/v37_test172_bunchCONTROLS1/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25  --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d tau_pt  --wjet 1.4 --qcd 1.05 --ratio-range 0.5 --bin-norm --title "" --title-x "#tau p_{T} [GeV]"  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02   --drop-bin 27.
python stack_plot.py distrs/v37_test172_bunchCONTROLS1_mc.root distrs/v37_test172_bunchCONTROLS1/SingleElectron.root --output-type pdf -o plots/v37_test172_bunchCONTROLS1/ --data-nick data_other --overwrite --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25  --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. -p -r --lumi 35800 -c el_sel    -x el_selVloose    -d tau_pt  --wjet 1.4 --qcd 1.05 --ratio-range 0.5 --bin-norm --title "" --title-x "#tau p_{T} [GeV]"  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02   --drop-bin 27.






## prefit plots with full systematic

old plots:

python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c el_sel -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,250. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend
python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c mu_sel -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,375. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend

do they have lj, ljout?  no

how to add Tau ID and mis-ID uncertainty?
the best is to run the same as histosels!

make --dry-run run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test172_bunchFULLFIT1BIN1/SingleMuon.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=mu_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_lj"
make --dry-run run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test172_bunchFULLFIT1BIN1/SingleElectron.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=el_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_lj"
make --dry-run run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test172_bunchFULLFIT1BIN1/SingleMuon.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=mu_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_ljout"
make --dry-run run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test172_bunchFULLFIT1BIN1/SingleElectron.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=el_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_ljout"



python stack_plot.py distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root distrs/v37_test172_bunchFULLFIT1BIN1/SingleMuon.root     -o histosels/v37_test172_bunchFULLFIT1BIN1/ --data-nick data_other --lumi 35800 -c mu_sel_lj    -d Mt_lep_met_c --wjet 1.4 --qcd 1.05 -x mu_selVloose_lj    --systematic $sys  ; \
python stack_plot.py distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root distrs/v37_test172_bunchFULLFIT1BIN1/SingleElectron.root -o histosels/v37_test172_bunchFULLFIT1BIN1/ --data-nick data_other --lumi 35800 -c el_sel_lj    -d Mt_lep_met_c --wjet 1.4 --qcd 1.05 -x el_selVloose_lj    --systematic $sys  ; \
python stack_plot.py distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root distrs/v37_test172_bunchFULLFIT1BIN1/SingleMuon.root     -o histosels/v37_test172_bunchFULLFIT1BIN1/ --data-nick data_other --lumi 35800 -c mu_sel_ljout -d Mt_lep_met_c --wjet 1.4 --qcd 1.05 -x mu_selVloose_ljout --systematic $sys  ; \
python stack_plot.py distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root distrs/v37_test172_bunchFULLFIT1BIN1/SingleElectron.root -o histosels/v37_test172_bunchFULLFIT1BIN1/ --data-nick data_other --lumi 35800 -c el_sel_ljout -d Mt_lep_met_c --wjet 1.4 --qcd 1.05 -x el_selVloose_ljout --systematic $sys  ; \

--rename-sys TauMisIDDown --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj:0.7
--rename-sys TauMisIDUp   --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj:1.3
--rename-sys TauIDDown --factor-rate-systematic tt_eltau,tt_eltau,tt_taultauh,s_top_eltau,s_top_eltau,s_top_other,dy_tautau,dibosons_other:0.95
--rename-sys TauIDUp   --factor-rate-systematic tt_eltau,tt_eltau,tt_taultauh,s_top_eltau,s_top_eltau,s_top_other,dy_tautau,dibosons_other:1.05

mkdir -p histosels/v37_test172_bunchFULLFIT1BIN1/tausys

foreach tausys ( "--rename-sys TauMisIDDown --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj:0.7" "--rename-sys TauMisIDUp   --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj:1.3" "--rename-sys TauIDDown --factor-rate-systematic tt_eltau,tt_eltau,tt_taultauh,s_top_eltau,s_top_eltau,s_top_other,dy_tautau,dibosons_other:0.95" "--rename-sys TauIDUp   --factor-rate-systematic tt_eltau,tt_eltau,tt_taultauh,s_top_eltau,s_top_eltau,s_top_other,dy_tautau,dibosons_other:1.05")
python stack_plot.py distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root distrs/v37_test172_bunchFULLFIT1BIN1/SingleMuon.root     -o histosels/v37_test172_bunchFULLFIT1BIN1/tausys/ --data-nick data_other --lumi 35800 -c mu_sel_lj    -d Mt_lep_met_c --wjet 1.4 --qcd 1.05 -x mu_selVloose_lj    $tausys
python stack_plot.py distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root distrs/v37_test172_bunchFULLFIT1BIN1/SingleElectron.root -o histosels/v37_test172_bunchFULLFIT1BIN1/tausys/ --data-nick data_other --lumi 35800 -c el_sel_lj    -d Mt_lep_met_c --wjet 1.4 --qcd 1.05 -x el_selVloose_lj    $tausys
python stack_plot.py distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root distrs/v37_test172_bunchFULLFIT1BIN1/SingleMuon.root     -o histosels/v37_test172_bunchFULLFIT1BIN1/tausys/ --data-nick data_other --lumi 35800 -c mu_sel_ljout -d Mt_lep_met_c --wjet 1.4 --qcd 1.05 -x mu_selVloose_ljout $tausys
python stack_plot.py distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root distrs/v37_test172_bunchFULLFIT1BIN1/SingleElectron.root -o histosels/v37_test172_bunchFULLFIT1BIN1/tausys/ --data-nick data_other --lumi 35800 -c el_sel_ljout -d Mt_lep_met_c --wjet 1.4 --qcd 1.05 -x el_selVloose_ljout $tausys
end

-- no! this won't work, we need nominal QCD in the following

foreach tausys ( "--rename-sys TauMisIDDown --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj:0.5" "--rename-sys TauMisIDUp   --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj:1.5" "--rename-sys TauIDDown --factor-rate-systematic tt_eltau,tt_eltau,tt_taultauh,s_top_eltau,s_top_eltau,s_top_other,dy_tautau,dibosons_other:0.95" "--rename-sys TauIDUp   --factor-rate-systematic tt_eltau,tt_eltau,tt_taultauh,s_top_eltau,s_top_eltau,s_top_other,dy_tautau,dibosons_other:1.05")
python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1.root  --do-not-reweight   -o histosels/v37_test172_bunchFULLFIT1BIN1/tausys/ --data-nick data_other --lumi 35800 -c mu_sel_lj    -d Mt_lep_met_c   $tausys
python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1.root  --do-not-reweight   -o histosels/v37_test172_bunchFULLFIT1BIN1/tausys/ --data-nick data_other --lumi 35800 -c el_sel_lj    -d Mt_lep_met_c   $tausys
python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1.root  --do-not-reweight   -o histosels/v37_test172_bunchFULLFIT1BIN1/tausys/ --data-nick data_other --lumi 35800 -c mu_sel_ljout -d Mt_lep_met_c   $tausys
python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1.root  --do-not-reweight   -o histosels/v37_test172_bunchFULLFIT1BIN1/tausys/ --data-nick data_other --lumi 35800 -c el_sel_ljout -d Mt_lep_met_c   $tausys
end

hadd histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1.root histosels/v37_test172_bunchFULLFIT1BIN1/tausys//*root


python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/update-v11-v12-approval_plot_with_sys/ --data-nick data_other --overwrite -p -r -c el_sel_ljout    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,200. --uncertainty-systematic TauMisID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend



python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/update-v11-v12-approval_plot_with_sys/paper-std/ --data-nick data_other --overwrite -p -r -c el_sel_lj    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,100. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend
python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/update-v11-v12-approval_plot_with_sys/paper-std/ --data-nick data_other --overwrite -p -r -c el_sel_ljout -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,100. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend

python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/update-v11-v12-approval_plot_with_sys/paper-std/ --data-nick data_other --overwrite -p -r -c mu_sel_lj    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,150. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend
python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/update-v11-v12-approval_plot_with_sys/paper-std/ --data-nick data_other --overwrite -p -r -c mu_sel_ljout -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,150. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend


with no merging processes

python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/update-v11-v12-approval_plot_with_sys/ --data-nick data_other --overwrite -p -r -c el_sel_lj    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02  --y-range 0,100. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25
python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/update-v11-v12-approval_plot_with_sys/ --data-nick data_other --overwrite -p -r -c el_sel_ljout -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02  --y-range 0,100. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25

python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/update-v11-v12-approval_plot_with_sys/ --data-nick data_other --overwrite -p -r -c mu_sel_lj    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02  --y-range 0,150. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25
python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/update-v11-v12-approval_plot_with_sys/ --data-nick data_other --overwrite -p -r -c mu_sel_ljout -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02  --y-range 0,150. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25


merged processes for the paper:

python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/update-v11-v12-approval_plot_with_sys/paper-std/ --data-nick data_other --overwrite -p -r -c el_sel_lj    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,100. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25
python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/update-v11-v12-approval_plot_with_sys/paper-std/ --data-nick data_other --overwrite -p -r -c el_sel_ljout -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,100. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25

python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/update-v11-v12-approval_plot_with_sys/paper-std/ --data-nick data_other --overwrite -p -r -c mu_sel_lj    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,150. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25
python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/update-v11-v12-approval_plot_with_sys/paper-std/ --data-nick data_other --overwrite -p -r -c mu_sel_ljout -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,150. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25


test usual legend

python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/update-v11-v12-approval_plot_with_sys/paper-std/ --data-nick data_other --overwrite -p -r -c el_sel_ljout -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,100. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25

python stack_plot.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1_with_tausys.root -o plots/update-v11-v12-approval_plot_with_sys/paper-std/ --data-nick data_other --overwrite -p -r -c mu_sel_ljout -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,150. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25





## remake the Mt plots with new binning

the Mt per tau pT with new binning for better stats?
signal-background plot in the new binning?

just plot Mt for signal and background, inclusive and per tau pT
then hadd and compare on plots

python sumup_ttree_draw.py "event_met_lep_mt" --custom-range 0,16,32,44,54,64,74,81,88,95,104,116,132,160,250   --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>30 && gen_proc_id<40)*event_weight" --output v37_new_bins_Mt_plots_mu_sel_tt_mutau_Mt_inclusive.root --histo-name tt_mutau_Mt_inclusive  lstore_outdirs/v37/test172/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "event_met_lep_mt" --custom-range 0,16,32,44,54,64,74,81,88,95,104,116,132,160,250   --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>20 && gen_proc_id<30)*event_weight" --output v37_new_bins_Mt_plots_mu_sel_tt_lj_Mt_inclusive.root    --histo-name tt_lj_Mt_inclusive     lstore_outdirs/v37/test172/MC2016_Summer16_TTJets_powheg/*root     &

python sumup_ttree_draw.py "event_met_lep_mt" --custom-range 0,16,32,44,54,64,74,81,88,95,104,116,132,160,250   --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>30 && gen_proc_id<40)*event_weight" --output v37_new_bins_Mt_plots_mu_sel_tt_mutau_Mt_inclusive2.root --histo-name tt_mutau_Mt_inclusive2  lstore_outdirs/v37/test172/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "event_met_lep_mt" --custom-range 0,16,32,44,54,64,74,81,88,95,104,116,132,160,250   --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>20 && gen_proc_id<30)*event_weight" --output v37_new_bins_Mt_plots_mu_sel_tt_lj_Mt_inclusive2.root    --histo-name tt_lj_Mt_inclusive2     lstore_outdirs/v37/test172/MC2016_Summer16_TTJets_powheg/*root     &

python sumup_ttree_draw.py "event_met_lep_mt" --custom-range 0,16,32,44,54,64,74,81,88,95,104,116,132,160,250   --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>30 && gen_proc_id<40 && event_taus[0].pt() < 40.)*event_weight" --output v37_new_bins_Mt_plots_mu_sel_tt_mutau_Mt_tau_pt_40.root --histo-name tt_mutau_Mt_tau_pt_40  lstore_outdirs/v37/test172/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "event_met_lep_mt" --custom-range 0,16,32,44,54,64,74,81,88,95,104,116,132,160,250   --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>20 && gen_proc_id<30 && event_taus[0].pt() < 40.)*event_weight" --output v37_new_bins_Mt_plots_mu_sel_tt_lj_Mt_tau_pt_40.root    --histo-name tt_lj_Mt_tau_pt_40     lstore_outdirs/v37/test172/MC2016_Summer16_TTJets_powheg/*root     &

python sumup_ttree_draw.py "event_met_lep_mt" --custom-range 0,16,32,44,54,64,74,81,88,95,104,116,132,160,250   --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>30 && gen_proc_id<40 && event_taus[0].pt() < 65.)*event_weight" --output v37_new_bins_Mt_plots_mu_sel_tt_mutau_Mt_tau_pt_65.root --histo-name tt_mutau_Mt_tau_pt_65  lstore_outdirs/v37/test172/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "event_met_lep_mt" --custom-range 0,16,32,44,54,64,74,81,88,95,104,116,132,160,250   --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>20 && gen_proc_id<30 && event_taus[0].pt() < 65.)*event_weight" --output v37_new_bins_Mt_plots_mu_sel_tt_lj_Mt_tau_pt_65.root    --histo-name tt_lj_Mt_tau_pt_65     lstore_outdirs/v37/test172/MC2016_Summer16_TTJets_powheg/*root     &

python sumup_ttree_draw.py "event_met_lep_mt" --custom-range 0,16,32,44,54,64,74,81,88,95,104,116,132,160,250   --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>30 && gen_proc_id<40 && event_taus[0].pt() >= 65.)*event_weight" --output v37_new_bins_Mt_plots_mu_sel_tt_mutau_Mt_tau_pt_more.root --histo-name tt_mutau_Mt_tau_pt_more  lstore_outdirs/v37/test172/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "event_met_lep_mt" --custom-range 0,16,32,44,54,64,74,81,88,95,104,116,132,160,250   --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>20 && gen_proc_id<30 && event_taus[0].pt() >= 65.)*event_weight" --output v37_new_bins_Mt_plots_mu_sel_tt_lj_Mt_tau_pt_more.root    --histo-name tt_lj_Mt_tau_pt_more     lstore_outdirs/v37/test172/MC2016_Summer16_TTJets_powheg/*root     &

python sumup_ttree_draw.py "event_met_lep_mt" --custom-range 0,16,32,44,54,64,74,81,88,95,104,116,132,160,250   --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>30 && gen_proc_id<40 && event_taus[0].pt() < 60.)*event_weight" --output v37_new_bins_Mt_plots_mu_sel_tt_mutau_Mt_tau_pt_60.root --histo-name tt_mutau_Mt_tau_pt_60  lstore_outdirs/v37/test172/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "event_met_lep_mt" --custom-range 0,16,32,44,54,64,74,81,88,95,104,116,132,160,250   --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>20 && gen_proc_id<30 && event_taus[0].pt() < 60.)*event_weight" --output v37_new_bins_Mt_plots_mu_sel_tt_lj_Mt_tau_pt_60.root    --histo-name tt_lj_Mt_tau_pt_60     lstore_outdirs/v37/test172/MC2016_Summer16_TTJets_powheg/*root     &

python sumup_ttree_draw.py "event_met_lep_mt" --custom-range 0,16,32,44,54,64,74,81,88,95,104,116,132,160,250   --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>30 && gen_proc_id<40 && event_taus[0].pt() >= 60.)*event_weight" --output v37_new_bins_Mt_plots_mu_sel_tt_mutau_Mt_tau_pt_more60.root --histo-name tt_mutau_Mt_tau_pt_more60  lstore_outdirs/v37/test172/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "event_met_lep_mt" --custom-range 0,16,32,44,54,64,74,81,88,95,104,116,132,160,250   --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>20 && gen_proc_id<30 && event_taus[0].pt() >= 60.)*event_weight" --output v37_new_bins_Mt_plots_mu_sel_tt_lj_Mt_tau_pt_more60.root    --histo-name tt_lj_Mt_tau_pt_more60     lstore_outdirs/v37/test172/MC2016_Summer16_TTJets_powheg/*root     &

hadd -f v37_new_bins_Mt_plots_mu_sel_all.root v37_new_bins_Mt_plots_mu_sel_tt_*.root

root -l v37_new_bins_Mt_plots_mu_sel_all.root

tt_lj_Mt_tau_pt_40   ->Divide(tt_lj_Mt_inclusive)
tt_lj_Mt_tau_pt_65   ->Divide(tt_lj_Mt_inclusive)
tt_lj_Mt_tau_pt_more ->Divide(tt_lj_Mt_inclusive)
tt_lj_Mt_inclusive   ->Divide(tt_lj_Mt_inclusive)

tt_lj_Mt_tau_pt_40   ->Draw()
tt_lj_Mt_tau_pt_65   ->Draw("same")
tt_lj_Mt_tau_pt_more ->Draw("same")
tt_lj_Mt_inclusive   ->Draw("same")

-- ok

try more robust measure:

python sumup_ttree_draw.py "event_met_lep_mt" --custom-range 0,16,32,44,54,64,74,81,88,95,104,116,132,160,250   --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>30 && gen_proc_id<40 && event_taus[0].pt() > 40.)*event_weight" --output v37_new_bins_Mt_plots_mu_sel_tt_mutau_Mt_tau_pt_more40.root --histo-name tt_mutau_Mt_tau_pt_more40  lstore_outdirs/v37/test172/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "event_met_lep_mt" --custom-range 0,16,32,44,54,64,74,81,88,95,104,116,132,160,250   --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>20 && gen_proc_id<30 && event_taus[0].pt() > 40.)*event_weight" --output v37_new_bins_Mt_plots_mu_sel_tt_lj_Mt_tau_pt_more40.root    --histo-name tt_lj_Mt_tau_pt_more40     lstore_outdirs/v37/test172/MC2016_Summer16_TTJets_powheg/*root     &

python sumup_ttree_draw.py "event_met_lep_mt" --custom-range 0,16,32,44,54,64,74,81,88,95,104,116,132,160,250   --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>30 && gen_proc_id<40 && event_taus[0].pt() > 65.)*event_weight" --output v37_new_bins_Mt_plots_mu_sel_tt_mutau_Mt_tau_pt_more65.root --histo-name tt_mutau_Mt_tau_pt_more65  lstore_outdirs/v37/test172/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "event_met_lep_mt" --custom-range 0,16,32,44,54,64,74,81,88,95,104,116,132,160,250   --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>20 && gen_proc_id<30 && event_taus[0].pt() > 65.)*event_weight" --output v37_new_bins_Mt_plots_mu_sel_tt_lj_Mt_tau_pt_more65.root    --histo-name tt_lj_Mt_tau_pt_more65     lstore_outdirs/v37/test172/MC2016_Summer16_TTJets_powheg/*root     &

tt_lj_Mt_tau_pt_40   ->Divide(tt_lj_Mt_tau_pt_more40)
tt_lj_Mt_tau_pt_65   ->Divide(tt_lj_Mt_tau_pt_more65)

tt_lj_Mt_tau_pt_65   ->Draw()
tt_lj_Mt_tau_pt_40   ->Draw("same")

-- there is some strange deviation with two peaks, but it is small and does not break overall linearity

let's plot comparisons

python jobsums/get_shapes.py --x-title "M_{T}(l, p^{miss}_{T}) [GeV]" --y-title "a.u." --norm-binwidth --formula "background:signal" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "signal":v37_new_bins_Mt_plots_mu_sel_all.root:tt_mutau_Mt_inclusive "background":v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_inclusive --y-range 0,0.0159 --output-type pdf --left-title --no-std-path

python jobsums/get_shapes.py --x-title "M_{T}(l, p^{miss}_{T}) [GeV]" --y-title "a.u." --formula "inclusive/inclusive2:tau40/inclusive2:tau65/inclusive2:tauMore/inclusive2" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "inclusive":v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_inclusive "inclusive2":v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_inclusive "tau40":v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_tau_pt_40 "tau65":v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_tau_pt_65 "tauMore":v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_tau_pt_more --y-range 0,2. --output-type pdf --left-title --no-std-path --no-norm --draw-error-bars

python jobsums/get_shapes.py --x-title "M_{T}(l, p^{miss}_{T}) [GeV]" --y-title "a.u." --formula "inclusive/inclusive2:tau40/inclusive2:tau60/inclusive2:tauMore60/inclusive2" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "inclusive":v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_inclusive "inclusive2":v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_inclusive "tau40":v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_tau_pt_40 "tau60":v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_tau_pt_60 "tauMore60":v37_new_bins_Mt_plots_mu_sel_all.root:tt_lj_Mt_tau_pt_more60 --y-range 0,2. --output-type pdf --left-title --no-std-path --no-norm --draw-error-bars

cp ./compare_mu_selVloose_tt_lj_NOMINAL_Mt_lep_met_c_inclusive2,tau40,tau60,tauMore60,inclusive_formula_nonorm.pdf mu_Mt_tau_pt_lj.pdf

done




# questions of object sign offs

tau fakes from electrons and muons?

python sumup_ttree_draw.py "@event_taus_genmatch.size()" --histo-range 20,0,10   --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7)*event_weight" --output v37_test15_taus_genmatch_length.root  --histo-name taus_genmatch_length   lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "event_taus_genmatch[0]"      --histo-range 20,-10,10 --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7)*event_weight" --output v37_test15_taus_genmatch_value.root   --histo-name taus_genmatch          lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root     &

hadd v37_test15_all_taus_genmatch.root v37_test15_taus_genmatch_value.root v37_test15_taus_genmatch_length.root

# a datacard with complex signal strength

multiply the tau_l channel with r^2

cp ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_complexsignal.txt

vim -p ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_complexsignal.txt

dilep_norm              extArg                   1.         [0.8,1.2]
tau_ratio               extArg                   1.         [0.85,1.15]
rate_elmu               rateParam  elmu     tt_other  (@0)   dilep_norm
rate_eltau              rateParam  el       tt_eltau (@0*@1) dilep_norm,tau_ratio

rate_taul               rateParam  mu_sel_lj     tt_taultauh  (@0*@0)   r
rate_taul               rateParam  mu_sel_ljout  tt_taultauh  (@0*@0)   r


make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_complexsignal

combine -M FitDiagnostics   ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_complexsignal.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root

Best fit r: 0.943688  -0.0746634/+0.0804922  (68% CL)
Best fit r: 0.9463  -0.0732235/+0.0785937  (68% CL)

and without the rate_taul in the datacard

make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_complexsignal
combine -M FitDiagnostics   ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_complexsignal.root

Best fit r: 0.9463  -0.0732235/+0.0785937  (68% CL)

perfect





# questions in v8

shape plot

python get_shapes.py --x-title "M_{T}(l, p^{miss}_{T}) [GeV]" --y-title "a.u." --norm-binwidth --formula "background:signal" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "signal":distrs/v37_test15_bunchFULLFIT1_mc_1.root:mu_selVloose/tt_mutau/NOMINAL "background":distrs/v37_test15_bunchFULLFIT1_mc_1.root:mu_selVloose/tt_lj/NOMINAL --y-range 0,0.015
python get_shapes.py --x-title "M_{T}(l, p^{miss}_{T}) [GeV]" --y-title "a.u." --norm-binwidth --formula "background:signal" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "signal":distrs/v37_test15_bunchFULLFIT1_mc_1.root:mu_selVloose/tt_mutau/NOMINAL "background":distrs/v37_test15_bunchFULLFIT1_mc_1.root:mu_selVloose/tt_lj/NOMINAL --y-range 0,0.0159 --output-type pdf --left-title


stack plot

python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c mu_sel -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj:tt_muj.tt_taultauh,tt_other. --y-range 0,250. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --lumi-label 35.8 --output-type pdf

python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c el_sel -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj:tt_elj.tt_taultauh,tt_other. --y-range 0,250. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25



python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c el_sel -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,250. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend
python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c mu_sel -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,375. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend



and the NLL scan in pdf with horizontal lines at 1 and 4

python ttxsec/fit-stuff/plot_uncertainty_scans.py v37_test15_exp_unc --xsec-scale 831.76 --title-x "cross section [pb]" --horizontal-lines 1,4 --output-type pdf

-- the horizontal TLine-s don't work with the TGraph-s.......



# stat comitee tests for higgsCombine datacard, run on the datacards

make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_el
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu
make both mucard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu elcard=ttxsec/datacard_v37_test15_bunchFULLFIT1_el bothcard=ttxsec/datacard_v37_test15_bunchFULLFIT1_both
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_both

combineCards.py mu=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.txt el=ttxsec/datacard_v37_test15_bunchFULLFIT1_el.txt > ttxsec/datacard_v37_test15_bunchFULLFIT1_both.txt
../scripts/text2workspace.py ttxsec/datacard_v37_test15_bunchFULLFIT1_el.txt


make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.root   nn=v37_test15_mu_STATTEST    &
make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_el.root   nn=v37_test15_el_STATTEST    &
make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_both.root nn=v37_test15_both_STATTEST  &

 POI: r= 0.945318 -> [0.5,1.5]
 POI: r= 0.944658 -> [0.5,1.5]
 POI: r= 0.958266 -> [0.5,1.5]

VS

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   nn=v37_test15_mu_STATTESTexp
make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_el_exp.root   nn=v37_test15_el_STATTESTexp
make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_both_exp.root nn=v37_test15_both_STATTESTexp

 POI: r= 0.945318 -> [0.5,1.5]
 POI: r= 0.944658 -> [0.5,1.5]
 POI: r= 0.958266 -> [0.5,1.5]

same

make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.root   nn=v37_test15_mu_STATTEST    &
make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_el.root   nn=v37_test15_el_STATTEST    &
make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_both.root nn=v37_test15_both_STATTEST  &

overall uncertainty:

el   0.945 +- 0.0824
mu   0.945 +- 0.073
both 0.958 +- 0.0697

OK




goodness of fit

combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.root   --algo=KS         -s 123                    --freezeParameters lumi_13TeV -n v37_test15_mu_STATTEST_KS
combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_el.root   --algo=KS         -s 123                    --freezeParameters lumi_13TeV -n v37_test15_el_STATTEST_KS
combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_both.root --algo=KS         -s 123                    --freezeParameters lumi_13TeV -n v37_test15_both_STATTEST_KS

Kolmogorov-Smirnov test statistic: 0.00514565
Kolmogorov-Smirnov test statistic: 0.0146337
Kolmogorov-Smirnov test statistic: 0.0201683

combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.root   --algo=KS         -s 321                    --freezeParameters lumi_13TeV -n v37_test15_mu_STATTEST_KS
combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_el.root   --algo=KS         -s 321                    --freezeParameters lumi_13TeV -n v37_test15_el_STATTEST_KS
combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_both.root --algo=KS         -s 321                    --freezeParameters lumi_13TeV -n v37_test15_both_STATTEST_KS

Kolmogorov-Smirnov test statistic: 0.00514565
Kolmogorov-Smirnov test statistic: 0.0146337
Kolmogorov-Smirnov test statistic: 0.0201683


combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.root   --algo=KS -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test15_mu_STATTEST_KS100    &
combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_el.root   --algo=KS -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test15_el_STATTEST_KS100    &
combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_both.root --algo=KS -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test15_both_STATTEST_KS100  &

root -l higgsCombinev37_test15_mu_STATTEST_KS100.GoodnessOfFit.mH120.123.root
root -l higgsCombinev37_test15_el_STATTEST_KS100.GoodnessOfFit.mH120.123.root
root -l higgsCombinev37_test15_both_STATTEST_KS100.GoodnessOfFit.mH120.123.root

limit->Draw("limit")
h = (TH1D*) limit->GetHistogram()
h_c = (TH1D*) h->GetCumulative(kFALSE)
h_c->Draw()

h_c->GetBinContent(h_c->FindBin(0.00514565))
h_c->GetBinContent(h_c->FindBin(0.0146337))
h_c->GetBinContent(h_c->FindBin(0.0201683))

90.000
15.000
40.000

good!
perfect

combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.root   --algo=KS         -s 123                    --freezeParameters lumi_13TeV,TOPPT --setParameters TOPPT=1 -n v37_test15_mu_STATTEST_KS_TOPPT1

Kolmogorov-Smirnov test statistic: 0.00494335

root -l stattests/1/higgsCombinev37_test15_mu_STATTEST_KS100.GoodnessOfFit.mH120.123.root

limit->Draw("limit")
h = (TH1D*) limit->GetHistogram()
h_c = (TH1D*) h->GetCumulative(kFALSE)
h_c->Draw()

h_c->GetBinContent(h_c->FindBin(0.00494335))

93.0000

-- 93% on one side of the test!

test nll-s!

also the KS 100 run does not include 1 less parameter?

combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.root   --algo=KS -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV,TOPPT --setParameters TOPPT=1 -n v37_test15_mu_STATTEST_KS100_TOPPT1

mv higgsCombinev37_test15_mu_STATTEST_KS100_TOPPT1.GoodnessOfFit.mH120.123.root stattests/1/
root -l stattests/1/higgsCombinev37_test15_mu_STATTEST_KS100_TOPPT1.GoodnessOfFit.mH120.123.root

mean   expected limit: r < 0.00884269 +/- 0.000252048 @ 95%CL (100 toyMC)
median expected limit: r < 0.00847823 @ 95%CL (100 toyMC)
   68% expected band : 0.00646995 < r < 0.0111219
   95% expected band : 0.00481851 < r < 0.0153409

aha

97.0000

aha


tests from twiki:
https://twiki.cern.ch/twiki/bin/viewauth/CMS/HiggsWG/HiggsPAGPreapprovalChecks

combine -M FitDiagnostics -t -1 --expectSignal 0  ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.root
combine -M FitDiagnostics -t -1 --expectSignal 0  ttxsec/datacard_v37_test15_bunchFULLFIT1_el.root
combine -M FitDiagnostics -t -1 --expectSignal 0  ttxsec/datacard_v37_test15_bunchFULLFIT1_both.root

python ../test/diffNuisances.py -a fitDiagnostics.root -g plots.root


mu

Best fit r: 6.16239e-06  -6.16239e-06/+4.52402  (68% CL)

in table b fit has most parameters like this:
* +0.00, 1.24*
! -0.00, 1.59!

-- it's at 0, the variation is slightly larger than 1sigma
   why are they marked?
   probably >1.1sigma is *marked*
   and      >1.5sigma is !marked!


el

Best fit r: 9.29125e-05  -9.29125e-05/+0.0211531  (68% CL)

all at zero, few marks and only *marks*



both

Best fit r: 0.000312353  -0.000312353/+0.0166493  (68% CL)

and also all nuisances at 0, few are marked, couple !with!


combine -M FitDiagnostics -t -1 --expectSignal 1  ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.root
combine -M FitDiagnostics -t -1 --expectSignal 1  ttxsec/datacard_v37_test15_bunchFULLFIT1_el.root
combine -M FitDiagnostics -t -1 --expectSignal 1  ttxsec/datacard_v37_test15_bunchFULLFIT1_both.root

python ../test/diffNuisances.py -a fitDiagnostics.root -g plots.root



mu

Best fit r: 1  -0.0718557/+0.0821157  (68% CL)

s+b is perfect, very few are marked



el

Best fit r: 1  -0.0792545/+0.0920065  (68% CL)

more marks than in mu, but *majority is*


both

Best fit r: 1  -0.0682529/+0.0778925  (68% CL)

same, only FSR and fakes are !marked!, a bunch of *marks*



Validate script

../../../CombineHarvester/CombineTools/scripts/ValidateDatacards.py ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.txt
../../../CombineHarvester/CombineTools/scripts/ValidateDatacards.py ttxsec/datacard_v37_test15_bunchFULLFIT1_el.txt
../../../CombineHarvester/CombineTools/scripts/ValidateDatacards.py ttxsec/datacard_v37_test15_bunchFULLFIT1_both.txt

../../../CombineHarvester/CombineTools/scripts/ValidateDatacards.py ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.txt
[SetFlag] Changing value of flag "check-negative-bins-on-import" from 1 to 0
[SetFlag] Changing value of flag "workspaces-use-clone" from 0 to 1
================================
=======Validation results=======
================================
>>>There were  40 warnings of type  'up/down templates vary the yield in the same direction'
>>>There were no warnings of type  'At least one of the up/down systematic uncertainty templates is empty'
>>>There were  40 warnings of type  'Uncertainty has normalisation effect of more than 10.0%'
>>>There were  4 warnings of type  'Uncertainty probably has no genuine shape effect'
>>>There were no warnings of type 'Empty process'

../../../CombineHarvester/CombineTools/scripts/ValidateDatacards.py ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.root
../../../CombineHarvester/CombineTools/scripts/ValidateDatacards.py ttxsec/datacard_v37_test15_bunchFULLFIT1_el.root
../../../CombineHarvester/CombineTools/scripts/ValidateDatacards.py ttxsec/datacard_v37_test15_bunchFULLFIT1_both.root

../../../CombineHarvester/CombineTools/scripts/ValidateDatacards.py ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.root
[SetFlag] Changing value of flag "check-negative-bins-on-import" from 1 to 0
[SetFlag] Changing value of flag "workspaces-use-clone" from 0 to 1
================================
=======Validation results=======
================================
>>>There were no warnings

[SetFlag] Changing value of flag "check-negative-bins-on-import" from 1 to 0
[SetFlag] Changing value of flag "workspaces-use-clone" from 0 to 1
================================
=======Validation results=======
================================
>>>There were no warnings

[SetFlag] Changing value of flag "check-negative-bins-on-import" from 1 to 0
[SetFlag] Changing value of flag "workspaces-use-clone" from 0 to 1
================================
=======Validation results=======
================================
>>>There were no warnings


# corrected the fixed lepjet propagation test172 BIN1

make run_std_histos out=histosels/v37_test172_bunchFULLFIT1BIN1/ wjets_norm=1.4 lumi_mu=35800 lumi_el=35800 mc=distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root data_mu=distrs/v37_test172_bunchFULLFIT1BIN1/SingleMuon.root data_el=distrs/v37_test172_bunchFULLFIT1BIN1/SingleElectron.root

something crashes with "file exists, nothing is written"?

make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test172_bunchFULLFIT1BIN1/SingleMuon.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=mu_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_lj"    & \
make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test172_bunchFULLFIT1BIN1/SingleElectron.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=el_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_lj"    & \
make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test172_bunchFULLFIT1BIN1/SingleMuon.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=mu_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_ljout" & \
make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test172_bunchFULLFIT1BIN1/SingleElectron.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=el_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_ljout" & \

make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test172_bunchFULLFIT1BIN1/SingleMuon.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=mu_sel_lj    systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_lj" & \
make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test172_bunchFULLFIT1BIN1/SingleElectron.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=el_sel_lj    systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_lj" & \
make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test172_bunchFULLFIT1BIN1/SingleMuon.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=mu_sel_ljout systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_ljout" & \
make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test172_bunchFULLFIT1BIN1/SingleElectron.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=el_sel_ljout systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_ljout" & \

make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test172_bunchFULLFIT1BIN1/SingleMuon.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=mu_sel & \
make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test172_bunchFULLFIT1BIN1/SingleElectron.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=el_sel & 



hadd histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1.root histosels/v37_test172_bunchFULLFIT1BIN1/*

cp ttxsec/datacard_v37_test17_bunchFULLFIT1BIN1_el.txt ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.txt
cp ttxsec/datacard_v37_test17_bunchFULLFIT1BIN1_mu.txt ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.txt

cp ttxsec/datacard_v37_test172_bunchFULLFIT1_el.txt ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.txt
cp ttxsec/datacard_v37_test172_bunchFULLFIT1_mu.txt ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.txt

vim -p ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.txt ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.txt

grep observa ttxsec/datacard_v37_test172_bunchFULLFIT1_el.txt ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.txt
ttxsec/datacard_v37_test172_bunchFULLFIT1_el.txt:observation  6690.000000       8414.000000
ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.txt:observation  6690.000000       8414.000000

grep observa ttxsec/datacard_v37_test172_bunchFULLFIT1_mu.txt ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.txt
ttxsec/datacard_v37_test172_bunchFULLFIT1_mu.txt:observation  9831.000000       12855.000000
ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.txt:observation  9831.000000       12855.000000

absolutely the same data

shapes qcd       el_sel_lj     fit-stuff/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1.root  el_sel_lj/qcd_other/NOMINAL/el_sel_lj_qcd_NOMINAL_Mt_lep_met_c                 el_sel_lj/qcd_other/$SYSTEMATIC/el_sel_lj_qcd_$SYSTEMATIC_Mt_lep_met_c
shapes qcd       el_sel_ljout  fit-stuff/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1.root  el_sel_ljout/qcd_other/NOMINAL/el_sel_ljout_qcd_NOMINAL_Mt_lep_met_c           el_sel_ljout/qcd_other/$SYSTEMATIC/el_sel_ljout_qcd_$SYSTEMATIC_Mt_lep_met_c

shapes qcd       mu_sel_lj     fit-stuff/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1.root  mu_sel_lj/qcd_other/NOMINAL/mu_sel_lj_qcd_NOMINAL_Mt_lep_met_c                 mu_sel_lj/qcd_other/$SYSTEMATIC/mu_sel_lj_qcd_$SYSTEMATIC_Mt_lep_met_c
shapes qcd       mu_sel_ljout  fit-stuff/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1.root  mu_sel_ljout/qcd_other/NOMINAL/mu_sel_ljout_qcd_NOMINAL_Mt_lep_met_c           mu_sel_ljout/qcd_other/$SYSTEMATIC/mu_sel_ljout_qcd_$SYSTEMATIC_Mt_lep_met_c

python numbers_for_datacard.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1.root  -d Mt_lep_met_c -c mu_sel_lj,mu_sel_ljout --data-nick data_other
python numbers_for_datacard.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1.root  -d Mt_lep_met_c -c el_sel_lj,el_sel_ljout --data-nick data_other



make workspace datacard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el
make workspace datacard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu

RuntimeError: Mismatch in normalizations for bin el_sel_lj, process wjets_taul: rate 14.372000, shape 33.656336

-- amcatnlo wjets have been hadded!

rehadd distrs and histosel
-- el passes
   mu passes

make both mucard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu elcard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el bothcard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both
make workspace datacard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both


combineCards.py mu=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.txt el=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.txt > ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.txt
../scripts/text2workspace.py ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.txt


test172:

make nll  workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1_mu.root   nn=v37_test172_mu_test1
make nll  workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1_el.root   nn=v37_test172_el_test1
make nll  workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1_both.root nn=v37_test172_both_test1

 POI: r= 0.91961 -> [0.5,1.5]
 POI: r= 0.933139 -> [0.5,1.5]
 POI: r= 0.929332 -> [0.5,1.5]

-- yeap...

combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1_mu.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1_el.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1_both.root

Best fit r: 0.919563  -0.0714482/+0.0783514  (68% CL)
Best fit r: 0.933132  -0.0797546/+0.0884625  (68% CL)
Best fit r: 0.928627  -0.0698014/+0.0753698  (68% CL)

combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root

Best fit r: 0.926233  -0.0709715/+0.0789828  (68% CL)
Best fit r: 0.948986  -0.0799883/+0.0876587  (68% CL)
Best fit r: 0.94178   -0.0684634/+0.0753474  (68% CL)

el_sig  = 0.946
mu_sig  = 0.945
bt_sig  = 0.961

test15:

combine -M FitDiagnostics  ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.root
combine -M FitDiagnostics  ttxsec/datacard_v37_test15_bunchFULLFIT1_el.root

Best fit r: 0.9463  -0.0732235/+0.0785937  (68% CL)
Best fit r: 0.946198  -0.082118/+0.0889266  (68% CL)

combine -M FitDiagnostics  ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.root --freezeParameters TOPPT,lumi_13TeV --setParameters TOPPT=1.0
combine -M FitDiagnostics  ttxsec/datacard_v37_test15_bunchFULLFIT1_el.root --freezeParameters TOPPT,lumi_13TeV --setParameters TOPPT=1.0

Best fit r: 0.963472  -0.0677546/+0.0735895  (68% CL)
Best fit r: 0.952573  -0.074693/+0.0805046  (68% CL)

combine -M FitDiagnostics  ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root
combine -M FitDiagnostics  ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root --freezeParameters TOPPT,lumi_13TeV --setParameters TOPPT=1.0

Best fit r: 0.9463  -0.0732235/+0.0785937  (68% CL)
Best fit r: 0.963472  -0.0677546/+0.0735895  (68% CL)



## post-fit TOPPT for test15 and test172 BIN

make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.root   nn=v37_test15_mu    &
make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_el.root   nn=v37_test15_el    &
make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_both.root nn=v37_test15_both  &

make impacts  workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   nn=v37_test172_BIN1_mu    &
make impacts  workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   nn=v37_test172_BIN1_el    &
make impacts  workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root nn=v37_test172_BIN1_both  &





## goodness of fit for test15 and test172 BIN

test15:

combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.root   --algo=KS         -s 123                    --freezeParameters lumi_13TeV -n v37_test15_mu_STATTEST_KS
combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_el.root   --algo=KS         -s 123                    --freezeParameters lumi_13TeV -n v37_test15_el_STATTEST_KS
combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_both.root --algo=KS         -s 123                    --freezeParameters lumi_13TeV -n v37_test15_both_STATTEST_KS

Kolmogorov-Smirnov test statistic: 0.00514565
Kolmogorov-Smirnov test statistic: 0.0146337
Kolmogorov-Smirnov test statistic: 0.0201683

combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.root   --algo=KS         -s 321                    --freezeParameters lumi_13TeV -n v37_test15_mu_STATTEST_KS
combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_el.root   --algo=KS         -s 321                    --freezeParameters lumi_13TeV -n v37_test15_el_STATTEST_KS
combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_both.root --algo=KS         -s 321                    --freezeParameters lumi_13TeV -n v37_test15_both_STATTEST_KS

Kolmogorov-Smirnov test statistic: 0.00514565
Kolmogorov-Smirnov test statistic: 0.0146337
Kolmogorov-Smirnov test statistic: 0.0201683


combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.root   --algo=KS -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test15_mu_STATTEST_KS100    &
combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_el.root   --algo=KS -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test15_el_STATTEST_KS100    &
combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_both.root --algo=KS -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test15_both_STATTEST_KS100  &

combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.root   --algo=KS -t 1000  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test15_mu_STATTEST_KS1000    &
combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_el.root   --algo=KS -t 1000  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test15_el_STATTEST_KS1000    &
combine -M GoodnessOfFit ttxsec/datacard_v37_test15_bunchFULLFIT1_both.root --algo=KS -t 1000  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test15_both_STATTEST_KS1000  &

root -l higgsCombinev37_test15_mu_STATTEST_KS100.GoodnessOfFit.mH120.123.root
root -l higgsCombinev37_test15_el_STATTEST_KS100.GoodnessOfFit.mH120.123.root
root -l higgsCombinev37_test15_both_STATTEST_KS100.GoodnessOfFit.mH120.123.root

limit->Draw("limit")
h = (TH1D*) limit->GetHistogram()
h_c = (TH1D*) h->GetCumulative(kFALSE)
h_c->Draw()

h_c->GetBinContent(h_c->FindBin(0.00514565))
h_c->GetBinContent(h_c->FindBin(0.0146337))
h_c->GetBinContent(h_c->FindBin(0.0201683))

90.000
15.000
40.000



test172 BIN1:

combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   --algo=KS         -s 123                    --freezeParameters lumi_13TeV -n v37_test172_BIN1_el_KS
combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   --algo=KS         -s 123                    --freezeParameters lumi_13TeV -n v37_test172_BIN1_mu_KS
combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root --algo=KS         -s 123                    --freezeParameters lumi_13TeV -n v37_test172_BIN1_both_KS

Kolmogorov-Smirnov test statistic: 0.0195574
Kolmogorov-Smirnov test statistic: 0.00641978
Kolmogorov-Smirnov test statistic: 0.0268595

combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   --algo=KS         -s 333                    --freezeParameters lumi_13TeV -n v37_test172_BIN1_el_KS
combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   --algo=KS         -s 333                    --freezeParameters lumi_13TeV -n v37_test172_BIN1_mu_KS

Kolmogorov-Smirnov test statistic: 0.0195574
Kolmogorov-Smirnov test statistic: 0.00641978



combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   --algo=KS -t 1000  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test172_BIN1_el_KS1000
combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   --algo=KS -t 1000  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test172_BIN1_mu_KS1000
combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root --algo=KS -t 1000  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test172_BIN1_both_KS1000

some BUSERRORs

combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   --algo=KS -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test172_BIN1_el_KS100   &
combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   --algo=KS -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test172_BIN1_mu_KS100   &
combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root --algo=KS -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test172_BIN1_both_KS100 &

root -l higgsCombinev37_test172_BIN1_el_KS100.GoodnessOfFit.mH120.123.root
root -l higgsCombinev37_test172_BIN1_mu_KS100.GoodnessOfFit.mH120.123.root
root -l higgsCombinev37_test172_BIN1_both_KS100.GoodnessOfFit.mH120.123.root

limit->Draw("limit")
h = (TH1D*) limit->GetHistogram()
h_c = (TH1D*) h->GetCumulative(kFALSE)
h_c->Draw()

h_c->GetBinContent(h_c->FindBin(0.0195574))
h_c->GetBinContent(h_c->FindBin(0.00641978))
h_c->GetBinContent(h_c->FindBin(0.0268595))


el

Done in 0.08 min (cpu), 0.08 min (real)
mean   expected limit: r < 0.0111579 +/- 0.000264503 @ 95%CL (100 toyMC)
median expected limit: r < 0.0111493 @ 95%CL (100 toyMC)
   68% expected band : 0.00875235 < r < 0.0138181
   95% expected band : 0.00660687 < r < 0.0182304

-- damn! el is farther than 2 sigma

mu

Done in 0.08 min (cpu), 0.08 min (real)
mean   expected limit: r < 0.00962801 +/- 0.000267278 @ 95%CL (100 toyMC)
median expected limit: r < 0.00938763 @ 95%CL (100 toyMC)
   68% expected band : 0.00715396 < r < 0.0116733
   95% expected band : 0.00529382 < r < 0.0167107

-- at 2 sigma

both

Done in 0.20 min (cpu), 0.20 min (real)
mean   expected limit: r < 0.0227406 +/- 0.000453121 @ 95%CL (100 toyMC)
median expected limit: r < 0.022558 @ 95%CL (100 toyMC)
   68% expected band : 0.0187187 < r < 0.0276366
   95% expected band : 0.0148432 < r < 0.0353402

-- 1 sigma



combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root --algo=KS         -s 123                    --freezeParameters lumi_13TeV -n v37_test172_BIN1_both_KS
combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root --algo=KS -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test172_BIN1_both_KS100

other algo

combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   --algo=AD         -s 123                    --freezeParameters lumi_13TeV -n v37_test172_BIN1_el_AD
combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   --algo=AD -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test172_BIN1_el_AD100

Anderson-Darling test statistic: 2.68542

Done in 0.09 min (cpu), 0.09 min (real)
mean   expected limit: r < 0.816318 +/- 0.0385012 @ 95%CL (100 toyMC)
median expected limit: r < 0.718764 @ 95%CL (100 toyMC)
   68% expected band : 0.478446 < r < 1.21722
   95% expected band : 0.2746 < r < 1.8618

-- out of 2 sigma


combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   --algo=AD         -s 123                    --freezeParameters lumi_13TeV -n v37_test172_BIN1_mu_AD
combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   --algo=AD -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test172_BIN1_mu_AD100

Anderson-Darling test statistic: 0.432311

Done in 0.09 min (cpu), 0.09 min (real)
mean   expected limit: r < 0.901912 +/- 0.0503163 @ 95%CL (100 toyMC)
median expected limit: r < 0.795609 @ 95%CL (100 toyMC)
   68% expected band : 0.441055 < r < 1.33012
   95% expected band : 0.344676 < r < 2.69014

-- close within 2sigma

the same as KS....


combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root   --algo=AD         -s 123                    --freezeParameters lumi_13TeV -n v37_test172_BIN1_both_AD
combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root   --algo=AD -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test172_BIN1_both_AD100

Anderson-Darling test statistic: 3.24128

Done in 0.19 min (cpu), 0.19 min (real)
mean   expected limit: r < 2.12534 +/- 0.0837728 @ 95%CL (100 toyMC)
median expected limit: r < 1.81222 @ 95%CL (100 toyMC)
   68% expected band : 1.43246 < r < 2.85778
   95% expected band : 1.15873 < r < 4.61773






combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   --algo=saturated         -s 123                    --freezeParameters lumi_13TeV -n v37_test172_BIN1_el_saturated
combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   --algo=saturated -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test172_BIN1_el_saturated100

Best fit test statistic: 34.9071

-- toys look the same

Done in 0.06 min (cpu), 0.06 min (real)
mean   expected limit: r < 25.4939 +/- 0.740418 @ 95%CL (100 toyMC)
median expected limit: r < 24.4254 @ 95%CL (100 toyMC)
   68% expected band : 18.5552 < r < 33.5456
   95% expected band : 14.2932 < r < 48.9625

-- will be close within 2sigma

combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   --algo=saturated         -s 123                    --freezeParameters lumi_13TeV -n v37_test172_BIN1_mu_saturated
combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   --algo=saturated -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test172_BIN1_mu_saturated100

Best fit test statistic: 21.3244

-- toys are spot on around it???

Done in 0.06 min (cpu), 0.06 min (real)
mean   expected limit: r < 26.1437 +/- 0.649555 @ 95%CL (100 toyMC)
median expected limit: r < 25.0417 @ 95%CL (100 toyMC)
   68% expected band : 20.1302 < r < 33.0529
   95% expected band : 14.9615 < r < 38.5587

combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root   --algo=saturated         -s 123                    --freezeParameters lumi_13TeV -n v37_test172_BIN1_both_saturated
combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root   --algo=saturated -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test172_BIN1_both_saturated100

Best fit test statistic: 59.2
Done in 0.13 min (cpu), 0.13 min (real)
mean   expected limit: r < 54.236 +/- 1.14671 @ 95%CL (100 toyMC)
median expected limit: r < 51.7415 @ 95%CL (100 toyMC)
   68% expected band : 45.1974 < r < 63.3964
   95% expected band : 38.3026 < r < 88.0115





saturated must use --toysFreq (recommendations of StatComm)

combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   --toysFreq --algo=saturated         -s 123                    --freezeParameters lumi_13TeV -n v37_test172_BIN1_el_Freq_saturated
combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   --toysFreq --algo=saturated -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test172_BIN1_el_Freq_saturated100

Best fit test statistic: 34.9071

Done in 0.05 min (cpu), 0.05 min (real)
mean   expected limit: r < 25.8833 +/- 0.790352 @ 95%CL (100 toyMC)
median expected limit: r < 25.0568 @ 95%CL (100 toyMC)
   68% expected band : 17.9224 < r < 34.3626
   95% expected band : 12.2765 < r < 45.1597


combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   --toysFreq --algo=saturated         -s 123                    --freezeParameters lumi_13TeV -n v37_test172_BIN1_mu_Freq_saturated
combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   --toysFreq --algo=saturated -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test172_BIN1_mu_Freq_saturated100

Best fit test statistic: 21.3244

Done in 0.05 min (cpu), 0.05 min (real)
mean   expected limit: r < 24.6986 +/- 0.610106 @ 95%CL (100 toyMC)
median expected limit: r < 24.2238 @ 95%CL (100 toyMC)
   68% expected band : 18.7463 < r < 30.2441
   95% expected band : 14.7774 < r < 41.4129


combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root --toysFreq --algo=saturated         -s 123                    --freezeParameters lumi_13TeV -n v37_test172_BIN1_both_Freq_saturated
combine -M GoodnessOfFit ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root --toysFreq --algo=saturated -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n v37_test172_BIN1_both_Freq_saturated100

Best fit test statistic: 59.2

Done in 0.13 min (cpu), 0.13 min (real)
mean   expected limit: r < 54.2977 +/- 1.00356 @ 95%CL (100 toyMC)
median expected limit: r < 53.6138 @ 95%CL (100 toyMC)
   68% expected band : 45.1399 < r < 64.2596
   95% expected band : 36.1924 < r < 79.3447


root -l higgsCombinev37_test172_BIN1_el_Freq_saturated100.GoodnessOfFit.mH120.123.root
root -l higgsCombinev37_test172_BIN1_mu_Freq_saturated100.GoodnessOfFit.mH120.123.root
root -l higgsCombinev37_test172_BIN1_both_Freq_saturated100.GoodnessOfFit.mH120.123.root

limit->Draw("limit")
h = (TH1D*) limit->GetHistogram()
h_c = (TH1D*) h->GetCumulative(kFALSE)
h_c->Draw()

h_c->GetBinContent(h_c->FindBin(34.9071))
h_c->GetBinContent(h_c->FindBin(21.3244))
h_c->GetBinContent(h_c->FindBin(59.2))

14
72
33

saturated is perfect, probably KS will move with 1000 toys


## fit results test172 BIN1

make full_card_fit  workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   nn=v37_test172BIN1_mu_test1    &
make full_card_fit  workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   nn=v37_test172BIN1_el_test1    &
make full_card_fit  workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root nn=v37_test172BIN1_both_test1  &


full_card_fit: workspace=ttxsec/latest_datacard_el.root
full_card_fit: nn=el
full_card_fit: freeze=--freezeParameters lumi_13TeV
full_card_fit: points=100
full_card_fit: min=0.5
full_card_fit: max=1.5

workspace=ttxsec/latest_datacard_el.root nn=el freeze=--freezeParameters lumi_13TeV points=100 min=0.5 max=1.5

make nll             workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   nn=v37_test172BIN1_el_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make impacts         workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   nn=v37_test172BIN1_el_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make impacts_toys    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   nn=v37_test172BIN1_el_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make fit_unc         workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   nn=v37_test172BIN1_el_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make fit_unc_toys    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   nn=v37_test172BIN1_el_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make pre_pulls       workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   nn=v37_test172BIN1_el_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make pre_pulls_short workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   nn=v37_test172BIN1_el_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &

make nll             workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   nn=v37_test172BIN1_mu_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make impacts         workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   nn=v37_test172BIN1_mu_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make impacts_toys    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   nn=v37_test172BIN1_mu_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make fit_unc         workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   nn=v37_test172BIN1_mu_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make fit_unc_toys    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   nn=v37_test172BIN1_mu_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make pre_pulls       workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   nn=v37_test172BIN1_mu_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make pre_pulls_short workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   nn=v37_test172BIN1_mu_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &

make nll             workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root   nn=v37_test172BIN1_both_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make impacts         workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root   nn=v37_test172BIN1_both_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make impacts_toys    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root   nn=v37_test172BIN1_both_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make fit_unc         workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root   nn=v37_test172BIN1_both_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make fit_unc_toys    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root   nn=v37_test172BIN1_both_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make pre_pulls       workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root   nn=v37_test172BIN1_both_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make pre_pulls_short workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root   nn=v37_test172BIN1_both_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &

essential now:

make impacts         workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   nn=v37_test172BIN1_el_test1   freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make impacts         workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   nn=v37_test172BIN1_mu_test1   freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make impacts         workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root nn=v37_test172BIN1_both_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &

make fit_unc         workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   nn=v37_test172BIN1_el_test1   freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make fit_unc         workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   nn=v37_test172BIN1_mu_test1   freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make fit_unc         workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root nn=v37_test172BIN1_both_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &

make fit_unc_toys    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root   nn=v37_test172BIN1_el_test1   freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make fit_unc_toys    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root   nn=v37_test172BIN1_mu_test1   freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make fit_unc_toys    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root nn=v37_test172BIN1_both_test1 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &

python new_impact_table.py --merge-pdf  v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_el_test1.json v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_mu_test1.json v37_test172BIN1_test1/latest_impacts_v37_test172BIN1_both_test1.json  > v37_test172BIN1_test1/impacts_table

make postfit_distrs fit_tag=v37_test172_bunchFULLFIT1BIN1 bins=0,16,32,44,54,64,74,81,88,95,104,116,132,160,250

make --dry-run postfit_distrs fit_tag=v37_test172_bunchFULLFIT1BIN1 bins=0,16,32,44,54,64,74,81,88,95,104,116,132,160,250

combine -M FitDiagnostics ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root  --saveShapes --saveWithUncertainties --name v37_test172_bunchFULLFIT1BIN1_MuShapes --freezeParameters lumi_13TeV
combine -M FitDiagnostics ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root  --saveShapes --saveWithUncertainties --name v37_test172_bunchFULLFIT1BIN1_ElShapes --freezeParameters lumi_13TeV
# plot results
python ttxsec/fit-stuff/stack_postfit.py --custom-bins "0,16,32,44,54,64,74,81,88,95,104,116,132,160,250" fitDiagnosticsv37_test172_bunchFULLFIT1BIN1_MuShapes.root mu_sel_lj    --mu --ratio --ratio-range 0.55 --y-max 150 --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]"  --out-type pdf
python ttxsec/fit-stuff/stack_postfit.py --custom-bins "0,16,32,44,54,64,74,81,88,95,104,116,132,160,250" fitDiagnosticsv37_test172_bunchFULLFIT1BIN1_MuShapes.root mu_sel_ljout --mu --ratio --ratio-range 0.55 --y-max 150 --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]"  --out-type pdf

python ttxsec/fit-stuff/stack_postfit.py --custom-bins "0,16,32,44,54,64,74,81,88,95,104,116,132,160,250" fitDiagnosticsv37_test172_bunchFULLFIT1BIN1_ElShapes.root el_sel_lj    --lumi 35.8 --ratio --ratio-range 0.55 --y-max 100 --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"  --out-type pdf
python ttxsec/fit-stuff/stack_postfit.py --custom-bins "0,16,32,44,54,64,74,81,88,95,104,116,132,160,250" fitDiagnosticsv37_test172_bunchFULLFIT1BIN1_ElShapes.root el_sel_ljout --lumi 35.8 --ratio --ratio-range 0.55 --y-max 100 --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"  --out-type pdf



$\tauh$ jet identification  &  4.7 &  4.5 &  4.5 \\
$\tauh$ misidentification background  &  2.4 &  2.3 &  2.3 \\
           PU uncertainty  &  2.6 &  2.2 &  2.3 \\
     b-tagging efficiency  &  1.1 &  1.2 &  0.9 \\
                      TES  &  0.7 &  0.8 &  0.8 \\
       muon ID efficiency  &      &  0.6 &  0.6 \\
         DY normalization  &  0.4 &  0.4 &  0.6 \\
 Single Top normalization  &  0.6 &  0.5 &  0.5 \\
     W+jets normalization  &  0.1 &  0.4 &  0.5 \\
        QCD normalization  &  0.1 &  0.5 &  0.4 \\
                      JES  &  0.1 &  0.2 &  0.4 \\
  muon trigger efficiency  &      &  0.3 &  0.2 \\
electron trigger efficiency &  2.3 &     &  0.2 \\
   electron ID efficiency  &  1.8 &      &  0.2 \\
                      JER  &  0.6 &  0.3 &  0.1 \\
   dibosons normalization  & <0.1 & <0.1 & <0.1 \\

        top quark $p_{T}$  &  2.7 &  2.3 &  2.4 \\
          b fragmentation  &  2.3 &  2.0 &  2.2 \\
  final   state radiation  &  1.7 &  1.9 &  1.7 \\
  initial state radiation  &  1.7 &  1.6 &  1.5 \\
                ME scales  &  1.1 &  1.2 &  1.1 \\
semi-leptonic b-hadron BRs  &  0.8 &  0.6 &  0.7 \\
underlying event (Pythia tune)  &  0.5 &  0.5 &  0.6 \\
   ME-PS matching (hdamp)  &  0.4 &  0.4 &  0.5 \\
                      PDF  &  1.5 &  1.5 &  1.6 \\
            MC statistics  &  2.0 &  1.6 &  1.6 \\

&  4.7 &  4.5 &  4.5 \\
&  2.4 &  2.3 &  2.3 \\
&  2.6 &  2.2 &  2.3 \\
&  1.1 &  1.2 &  0.9 \\
&  0.7 &  0.8 &  0.8 \\
&      &  0.6 &  0.6 \\
&  0.4 &  0.4 &  0.6 \\
&  0.6 &  0.5 &  0.5 \\
&  0.1 &  0.4 &  0.5 \\
&  0.1 &  0.5 &  0.4 \\
&  0.1 &  0.2 &  0.4 \\
&      &  0.3 &  0.2 \\
&  2.3 &      &  0.2 \\
&  1.8 &      &  0.2 \\
&  0.6 &  0.3 &  0.1 \\
& <0.1 & <0.1 & <0.1 \\

&  2.7 &  2.3 &  2.4 \\
&  2.3 &  2.0 &  2.2 \\
&  1.7 &  1.9 &  1.7 \\
&  1.7 &  1.6 &  1.5 \\
&  1.1 &  1.2 &  1.1 \\
&  0.8 &  0.6 &  0.7 \\
&  0.5 &  0.5 &  0.6 \\
&  0.4 &  0.4 &  0.5 \\
&  1.5 &  1.5 &  1.6 \\
&  2.0 &  1.6 &  1.6 \\

\begin{table}[htp]
\begin{center}
%\caption{Systematic uncertainties in the signal strength determined from the simultaneous fit in the $e\tauh$ and $\mu\tauh$ final states, and their combination.}
\label{tab:impacts_both}
\begin{tabular}{lccc|ccc}
%\toprule
\hline
\multicolumn{1}{c}{Source} & \multicolumn{3}{c}{Uncertainty [\%] v11} \\ \cline{2-4}
                           &  $e\tau$        & $\mu\tau$    &     Combined \\ \hline

\multicolumn{1}{l}\textit{Experimental uncertainties:}&      \\
$\tau$ jet identification               &  4.7 &  4.5 &  4.4 \\
$\tau$ misidentification background     &  2.3 &  2.2 &  2.3 \\
pileup (PU)                             &  2.6 &  2.3 &  2.3 \\
jet energy scale                        &  1.1 &  0.5 &  1.1 \\
\cPqb tagging efficiency                &  1.1 &  1.1 &  0.9 \\
W+jets normalization                    &  0.2 &  0.7 &  0.7 \\
$\tauh$ energy scale                    &  0.9 &  0.6 &  0.7 \\
muon reconstruction                     &   -  &  0.6 &  0.6 \\
Drell-Yan normalization                 &  0.4 &  0.5 &  0.6 \\
single top normalization                &  0.6 &  0.5 &  0.5 \\
muon trigger efficiency                 &   -  &  0.3 &  0.3 \\
electron trigger efficiency             &  2.3 &   -  &  0.2 \\
electron reconstruction                 &  1.8 &   -  &  0.2 \\
jet energy resolution                   &  0.3 &  0.6 &  0.1 \\
multijet normalization                  &  0.9 &  0.5 &  0.1 \\
dibosons normalization                  &  $<0.1$ &  $<0.1$ &  $<0.1$ \\

\hline
\multicolumn{1}{l}\textit{Theoretical uncertainties:} & \\
top quark \pt modeling                      &  2.9 &  2.2 &  2.3 \\
b quark fragmentation                       &  2.3 &  2.0 &  2.3 \\
initial state radiation (ISR)               &  1.6 &  1.5 &  1.6 \\
final state radiation (FSR)                 &  1.3 &  2.0 &  1.6 \\
                ME scales                   &  1.1 &  1.2 &  1.1 \\
semi-leptonic b-hadron branching fraction   &  0.7 &  0.6 &  0.6 \\
underlying event                            &  0.4 &  0.5 &  0.5 \\
ME-PS matching ($h_{\rm damp}$)             &  0.5 &  0.4 &  0.4 \\
PDF                                         &  1.4 &  1.5 &  1.5 \\
MC statistics                               &  2.1 &  1.8 &  1.7 \\
 \hline
\end{tabular}
\end{center}
\end{table}


cp ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.txt ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp.txt
cp ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.txt ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp.txt

vim -p ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp.txt ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp.txt

make workspace datacard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp
make workspace datacard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp

make impacts    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp.root   nn=v37_test172BIN1_el_test2   freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make impacts    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp.root   nn=v37_test172BIN1_mu_test2   freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &

FINISH:

make both mucard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp elcard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp bothcard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_exp
make workspace datacard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_exp

make impacts    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_exp.root   nn=v37_test172BIN1_both_test2   freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5



scans

el_sig  = 0.949
el_sys  = 0.082
el_stat = 0.014

mu_sig  = 0.926
mu_sys  = 0.072
mu_stat = 0.011

bt_sig  = 0.942
bt_sys  = 0.070
bt_stat = 0.009

[133.162 1.96445 11.5061 3.50795]
[135.249 1.60663 10.5161 3.65143]
[134.922 1.28906 10.026 3.58073]

789.34024 [11.0508 70.1052 19.7335]
770.2097600000001 [8.47231 61.7438 19.2552]
783.51792 [7.05166 61.1027 19.5879]



### fit with 2% tau ID uncertainty

cp ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.txt ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp3.txt
cp ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.txt ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp3.txt

vim -p ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp3.txt ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp3.txt

make workspace datacard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp3
make workspace datacard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp3

make both mucard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp3 elcard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp3 bothcard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_exp3
make workspace datacard=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_exp3

combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp3.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp3.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_exp3.root

Best fit r: 0.94626  -0.0695961/+0.0758241  (68% CL)
Best fit r: 0.925835  -0.0605657/+0.0673238  (68% CL)
Best fit r: 0.942713  -0.0579149/+0.0633641  (68% CL)

-- in impacts
0.946 +- 0.0691
0.926 +- 0.0601
0.943 +- 0.0571

-- not 0.0579149??

VS

0.951 +- 0.0794
0.925 +- 0.0705
0.943 +- 0.0679

exactly -1% in each channel...

1) compare to Atlas' paper
0.070 ± 0.003 ± 0.005
sqrt(0.003**2 + 0.005**2)
0.0058309518948453
0.0058309518948453 / 0.07
0.08329931278350428

2) compare impacts tables to see how each systematic changes, what happens?


_exp:

combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_exp.root

Best fit r: 0.951386  -0.0786579/+0.0864248  (68% CL)
Best fit r: 0.924956  -0.0699168/+0.0772119  (68% CL)
Best fit r: 0.943077  -0.0667657/+0.0745019  (68% CL)

no tag:

combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both.root

Best fit r: 0.948986  -0.0799883/+0.0876587  (68% CL)
Best fit r: 0.926233  -0.0709715/+0.0789828  (68% CL)
Best fit r: 0.94178  -0.0684634/+0.0753474  (68% CL)

-- somehow, only 1 percent reduction?
  
check the impacts:

make impacts    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_el_exp3.root   nn=v37_test172BIN1_el_test3   freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make impacts    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_mu_exp3.root   nn=v37_test172BIN1_mu_test3   freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &
make impacts    workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1BIN1_both_exp3.root nn=v37_test172BIN1_both_test3 freeze="--freezeParameters lumi_13TeV" points=100 min=0.5 max=1.5    &







## plots with latest format for the presentation and AN

mv plots/v37_test13_bunchCONTROLS1/ plots/v37_test13_bunchCONTROLS1_old_formats/ 

make plot_sel_1  nt=v37 proc=test13 distrs=bunchCONTROLS1 lumi=35800 chan_tag=mu datafile=SingleMuon     title_lep=muon      output_type=pdf  &
make plot_sel_1  nt=v37 proc=test13 distrs=bunchCONTROLS1 lumi=35800 chan_tag=el datafile=SingleElectron title_lep=electron  output_type=pdf  &

-- I think some style guide said presentations should be done with png?

make plot_sel_1  nt=v37 proc=test13 distrs=bunchCONTROLS1 lumi=35800 chan_tag=mu datafile=SingleMuon     title_lep=muon        &
make plot_sel_1  nt=v37 proc=test13 distrs=bunchCONTROLS1 lumi=35800 chan_tag=el datafile=SingleElectron title_lep=electron    &

make --dry-run plot_sel_1  nt=v37 proc=test13 distrs=bunchCONTROLS1 lumi=35800 chan_tag=mu datafile=SingleMuon     title_lep=muon

python stack_plot.py distrs/v37_test13_bunchCONTROLS1_mc.root distrs/v37_test13_bunchCONTROLS1/SingleMuon.root --output-type png -o plots/v37_test13_bunchCONTROLS1/ --data-nick data_other --overwrite -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d lep_pt  --wjet 1.4 --qcd 1.05 --ratio-range 0.5 --bin-norm --title "" --title-x "muon p_{T} [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/v37_test13_bunchCONTROLS1_mc.root distrs/v37_test13_bunchCONTROLS1/SingleMuon.root --output-type png -o plots/v37_test13_bunchCONTROLS1/ --data-nick data_other --overwrite -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d lep_eta --wjet 1.4 --qcd 1.05 --ratio-range 0.5            --title "" --title-x "muon #eta" --title-y "Events"
python stack_plot.py distrs/v37_test13_bunchCONTROLS1_mc.root distrs/v37_test13_bunchCONTROLS1/SingleMuon.root --output-type png -o plots/v37_test13_bunchCONTROLS1/ --data-nick data_other --overwrite -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d tau_pt  --wjet 1.4 --qcd 1.05 --ratio-range 0.5 --bin-norm --title "" --title-x "#tau p_{T} [GeV]"  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/v37_test13_bunchCONTROLS1_mc.root distrs/v37_test13_bunchCONTROLS1/SingleMuon.root --output-type png -o plots/v37_test13_bunchCONTROLS1/ --data-nick data_other --overwrite -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d tau_eta --wjet 1.4 --qcd 1.05 --ratio-range 0.5            --title "" --title-x "#tau #eta"         --title-y "Events"
python stack_plot.py distrs/v37_test13_bunchCONTROLS1_mc.root distrs/v37_test13_bunchCONTROLS1/SingleMuon.root --output-type png -o plots/v37_test13_bunchCONTROLS1/ --data-nick data_other --overwrite -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d bjet_pt  --wjet 1.4 --qcd 1.05 --ratio-range 0.5 --bin-norm --title "" --title-x "leading b-tagged jet p_{T} [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/v37_test13_bunchCONTROLS1_mc.root distrs/v37_test13_bunchCONTROLS1/SingleMuon.root --output-type png -o plots/v37_test13_bunchCONTROLS1/ --data-nick data_other --overwrite -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d bjet_eta --wjet 1.4 --qcd 1.05 --ratio-range 0.5            --title "" --title-x "leading b-tagged jet #eta"        --title-y "Events"
python stack_plot.py distrs/v37_test13_bunchCONTROLS1_mc.root distrs/v37_test13_bunchCONTROLS1/SingleMuon.root --output-type png -o plots/v37_test13_bunchCONTROLS1/ --data-nick data_other --overwrite -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d Mt_lep_met_f --wjet 1.4 --qcd 1.05 --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(muon, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/v37_test13_bunchCONTROLS1_mc.root distrs/v37_test13_bunchCONTROLS1/SingleMuon.root --output-type png -o plots/v37_test13_bunchCONTROLS1/ --data-nick data_other --overwrite -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d met_c      --wjet 1.4 --qcd 1.05 --ratio-range 0.5 --bin-norm --title "" --title-x "MET [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02

N jets                                                                                                    --output-type png

python stack_plot.py distrs/v37_test13_bunchCONTROLS1_mc.root distrs/v37_test13_bunchCONTROLS1/SingleMuon.root --output-type png -o plots/v37_test13_bunchCONTROLS1/ --data-nick data_other --overwrite -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d nbjets     --wjet 1.4 --qcd 1.05 --ratio-range 0.5 --bin-norm --title "" --title-x "number of b-tagged jets"         --title-y "Events"
python stack_plot.py distrs/v37_test13_bunchCONTROLS1_mc.root distrs/v37_test13_bunchCONTROLS1/SingleMuon.root --output-type png -o plots/v37_test13_bunchCONTROLS1/ --data-nick data_other --overwrite -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d nrjets     --wjet 1.4 --qcd 1.05 --ratio-range 0.5 --bin-norm --title "" --title-x "number of not b-tagged jets"     --title-y "Events"


-- no bjet pt, no nbjets and nrjets....

make -k plot_sel_1  nt=v37 proc=test13 distrs=bunchCONTROLS1 lumi=35800 chan_tag=mu datafile=SingleMuon     title_lep=muon        &
make -k plot_sel_1  nt=v37 proc=test13 distrs=bunchCONTROLS1 lumi=35800 chan_tag=el datafile=SingleElectron title_lep=electron    &

rename_for_update_main_sel

make -k rename_for_update_el_sel  nt=v37 proc=test13 distrs=bunchCONTROLS1
make -k rename_for_update_mu_sel  nt=v37 proc=test13 distrs=bunchCONTROLS1

python stack_plot.py distrs/v37_test13_bunchCONTROLS1_mc.root distrs/v37_test13_bunchCONTROLS1/SingleMuon.root --output-type png -o plots/v37_test13_bunchCONTROLS1/ --data-nick data_other --overwrite -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d Mt_lep_met_c --wjet 1.4 --qcd 1.05 --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(muon, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02



## NLL scans

python ttxsec/fit-stuff/plot_uncertainty_scans.py v37_test15_exp_unc --xsec-scale 831.76 --title-x "cross section [pb]"

does not really work:
python ttxsec/fit-stuff/plot_uncertainty_scans_mixed.py v37_test15_exp_unc --xsec-scale 831.76 --title-x "cross section [pb]"

rename higgsCombinev37_test172BIN1_el_test1 higgsCombineel_v37_test172BIN1_test1 v37_test172BIN1_test1/higgsCombinev37_test172BIN1_el_test1*
rename higgsCombinev37_test172BIN1_mu_test1 higgsCombinemu_v37_test172BIN1_test1 v37_test172BIN1_test1/higgsCombinev37_test172BIN1_mu_test1*
rename higgsCombinev37_test172BIN1_both_test1 higgsCombineboth_v37_test172BIN1_test1 v37_test172BIN1_test1/higgsCombinev37_test172BIN1_both_test1*

ls v37_test172BIN1_test1/higgsCombineel_v37_test172BIN1_test1*
ls v37_test172BIN1_test1/higgsCombinemu_v37_test172BIN1_test1*
ls v37_test172BIN1_test1/higgsCombineboth_v37_test172BIN1_test1*

mv v37_test172BIN1_test1/higgsCombineel_v37_test172BIN1_test1*   ./
mv v37_test172BIN1_test1/higgsCombinemu_v37_test172BIN1_test1*   ./
mv v37_test172BIN1_test1/higgsCombineboth_v37_test172BIN1_test1* ./

python ttxsec/fit-stuff/plot_uncertainty_scans.py v37_test172BIN1_test1 --xsec-scale 831.76 --title-x "cross section [pb]"

cp higgsCombinemu_v37_test172BIN1_test1FullUncertaintyWLumi.MultiDimFit.mH120.root   higgsCombinemu_v37_test172BIN1_test1FullUncertainty.MultiDimFit.mH120.root
cp higgsCombineel_v37_test172BIN1_test1FullUncertaintyWLumi.MultiDimFit.mH120.root   higgsCombineel_v37_test172BIN1_test1FullUncertainty.MultiDimFit.mH120.root
cp higgsCombineboth_v37_test172BIN1_test1FullUncertaintyWLumi.MultiDimFit.mH120.root higgsCombineboth_v37_test172BIN1_test1FullUncertainty.MultiDimFit.mH120.root

cp higgsCombinemu_v37_test172BIN1_test1_ExpectedFullUncertaintyWLumi.MultiDimFit.mH120.root   higgsCombinemu_v37_test172BIN1_test1_ExpectedFullUncertainty.MultiDimFit.mH120.root
cp higgsCombineel_v37_test172BIN1_test1_ExpectedFullUncertaintyWLumi.MultiDimFit.mH120.root   higgsCombineel_v37_test172BIN1_test1_ExpectedFullUncertainty.MultiDimFit.mH120.root
cp higgsCombineboth_v37_test172BIN1_test1_ExpectedFullUncertaintyWLumi.MultiDimFit.mH120.root higgsCombineboth_v37_test172BIN1_test1_ExpectedFullUncertainty.MultiDimFit.mH120.root

python ttxsec/fit-stuff/plot_uncertainty_scans_mixed.py v37_test172BIN1_test1 --xsec-scale 831.76 --title-x "cross section [pb]"
cp uncertainty_scans_el_mu_both.png uncertainty_scans_el_mu_both_10NLL_oldcolors.png

python ttxsec/fit-stuff/plot_uncertainty_scans_mixed.py v37_test172BIN1_test1 --xsec-scale 831.76 --title-x "cross section [pb]" --nll-limit 5.
cp uncertainty_scans_el_mu_both.png uncertainty_scans_el_mu_both_5NLL_oldcolors.png

once again, no el and mu
python ttxsec/fit-stuff/plot_uncertainty_scans_mixed.py --only-both v37_test172BIN1_test1 --xsec-scale 831.76 --title-x "cross section [pb]" --nll-limit 5. --output-type pdf
cp uncertainty_scans_both.png uncertainty_scans_both_5NLL_oldcolors.png
cp uncertainty_scans_both.pdf uncertainty_scans_both_5NLL_oldcolors.pdf

scp "olek@ui-cms.ncg.ingrid.pt:/lstore/cms/olek/CMSSW_8_1_0/src/HiggsAnalysis/CombinedLimit/fitting/uncertainty_scans_el_mu_both*.png" plots/






# corrected the fixed lepjet propagation test172

make run_std_histos out=histosels/v37_test172_bunchFULLFIT1/ wjets_norm=1.4 lumi_mu=35800 lumi_el=35800 mc=distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root data_mu=distrs/v37_test172_bunchFULLFIT1/SingleMuon.root data_el=distrs/v37_test172_bunchFULLFIT1/SingleElectron.root

something crashes with "file exists, nothing is written"?

make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root data=distrs/v37_test172_bunchFULLFIT1/SingleMuon.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_lj"    & \
make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root data=distrs/v37_test172_bunchFULLFIT1/SingleElectron.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_lj"    & \
make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root data=distrs/v37_test172_bunchFULLFIT1/SingleMuon.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_ljout" & \
make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root data=distrs/v37_test172_bunchFULLFIT1/SingleElectron.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_ljout" & \

make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root data=distrs/v37_test172_bunchFULLFIT1/SingleMuon.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_lj    systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_lj" & \
make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root data=distrs/v37_test172_bunchFULLFIT1/SingleElectron.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_lj    systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_lj" & \
make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root data=distrs/v37_test172_bunchFULLFIT1/SingleMuon.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_ljout systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_ljout" & \
make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root data=distrs/v37_test172_bunchFULLFIT1/SingleElectron.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_ljout systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_ljout" & \

make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root data=distrs/v37_test172_bunchFULLFIT1/SingleMuon.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel & \
make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root data=distrs/v37_test172_bunchFULLFIT1/SingleElectron.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel & 



hadd histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1.root histosels/v37_test172_bunchFULLFIT1/*

cp ttxsec/datacard_v37_test17_bunchFULLFIT1_el.txt ttxsec/datacard_v37_test172_bunchFULLFIT1_el.txt
cp ttxsec/datacard_v37_test17_bunchFULLFIT1_mu.txt ttxsec/datacard_v37_test172_bunchFULLFIT1_mu.txt

vim -p ttxsec/datacard_v37_test172_bunchFULLFIT1_el.txt ttxsec/datacard_v37_test172_bunchFULLFIT1_mu.txt

shapes qcd       el_sel_lj     fit-stuff/datafile_HISTOSEL_v37_test172_bunchFULLFIT1.root  el_sel_lj/qcd_other/NOMINAL/el_sel_lj_qcd_NOMINAL_Mt_lep_met_c                 el_sel_lj/qcd_other/$SYSTEMATIC/el_sel_lj_qcd_$SYSTEMATIC_Mt_lep_met_c
shapes qcd       el_sel_ljout  fit-stuff/datafile_HISTOSEL_v37_test172_bunchFULLFIT1.root  el_sel_ljout/qcd_other/NOMINAL/el_sel_ljout_qcd_NOMINAL_Mt_lep_met_c           el_sel_ljout/qcd_other/$SYSTEMATIC/el_sel_ljout_qcd_$SYSTEMATIC_Mt_lep_met_c

shapes qcd       mu_sel_lj     fit-stuff/datafile_HISTOSEL_v37_test172_bunchFULLFIT1.root  mu_sel_lj/qcd_other/NOMINAL/mu_sel_lj_qcd_NOMINAL_Mt_lep_met_c                 mu_sel_lj/qcd_other/$SYSTEMATIC/mu_sel_lj_qcd_$SYSTEMATIC_Mt_lep_met_c
shapes qcd       mu_sel_ljout  fit-stuff/datafile_HISTOSEL_v37_test172_bunchFULLFIT1.root  mu_sel_ljout/qcd_other/NOMINAL/mu_sel_ljout_qcd_NOMINAL_Mt_lep_met_c           mu_sel_ljout/qcd_other/$SYSTEMATIC/mu_sel_ljout_qcd_$SYSTEMATIC_Mt_lep_met_c


make workspace datacard=ttxsec/datacard_v37_test172_bunchFULLFIT1_el
make workspace datacard=ttxsec/datacard_v37_test172_bunchFULLFIT1_mu
make both mucard=ttxsec/datacard_v37_test172_bunchFULLFIT1_mu elcard=ttxsec/datacard_v37_test172_bunchFULLFIT1_el bothcard=ttxsec/datacard_v37_test172_bunchFULLFIT1_both
make workspace datacard=ttxsec/datacard_v37_test172_bunchFULLFIT1_both

combineCards.py mu=ttxsec/datacard_v37_test172_bunchFULLFIT1_mu.txt el=ttxsec/datacard_v37_test172_bunchFULLFIT1_el.txt > ttxsec/datacard_v37_test172_bunchFULLFIT1_both.txt
../scripts/text2workspace.py ttxsec/datacard_v37_test172_bunchFULLFIT1_el.txt


make nll  workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1_mu.root   nn=v37_test172_mu_test1
make nll  workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1_el.root   nn=v37_test172_el_test1
make nll  workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1_both.root nn=v37_test172_both_test1

 POI: r= 0.91961 -> [0.5,1.5]
 POI: r= 0.933139 -> [0.5,1.5]
 POI: r= 0.929332 -> [0.5,1.5]

-- yeap...

combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1_mu.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1_el.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1_both.root

Best fit r: 0.919563  -0.0714482/+0.0783514  (68% CL)
Best fit r: 0.933132  -0.0797546/+0.0884625  (68% CL)
Best fit r: 0.928627  -0.0698014/+0.0753698  (68% CL)

make impacts  workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1_mu.root   nn=v37_test172_mu_test1    &
make impacts  workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1_el.root   nn=v37_test172_el_test1    &
make impacts  workspace=ttxsec/datacard_v37_test172_bunchFULLFIT1_both.root nn=v37_test172_both_test1  &



## test172 plots

python stack_plot.py distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root distrs/v37_test172_bunchFULLFIT1/SingleElectron.root  -o plots/v37_test172_bunchFULLFIT1_mc1/ --data-nick data_other --overwrite -p -r -c el_sel_lj    -x el_selVloose_lj    --qcd 1.05 --wjets 1.4 -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,250.  --lumi 35800 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend
python stack_plot.py distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root distrs/v37_test172_bunchFULLFIT1/SingleMuon.root      -o plots/v37_test172_bunchFULLFIT1_mc1/ --data-nick data_other --overwrite -p -r -c mu_sel_lj    -x mu_selVloose_lj    --qcd 1.05 --wjets 1.4 -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,375.  --lumi 35800 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend

python stack_plot.py distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root distrs/v37_test172_bunchFULLFIT1/SingleElectron.root  -o plots/v37_test172_bunchFULLFIT1_mc1/ --data-nick data_other --overwrite -p -r -c el_sel_ljout -x el_selVloose_ljout --qcd 1.05 --wjets 1.4 -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,250.  --lumi 35800 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend
python stack_plot.py distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root distrs/v37_test172_bunchFULLFIT1/SingleMuon.root      -o plots/v37_test172_bunchFULLFIT1_mc1/ --data-nick data_other --overwrite -p -r -c mu_sel_ljout -x mu_selVloose_ljout --qcd 1.05 --wjets 1.4 -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,375.  --lumi 35800 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend

evince plots/v37_test172_bunchFULLFIT1_mc1/*pdf

-- not clear whether the outlier bin will change anything


plot tau eta:

python stack_plot.py distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root distrs/v37_test172_bunchFULLFIT1/SingleElectron.root  -o plots/v37_test172_bunchFULLFIT1_mc1/ --data-nick data_other --overwrite -p -r -c el_sel -x el_selVloose --qcd 1.05 --wjets 1.4 -d tau_eta --ratio-range 0.5 --title "" --title-x "tau eta" --title-y "Events" --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,250.  --lumi 35800 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend
python stack_plot.py distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root distrs/v37_test172_bunchFULLFIT1/SingleMuon.root      -o plots/v37_test172_bunchFULLFIT1_mc1/ --data-nick data_other --overwrite -p -r -c mu_sel -x mu_selVloose --qcd 1.05 --wjets 1.4 -d tau_eta --ratio-range 0.5 --title "" --title-x "tau eta" --title-y "Events" --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,375.  --lumi 35800 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend

-- yeah, there is no tau eta here, its a FIT bunch of distributions

python stack_plot.py distrs/v37_test13_bunchCONTROLS1_mc_1.root distrs/v37_test13_bunchCONTROLS1/SingleMuon.root     -p -r -o plots/v37_test13_bunchCONTROLS1/ -c mu_sel --data-nick data_other -d tau_eta --lumi 35800 --overwrite --wjets 1.4 --qcd 1.05
python stack_plot.py distrs/v37_test13_bunchCONTROLS1_mc_1.root distrs/v37_test13_bunchCONTROLS1/SingleElectron.root -p -r -o plots/v37_test13_bunchCONTROLS1/ -c el_sel --data-nick data_other -d tau_eta --lumi 35800 --overwrite --wjets 1.4 --qcd 1.05

eog plots/v37_test13_bunchCONTROLS1//distrs,v37_test13_bunchCONTROLS1_mc_1_distrs,v37_test13_bunchCONTROLS1,SingleMuon_tau_eta_mu_sel_NOMINAL_stack_ratio_dataqcd.png plots/v37_test13_bunchCONTROLS1//distrs,v37_test13_bunchCONTROLS1_mc_1_distrs,v37_test13_bunchCONTROLS1,SingleElectron_tau_eta_el_sel_NOMINAL_stack_ratio_dataqcd.png

-- 2.3-2.4 part is negligible





## test172 fit with overflow bin

make --dry-run run_histos mc=distrs/v37_test15_bunchFULLFIT1_mc_1.root data=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root options="--draw-overflows 5" lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_withOVERFLOWS/ wjets_norm=1.4 chan=mu_sel_lj    systematics="bSFUp" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_lj"    & \

make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root data=distrs/v37_test172_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1_2/ wjets_norm=1.4 chan=mu_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_lj"    options="--draw-overflows 5"  & \
make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root data=distrs/v37_test172_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1_2/ wjets_norm=1.4 chan=el_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_lj"    options="--draw-overflows 5"  & \
make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root data=distrs/v37_test172_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1_2/ wjets_norm=1.4 chan=mu_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_ljout" options="--draw-overflows 5"  & \
make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root data=distrs/v37_test172_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1_2/ wjets_norm=1.4 chan=el_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_ljout" options="--draw-overflows 5"  & \

make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root data=distrs/v37_test172_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1_2/ wjets_norm=1.4 chan=mu_sel_lj        systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_lj"    options="--draw-overflows 5" & \
make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root data=distrs/v37_test172_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1_2/ wjets_norm=1.4 chan=el_sel_lj        systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_lj"    options="--draw-overflows 5" & \
make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root data=distrs/v37_test172_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1_2/ wjets_norm=1.4 chan=mu_sel_ljout     systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_ljout" options="--draw-overflows 5" & \
make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root data=distrs/v37_test172_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1_2/ wjets_norm=1.4 chan=el_sel_ljout     systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_ljout" options="--draw-overflows 5" & \

make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root data=distrs/v37_test172_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1_2/ wjets_norm=1.4 chan=mu_sel options="--draw-overflows 5" & \
make run_histos mc=distrs/distrs_v37_test172_bunchFULLFIT1_mc1.root data=distrs/v37_test172_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test172_bunchFULLFIT1_2/ wjets_norm=1.4 chan=el_sel options="--draw-overflows 5" & 


hadd histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1_2.root histosels/v37_test172_bunchFULLFIT1_2/*

python numbers_for_datacard.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1_2.root  -d Mt_lep_met_c -c mu_sel_lj,mu_sel_ljout --data-nick data_other

bin           mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                
process       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                       
rate          5021.803                 3609.855                 204.639                  272.438                  85.248                   23.261                   226.264                  34.568                   229.161                  0.000                    15.283                   228.671                  8.529                    190.632                  177.058                  
mu_sel_lj/data_other/NOMINAL/mu_sel_lj_data_other_NOMINAL_Mt_lep_met_c
obs 9932.000000
mc sum = 10327.409868
INFO:root:mu_sel_ljout
bin           mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             
process       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                       
rate          8019.434                 2507.608                 142.576                  458.961                  174.253                  56.038                   289.802                  52.688                   462.391                  0.000                    29.676                   364.950                  23.466                   390.389                  177.152                  
mu_sel_ljout/data_other/NOMINAL/mu_sel_ljout_data_other_NOMINAL_Mt_lep_met_c
obs 13094.000000
mc sum = 13149.383742


python numbers_for_datacard.py histosels/datafile_HISTOSEL_v37_test172_bunchFULLFIT1_2.root  -d Mt_lep_met_c -c el_sel_lj,el_sel_ljout --data-nick data_other

bin           el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                
process       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_eltau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        12                       13                       14                       15                       16                       17                       18                       
rate          3355.384                 2404.346                 129.315                  186.019                  64.980                   15.755                   167.842                  24.050                   173.624                  0.981                    14.372                   176.844                  29.613                   118.405                  107.531                  
el_sel_lj/data_other/NOMINAL/el_sel_lj_data_other_NOMINAL_Mt_lep_met_c
obs 6787.000000
mc sum = 6969.060320
INFO:root:el_sel_ljout
bin           el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             
process       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_eltau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        12                       13                       14                       15                       16                       17                       18                       
rate          5410.106                 1653.031                 87.149                   313.907                  115.389                  36.563                   186.752                  32.833                   323.447                  1.928                    12.859                   223.866                  81.758                   228.733                  341.542                  
el_sel_ljout/data_other/NOMINAL/el_sel_ljout_data_other_NOMINAL_Mt_lep_met_c
obs 8633.000000
mc sum = 9049.862830




cp ttxsec/datacard_v37_test172_bunchFULLFIT1_el.txt ttxsec/datacard_v37_test172_bunchFULLFIT1_2_el.txt
cp ttxsec/datacard_v37_test172_bunchFULLFIT1_mu.txt ttxsec/datacard_v37_test172_bunchFULLFIT1_2_mu.txt

vim -p ttxsec/datacard_v37_test172_bunchFULLFIT1_2_el.txt ttxsec/datacard_v37_test172_bunchFULLFIT1_2_mu.txt

make workspace datacard=ttxsec/datacard_v37_test172_bunchFULLFIT1_2_el
make workspace datacard=ttxsec/datacard_v37_test172_bunchFULLFIT1_2_mu
make both mucard=ttxsec/datacard_v37_test172_bunchFULLFIT1_2_mu elcard=ttxsec/datacard_v37_test172_bunchFULLFIT1_2_el bothcard=ttxsec/datacard_v37_test172_bunchFULLFIT1_2_both
make workspace datacard=ttxsec/datacard_v37_test172_bunchFULLFIT1_2_both

combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1_2_el.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1_2_mu.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test172_bunchFULLFIT1_2_both.root

Best fit r: 0.927935  -0.0776618/+0.0886654  (68% CL)
Best fit r: 0.918919  -0.0703641/+0.0785824  (68% CL)
Best fit r: 0.923146  -0.0688665/+0.0741745  (68% CL)

damn



# test173 (all jets are propagated to met)

mkdir histosels/v37_test173_bunchFULLFIT1_1/

make run_histos mc=distrs/distrs_v37_test173_bunchFULLFIT1_mc3.root data=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test173_bunchFULLFIT1_1/ wjets_norm=1.4 chan=mu_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_lj"    options="--draw-overflows 5"  & \
make run_histos mc=distrs/distrs_v37_test173_bunchFULLFIT1_mc3.root data=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test173_bunchFULLFIT1_1/ wjets_norm=1.4 chan=el_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_lj"    options="--draw-overflows 5"  & \
make run_histos mc=distrs/distrs_v37_test173_bunchFULLFIT1_mc3.root data=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test173_bunchFULLFIT1_1/ wjets_norm=1.4 chan=mu_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_ljout" options="--draw-overflows 5"  & \
make run_histos mc=distrs/distrs_v37_test173_bunchFULLFIT1_mc3.root data=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test173_bunchFULLFIT1_1/ wjets_norm=1.4 chan=el_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_ljout" options="--draw-overflows 5"  & \

make run_histos mc=distrs/distrs_v37_test173_bunchFULLFIT1_mc3.root data=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test173_bunchFULLFIT1_1/ wjets_norm=1.4 chan=mu_sel_lj        systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_lj"    options="--draw-overflows 5" & \
make run_histos mc=distrs/distrs_v37_test173_bunchFULLFIT1_mc3.root data=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test173_bunchFULLFIT1_1/ wjets_norm=1.4 chan=el_sel_lj        systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_lj"    options="--draw-overflows 5" & \
make run_histos mc=distrs/distrs_v37_test173_bunchFULLFIT1_mc3.root data=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test173_bunchFULLFIT1_1/ wjets_norm=1.4 chan=mu_sel_ljout     systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_ljout" options="--draw-overflows 5" & \
make run_histos mc=distrs/distrs_v37_test173_bunchFULLFIT1_mc3.root data=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test173_bunchFULLFIT1_1/ wjets_norm=1.4 chan=el_sel_ljout     systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_ljout" options="--draw-overflows 5" & \

make run_histos mc=distrs/distrs_v37_test173_bunchFULLFIT1_mc3.root data=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test173_bunchFULLFIT1_1/ wjets_norm=1.4 chan=mu_sel options="--draw-overflows 5" & \
make run_histos mc=distrs/distrs_v37_test173_bunchFULLFIT1_mc3.root data=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test173_bunchFULLFIT1_1/ wjets_norm=1.4 chan=el_sel options="--draw-overflows 5" & 

datafile_v37_test173_bunchFULLFIT1_1_HISTOSELS.root

python numbers_for_datacard.py histosels/datafile_v37_test173_bunchFULLFIT1_1_HISTOSELS.root  -d Mt_lep_met_c -c mu_sel_lj,mu_sel_ljout --data-nick data_other

bin           mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                
process       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                       
rate          5021.631                 3609.587                 204.639                  272.438                  85.639                   19.814                   226.264                  34.568                   229.457                  0.000                    14.417                   210.746                  8.529                    182.381                  191.965                  
mu_sel_lj/data_other/NOMINAL/mu_sel_lj_data_other_NOMINAL_Mt_lep_met_c
obs 9932.000000
mc sum = 10312.074358
INFO:root:mu_sel_ljout
bin           mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             
process       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                       
rate          8022.158                 2507.487                 142.576                  458.961                  173.945                  48.551                   289.888                  52.688                   462.813                  0.000                    28.105                   328.486                  20.106                   363.954                  204.176                  
mu_sel_ljout/data_other/NOMINAL/mu_sel_ljout_data_other_NOMINAL_Mt_lep_met_c
obs 13094.000000
mc sum = 13103.893821


python numbers_for_datacard.py histosels/datafile_v37_test173_bunchFULLFIT1_1_HISTOSELS.root  -d Mt_lep_met_c -c el_sel_lj,el_sel_ljout --data-nick data_other

bin           el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                
process       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_eltau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        12                       13                       14                       15                       16                       17                       18                       
rate          3355.162                 2404.101                 129.315                  186.019                  65.278                   12.559                   167.903                  24.050                   173.703                  0.981                    14.372                   163.975                  26.450                   103.876                  116.763                  
el_sel_lj/data_other/NOMINAL/el_sel_lj_data_other_NOMINAL_Mt_lep_met_c
obs 6787.000000
mc sum = 6944.506603
INFO:root:el_sel_ljout
bin           el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             
process       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_eltau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        12                       13                       14                       15                       16                       17                       18                       
rate          5410.930                 1652.989                 87.149                   313.832                  115.389                  32.073                   186.752                  32.833                   323.063                  1.928                    12.859                   202.614                  78.079                   213.738                  360.008                  
el_sel_ljout/data_other/NOMINAL/el_sel_ljout_data_other_NOMINAL_Mt_lep_met_c
obs 8633.000000
mc sum = 9024.235665

obs 9932.000000
obs 13094.000000

obs 6787.000000
obs 8633.000000


bin          mu_sel_lj         mu_sel_ljout
observation  9831.000000       12855.000000

bin          el_sel_lj         el_sel_ljout
observation  6690.000000       8414.000000

-- these are numbers of 172 data. They are smaller than test15! Did all data jobs return?
   CHECK!!!!!! what's with data integral in test172???



cp ttxsec/datacard_v37_test172_bunchFULLFIT1_el.txt ttxsec/datacard_v37_test173_bunchFULLFIT1_1_el.txt
cp ttxsec/datacard_v37_test172_bunchFULLFIT1_mu.txt ttxsec/datacard_v37_test173_bunchFULLFIT1_1_mu.txt

vim -p ttxsec/datacard_v37_test173_bunchFULLFIT1_1_el.txt ttxsec/datacard_v37_test173_bunchFULLFIT1_1_mu.txt

make workspace datacard=ttxsec/datacard_v37_test173_bunchFULLFIT1_1_el
make workspace datacard=ttxsec/datacard_v37_test173_bunchFULLFIT1_1_mu
make both mucard=ttxsec/datacard_v37_test173_bunchFULLFIT1_1_mu elcard=ttxsec/datacard_v37_test173_bunchFULLFIT1_1_el bothcard=ttxsec/datacard_v37_test173_bunchFULLFIT1_1_both
make workspace datacard=ttxsec/datacard_v37_test173_bunchFULLFIT1_1_both

combine -M FitDiagnostics   ttxsec/datacard_v37_test173_bunchFULLFIT1_1_el.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test173_bunchFULLFIT1_1_mu.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test173_bunchFULLFIT1_1_both.root

Best fit r: 0.932459  -0.0813973/+0.0867149  (68% CL)
Best fit r: 0.943797  -0.0730817/+0.0799847  (68% CL)
Best fit r: 0.950343  -0.0693685/+0.0760036  (68% CL)

-- same crap as in test15, slight fluctuations


combine -M FitDiagnostics   ttxsec/datacard_v37_test173_bunchFULLFIT1_1_mu.root --freezeParameters TOPPT --setParameters TOPPT=1.0

Best fit r: 0.956954  -0.0708596/+0.0771303  (68% CL)







## check data integrals in test15, test172, test173

head ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.txt

head ttxsec/datacard_v37_test172_bunchFULLFIT1_mu.txt
head ttxsec/datacard_v37_test172_bunchFULLFIT1_2_mu.txt

head ttxsec/datacard_v37_test173_bunchFULLFIT1_1_el.txt

root -l fit-stuff/v37_test15_bunchFULLFIT1_HISTOSEL.root

root -l fit-stuff/datafile_HISTOSEL_v37_test172_bunchFULLFIT1.root
root -l fit-stuff/datafile_HISTOSEL_v37_test172_bunchFULLFIT1_2.root

root -l fit-stuff/datafile_v37_test173_bunchFULLFIT1_1_HISTOSELS.root

mu_sel_lj    ->Get("data_other/NOMINAL/mu_sel_lj_data_other_NOMINAL_Mt_lep_met_c")->Print()
mu_sel_ljout ->Get("data_other/NOMINAL/mu_sel_ljout_data_other_NOMINAL_Mt_lep_met_c")->Print()
el_sel_lj    ->Get("data_other/NOMINAL/el_sel_lj_data_other_NOMINAL_Mt_lep_met_c")->Print()
el_sel_ljout ->Get("data_other/NOMINAL/el_sel_ljout_data_other_NOMINAL_Mt_lep_met_c")->Print()

TH1.Print Name  = mu_sel_lj_data_other_NOMINAL_Mt_lep_met_c,    Entries= 9932, Total sum= 9831
TH1.Print Name  = mu_sel_ljout_data_other_NOMINAL_Mt_lep_met_c, Entries= 13094, Total sum= 12855
TH1.Print Name  = el_sel_lj_data_other_NOMINAL_Mt_lep_met_c,    Entries= 6787, Total sum= 6690
TH1.Print Name  = el_sel_ljout_data_other_NOMINAL_Mt_lep_met_c, Entries= 8633, Total sum= 8414



TH1.Print Name  = mu_sel_lj_data_other_NOMINAL_Mt_lep_met_c,    Entries= 9932, Total sum= 9843
TH1.Print Name  = mu_sel_ljout_data_other_NOMINAL_Mt_lep_met_c, Entries= 13094, Total sum= 12891
TH1.Print Name  = el_sel_lj_data_other_NOMINAL_Mt_lep_met_c,    Entries= 6787, Total sum= 6702
TH1.Print Name  = el_sel_ljout_data_other_NOMINAL_Mt_lep_met_c, Entries= 8633, Total sum= 8436

TH1.Print Name  = mu_sel_lj_data_other_NOMINAL_Mt_lep_met_c,    Entries= 9843, Total sum= 9932
TH1.Print Name  = mu_sel_ljout_data_other_NOMINAL_Mt_lep_met_c, Entries= 12891, Total sum= 13094
TH1.Print Name  = el_sel_lj_data_other_NOMINAL_Mt_lep_met_c,    Entries= 6702, Total sum= 6787
TH1.Print Name  = el_sel_ljout_data_other_NOMINAL_Mt_lep_met_c, Entries= 8436, Total sum= 8633


TH1.Print Name  = mu_sel_lj_data_other_NOMINAL_Mt_lep_met_c,    Entries= 9831, Total sum= 9932
TH1.Print Name  = mu_sel_ljout_data_other_NOMINAL_Mt_lep_met_c, Entries= 12855, Total sum= 13094
TH1.Print Name  = el_sel_lj_data_other_NOMINAL_Mt_lep_met_c,    Entries= 6690, Total sum= 6787
TH1.Print Name  = el_sel_ljout_data_other_NOMINAL_Mt_lep_met_c, Entries= 8414, Total sum= 8633


bin          mu_sel_lj         mu_sel_ljout
observation  9831.000000       12855.000000

bin          el_sel_lj         el_sel_ljout
observation  6690.000000       8414.000000


-- the last two contain overflows!




# test174 tau jet JER is not propagated to MET, otherwise identical to test173 = test15 with all jets propagated to MET

compare shapes

python get_shapes.py --x-title "M_{T}(l, MET) [GeV]" --y-title "" --norm-binwidth --formula "test15_mutau:test174_mutau" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "test15_mutau":mc_norm/v37_test15_bunchFULLFIT1/MC2016_Summer16_TTJets_powheg.root:mu_sel_lj/tt_mutau/NOMINAL "test174_mutau":mc_norm/v37_test174_bunchFULLFIT1/MC2016_Summer16_TTJets_powheg.root:mu_sel_lj/tt_mutau/NOMINAL 
python get_shapes.py --x-title "M_{T}(l, MET) [GeV]" --y-title "" --norm-binwidth --formula "test15_lj:test174_lj" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "test15_lj":mc_norm/v37_test15_bunchFULLFIT1/MC2016_Summer16_TTJets_powheg.root:mu_sel_lj/tt_lj/NOMINAL "test174_lj":mc_norm/v37_test174_bunchFULLFIT1/MC2016_Summer16_TTJets_powheg.root:mu_sel_lj/tt_lj/NOMINAL 

python get_shapes.py --x-title "M_{T}(l, MET) [GeV]" --y-title "" --no-norm --norm-formulas --formula "test15_mutau/test174_mutau" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "test15_mutau":mc_norm/v37_test15_bunchFULLFIT1/MC2016_Summer16_TTJets_powheg.root:mu_sel_lj/tt_mutau/NOMINAL "test174_mutau":mc_norm/v37_test174_bunchFULLFIT1/MC2016_Summer16_TTJets_powheg.root:mu_sel_lj/tt_mutau/NOMINAL 

-- random deviations within 0.01

python get_shapes.py --x-title "M_{T}(l, MET) [GeV]" --y-title "" --no-norm --norm-formulas --formula "test15_lj/test174_lj" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "test15_lj":mc_norm/v37_test15_bunchFULLFIT1/MC2016_Summer16_TTJets_powheg.root:mu_sel_lj/tt_lj/NOMINAL "test174_lj":mc_norm/v37_test174_bunchFULLFIT1/MC2016_Summer16_TTJets_powheg.root:mu_sel_lj/tt_lj/NOMINAL 

-- same

eog ./compare_mu_selVloose_tt_lj_NOMINAL_Mt_lep_met_c_test174_mutau,test15_mutau_formula_nonorm.png ./compare_mu_selVloose_tt_lj_NOMINAL_Mt_lep_met_c_test15_lj,test174_lj_formula_nonorm.png

weird, it seems 1% is too much for stat deviations?



## histosels and fit

distrs_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1.root

mkdir histosels/v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1/

make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1.root data=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_lj"    options="--draw-overflows 5"  & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1.root data=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_lj"    options="--draw-overflows 5"  & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1.root data=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_ljout" options="--draw-overflows 5"  & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1.root data=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_ljout" options="--draw-overflows 5"  & \

make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1.root data=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_lj        systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_lj"    options="--draw-overflows 5" & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1.root data=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_lj        systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_lj"    options="--draw-overflows 5" & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1.root data=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_ljout     systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_ljout" options="--draw-overflows 5" & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1.root data=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_ljout     systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_ljout" options="--draw-overflows 5" & \

make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1.root data=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel options="--draw-overflows 5" & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1.root data=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel options="--draw-overflows 5" & 

without overflows:

make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1.root data=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_lj"      & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1.root data=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_lj"      & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1.root data=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_ljout"   & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1.root data=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_ljout"   & \

make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1.root data=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_lj        systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_lj"     & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1.root data=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_lj        systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_lj"     & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1.root data=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_ljout     systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_ljout"  & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1.root data=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_ljout     systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_ljout"  & \


hadd datafile_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_HISTOSEL.root v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1/*

cp ttxsec/datacard_v37_test15_bunchFULLFIT1_el_exp.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_el.txt
cp ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_mu.txt

vim -p ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_el.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_mu.txt

shapes qcd       el_sel_lj     fit-stuff/datafile_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_HISTOSEL.root  el_sel_lj/qcd_other/NOMINAL/el_sel_lj_qcd_NOMINAL_Mt_lep_met_c                 el_sel_lj/qcd_other/$SYSTEMATIC/el_sel_lj_qcd_$SYSTEMATIC_Mt_lep_met_c
shapes qcd       el_sel_ljout  fit-stuff/datafile_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_HISTOSEL.root  el_sel_ljout/qcd_other/NOMINAL/el_sel_ljout_qcd_NOMINAL_Mt_lep_met_c           el_sel_ljout/qcd_other/$SYSTEMATIC/el_sel_ljout_qcd_$SYSTEMATIC_Mt_lep_met_c

python numbers_for_datacard.py histosels/datafile_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_HISTOSEL.root  -d Mt_lep_met_c -c el_sel_lj,el_sel_ljout --data-nick data_other
python numbers_for_datacard.py histosels/datafile_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_HISTOSEL.root  -d Mt_lep_met_c -c mu_sel_lj,mu_sel_ljout --data-nick data_other

bin           el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                
process       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_eltau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        12                       13                       14                       15                       16                       17                       18                       
rate          3256.908                 2402.510                 129.463                  184.964                  63.698                   15.511                   167.755                  23.972                   164.546                  0.981                    14.372                   176.465                  29.613                   118.405                  106.489                  
el_sel_lj/data_other/NOMINAL/el_sel_lj_data_other_NOMINAL_Mt_lep_met_c
obs 6690.000000
mc sum = 6855.653553
INFO:root:el_sel_ljout
bin           el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             
process       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_eltau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        12                       13                       14                       15                       16                       17                       18                       
rate          5194.214                 1655.026                 87.311                   308.340                  113.105                  35.835                   186.706                  32.157                   303.162                  1.928                    12.859                   223.866                  79.913                   228.733                  338.432                  
el_sel_ljout/data_other/NOMINAL/el_sel_ljout_data_other_NOMINAL_Mt_lep_met_c
obs 8414.000000
mc sum = 8801.586957


bin           mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                
process       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                       
rate          4903.004                 3606.886                 204.417                  271.802                  83.768                   23.138                   226.131                  34.416                   220.923                  0.000                    15.283                   228.671                  8.529                    190.632                  176.186                  
mu_sel_lj/data_other/NOMINAL/mu_sel_lj_data_other_NOMINAL_Mt_lep_met_c
obs 9831.000000
mc sum = 10193.786692
INFO:root:mu_sel_ljout
bin           mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             
process       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                       
rate          7759.163                 2514.329                 143.036                  455.072                  172.448                  54.709                   289.521                  52.217                   440.611                  0.000                    29.676                   364.950                  23.466                   390.389                  166.116                  
mu_sel_ljout/data_other/NOMINAL/mu_sel_ljout_data_other_NOMINAL_Mt_lep_met_c
obs 12855.000000
mc sum = 12855.704582



make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_el
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_mu
make both mucard=ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_mu elcard=ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_el bothcard=ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_both
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_both

combine -M FitDiagnostics   ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_el.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_mu.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_both.root

Best fit r: 0.951809  -0.0815818/+0.0884361  (68% CL)
Best fit r: 0.940956  -0.0726787/+0.0790259  (68% CL)
Best fit r: 0.952406  -0.0693208/+0.0753598  (68% CL)

damn this!

combine -M FitDiagnostics   ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_mu.root --freezeParameters TOPPT --setParameters TOPPT=1

Best fit r: 0.956336  -0.0711743/+0.0775188  (68% CL)

yeap

mix with test172?

Best fit r: 0.919563  -0.0714482/+0.0783514  (68% CL)
Best fit r: 0.933132  -0.0797546/+0.0884625  (68% CL)
Best fit r: 0.928627  -0.0698014/+0.0753698  (68% CL)

-- here on_uncor_lepjets was used and the taujet JER was propagated...
   just repeate uncor lepjets with no JER from tau
   or
   uncor taujets with them?

the JER from tau just gives random fluctuation of 1%
uncorrecting is probably better






# test175

hadd distrs_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1.root v37_test15_bunchFULLFIT1/MC*root v37_test175_bunchFULLFIT1/ttbar/MC2016_Summer16_TTJets_powheg.root

mkdir histosels/v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1/

make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1.root data=distrs/v37_test175_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_lj"      & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1.root data=distrs/v37_test175_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_lj"      & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1.root data=distrs/v37_test175_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_ljout"   & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1.root data=distrs/v37_test175_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_ljout"   & \

make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1.root data=distrs/v37_test175_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_lj        systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_lj"     & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1.root data=distrs/v37_test175_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_lj        systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_lj"     & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1.root data=distrs/v37_test175_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_ljout     systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_ljout"  & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1.root data=distrs/v37_test175_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_ljout     systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_ljout"  & \


hadd datafile_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1_HISTOSEL.root v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1/*

cp ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_el.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1_el.txt
cp ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_mu.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1_mu.txt


vim -p ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1_el.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1_mu.txt

data changed significantly! (no overflows? test174 also did not have them)


python numbers_for_datacard.py histosels/datafile_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1_HISTOSEL.root  -d Mt_lep_met_c -c el_sel_lj,el_sel_ljout --data-nick data_other
python numbers_for_datacard.py histosels/datafile_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1_HISTOSEL.root  -d Mt_lep_met_c -c mu_sel_lj,mu_sel_ljout --data-nick data_other

bin           el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                
process       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_eltau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        12                       13                       14                       15                       16                       17                       18                       
rate          3266.333                 2402.517                 129.463                  184.964                  63.698                   15.511                   167.755                  23.972                   164.546                  0.981                    14.372                   176.465                  29.613                   118.405                  86.450                   

obs 6552.000000
mc sum = 6845.046683

bin           el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             
process       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_eltau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        12                       13                       14                       15                       16                       17                       18                       
rate          5208.330                 1655.452                 87.311                   308.340                  113.105                  35.835                   186.706                  32.157                   303.162                  1.928                    12.859                   223.866                  79.913                   228.733                  309.600                  

obs 8263.000000
mc sum = 8787.296649

-- way to large difference!

test15
obs 6690.000000
mc sum = 6861.168569
obs 8414.000000
mc sum = 8827.654918

test172
obs 6787.000000
mc sum = 6944.506603
obs 8633.000000
mc sum = 9024.235665

test174
obs 6690.000000
mc sum = 6855.653553
obs 8414.000000
mc sum = 8801.586957

-- test174 contains the test15 data, only TT was re-processed

root -l v37_test15_bunchFULLFIT1/SingleElectron.root
root -l v37_test172_bunchFULLFIT1/SingleElectron.root
root -l v37_test174_bunchFULLFIT1/SingleElectron.root
root -l v37_test175_bunchFULLFIT1/SingleElectron.root

el_sel_lj->Get("data_other/NOMINAL/el_sel_lj_data_other_NOMINAL_Mt_lep_met_c")->Print()
TH1.Print Name  = el_sel_lj_data_other_NOMINAL_Mt_lep_met_c, Entries= 6787, Total sum= 6690
TH1.Print Name  = el_sel_lj_data_other_NOMINAL_Mt_lep_met_c, Entries= 6787, Total sum= 6702
-- test174 must have test15 data without overflows
TH1.Print Name  = el_sel_lj_data_other_NOMINAL_Mt_lep_met_c, Entries= 6635, Total sum= 6552

-- aha!


ls -lh lstore_outdirs/v37/test175/Data13TeV_SingleElectron2016*/ | sort | less

first suspects:

-rw-r-----+ 1 olek t3cms 1.5M Jun 25 15:58 Data13TeV_SingleElectron2016C_03Feb2017_v1_36.root

-rw-r-----+ 1 olek t3cms 28M Jun 25 16:46 Data13TeV_SingleElectron2016E_03Feb2017_v1_48.root
-rw-r-----+ 1 olek t3cms 3.5M Jun 25 17:07 Data13TeV_SingleElectron2016F_03Feb2017_v1_37.root
-rw-r-----+ 1 olek t3cms 4.9M Jun 25 15:54 Data13TeV_SingleElectron2016H_03Feb2017_ver2_1.root
-rw-r-----+ 1 olek t3cms 5.7M Jun 25 15:53 Data13TeV_SingleElectron2016D_03Feb2017_v1_59.root
-rw-r-----+ 1 olek t3cms 7.4M Jun 25 15:55 Data13TeV_SingleElectron2016B_03Feb2017_ver2_106.root
-rw-r-----+ 1 olek t3cms 8.0M Jun 25 15:54 Data13TeV_SingleElectron2016B_03Feb2017_ver2_1.root
-rw-r-----+ 1 olek t3cms 9.6M Jun 25 15:54 Data13TeV_SingleElectron2016B_03Feb2017_ver2_2.root
-rw-r-----+ 1 olek t3cms 9.6M Jun 25 16:42 Data13TeV_SingleElectron2016G_03Feb2017_v1_86.root
-rw-r-----+ 1 olek t3cms 9.9M Jun 25 15:55 Data13TeV_SingleElectron2016B_03Feb2017_ver2_4.root

same now:

-rw-r-----+ 1 olek t3cms 1.5M May 21 15:13 Data13TeV_SingleElectron2016C_03Feb2017_v1_36.root

-rw-r-----+ 1 olek t3cms 28M May 21 16:55 Data13TeV_SingleElectron2016E_03Feb2017_v1_48.root
-rw-r-----+ 1 olek t3cms 3.5M May 21 17:29 Data13TeV_SingleElectron2016F_03Feb2017_v1_37.root
-rw-r-----+ 1 olek t3cms 4.9M May 21 15:01 Data13TeV_SingleElectron2016H_03Feb2017_ver2_1.root
-rw-r-----+ 1 olek t3cms 5.7M May 21 15:38 Data13TeV_SingleElectron2016D_03Feb2017_v1_59.root
-rw-r-----+ 1 olek t3cms 7.4M May 21 16:58 Data13TeV_SingleElectron2016B_03Feb2017_ver2_106.root
-rw-r-----+ 1 olek t3cms 8.0M May 21 17:00 Data13TeV_SingleElectron2016B_03Feb2017_ver2_1.root
-rw-r-----+ 1 olek t3cms 9.6M May 21 15:34 Data13TeV_SingleElectron2016B_03Feb2017_ver2_2.root
-rw-r-----+ 1 olek t3cms 9.6M May 21 15:41 Data13TeV_SingleElectron2016G_03Feb2017_v1_86.root
-rw-r-----+ 1 olek t3cms 9.9M May 21 15:35 Data13TeV_SingleElectron2016B_03Feb2017_ver2_4.root

sumup their event counters

python check_gen_lumi_weights.py --counter-histo events_counter --counter-bin 1 lstore_outdirs/v37/test175/Data13TeV_SingleElectron2016*/*root
python check_gen_lumi_weights.py --counter-histo events_counter --counter-bin 1 lstore_outdirs/v37/test15/Data13TeV_SingleElectron2016*/*root

"                None" : 939605058.000000,
"                None" : 939605058.000000,

-- so, probably the plots failed

python check_gen_lumi_weights.py --counter-histo events_counter --counter-bin 1 lstore_outdirs/v37/test175/Data13TeV_SingleMuon2016*/*root &
python check_gen_lumi_weights.py --counter-histo events_counter --counter-bin 1 lstore_outdirs/v37/test15/Data13TeV_SingleMuon2016*/*root  &

"                None" : 783262254.000000,
"                None" : 784877187.000000,

1/7% less

find jobsums/distrs/v37_test15_bunchFULLFIT1/all/  -name "*SingleEle*root" | wc -l
find jobsums/distrs/v37_test175_bunchFULLFIT1/all/ -name "*SingleEle*root" | wc -l

2814
1876

-- but 175 does not have simple _sel channels!

find jobsums/distrs/v37_test15_bunchFULLFIT1/all/  -name "*SingleMu*root" | wc -l
find jobsums/distrs/v37_test175_bunchFULLFIT1/all/ -name "*SingleMu*root" | wc -l

2808
1872

number of data jobs in both cases:

rm batch_jobs/*
python loop_selections.py --options " --wjets-nup-cut " --nt v37 --proc test175 --distrs bunchFULLFIT1 --chan-groups fit_tt_leptau_lj,fit_tt_leptau_ljout,fit_tt_leptau_Vloose_lj,fit_tt_leptau_Vloose_ljout --dtags Data13TeV_SingleElectron2016B_03Feb2017_ver2,Data13TeV_SingleElectron2016C_03Feb2017_v1,Data13TeV_SingleElectron2016D_03Feb2017_v1,Data13TeV_SingleElectron2016E_03Feb2017_v1,Data13TeV_SingleElectron2016F_03Feb2017_v1,Data13TeV_SingleElectron2016G_03Feb2017_v1,Data13TeV_SingleElectron2016H_03Feb2017_ver2,Data13TeV_SingleElectron2016H_03Feb2017_ver3 && ls batch_jobs/ | wc -l

rm batch_jobs/*
python loop_selections.py --options " --wjets-nup-cut " --nt v37 --proc test175 --distrs bunchFULLFIT1 --chan-groups fit_tt_leptau_lj,fit_tt_leptau_ljout,fit_tt_leptau_Vloose_lj,fit_tt_leptau_Vloose_ljout --dtags Data13TeV_SingleMuon2016B_03Feb2017_ver2,Data13TeV_SingleMuon2016C_03Feb2017_v1,Data13TeV_SingleMuon2016D_03Feb2017_v1,Data13TeV_SingleMuon2016E_03Feb2017_v1,Data13TeV_SingleMuon2016F_03Feb2017_v1,Data13TeV_SingleMuon2016G_03Feb2017_v1,Data13TeV_SingleMuon2016H_03Feb2017_ver2,Data13TeV_SingleMuon2016H_03Feb2017_ver3   && ls batch_jobs/ | wc -l

469
468

fit_tt_leptau,fit_tt_leptau_lj,fit_tt_leptau_ljout,fit_tt_leptau_Vloose,fit_tt_leptau_Vloose_lj,fit_tt_leptau_Vloose_ljout


rm batch_jobs/*
python loop_selections.py --options " --wjets-nup-cut " --nt v37 --proc test175 --distrs bunchFULLFIT1 --chan-groups fit_tt_leptau,fit_tt_leptau_lj,fit_tt_leptau_ljout,fit_tt_leptau_Vloose,fit_tt_leptau_Vloose_lj,fit_tt_leptau_Vloose_ljout --dtags Data13TeV_SingleElectron2016B_03Feb2017_ver2,Data13TeV_SingleElectron2016C_03Feb2017_v1,Data13TeV_SingleElectron2016D_03Feb2017_v1,Data13TeV_SingleElectron2016E_03Feb2017_v1,Data13TeV_SingleElectron2016F_03Feb2017_v1,Data13TeV_SingleElectron2016G_03Feb2017_v1,Data13TeV_SingleElectron2016H_03Feb2017_ver2,Data13TeV_SingleElectron2016H_03Feb2017_ver3  && ls batch_jobs/ | wc -l

rm batch_jobs/*
python loop_selections.py --options " --wjets-nup-cut " --nt v37 --proc test175 --distrs bunchFULLFIT1 --chan-groups fit_tt_leptau,fit_tt_leptau_lj,fit_tt_leptau_ljout,fit_tt_leptau_Vloose,fit_tt_leptau_Vloose_lj,fit_tt_leptau_Vloose_ljout --dtags Data13TeV_SingleMuon2016B_03Feb2017_ver2,Data13TeV_SingleMuon2016C_03Feb2017_v1,Data13TeV_SingleMuon2016D_03Feb2017_v1,Data13TeV_SingleMuon2016E_03Feb2017_v1,Data13TeV_SingleMuon2016F_03Feb2017_v1,Data13TeV_SingleMuon2016G_03Feb2017_v1,Data13TeV_SingleMuon2016H_03Feb2017_ver2,Data13TeV_SingleMuon2016H_03Feb2017_ver3  && ls batch_jobs/ | wc -l

469
468

[469 468] .* 4
1x2 Array{Int64,2}:
 1876  1872

julia> [469 468] .* 6
1x2 Array{Int64,2}:
 2814  2808

 all ok
despite 1/7% less events in test175 muons?


find v37_test175_bunchFULLFIT1/all/ -name "*SingleEle*root" -exec ls -lh '{}' \; | sort | less

-rw-r-----+ 1 olek t3cms 13K Jun 25 18:35 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016H_03Feb2017_ver2/fit_tt_leptau_Vloose_ljout/Data13TeV_SingleElectron2016H_03Feb2017_ver2_72.root
-rw-r-----+ 1 olek t3cms 902 Jun 25 18:46 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016D_03Feb2017_v1/fit_tt_leptau_lj/Data13TeV_SingleElectron2016D_03Feb2017_v1_39.root
-rw-r-----+ 1 olek t3cms 902 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016F_03Feb2017_v1/fit_tt_leptau_lj/Data13TeV_SingleElectron2016F_03Feb2017_v1_19.root
-rw-r-----+ 1 olek t3cms 902 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016G_03Feb2017_v1/fit_tt_leptau_lj/Data13TeV_SingleElectron2016G_03Feb2017_v1_60.root
-rw-r-----+ 1 olek t3cms 914 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016D_03Feb2017_v1/fit_tt_leptau_ljout/Data13TeV_SingleElectron2016D_03Feb2017_v1_39.root
-rw-r-----+ 1 olek t3cms 914 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016F_03Feb2017_v1/fit_tt_leptau_ljout/Data13TeV_SingleElectron2016F_03Feb2017_v1_19.root
-rw-r-----+ 1 olek t3cms 914 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016G_03Feb2017_v1/fit_tt_leptau_ljout/Data13TeV_SingleElectron2016G_03Feb2017_v1_60.root
-rw-r-----+ 1 olek t3cms 918 Jun 25 18:46 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016B_03Feb2017_ver2/fit_tt_leptau_lj/Data13TeV_SingleElectron2016B_03Feb2017_ver2_21.root
-rw-r-----+ 1 olek t3cms 918 Jun 25 18:46 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016B_03Feb2017_ver2/fit_tt_leptau_lj/Data13TeV_SingleElectron2016B_03Feb2017_ver2_75.root
-rw-r-----+ 1 olek t3cms 918 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016H_03Feb2017_ver2/fit_tt_leptau_lj/Data13TeV_SingleElectron2016H_03Feb2017_ver2_55.root
-rw-r-----+ 1 olek t3cms 918 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016H_03Feb2017_ver2/fit_tt_leptau_lj/Data13TeV_SingleElectron2016H_03Feb2017_ver2_58.root
-rw-r-----+ 1 olek t3cms 918 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016H_03Feb2017_ver2/fit_tt_leptau_lj/Data13TeV_SingleElectron2016H_03Feb2017_ver2_59.root
-rw-r-----+ 1 olek t3cms 918 Jun 25 19:09 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016B_03Feb2017_ver2/fit_tt_leptau_lj/Data13TeV_SingleElectron2016B_03Feb2017_ver2_83.root
-rw-r-----+ 1 olek t3cms 922 Jun 25 18:46 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016B_03Feb2017_ver2/fit_tt_leptau_lj/Data13TeV_SingleElectron2016B_03Feb2017_ver2_105.root
-rw-r-----+ 1 olek t3cms 930 Jun 25 18:46 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016B_03Feb2017_ver2/fit_tt_leptau_ljout/Data13TeV_SingleElectron2016B_03Feb2017_ver2_21.root
-rw-r-----+ 1 olek t3cms 930 Jun 25 18:46 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016B_03Feb2017_ver2/fit_tt_leptau_ljout/Data13TeV_SingleElectron2016B_03Feb2017_ver2_75.root
-rw-r-----+ 1 olek t3cms 930 Jun 25 18:46 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016B_03Feb2017_ver2/fit_tt_leptau_ljout/Data13TeV_SingleElectron2016B_03Feb2017_ver2_83.root
-rw-r-----+ 1 olek t3cms 930 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016D_03Feb2017_v1/fit_tt_leptau_Vloose_lj/Data13TeV_SingleElectron2016D_03Feb2017_v1_39.root
-rw-r-----+ 1 olek t3cms 930 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016F_03Feb2017_v1/fit_tt_leptau_Vloose_lj/Data13TeV_SingleElectron2016F_03Feb2017_v1_19.root
-rw-r-----+ 1 olek t3cms 930 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016G_03Feb2017_v1/fit_tt_leptau_Vloose_lj/Data13TeV_SingleElectron2016G_03Feb2017_v1_60.root
-rw-r-----+ 1 olek t3cms 930 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016H_03Feb2017_ver2/fit_tt_leptau_ljout/Data13TeV_SingleElectron2016H_03Feb2017_ver2_55.root
-rw-r-----+ 1 olek t3cms 930 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016H_03Feb2017_ver2/fit_tt_leptau_ljout/Data13TeV_SingleElectron2016H_03Feb2017_ver2_58.root
-rw-r-----+ 1 olek t3cms 930 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016H_03Feb2017_ver2/fit_tt_leptau_ljout/Data13TeV_SingleElectron2016H_03Feb2017_ver2_59.root
-rw-r-----+ 1 olek t3cms 934 Jun 25 18:46 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016B_03Feb2017_ver2/fit_tt_leptau_ljout/Data13TeV_SingleElectron2016B_03Feb2017_ver2_105.root
-rw-r-----+ 1 olek t3cms 942 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016D_03Feb2017_v1/fit_tt_leptau_Vloose_ljout/Data13TeV_SingleElectron2016D_03Feb2017_v1_39.root
-rw-r-----+ 1 olek t3cms 942 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016F_03Feb2017_v1/fit_tt_leptau_Vloose_ljout/Data13TeV_SingleElectron2016F_03Feb2017_v1_19.root
-rw-r-----+ 1 olek t3cms 942 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016G_03Feb2017_v1/fit_tt_leptau_Vloose_ljout/Data13TeV_SingleElectron2016G_03Feb2017_v1_60.root
-rw-r-----+ 1 olek t3cms 946 Jun 25 18:46 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016B_03Feb2017_ver2/fit_tt_leptau_Vloose_lj/Data13TeV_SingleElectron2016B_03Feb2017_ver2_21.root
-rw-r-----+ 1 olek t3cms 946 Jun 25 18:46 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016B_03Feb2017_ver2/fit_tt_leptau_Vloose_lj/Data13TeV_SingleElectron2016B_03Feb2017_ver2_75.root
-rw-r-----+ 1 olek t3cms 946 Jun 25 18:46 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016B_03Feb2017_ver2/fit_tt_leptau_Vloose_lj/Data13TeV_SingleElectron2016B_03Feb2017_ver2_83.root
-rw-r-----+ 1 olek t3cms 946 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016H_03Feb2017_ver2/fit_tt_leptau_Vloose_lj/Data13TeV_SingleElectron2016H_03Feb2017_ver2_55.root
-rw-r-----+ 1 olek t3cms 946 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016H_03Feb2017_ver2/fit_tt_leptau_Vloose_lj/Data13TeV_SingleElectron2016H_03Feb2017_ver2_58.root
-rw-r-----+ 1 olek t3cms 946 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016H_03Feb2017_ver2/fit_tt_leptau_Vloose_lj/Data13TeV_SingleElectron2016H_03Feb2017_ver2_59.root
-rw-r-----+ 1 olek t3cms 950 Jun 25 18:46 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016B_03Feb2017_ver2/fit_tt_leptau_Vloose_lj/Data13TeV_SingleElectron2016B_03Feb2017_ver2_105.root
-rw-r-----+ 1 olek t3cms 958 Jun 25 18:46 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016B_03Feb2017_ver2/fit_tt_leptau_Vloose_ljout/Data13TeV_SingleElectron2016B_03Feb2017_ver2_21.root
-rw-r-----+ 1 olek t3cms 958 Jun 25 18:46 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016B_03Feb2017_ver2/fit_tt_leptau_Vloose_ljout/Data13TeV_SingleElectron2016B_03Feb2017_ver2_75.root
-rw-r-----+ 1 olek t3cms 958 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016B_03Feb2017_ver2/fit_tt_leptau_Vloose_ljout/Data13TeV_SingleElectron2016B_03Feb2017_ver2_83.root
-rw-r-----+ 1 olek t3cms 958 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016H_03Feb2017_ver2/fit_tt_leptau_Vloose_ljout/Data13TeV_SingleElectron2016H_03Feb2017_ver2_55.root
-rw-r-----+ 1 olek t3cms 958 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016H_03Feb2017_ver2/fit_tt_leptau_Vloose_ljout/Data13TeV_SingleElectron2016H_03Feb2017_ver2_58.root
-rw-r-----+ 1 olek t3cms 958 Jun 25 18:47 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016H_03Feb2017_ver2/fit_tt_leptau_Vloose_ljout/Data13TeV_SingleElectron2016H_03Feb2017_ver2_59.root
-rw-r-----+ 1 olek t3cms 962 Jun 25 18:46 v37_test175_bunchFULLFIT1/all/Data13TeV_SingleElectron2016B_03Feb2017_ver2/fit_tt_leptau_Vloose_ljout/Data13TeV_SingleElectron2016B_03Feb2017_ver2_105.root

find v37_test15_bunchFULLFIT1/all/ -name "*SingleEle*root" -exec ls -lh '{}' \; | sort | less

-- all 12 and 13 K

find v37_test175_bunchFULLFIT1/all/ -name "*SingleEl*root" -size -10k | wc -l
find v37_test175_bunchFULLFIT1/all/ -name "*SingleMu*root" -size -10k | wc -l
find v37_test175_bunchFULLFIT1/all/ -name "*TTJe*root" -size -10k | wc -l
find v37_test175_bunchFULLFIT1/all/ -name "*TTJe*root"            | wc -l
40
152
174
396


find v37_test15_bunchFULLFIT1/all/  -name "*SingleEl*root" -size -10k | wc -l
find v37_test15_bunchFULLFIT1/all/  -name "*SingleMu*root" -size -10k | wc -l
find v37_test15_bunchFULLFIT1/all/ -name "*TTJe*root" -size -10k | wc -l
find v37_test15_bunchFULLFIT1/all/ -name "*TTJe*root"            | wc -l
0
0
0
594




find v37_test175_bunchFULLFIT1/all/ -name "*SingleEl*root" -size -10k -delete
find v37_test175_bunchFULLFIT1/all/ -name "*SingleMu*root" -size -10k -delete
find v37_test175_bunchFULLFIT1/all/ -name "*TTJe*root" -size -10k -delete

and use this for failed plots:

make find_failed_jobs_plots

find v37_test175_bunchFULLFIT1/all/ -name "*SingleMu*root" -size -10k | wc -l
4

-- still some output file is created empty!

example file:
el_selVloose_ljout->Get("data_other/NOMINAL")->ls()
TDirectoryFile*		NOMINAL	NOMINAL


no files less then 10K


find v37_test175_bunchFULLFIT1/all/ -name "*SingleMu*root" -size -10k

v37_test175_bunchFULLFIT1/all/Data13TeV_SingleMuon2016F_03Feb2017_v1/fit_tt_leptau_ljout/Data13TeV_SingleMuon2016F_03Feb2017_v1_4.root
v37_test175_bunchFULLFIT1/all/Data13TeV_SingleMuon2016F_03Feb2017_v1/fit_tt_leptau_Vloose_lj/Data13TeV_SingleMuon2016F_03Feb2017_v1_4.root
v37_test175_bunchFULLFIT1/all/Data13TeV_SingleMuon2016F_03Feb2017_v1/fit_tt_leptau_lj/Data13TeV_SingleMuon2016F_03Feb2017_v1_4.root
v37_test175_bunchFULLFIT1/all/Data13TeV_SingleMuon2016F_03Feb2017_v1/fit_tt_leptau_Vloose_ljout/Data13TeV_SingleMuon2016F_03Feb2017_v1_4.root

-- this is the broken lstore file! the 1/7% of the difference!

root -l lstore_outdirs/v37/test175/Data13TeV_SingleMuon2016F_03Feb2017_v1/Data13TeV_SingleMuon2016F_03Feb2017_v1_4.root

qsub -l h_vmem=1G '/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/./queue_dir/v37/test175/jobs_dir/tt_data_00706' 

find jobsums/distrs/v37_test175_bunchFULLFIT1/all/Data13TeV_SingleMuon2016F_03Feb2017_v1/ -name "*root" -size -10k
find jobsums/distrs/v37_test175_bunchFULLFIT1/all/ -name "*root" -size -10k | wc -l
find jobsums/distrs/v37_test175_bunchFULLFIT1/all/ -name "*root"            | wc -l
find ./ -name "*root"            | wc -l




bin           mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                
process       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                       
rate          4915.346                 3607.634                 204.417                  271.802                  83.768                   23.138                   226.131                  34.416                   220.923                  0.000                    15.283                   228.671                  8.529                    190.632                  71.865                   

obs 9284.000000
mc sum = 10102.555409

bin           mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             
process       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                       
rate          7776.974                 2514.654                 143.036                  455.072                  172.542                  54.709                   289.521                  52.217                   440.611                  0.000                    29.676                   364.950                  23.466                   390.389                  36.128                   

obs 12113.000000
mc sum = 12743.946387


new numbers:

bin           el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                
process       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_eltau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        12                       13                       14                       15                       16                       17                       18                       
rate          3266.333                 2402.517                 129.463                  184.964                  63.698                   15.511                   167.755                  23.972                   164.546                  0.981                    14.372                   176.465                  29.613                   118.405                  107.450                  
el_sel_lj/data_other/NOMINAL/el_sel_lj_data_other_NOMINAL_Mt_lep_met_c
obs 6700.000000
mc sum = 6866.046683
INFO:root:el_sel_ljout
bin           el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             
process       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_eltau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        12                       13                       14                       15                       16                       17                       18                       
rate          5208.330                 1655.452                 87.311                   308.340                  113.105                  35.835                   186.706                  32.157                   303.162                  1.928                    12.859                   223.866                  79.913                   228.733                  336.900                  
el_sel_ljout/data_other/NOMINAL/el_sel_ljout_data_other_NOMINAL_Mt_lep_met_c
obs 8426.000000
mc sum = 8814.596649




bin           mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                
process       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                       
rate          4915.346                 3607.634                 204.417                  271.802                  83.768                   23.138                   226.131                  34.416                   220.923                  0.000                    15.283                   228.671                  8.529                    190.632                  175.815                  
mu_sel_lj/data_other/NOMINAL/mu_sel_lj_data_other_NOMINAL_Mt_lep_met_c
obs 9842.000000
mc sum = 10206.505409
INFO:root:mu_sel_ljout
bin           mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             
process       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                       
rate          7776.974                 2514.654                 143.036                  455.072                  172.542                  54.709                   289.521                  52.217                   440.611                  0.000                    29.676                   364.950                  23.466                   390.389                  164.228                  
mu_sel_ljout/data_other/NOMINAL/mu_sel_ljout_data_other_NOMINAL_Mt_lep_met_c
obs 12877.000000
mc sum = 12872.046387






vim -p ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1_el.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1_mu.txt

make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1_el
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1_mu
make both mucard=ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1_mu elcard=ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1_el bothcard=ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1_both
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1_both

combine -M FitDiagnostics   ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1_el.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1_mu.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1_both.root

Best fit r: 0.951809  -0.0815818/+0.0884361  (68% CL)
Best fit r: 0.940956  -0.0726787/+0.0790259  (68% CL)

-- fuck!

Best fit r: 0.952406  -0.0693208/+0.0753598  (68% CL)

fuck muons!

new files:

Best fit r: 0.929758  -0.0785335/+0.08767  (68% CL)
Best fit r: 0.901719  -0.0707892/+0.0768039  (68% CL)
Best fit r: 0.909421  -0.0671927/+0.0739513  (68% CL)

asymmetric and worse? how is it possible?

test174

Best fit r: 0.951809  -0.0815818/+0.0884361  (68% CL)
Best fit r: 0.940956  -0.0726787/+0.0790259  (68% CL)
Best fit r: 0.952406  -0.0693208/+0.0753598  (68% CL)


make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1_el.root      nn=v37_test175_mu_test1    &
make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1_mu.root      nn=v37_test175_el_test1    &
make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test175_bunchFULLFIT1_both.root    nn=v37_test175_both_test1  &

-- looks OK






# test176

mv distrs/distrs_v37_test15_bunchFULLFIT1_tt_data_from_v37_test176_bunchFULLFIT1_mc1.root distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1.root

mkdir histosels/v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1/

make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1.root data=distrs/v37_test176_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_lj"      & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1.root data=distrs/v37_test176_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_lj"      & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1.root data=distrs/v37_test176_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_ljout"   & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1.root data=distrs/v37_test176_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_ljout"   & \

make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1.root data=distrs/v37_test176_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_lj        systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_lj"     & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1.root data=distrs/v37_test176_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_lj        systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_lj"     & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1.root data=distrs/v37_test176_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_ljout     systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_ljout"  & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1.root data=distrs/v37_test176_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_ljout     systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_ljout"  & \


hadd datafile_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1_HISTOSEL.root v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1/*

cp ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_el.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1_el.txt
cp ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_mu.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1_mu.txt


vim -p ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1_el.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1_mu.txt

make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1_el
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1_mu

-- ??? in el no error after the change of the histosel file? qcd did not change???
   qcd slightly changed in mu_sel_ljout

make both mucard=ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1_mu elcard=ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1_el bothcard=ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1_both
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1_both

combine -M FitDiagnostics   ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1_el.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1_mu.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1_both.root

test174:

Best fit r: 0.951809  -0.0815818/+0.0884361  (68% CL)
Best fit r: 0.940956  -0.0726787/+0.0790259  (68% CL)
Best fit r: 0.952406  -0.0693208/+0.0753598  (68% CL)

test176:

Best fit r: 0.913926  -0.0798187/+0.0868165  (68% CL)
Best fit r: 0.890489  -0.0697686/+0.0763669  (68% CL)
Best fit r: 0.892041  -0.0674457/+0.0739623  (68% CL)

-- damn this? what is this?
   the same as test172 but with no JER from taujet
   but the numbers are the same as in test174??

test172:

Best fit r: 0.927935  -0.0776618/+0.0886654  (68% CL)
Best fit r: 0.918919  -0.0703641/+0.0785824  (68% CL)
Best fit r: 0.923146  -0.0688665/+0.0741745  (68% CL)

compare data and tt shapes in test174 and test176:

python get_shapes.py --x-title "M_{T}(l, MET) [GeV]" --y-title "" --norm-binwidth --formula "test174:test176" -c mu_sel -d Mt_lep_met_c -p tt_lj test176:histosels/datafile_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1_HISTOSEL.root:mu_sel_lj/data_other/NOMINAL test174:histosels/datafile_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_HISTOSEL.root:mu_sel_lj/data_other/NOMINAL

-- data noticeably went down at large Mt

python get_shapes.py --x-title "M_{T}(l, MET) [GeV]" --y-title "" --no-norm --norm-formulas --formula "test176/test174" -c mu_sel -d Mt_lep_met_c -p tt_lj test176:histosels/datafile_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1_HISTOSEL.root:mu_sel_lj/data_other/NOMINAL    test174:histosels/datafile_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_HISTOSEL.root:mu_sel_lj/data_other/NOMINAL
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_c_test176,test174_formula_nonorm.png ./compare_mu_sel_lj_data_NOMINAL_Mt_lep_met_c_test176,test174_formula_nonorm.png
python get_shapes.py --x-title "M_{T}(l, MET) [GeV]" --y-title "" --no-norm --norm-formulas --formula "test176/test174" -c mu_sel -d Mt_lep_met_c -p tt_lj test176:histosels/datafile_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1_HISTOSEL.root:mu_sel_ljout/data_other/NOMINAL test174:histosels/datafile_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_HISTOSEL.root:mu_sel_ljout/data_other/NOMINAL
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_c_test176,test174_formula_nonorm.png ./compare_mu_sel_ljout_data_NOMINAL_Mt_lep_met_c_test176,test174_formula_nonorm.png

python get_shapes.py --x-title "M_{T}(l, MET) [GeV]" --y-title "" --no-norm --norm-formulas --formula "test176/test174" -c mu_sel -d Mt_lep_met_c -p tt_lj test176:histosels/datafile_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1_HISTOSEL.root:mu_sel_lj/tt_lj/NOMINAL    test174:histosels/datafile_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_HISTOSEL.root:mu_sel_lj/tt_lj/NOMINAL
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_c_test176,test174_formula_nonorm.png ./compare_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_c_test176,test174_formula_nonorm.png
python get_shapes.py --x-title "M_{T}(l, MET) [GeV]" --y-title "" --no-norm --norm-formulas --formula "test176/test174" -c mu_sel -d Mt_lep_met_c -p tt_lj test176:histosels/datafile_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1_HISTOSEL.root:mu_sel_ljout/tt_lj/NOMINAL test174:histosels/datafile_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_HISTOSEL.root:mu_sel_ljout/tt_lj/NOMINAL
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_c_test176,test174_formula_nonorm.png ./compare_mu_sel_ljout_tt_lj_NOMINAL_Mt_lep_met_c_test176,test174_formula_nonorm.png

python get_shapes.py --x-title "M_{T}(l, MET) [GeV]" --y-title "" --no-norm --norm-formulas --formula "test176/test174" -c mu_sel -d Mt_lep_met_c -p tt_lj test176:histosels/datafile_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1_HISTOSEL.root:mu_sel_lj/tt_mutau/NOMINAL    test174:histosels/datafile_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_HISTOSEL.root:mu_sel_lj/tt_mutau/NOMINAL
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_c_test176,test174_formula_nonorm.png ./compare_mu_sel_lj_tt_mutau_NOMINAL_Mt_lep_met_c_test176,test174_formula_nonorm.png
python get_shapes.py --x-title "M_{T}(l, MET) [GeV]" --y-title "" --no-norm --norm-formulas --formula "test176/test174" -c mu_sel -d Mt_lep_met_c -p tt_lj test176:histosels/datafile_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1_HISTOSEL.root:mu_sel_ljout/tt_mutau/NOMINAL test174:histosels/datafile_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_HISTOSEL.root:mu_sel_ljout/tt_mutau/NOMINAL
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_c_test176,test174_formula_nonorm.png ./compare_mu_sel_ljout_tt_mutau_NOMINAL_Mt_lep_met_c_test176,test174_formula_nonorm.png

eog compare*data*test176*png
eog compare*tt_lj*test176*png
eog compare*tt_mutau*test176*png

-- data falls significantly, but tt too...

let's try the rest of mc..


## full test176

mkdir histosels/v37_test176_bunchFULLFIT1/

make run_histos mc=distrs/distrs_v37_test176_bunchFULLFIT1_mc1.root data=distrs/v37_test176_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test176_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_lj"      & \
make run_histos mc=distrs/distrs_v37_test176_bunchFULLFIT1_mc1.root data=distrs/v37_test176_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test176_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_lj"      & \
make run_histos mc=distrs/distrs_v37_test176_bunchFULLFIT1_mc1.root data=distrs/v37_test176_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test176_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_ljout"   & \
make run_histos mc=distrs/distrs_v37_test176_bunchFULLFIT1_mc1.root data=distrs/v37_test176_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test176_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_ljout"   & \

make run_histos mc=distrs/distrs_v37_test176_bunchFULLFIT1_mc1.root data=distrs/v37_test176_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test176_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_lj        systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_lj"     & \
make run_histos mc=distrs/distrs_v37_test176_bunchFULLFIT1_mc1.root data=distrs/v37_test176_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test176_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_lj        systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_lj"     & \
make run_histos mc=distrs/distrs_v37_test176_bunchFULLFIT1_mc1.root data=distrs/v37_test176_bunchFULLFIT1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test176_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_ljout     systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_ljout"  & \
make run_histos mc=distrs/distrs_v37_test176_bunchFULLFIT1_mc1.root data=distrs/v37_test176_bunchFULLFIT1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test176_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_ljout     systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_ljout"  & \

datafile_v37_test176_bunchFULLFIT1_HISTOSELS1.root

cp ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_el.txt ttxsec/datacard_v37_test176_bunchFULLFIT1_el.txt
cp ttxsec/datacard_v37_test15_bunchFULLFIT1_ttbar_from_test174_bunchFULLFIT1_mu.txt ttxsec/datacard_v37_test176_bunchFULLFIT1_mu.txt


vim -p ttxsec/datacard_v37_test176_bunchFULLFIT1_el.txt ttxsec/datacard_v37_test176_bunchFULLFIT1_mu.txt

shapes qcd       el_sel_lj     fit-stuff/v37_test15_bunchFULLFIT1_HISTOSEL.root  el_sel_lj/qcd_other/NOMINAL/el_sel_lj_qcd_NOMINAL_Mt_lep_met_c                 el_sel_lj/qcd_other/$SYSTEMATIC/el_sel_lj_qcd_$SYSTEMATIC_Mt_lep_met_c
shapes qcd       el_sel_ljout  fit-stuff/v37_test15_bunchFULLFIT1_HISTOSEL.root  el_sel_ljout/qcd_other/NOMINAL/el_sel_ljout_qcd_NOMINAL_Mt_lep_met_c           el_sel_ljout/qcd_other/$SYSTEMATIC/el_sel_ljout_qcd_$SYSTEMATIC_Mt_lep_met_c



make workspace datacard=ttxsec/datacard_v37_test176_bunchFULLFIT1_el
make workspace datacard=ttxsec/datacard_v37_test176_bunchFULLFIT1_mu

-- in el qcd changed only in ljout!
   in mu qcd changed only in ljout and dy_other changed in lj

make both mucard=ttxsec/datacard_v37_test176_bunchFULLFIT1_el elcard=ttxsec/datacard_v37_test176_bunchFULLFIT1_mu bothcard=ttxsec/datacard_v37_test176_bunchFULLFIT1_both
make workspace datacard=ttxsec/datacard_v37_test176_bunchFULLFIT1_both

combine -M FitDiagnostics   ttxsec/datacard_v37_test176_bunchFULLFIT1_el.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test176_bunchFULLFIT1_mu.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test176_bunchFULLFIT1_both.root

Best fit r: 0.907093  -0.0807581/+0.0861987  (68% CL)
Best fit r: 0.905444  -0.070016/+0.0772323  (68% CL)
Best fit r: 0.909669  -0.0694934/+0.0731807  (68% CL)

-- the worst of both test15 and test172....





# optimizing number of bins in Mt

1) reduce MC stat
2) but increase number of bins to fit nuisances better

-- how to quantify these?

typical data stat in the results:
el   1.5%
mu   1.1%
both 0.9%

number of experimental systematics
14
+ 3 frag
+ 1 toppt
+ 4 updowns
+ 3 scales
+ 1 alpha
+ pdfs

root -l histosels/datafile_v37_test15_bunchFULLFIT1_ttbar_data_from_test176_bunchFULLFIT1_HISTOSEL.root

((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(1)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(2)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(3)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(4)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(5)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(6)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(7)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(8)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(9)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(10)

-- bin 10 is overflow

((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(1)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(2)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(3)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(4)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(5)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(6)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(7)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(8)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(9)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(10)

(Double_t) 1223.27
(Double_t) 1370.44
(Double_t) 1705.40
(Double_t) 1935.81
(Double_t) 1647.13
(Double_t) 1334.35
(Double_t) 546.085
(Double_t) 302.178
(Double_t) 145.247
(Double_t) 107.953

((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(1)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(1) 
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(2)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(2)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(3)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(3)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(4)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(4)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(5)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(5)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(6)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(6)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(7)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(7)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(8)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(8)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(9)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(9)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(10) / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(10)

(double) 0.0151734
root [25] ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(2)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(2)
(double) 0.0141962
root [26] ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(3)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(3)
(double) 0.0117133
root [27] ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(4)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(4)
(double) 0.0111209
root [28] ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(5)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(5)
(double) 0.0116769
root [29] ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(6)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(6)
(double) 0.0136230
root [30] ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(7)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(7)
(double) 0.0216158
root [31] ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(8)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(8)
(double) 0.0293189
root [32] ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(9)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(9)
(double) 0.0425628
root [33] ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(10) / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(10)
(double) 0.0490453

-- so what if aim at 14 bins and minimize MC stat?

 9 bins
-1 merge the last two
+3 split the middle
+3 more?

merge last two bins and add 1 bin between 7 first ones

1/sqrt(N)

sqrt(N1/N2)

sqrt( 1223.27 ) / 1223.27
sqrt( 1370.44 ) / 1370.44
sqrt( 1705.40 ) / 1705.40
sqrt( 1935.81 ) / 1935.81
sqrt( 1647.13 ) / 1647.13
sqrt( 1334.35 ) / 1334.35
sqrt( 546.085 ) / 546.085
sqrt( 302.178 ) / 302.178
sqrt( 145.247 ) / 145.247
sqrt( 107.953 ) / 107.953

((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(1)  / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(1) 
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(2)  / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(2)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(3)  / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(3)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(4)  / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(4)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(5)  / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(5)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(6)  / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(6)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(7)  / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(7)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(8)  / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(8)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(9)  / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(9)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(10) / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(10)

(double) 0.0157412
(double) 0.0129166
(double) 0.0110614
(double) 0.0103275
(double) 0.0101011
(double) 0.0104918
(double) 0.0150304
(double) 0.0194137
(double) 0.0274660
(double) 0.0302012

((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(1)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(2)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(3)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(4)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(5)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(6)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(7)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(8)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(9)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(10)

((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(1) 
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(2)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(3)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(4)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(5)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(6)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(7)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(8)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(9)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(10)

(Double_t) 2545.56
(Double_t) 2800.67
(Double_t) 3505.97
(Double_t) 4014.17
(Double_t) 3728.21
(Double_t) 3256.67
(Double_t) 1539.01
(Double_t) 917.179
(Double_t) 456.622
(Double_t) 365.509

-- the effect of different MC
   first bin has 2.5k events and 0.015 error
   the bin 1539.01 has the same 0.015 error


flatten the distr via the cumulative distr

((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetCumulative()

test on data with sumup draw script
and tilt the bin size to approximately accomodate the MC stat difference

overall 22k events
22k / 14 = 1.5k

the first bin is 2.5k and 1.57%
make it 2k first and 1k last?

julia> sqrt(1000)/1000
0.03162277660168379

julia> 0.3 * sqrt(1000)/1000 
0.009486832980505138

julia> sqrt(456) / 456
0.0468292905790847

julia> 0.0275 / (sqrt(456) / 456)
0.5872393038617221

julia> 0.6 * sqrt(1000)/1000
0.018973665961010275

-- yeah seems ok

python sumup_ttree_draw.py "event_met_lep_mt" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7)" --custom-range 0,20,40,60,80,100,130,160,200,250 --output study_bins_data_mu_sel_std_Mt_c_test6.root   --histo-name data_mu_sel_std_Mt_c_test6   lstore_outdirs/v37/test6/Data13TeV_SingleMu*/Data13TeV*.root   &

python sumup_ttree_draw.py "event_met_lep_mt" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7)" --custom-range 0,20,40,60,80,100,130,160,200,250 --output study_bins_data_mu_sel_std_Mt_c.root   --histo-name data_mu_sel_std_Mt_c   lstore_outdirs/v37/test15/Data13TeV_SingleMu*/Data13TeV*.root   &

python sumup_ttree_draw.py "event_met_lep_mt" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7)" --custom-range 0,16,30,42,54,62,70,88,96,108,118,130,160,250 --output study_bins_data_mu_sel_Mt_c_test1.root --histo-name data_mu_sel_Mt_c_test1 lstore_outdirs/v37/test15/Data13TeV_SingleMu*/Data13TeV*.root   &

hadd -f study_bins_all_data.root study_bins_data*root

root -l study_bins_all_data.root

data_mu_sel_std_Mt_c->GetBinContent(1) 
data_mu_sel_std_Mt_c->GetBinContent(2)
data_mu_sel_std_Mt_c->GetBinContent(3)
data_mu_sel_std_Mt_c->GetBinContent(4)
data_mu_sel_std_Mt_c->GetBinContent(5)
data_mu_sel_std_Mt_c->GetBinContent(6)
data_mu_sel_std_Mt_c->GetBinContent(7)
data_mu_sel_std_Mt_c->GetBinContent(8)
data_mu_sel_std_Mt_c->GetBinContent(9)
data_mu_sel_std_Mt_c->GetBinContent(10)

-- test6 was what?

data_mu_sel_std_Mt_c_test15->GetBinContent(1) 
data_mu_sel_std_Mt_c_test15->GetBinContent(2)
data_mu_sel_std_Mt_c_test15->GetBinContent(3)
data_mu_sel_std_Mt_c_test15->GetBinContent(4)
data_mu_sel_std_Mt_c_test15->GetBinContent(5)
data_mu_sel_std_Mt_c_test15->GetBinContent(6)
data_mu_sel_std_Mt_c_test15->GetBinContent(7)
data_mu_sel_std_Mt_c_test15->GetBinContent(8)
data_mu_sel_std_Mt_c_test15->GetBinContent(9)
data_mu_sel_std_Mt_c_test15->GetBinContent(10)

data_mu_sel_Mt_c_test1->GetBinContent(1) 
data_mu_sel_Mt_c_test1->GetBinContent(2)
data_mu_sel_Mt_c_test1->GetBinContent(3)
data_mu_sel_Mt_c_test1->GetBinContent(4)
data_mu_sel_Mt_c_test1->GetBinContent(5)
data_mu_sel_Mt_c_test1->GetBinContent(6)
data_mu_sel_Mt_c_test1->GetBinContent(7)
data_mu_sel_Mt_c_test1->GetBinContent(8)
data_mu_sel_Mt_c_test1->GetBinContent(9)
data_mu_sel_Mt_c_test1->GetBinContent(10)
data_mu_sel_Mt_c_test1->GetBinContent(11)
data_mu_sel_Mt_c_test1->GetBinContent(12)
data_mu_sel_Mt_c_test1->GetBinContent(13)
data_mu_sel_Mt_c_test1->GetBinContent(14)

(Double_t) 2063.00
(Double_t) 1811.00
(Double_t) 1825.00
(Double_t) 2025.00
(Double_t) 1575.00
(Double_t) 1578.00
(Double_t) 3771.00
(Double_t) 1433.00
(Double_t) 1758.00
(Double_t) 1124.00
(Double_t) 943.000
(Double_t) 1502.00
(Double_t) 1278.00
(Double_t) 340.000

data_mu_sel_Mt_c_test1->GetBinCenter(7)

python sumup_ttree_draw.py "event_met_lep_mt" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7)" --custom-range 0,16,30,42,54,62,70,78,86,96,106,118,135,160,250 --output study_bins_data_mu_sel_Mt_c_test2.root --histo-name data_mu_sel_Mt_c_test2 lstore_outdirs/v37/test15/Data13TeV_SingleMu*/Data13TeV*.root

hadd -f study_bins_all_data.root study_bins_data*root

root -l study_bins_all_data.root

data_mu_sel_Mt_c_test2->GetBinContent(1) 
data_mu_sel_Mt_c_test2->GetBinContent(2)
data_mu_sel_Mt_c_test2->GetBinContent(3)
data_mu_sel_Mt_c_test2->GetBinContent(4)
data_mu_sel_Mt_c_test2->GetBinContent(5)
data_mu_sel_Mt_c_test2->GetBinContent(6)
data_mu_sel_Mt_c_test2->GetBinContent(7)
data_mu_sel_Mt_c_test2->GetBinContent(8)
data_mu_sel_Mt_c_test2->GetBinContent(9)
data_mu_sel_Mt_c_test2->GetBinContent(10)
data_mu_sel_Mt_c_test2->GetBinContent(11)
data_mu_sel_Mt_c_test2->GetBinContent(12)
data_mu_sel_Mt_c_test2->GetBinContent(13)
data_mu_sel_Mt_c_test2->GetBinContent(14)
data_mu_sel_Mt_c_test2->GetBinContent(15)

root [1] data_mu_sel_Mt_c_test2->GetBinContent(1)
(Double_t) 2063.00
root [2] data_mu_sel_Mt_c_test2->GetBinContent(2)
(Double_t) 1811.00
root [3] data_mu_sel_Mt_c_test2->GetBinContent(3)
(Double_t) 1825.00
root [4] data_mu_sel_Mt_c_test2->GetBinContent(4)
(Double_t) 2025.00
root [5] data_mu_sel_Mt_c_test2->GetBinContent(5)
(Double_t) 1575.00
root [6] data_mu_sel_Mt_c_test2->GetBinContent(6)
(Double_t) 1578.00
root [7] data_mu_sel_Mt_c_test2->GetBinContent(7)
(Double_t) 1688.00
root [8] data_mu_sel_Mt_c_test2->GetBinContent(8)
(Double_t) 1686.00
root [9] data_mu_sel_Mt_c_test2->GetBinContent(9)
(Double_t) 1830.00
root [10] data_mu_sel_Mt_c_test2->GetBinContent(10)
(Double_t) 1511.00
root [11] data_mu_sel_Mt_c_test2->GetBinContent(11)
(Double_t) 1371.00
root [12] data_mu_sel_Mt_c_test2->GetBinContent(12) 
(Double_t) 1277.00
root [13] data_mu_sel_Mt_c_test2->GetBinContent(13)
(Double_t) 1168.00
root [14] data_mu_sel_Mt_c_test2->GetBinContent(14)
(Double_t) 1278.00
root [15] data_mu_sel_Mt_c_test2->GetBinContent(15)
(Double_t) 340.000

data_mu_sel_Mt_c_test2->GetBinCenter(9)
91

0,16,30,42,54, 62, 70,78,86,96, 106,118,135,160,250
0,16,32,44,54, 64, 74,81,88,95, 104,116,132,160,250

0,16,32,44,54,64,74,81,88,95,104,116,132,160,250

python sumup_ttree_draw.py "event_met_lep_mt" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7)" --custom-range 0,16,32,44,54,64,74,81,88,95,104,116,132,160,250 --output study_bins_data_mu_sel_Mt_c_test3.root --histo-name data_mu_sel_Mt_c_test3 lstore_outdirs/v37/test15/Data13TeV_SingleMu*/Data13TeV*.root

hadd -f study_bins_all_data.root study_bins_data*root

root -l study_bins_all_data.root

data_mu_sel_Mt_c_test3->GetBinContent(1) 
data_mu_sel_Mt_c_test3->GetBinContent(2)
data_mu_sel_Mt_c_test3->GetBinContent(3)
data_mu_sel_Mt_c_test3->GetBinContent(4)
data_mu_sel_Mt_c_test3->GetBinContent(5)
data_mu_sel_Mt_c_test3->GetBinContent(6)
data_mu_sel_Mt_c_test3->GetBinContent(7)
data_mu_sel_Mt_c_test3->GetBinContent(8)
data_mu_sel_Mt_c_test3->GetBinContent(9)
data_mu_sel_Mt_c_test3->GetBinContent(10)
data_mu_sel_Mt_c_test3->GetBinContent(11)
data_mu_sel_Mt_c_test3->GetBinContent(12)
data_mu_sel_Mt_c_test3->GetBinContent(13)
data_mu_sel_Mt_c_test3->GetBinContent(14)
data_mu_sel_Mt_c_test3->GetBinContent(15)
data_mu_sel_Mt_c_test3->GetBinContent(16)

root [1] data_mu_sel_Mt_c_test3->GetBinContent(1)
(Double_t) 2063.00
root [2] data_mu_sel_Mt_c_test3->GetBinContent(2)
(Double_t) 2080.00
root [3] data_mu_sel_Mt_c_test3->GetBinContent(3)
(Double_t) 1880.00
root [4] data_mu_sel_Mt_c_test3->GetBinContent(4)
(Double_t) 1701.00
root [5] data_mu_sel_Mt_c_test3->GetBinContent(5)
(Double_t) 1929.00
root [6] data_mu_sel_Mt_c_test3->GetBinContent(6)
(Double_t) 2101.00
root [7] data_mu_sel_Mt_c_test3->GetBinContent(7)
(Double_t) 1425.00
root [8] data_mu_sel_Mt_c_test3->GetBinContent(8)
(Double_t) 1469.00
root [9] data_mu_sel_Mt_c_test3->GetBinContent(9)
(Double_t) 1260.00
root [10] data_mu_sel_Mt_c_test3->GetBinContent(10)
(Double_t) 1398.00
root [11] data_mu_sel_Mt_c_test3->GetBinContent(11)
(Double_t) 1468.00
root [12] data_mu_sel_Mt_c_test3->GetBinContent(12)
(Double_t) 1278.00
root [13] data_mu_sel_Mt_c_test3->GetBinContent(13)
(Double_t) 1356.00
root [14] data_mu_sel_Mt_c_test3->GetBinContent(14)
(Double_t) 1278.00
root [15] data_mu_sel_Mt_c_test3->GetBinContent(15)
(Double_t) 340.000
root [16] data_mu_sel_Mt_c_test3->GetBinContent(16)
(Double_t) 340.000

-- the large bins in the middle should not be a problem, they cover the wjets



## new bins

root -l ttxsec/fit-stuff/datafile_HISTOSEL_v37_test172_bunchFULLFIT1BIN1.root

((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(1)  / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(1) 
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(2)  / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(2)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(3)  / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(3)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(4)  / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(4)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(5)  / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(5)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(6)  / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(6)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(7)  / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(7)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(8)  / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(8)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(9)  / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(9)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(10) / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(10)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(11) / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(11)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(12) / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(12)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(13) / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(13)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(14) / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(14)
((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(15) / ((TH1D*) mu_sel->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(15)

((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(1)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(1) 
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(2)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(2)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(3)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(3)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(4)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(4)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(5)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(5)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(6)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(6)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(7)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(7)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(8)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(8)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(9)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(9)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(10) / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(10)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(11) / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(11)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(12) / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(12)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(13) / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(13)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(14) / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(14)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(15) / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(15)

(double) 0.0172156
(double) 0.0166630
(double) 0.0164729
(double) 0.0168070
(double) 0.0163870
(double) 0.0155801
(double) 0.0177694
(double) 0.0188755
(double) 0.0197206
(double) 0.0194180
(double) 0.0207218
(double) 0.0216070
(double) 0.0229805
(double) 0.0243059


((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(1)  / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(1) 
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(2)  / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(2)
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(3)  / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(3)
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(4)  / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(4)
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(5)  / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(5)
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(6)  / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(6)
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(7)  / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(7)
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(8)  / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(8)
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(9)  / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(9)
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(10) / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(10)
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(11) / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(11)
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(12) / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(12)
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(13) / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(13)
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(14) / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(14)
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(15) / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(15)

(double) 0.0176836
(double) 0.0157696
(double) 0.0163650
(double) 0.0173664
(double) 0.0152858
(double) 0.0147253
(double) 0.0189938
(double) 0.0176682
(double) 0.0189050
(double) 0.0179056
(double) 0.0174288
(double) 0.0179586
(double) 0.0178912
(double) 0.0180873


root -l ttxsec/fit-stuff/v37_test15_bunchFULLFIT1_HISTOSEL.root

mu_sel:

(double) 0.0157412
(double) 0.0129166
(double) 0.0110614
(double) 0.0103275
(double) 0.0101011
(double) 0.0104918
(double) 0.0150304
(double) 0.0194137
(double) 0.0274660
(double) 0.0302012

reproduce:

sqrt(((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(1) *((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(1)  + ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(1) *((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(1)  )/ (((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(1) +((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(1))
sqrt(((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(2) *((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(2)  + ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(2) *((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(2)  )/ (((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(2) +((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(2))
sqrt(((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(3) *((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(3)  + ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(3) *((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(3)  )/ (((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(3) +((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(3))
sqrt(((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(4) *((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(4)  + ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(4) *((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(4)  )/ (((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(4) +((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(4))
sqrt(((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(5) *((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(5)  + ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(5) *((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(5)  )/ (((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(5) +((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(5))
sqrt(((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(6) *((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(6)  + ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(6) *((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(6)  )/ (((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(6) +((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(6))
sqrt(((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(7) *((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(7)  + ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(7) *((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(7)  )/ (((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(7) +((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(7))
sqrt(((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(8) *((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(8)  + ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(8) *((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(8)  )/ (((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(8) +((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(8))
sqrt(((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(9) *((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(9)  + ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(9) *((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(9)  )/ (((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(9) +((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(9))
sqrt(((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(10)*((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(10) + ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(10)*((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(10) )/ (((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(10)+((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(10))

(double) 0.0113655
(double) 0.0101276
(double) 0.00852927
(double) 0.00775465
(double) 0.00797480
(double) 0.00863227
(double) 0.0128444
(double) 0.0169468
(double) 0.0239307

((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(1)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(1) 
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(2)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(2)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(3)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(3)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(4)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(4)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(5)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(5)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(6)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(6)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(7)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(7)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(8)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(8)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(9)  / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(9)
((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(10) / ((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(10)

(double) 0.0156921
(double) 0.0147218
(double) 0.0119174
(double) 0.0112019
(double) 0.0114783
(double) 0.0132423
(double) 0.0204905
(double) 0.0282595
(double) 0.0401889
(double) 0.0458659

((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(1)  / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(1) 
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(2)  / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(2)
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(3)  / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(3)
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(4)  / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(4)
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(5)  / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(5)
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(6)  / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(6)
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(7)  / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(7)
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(8)  / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(8)
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(9)  / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(9)
((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinError(10) / ((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->GetBinContent(10)

(double) 0.0161757
(double) 0.0139308
(double) 0.0121156
(double) 0.0107360
(double) 0.0110546
(double) 0.0113832
(double) 0.0164848
(double) 0.0211763
(double) 0.0297870
(double) 0.0314496

mu_sel:

(double) 0.0157412
(double) 0.0129166
(double) 0.0110614
(double) 0.0103275
(double) 0.0101011
(double) 0.0104918
(double) 0.0150304
(double) 0.0194137
(double) 0.0274660
(double) 0.0302012







# test15 BIN1

mkdir histosels/v37_test15_bunchFULLFIT1BIN1/

make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test15_bunchFULLFIT1BIN1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=mu_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_lj"      & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test15_bunchFULLFIT1BIN1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=el_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_lj"      & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test15_bunchFULLFIT1BIN1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=mu_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_ljout"   & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test15_bunchFULLFIT1BIN1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=el_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_ljout"   & \

make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test15_bunchFULLFIT1BIN1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=mu_sel_lj        systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_lj"     & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test15_bunchFULLFIT1BIN1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=el_sel_lj        systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_lj"     & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test15_bunchFULLFIT1BIN1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=mu_sel_ljout     systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_ljout"  & \
make run_histos mc=distrs/distrs_v37_test15_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test15_bunchFULLFIT1BIN1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=el_sel_ljout     systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_ljout"  & \

hadd datafile_v37_test15_bunchFULLFIT1BIN1_HISTOSELS1.root histosels/v37_test15_bunchFULLFIT1BIN1/*root



cp ttxsec/datacard_v37_test15_bunchFULLFIT1_el.txt ttxsec/datacard_v37_test15_bunchFULLFIT1BIN1_el.txt
cp ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.txt ttxsec/datacard_v37_test15_bunchFULLFIT1BIN1_mu.txt


vim -p ttxsec/datacard_v37_test15_bunchFULLFIT1BIN1_el.txt ttxsec/datacard_v37_test15_bunchFULLFIT1BIN1_mu.txt

shapes qcd       el_sel_lj     fit-stuff/v37_test15_bunchFULLFIT1_HISTOSEL.root  el_sel_lj/qcd_other/NOMINAL/el_sel_lj_qcd_NOMINAL_Mt_lep_met_c                 el_sel_lj/qcd_other/$SYSTEMATIC/el_sel_lj_qcd_$SYSTEMATIC_Mt_lep_met_c
shapes qcd       el_sel_ljout  fit-stuff/v37_test15_bunchFULLFIT1_HISTOSEL.root  el_sel_ljout/qcd_other/NOMINAL/el_sel_ljout_qcd_NOMINAL_Mt_lep_met_c           el_sel_ljout/qcd_other/$SYSTEMATIC/el_sel_ljout_qcd_$SYSTEMATIC_Mt_lep_met_c


python numbers_for_datacard.py histosels/datafile_v37_test15_bunchFULLFIT1BIN1_HISTOSELS1.root  -d Mt_lep_met_c -c el_sel_lj,el_sel_ljout --data-nick data_other
python numbers_for_datacard.py histosels/datafile_v37_test15_bunchFULLFIT1BIN1_HISTOSELS1.root  -d Mt_lep_met_c -c mu_sel_lj,mu_sel_ljout --data-nick data_other


obs 6690.000000
mc sum = 6851.220294
obs 8414.000000
mc sum = 8821.297920

bin           el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                       el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             
process       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_eltau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_eltau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        12                       13                       14                       15                       16                       17                       18                              0                        3                        4                        5                        6                        7                        8                        9                        12                       13                       14                       15                       16                       17                       18                       
rate          3261.234                 2403.519                 129.315                  185.239                  63.863                   15.511                   161.823                  23.430                   159.969                  0.981                    14.372                   176.465                  29.613                   118.405                  107.481                         5217.944                 1651.873                 87.149                   309.987                  112.089                  35.835                   186.706                  32.157                   303.162                  1.928                    12.859                   223.866                  76.203                   224.576                  344.964                  



grep "^obs" ttxsec/datacard_v37_test15_bunchFULLFIT1_el.txt
observation  6690.000000       8414.000000
grep "^obs" ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.txt
observation  9831.000000       12855.000000



obs 9831.000000
mc sum = 10189.441646
obs 12855.000000
mc sum = 12885.022428

bin           mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                       mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             
process       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                              0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                       
rate          4910.391                 3608.734                 204.639                  271.988                  84.299                   23.138                   219.903                  33.017                   213.240                  0.000                    15.283                   228.671                  8.529                    190.632                  176.977                         7791.608                 2507.052                 142.576                  457.262                  171.572                  54.709                   289.521                  52.217                   440.611                  0.000                    29.676                   364.950                  23.466                   384.198                  175.603                  



python numbers_for_datacard.py histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root  -d Mt_lep_met_c -c el_sel_lj,el_sel_ljout --data-nick data_other
python numbers_for_datacard.py histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root  -d Mt_lep_met_c -c mu_sel_lj,mu_sel_ljout --data-nick data_other

obs 6690.000000
mc sum = 6861.168569
obs 8414.000000
mc sum = 8827.654918

bin           el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                       el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             
process       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_eltau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_eltau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        12                       13                       14                       15                       16                       17                       18                              0                        3                        4                        5                        6                        7                        8                        9                        12                       13                       14                       15                       16                       17                       18                       
rate          3261.234                 2403.519                 129.315                  185.239                  63.863                   15.511                   167.755                  23.972                   164.546                  0.981                    14.372                   176.465                  29.613                   118.405                  106.377                         5217.944                 1651.873                 87.149                   309.987                  112.089                  35.835                   186.706                  32.157                   303.162                  1.928                    12.859                   223.866                  79.913                   228.733                  343.455                  




obs 9831.000000
mc sum = 10203.165384
obs 12855.000000
mc sum = 12889.619626

bin           mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                       mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             
process       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                              0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                       
rate          4910.391                 3608.734                 204.639                  271.988                  84.299                   23.138                   226.131                  34.416                   220.923                  0.000                    15.283                   228.671                  8.529                    190.632                  175.391                         7791.608                 2507.052                 142.576                  457.262                  171.572                  54.709                   289.521                  52.217                   440.611                  0.000                    29.676                   364.950                  23.466                   390.389                  174.009                  




test172:

obs 6702.000000
mc sum = 6876.285164
obs 8436.000000
mc sum = 8850.535531

obs 9843.000000
mc sum = 10220.146489
obs 12891.000000
mc sum = 12921.257513

6702.000000 / 6876.285164
0.9746541686618162
8436.000000 / 8850.535531
0.9531626612256352

9843.000000 / 10220.146489
0.9630977413674133
12891.000000 / 12921.257513
0.9976583151469925

.............. purely shape thing
     which part of the shape?????


check PU norm again

python syst_rates.py --sys-histo ntupler/systematic_weights proc/gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root
               MU_PU             1.013878
             MU_PUUp             0.994845
           MU_PUDown             1.036569
               El_PU             1.031057
             El_PUUp             1.008920
           El_PUDown             1.057174

python syst_rates.py --sys-histo ntupler/systematic_weights proc/gstore_outdirs/v37/WJetsToLNu_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/Ntupler_v37_MC2016_Summer16_WJets_madgraph/190206_135543/0000/*root
               MU_PU             1.013839
             MU_PUUp             0.994828
           MU_PUDown             1.036514
               El_PU             1.030980
             El_PUUp             1.008845
           El_PUDown             1.057099


probably, if you split PU into epochs you have to renormalize it specially too



check PU pull in mu whith TOPPT=1  <---------- might not mean anything! if PU is broken it won't behave even if TOPPT=1

make nll      workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   nn=v37_test15_mu_exp_REPTEST_TOPPT1 freeze="--freezeParameters lumi_13TeV,TOPPT --setParameters TOPPT=1"

make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   nn=v37_test15_mu_REPTEST2_TOPPTf_checkPU freeze="--freezeParameters lumi_13TeV"    &
make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   nn=v37_test15_mu_REPTEST2_TOPPT1_checkPU freeze="--freezeParameters lumi_13TeV,TOPPT --setParameters TOPPT=1"    &

-- PU does not move
   but again, it can be broken, together with the normalization





make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1BIN1_el
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1BIN1_mu

-- Mismatch in normalizations for bin el_sel_lj, process s_top_eltau: rate 164.546000, shape 159.969287


make both mucard=ttxsec/datacard_v37_test15_bunchFULLFIT1BIN1_el elcard=ttxsec/datacard_v37_test15_bunchFULLFIT1BIN1_mu bothcard=ttxsec/datacard_v37_test15_bunchFULLFIT1BIN1_both
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1BIN1_both

combine -M FitDiagnostics   ttxsec/datacard_v37_test15_bunchFULLFIT1BIN1_el.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test15_bunchFULLFIT1BIN1_mu.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test15_bunchFULLFIT1BIN1_both.root

Best fit r: 0.954726  -0.0807631/+0.0889651  (68% CL)
Best fit r: 0.946875  -0.072756/+0.0787322  (68% CL)
Best fit r: 0.967728  -0.070674/+0.0768737  (68% CL)



howww?????



# test20 BIN1

check the electrons:
normalization and shape w.r. to test15

python sumup_ttree_draw.py "event_met_lep_mt" --histo-range 20,0,250 --ttree ttree_out --cond-com "(selection_stage == 19 || selection_stage == 17 || selection_stage == 15)*event_weight"    --output met_lep_control_test20_el_selVloose.root       --histo-name test20_el_selVloose       lstore_outdirs/v37/test20/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "event_met_lep_mt" --histo-range 20,0,250 --ttree ttree_out --cond-com "(selection_stage == 19 || selection_stage == 17 || selection_stage == 15)*event_weight"    --output met_lep_control_test15_el_selVloose.root       --histo-name test15_el_selVloose       lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root     &

python sumup_ttree_draw.py "event_met_lep_mt" --histo-range 20,0,250 --ttree ttree_out --cond-com "(selection_stage ==  9 || selection_stage ==  7 || selection_stage ==  5)*event_weight"    --output met_lep_control_test20_mu_selVloose.root       --histo-name test20_mu_selVloose       lstore_outdirs/v37/test20/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "event_met_lep_mt" --histo-range 20,0,250 --ttree ttree_out --cond-com "(selection_stage ==  9 || selection_stage ==  7 || selection_stage ==  5)*event_weight"    --output met_lep_control_test15_mu_selVloose.root       --histo-name test15_mu_selVloose       lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root     &


mkdir histosels/v37_test20_bunchFULLFIT1BIN1/

make run_histos mc=distrs/distrs_v37_test20_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test15_bunchFULLFIT1BIN1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test20_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=mu_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_lj"      & \
make run_histos mc=distrs/distrs_v37_test20_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test15_bunchFULLFIT1BIN1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test20_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=el_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_lj"      & \
make run_histos mc=distrs/distrs_v37_test20_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test15_bunchFULLFIT1BIN1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test20_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=mu_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_ljout"   & \
make run_histos mc=distrs/distrs_v37_test20_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test15_bunchFULLFIT1BIN1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test20_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=el_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_ljout"   & \

make run_histos mc=distrs/distrs_v37_test20_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test15_bunchFULLFIT1BIN1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test20_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=mu_sel_lj        systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_lj"     & \
make run_histos mc=distrs/distrs_v37_test20_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test15_bunchFULLFIT1BIN1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test20_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=el_sel_lj        systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_lj"     & \
make run_histos mc=distrs/distrs_v37_test20_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test15_bunchFULLFIT1BIN1/SingleMuon.root     lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test20_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=mu_sel_ljout     systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_ljout"  & \
make run_histos mc=distrs/distrs_v37_test20_bunchFULLFIT1BIN1_mc1.root data=distrs/v37_test15_bunchFULLFIT1BIN1/SingleElectron.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test20_bunchFULLFIT1BIN1/ wjets_norm=1.4 chan=el_sel_ljout     systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_ljout"  & \

hadd datafile_v37_test20_bunchFULLFIT1BIN1_HISTOSELS1.root histosels/v37_test20_bunchFULLFIT1BIN1/*root



cp ttxsec/datacard_v37_test15_bunchFULLFIT1BIN1_el.txt ttxsec/datacard_v37_test20_bunchFULLFIT1BIN1_el.txt
cp ttxsec/datacard_v37_test15_bunchFULLFIT1BIN1_mu.txt ttxsec/datacard_v37_test20_bunchFULLFIT1BIN1_mu.txt


vim -p ttxsec/datacard_v37_test20_bunchFULLFIT1BIN1_el.txt ttxsec/datacard_v37_test20_bunchFULLFIT1BIN1_mu.txt

shapes qcd       el_sel_lj     fit-stuff/v37_test20_bunchFULLFIT1_HISTOSEL.root  el_sel_lj/qcd_other/NOMINAL/el_sel_lj_qcd_NOMINAL_Mt_lep_met_c                 el_sel_lj/qcd_other/$SYSTEMATIC/el_sel_lj_qcd_$SYSTEMATIC_Mt_lep_met_c
shapes qcd       el_sel_ljout  fit-stuff/v37_test20_bunchFULLFIT1_HISTOSEL.root  el_sel_ljout/qcd_other/NOMINAL/el_sel_ljout_qcd_NOMINAL_Mt_lep_met_c           el_sel_ljout/qcd_other/$SYSTEMATIC/el_sel_ljout_qcd_$SYSTEMATIC_Mt_lep_met_c


python numbers_for_datacard.py histosels/datafile_v37_test20_bunchFULLFIT1BIN1_HISTOSELS1.root  -d Mt_lep_met_c -c el_sel_lj,el_sel_ljout --data-nick data_other
python numbers_for_datacard.py histosels/datafile_v37_test20_bunchFULLFIT1BIN1_HISTOSELS1.root  -d Mt_lep_met_c -c mu_sel_lj,mu_sel_ljout --data-nick data_other



obs 6690.000000
mc sum = 6851.017315

obs 8414.000000
mc sum = 8798.990924

bin           el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                       el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             
process       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_eltau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_eltau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        12                       13                       14                       15                       16                       17                       18                              0                        3                        4                        5                        6                        7                        8                        9                        12                       13                       14                       15                       16                       17                       18                       
rate          3256.908                 2402.510                 129.463                  184.964                  63.698                   15.427                   167.535                  23.932                   164.159                  0.982                    11.949                   174.400                  29.769                   118.131                  107.189                         5194.214                 1655.026                 87.311                   308.340                  113.105                  35.667                   186.973                  32.089                   301.632                  1.852                    12.860                   220.195                  79.876                   227.721                  342.130                  






[olek@fermi05 jobsums]$ python numbers_for_datacard.py histosels/datafile_v37_test20_bunchFULLFIT1BIN1_HISTOSELS1.root  -d Mt_lep_met_c -c mu_sel_lj,mu_sel_ljout --data-nick data_other

obs 9831.000000
mc sum = 10162.738523

obs 12855.000000
mc sum = 12813.486516

bin           mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                       mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             
process       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                              0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                       
rate          4888.060                 3594.730                 203.579                  270.983                  83.465                   22.937                   224.789                  34.192                   219.830                  0.000                    15.198                   221.654                  8.871                    189.804                  184.646                         7734.791                 2506.049                 142.550                  453.715                  171.880                  54.265                   289.423                  51.891                   436.840                  0.000                    26.796                   358.548                  23.314                   387.794                  175.630                  









make workspace datacard=ttxsec/datacard_v37_test20_bunchFULLFIT1BIN1_el
make workspace datacard=ttxsec/datacard_v37_test20_bunchFULLFIT1BIN1_mu

-- Mismatch in normalizations for bin el_sel_lj, process s_top_eltau: rate 164.546000, shape 159.969287


make both mucard=ttxsec/datacard_v37_test20_bunchFULLFIT1BIN1_el elcard=ttxsec/datacard_v37_test20_bunchFULLFIT1BIN1_mu bothcard=ttxsec/datacard_v37_test20_bunchFULLFIT1BIN1_both
make workspace datacard=ttxsec/datacard_v37_test20_bunchFULLFIT1BIN1_both

combine -M FitDiagnostics   ttxsec/datacard_v37_test20_bunchFULLFIT1BIN1_el.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test20_bunchFULLFIT1BIN1_mu.root
combine -M FitDiagnostics   ttxsec/datacard_v37_test20_bunchFULLFIT1BIN1_both.root

old:

Best fit r: 0.954726  -0.0807631/+0.0889651  (68% CL)
Best fit r: 0.946875  -0.072756/+0.0787322  (68% CL)
Best fit r: 0.967728  -0.070674/+0.0768737  (68% CL)

now:

Best fit r: 0.954104  -0.0799465/+0.0878753  (68% CL)
Best fit r: 0.946333  -0.0711769/+0.0789428  (68% CL)
Best fit r: 0.968751  -0.069108/+0.0763255  (68% CL)

-- no difference?!

combine -M FitDiagnostics   ttxsec/datacard_v37_test20_bunchFULLFIT1BIN1_mu.root --freezeParameters lumi_13TeV,TOPPT --setParameters TOPPT=1

Best fit r: 0.958599  -0.0665209/+0.0729311  (68% CL)

-- well... now it is even more broken



# test172 plotted BIN1










# any remaining old problems

el energy scale? -- why did it never show up?
tau eta < 2.3    -- negligible difference
jet or bjet eta? -- negligibly reduces MC
met trends?      -- in presel TOPPT would not fix the data-mc difference in mu and el
DY dileps eta    -- electrons had more deviation than muons
what else?

what if jer must be propagated from all jets, not just the passing ones?
-- test173
a problem with prop tau?
a problem with METMuEGClean for data? -- when checked the difference was negligible


difference in tt

python sumup_ttree_draw.py "event_met_lep_mt" --histo-range 20,0,250 --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight"    --output met_lep_prop_test_MT_in_v37_test173_mu_selVloose.root       --histo-name mt_lep_met_test173_mu_selVloose       lstore_outdirs/v37/test173/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "event_met_lep_mt" --histo-range 20,0,250 --ttree ttree_out --cond-com "(selection_stage == 19 || selection_stage == 17 || selection_stage == 15)*event_weight" --output met_lep_prop_test_MT_in_v37_test173_el_selVloose.root       --histo-name mt_lep_met_test173_el_selVloose       lstore_outdirs/v37/test173/MC2016_Summer16_TTJets_powheg/*root     &

hadd -f met_lep_prop_test_MT_all_v37_tests.root met_lep_prop_test_MT_in_v37_test15*.root met_lep_prop_test_MT_in_v37_test16*.root met_lep_prop_test_MT_in_v37_test17*.root

root -l met_lep_prop_test_MT_all_v37_tests.root

mt_lep_met_test15_el_selVloose ->Scale(1./mt_lep_met_test15_el_selVloose ->Integral())
mt_lep_met_test15_mu_selVloose ->Scale(1./mt_lep_met_test15_mu_selVloose ->Integral())
mt_lep_met_test173_el_selVloose->Scale(1./mt_lep_met_test173_el_selVloose->Integral())
mt_lep_met_test173_mu_selVloose->Scale(1./mt_lep_met_test173_mu_selVloose->Integral())

mt_lep_met_test173_el_selVloose->Divide( mt_lep_met_test15_el_selVloose)
mt_lep_met_test173_mu_selVloose->Divide( mt_lep_met_test15_mu_selVloose)

mt_lep_met_test173_el_selVloose->Draw()
mt_lep_met_test173_mu_selVloose->Draw()

negligible variations at sub percent level
but can they shift the fit in muons?
-- full MC




# the problem with the fit in muon channel

TOPPT is not pulled up, therefor the signal strangth is lower than in the fit in both channels

reproduce

correlations do not show anything useful???
the parameters affected by setting TOPPPT=1 --- freezing them does not set TOPPT to 1?
    freezing sets them to zero, which is not correct
    --- save all these parameters in NLL scan, check their correlation with TOPPT

--- check FSR variations?
    they affect mis-ID, which affects the signal at low Mt


make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   nn=v37_test15_mu_exp_REPTEST
make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   nn=v37_test15_mu_exp_REPTEST_TOPPT1 freeze="--freezeParameters lumi_13TeV       --setParameters TOPPT=1"
make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   nn=v37_test15_mu_exp_REPTEST_TOPPT1 freeze="--freezeParameters lumi_13TeV,TOPPT --setParameters TOPPT=1"

TOPPT correlations:

+0.29 signal
-0.10 wjets norm
-0.09 tau fakes
+0.09 Frag
-0.08 PU
+0.08 tau ID

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   nn=v37_test15_mu_exp_REPTEST options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff,wjets_norm,Frag,PU"

 POI: r= 0.945318 -> [0.5,1.5]

root -l higgsCombinev37_test15_mu_exp_REPTEST.MultiDimFit.mH120.root

limit->Draw("2*deltaNLL:TOPPT",     "deltaNLL>0 && 2*deltaNLL<10", "L")
limit->Draw("2*deltaNLL:TOPPT:r",     "deltaNLL>0 && 2*deltaNLL<10", "cont")


try to relax the gaussian constraint

cp ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.txt  ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_TOPPT3.txt
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_TOPPT3
make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_TOPPT3.root   nn=v37_test15_mu_exp_REPTEST_TOPPT3 options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff,wjets_norm,Frag,PU"

 POI: r= 0.954292 -> [0.5,1.5]

still not 0.96
and some interruption in
limit->Draw("2*deltaNLL:TOPPT",     "deltaNLL>0 && 2*deltaNLL<10", "L")


remove FSR from signal

cp ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.txt  ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noSigFSR.txt
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noSigFSR
make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noSigFSR.root   nn=v37_test15_mu_exp_REPTEST_noSigFSR options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff,wjets_norm,Frag,PU"

 POI: r= 0.948681 -> [0.5,1.5]

freezing FSR also did not help?

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noSigFSR.root   nn=v37_test15_mu_exp_REPTEST_noSigFSR options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff,wjets_norm,Frag,PU" freeze="--freezeParameters lumi_13TeV,FSR"

 POI: r= 0.951209 -> [0.5,1.5]

root -l higgsCombinev37_test15_mu_exp_REPTEST_noSigFSR.MultiDimFit.mH120.root
limit->Draw("2*deltaNLL:TOPPT",     "deltaNLL>0 && 2*deltaNLL<10", "L")
at  0.3
and 1.0 is about 2sigma away (2*deltaNLL = 4)


check separate Mt lj ljout plots!


## signal correlations

some systematic substitutes TOPPT in correcting the bins
find them by
1) post-fit values
2) signal correlations

post fit values

fitted                                                                                            set
name                                              b-only fit         rho            s+b fit           s+b fit         rho         name                                              b-only fit      
FSR                                           ! -5.95, 0.28!       -0.27        +0.31, 0.79       +0.31, 0.78       -0.28         FSR                                           ! -6.03, 0.28!      

Frag                                             -0.97, 0.89       +0.25        +0.09, 1.04       +0.16, 1.03       +0.26         Frag                                             -0.94, 0.87      

HDAMP                                            -1.07, 0.63       -0.06        -0.40, 0.97       -0.40, 0.97       -0.06         HDAMP                                            -1.09, 0.63      
ISR                                           ! -2.53, 0.91!       +0.21        -0.28, 0.98       -0.29, 0.98       +0.22         ISR                                           ! -2.57, 0.90!      
JER                                           ! -0.14, 0.41!       -0.05        +0.64, 0.90       +0.62, 0.91       -0.04         JER                                           ! -0.15, 0.41!      
JES                                           ! -0.06, 0.18!       +0.11        +0.54, 0.55       +0.56, 0.55       +0.10         JES                                           ! -0.05, 0.17!      
Mf                                               -0.21, 0.74       +0.00        +0.07, 0.92       +0.05, 1.03       +0.02         Mf                                               -0.24, 0.76      

Mfr                                              -0.06, 0.55       -0.13        -0.10, 1.03       -0.01, 1.15       -0.17         Mfr                                              -0.13, 0.55      
Mr                                               +0.11, 0.80       -0.11        -0.11, 0.96       +0.00, 0.96       -0.14         Mr                                               +0.02, 0.83      

PU                                               +0.39, 0.77       -0.34        -0.29, 0.97       -0.34, 0.94       -0.32         PU                                               +0.43, 0.75      

Peterson                                         -0.02, 0.70       +0.06        -0.04, 1.09       -0.01, 1.18       +0.08         Peterson                                         +0.04, 0.77      
SemilepBR                                        +0.49, 0.93       +0.01        +0.00, 0.81       +0.00, 0.79       +0.01         SemilepBR                                        +0.45, 0.80      
TES                                              +0.95, 0.62       -0.07        -0.07, 0.72       -0.09, 0.77       -0.07         TES                                              +0.95, 0.63      
TuneCUETP8M2T4                                   +0.78, 0.86       +0.07        -0.04, 0.97       -0.00, 0.97       +0.07         TuneCUETP8M2T4                                   +0.80, 0.86      
bSF                                              -0.84, 0.91       -0.14        +0.41, 0.94       +0.43, 0.94       -0.16         bSF                                              -0.81, 0.91      
dy_norm                                          -0.57, 0.97       +0.08        -0.09, 0.98       -0.05, 0.98       +0.06         dy_norm                                          -0.54, 0.97      
qcd_norm                                         -0.57, 0.88       +0.06        -0.35, 0.91       -0.31, 0.91       +0.04         qcd_norm                                         -0.51, 0.88      

tauID_eff                                        -0.74, 0.94       -0.61        -0.11, 0.96       -0.04, 0.96       -0.67         tauID_eff                                        -0.66, 0.94      

tau_fakes                                     ! +4.14, 0.21!       +0.30        -0.25, 0.60       -0.28, 0.59       +0.34         tau_fakes                                     ! +4.12, 0.21!      

wjets_norm                                       -0.18, 0.92       -0.09        +0.42, 0.97       +0.34, 0.95       -0.06         wjets_norm                                       -0.22, 0.91      

TOPPT                                         ! -0.12, 0.43!       +0.29        +0.37, 0.70

-- the "s+b fit" gives " %+4.2f, %4.2f" % (valShift, sigShift)
   where
   valShift = (nuis_x.getVal() - mean_p)/sigma_p
   sigShift =  nuis_x.getError()/sigma_p

                        # calculate the difference of the nuisance parameter
                        # w.r.t to the prefit value in terms of the uncertainty
                        # on the prefit value
                        valShift = (nuis_x.getVal() - mean_p)/sigma_p

correlations

make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC
combine -M FitDiagnostics ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.root --plots --saveShapes --saveWithUncertainties --name v37_test15_mu_exp_REPEAT_covariances --freezeNuisanceGroup tt_th_pdf
combine -M FitDiagnostics ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.root --plots --saveShapes --saveWithUncertainties --name v37_test15_mu_exp_REPEAT_covariances --freezeNuisanceGroup tt_th_pdf_only

root -l fitDiagnosticsv37_test15_mu_exp_REPEAT_covariances.root
gStyle->SetPaintTextFormat("1.2f")
covariance_fit_s->SetMarkerSize(1.)
covariance_fit_s->Draw("colz text")

signal correlations:

-0.58 tau ID
-0.32 PU
+0.31 tau fakes
+0.26 TOPPT
-0.25 FSR
+0.24 Frag
+0.20 ISR
+0.13 JES
-0.13 bSF
-0.13 Mfr
-0.11 Mr
-0.09 wjets



### check postfit values when TOPPT = 1 VS the fitted value?

combine -M FitDiagnostics ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.root   --name v37_test15_mu_exp_noMC_pulls_fitted    --noMCbonly 0 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf_only
python ttxsec/fit-stuff/diffNuisances.py fitDiagnosticsv37_test15_mu_exp_noMC_pulls_fitted.root -g pulls_of_nuisances_v37_test15_mu_exp_noMC_pulls_fitted.root   -o

Best fit r: 0.947316  -0.0683456/+0.0727285  (68% CL)

combine -M FitDiagnostics ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.root   --name v37_test15_mu_exp_noMC_pulls_set    --noMCbonly 0 --freezeParameters lumi_13TeV,TOPPT --freezeNuisanceGroup tt_th_pdf_only --setParameters TOPPT=1
python ttxsec/fit-stuff/diffNuisances.py fitDiagnosticsv37_test15_mu_exp_noMC_pulls_set.root -g pulls_of_nuisances_v37_test15_mu_exp_noMC_pulls_set.root   -o

Best fit r: 0.963743  -0.0662516/+0.0712771  (68% CL)

fitted                                                                                            set
name                                              b-only fit         rho            s+b fit           s+b fit         rho         name                                              b-only fit      
FSR                                           ! -5.95, 0.28!       -0.27        +0.31, 0.79       +0.31, 0.78       -0.28         FSR                                           ! -6.03, 0.28!      
Frag                                             -0.97, 0.89       +0.25        +0.09, 1.04       +0.16, 1.03       +0.26         Frag                                             -0.94, 0.87      
HDAMP                                            -1.07, 0.63       -0.06        -0.40, 0.97       -0.40, 0.97       -0.06         HDAMP                                            -1.09, 0.63      
ISR                                           ! -2.53, 0.91!       +0.21        -0.28, 0.98       -0.29, 0.98       +0.22         ISR                                           ! -2.57, 0.90!      
JER                                           ! -0.14, 0.41!       -0.05        +0.64, 0.90       +0.62, 0.91       -0.04         JER                                           ! -0.15, 0.41!      
JES                                           ! -0.06, 0.18!       +0.11        +0.54, 0.55       +0.56, 0.55       +0.10         JES                                           ! -0.05, 0.17!      
Mf                                               -0.21, 0.74       +0.00        +0.07, 0.92       +0.05, 1.03       +0.02         Mf                                               -0.24, 0.76      
Mfr                                              -0.06, 0.55       -0.13        -0.10, 1.03       -0.01, 1.15       -0.17         Mfr                                              -0.13, 0.55      
Mr                                               +0.11, 0.80       -0.11        -0.11, 0.96       +0.00, 0.96       -0.14         Mr                                               +0.02, 0.83      
PU                                               +0.39, 0.77       -0.34        -0.29, 0.97       -0.34, 0.94       -0.32         PU                                               +0.43, 0.75      
Peterson                                         -0.02, 0.70       +0.06        -0.04, 1.09       -0.01, 1.18       +0.08         Peterson                                         +0.04, 0.77      
SemilepBR                                        +0.49, 0.93       +0.01        +0.00, 0.81       +0.00, 0.79       +0.01         SemilepBR                                        +0.45, 0.80      
TES                                              +0.95, 0.62       -0.07        -0.07, 0.72       -0.09, 0.77       -0.07         TES                                              +0.95, 0.63      
TuneCUETP8M2T4                                   +0.78, 0.86       +0.07        -0.04, 0.97       -0.00, 0.97       +0.07         TuneCUETP8M2T4                                   +0.80, 0.86      
bSF                                              -0.84, 0.91       -0.14        +0.41, 0.94       +0.43, 0.94       -0.16         bSF                                              -0.81, 0.91      
dy_norm                                          -0.57, 0.97       +0.08        -0.09, 0.98       -0.05, 0.98       +0.06         dy_norm                                          -0.54, 0.97      
qcd_norm                                         -0.57, 0.88       +0.06        -0.35, 0.91       -0.31, 0.91       +0.04         qcd_norm                                         -0.51, 0.88      
tauID_eff                                        -0.74, 0.94       -0.61        -0.11, 0.96       -0.04, 0.96       -0.67         tauID_eff                                        -0.66, 0.94      
tau_fakes                                     ! +4.14, 0.21!       +0.30        -0.25, 0.60       -0.28, 0.59       +0.34         tau_fakes                                     ! +4.12, 0.21!      
wjets_norm                                       -0.18, 0.92       -0.09        +0.42, 0.97       +0.34, 0.95       -0.06         wjets_norm                                       -0.22, 0.91      

TOPPT                                         ! -0.12, 0.43!       +0.29        +0.37, 0.70

-- b Frag, wjets_norm, Mfr, Mr

freeze them

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.root   nn=v37_test15_mu_exp_noMC_noFSR    options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff --freezeNuisanceGroup tt_th_pdf_only" freeze="--freezeParameters lumi_13TeV,Frag,wjets_norm,Mfr,Mr"

 POI: r= 0.946315 -> [0.5,1.5]

-- freezing Frag should worsen things

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.root   nn=v37_test15_mu_exp_noMC_noFSR    options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff --freezeNuisanceGroup tt_th_pdf_only" freeze="--freezeParameters lumi_13TeV,wjets_norm,Mfr,Mr"

 POI: r= 0.947853 -> [0.5,1.5]


make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.root   nn=v37_test15_mu_exp_noMC_noFSR    options="--saveSpecifiedNuis tau_fakes,tauID_eff --freezeNuisanceGroup tt_th_pdf_only" freeze="--freezeParameters lumi_13TeV,TOPPT --setParameters TOPPT=1."

 POI: r= 0.963748 -> [0.5,1.5]

set FSR to 0.16

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.root   nn=v37_test15_mu_exp_noMC_noFSR    options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff --freezeNuisanceGroup tt_th_pdf_only" freeze="--freezeParameters lumi_13TeV,FSR --setParameters FSR=0.16"

 POI: r= 0.9509 -> [0.5,1.5]

-- not enough

limit->Draw("2*deltaNLL:r",         "deltaNLL>0 && 2*deltaNLL<10", "L")
limit->Draw("2*deltaNLL:TOPPT",     "deltaNLL>0 && 2*deltaNLL<10", "L")

at 0.35

set Mfr and Mr to 0.0

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.root   nn=v37_test15_mu_exp_noMC_noFSR    options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff --freezeNuisanceGroup tt_th_pdf_only" freeze="--freezeParameters lumi_13TeV,FSR,Mfr,Mr --setParameters FSR=0.16,Mfr=0.0,Mr=0.0"

 POI: r= 0.94901 -> [0.5,1.5]

-- ???



those are deviations from prefit value relative to prefit sigma
-- set 1.16 and 1.0

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.root   nn=v37_test15_mu_exp_noMC_noFSR    options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff --freezeNuisanceGroup tt_th_pdf_only" freeze="--freezeParameters lumi_13TeV,FSR --setParameters FSR=1.16"

 POI: r= 0.924019 -> [0.5,1.5]

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.root   nn=v37_test15_mu_exp_noMC_noFSR    options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff --freezeNuisanceGroup tt_th_pdf_only" freeze="--freezeParameters lumi_13TeV,FSR,Mfr,Mr --setParameters FSR=1.16,Mfr=1.0,Mr=1.0"

 POI: r= 0.904484 -> [0.5,1.5]

wtf?

and TOPPT = 0.6!!!?

not FSR! Frag

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.root   nn=v37_test15_mu_exp_noMC_noFSR    options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff --freezeNuisanceGroup tt_th_pdf_only" freeze="--freezeParameters lumi_13TeV,Frag --setParameters Frag=1.16"

 POI: r= 0.967048 -> [0.5,1.5]

this is it!

and TOPPT is only around 0.43


just to test:

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.root   nn=v37_test15_mu_exp_noMC_noFSR    options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff --freezeNuisanceGroup tt_th_pdf_only" freeze="--freezeParameters lumi_13TeV,Frag --setParameters Frag=0.16"

 POI: r= 0.948551 -> [0.5,1.5]


see the effect of Frag
-- FragUp reduces all MC


return Frag to 1.0

cp ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC_fullFrag.txt

make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC_fullFrag

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC_fullFrag.root   nn=v37_test15_mu_exp_noMC_fullFrag    options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff,Frag --freezeNuisanceGroup tt_th_pdf_only" freeze="--freezeParameters lumi_13TeV"

 POI: r= 0.950632 -> [0.5,1.5]

-- TOPPT 0.38
   Frag  0.1

the rest of frags:

cp ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC_fullFrag2.txt

make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC_fullFrag2
make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC_fullFrag2.root   nn=v37_test15_mu_exp_noMC_fullFrag2    options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff,Frag --freezeNuisanceGroup tt_th_pdf_only" freeze="--freezeParameters lumi_13TeV"

 POI: r= 0.950709 -> [0.5,1.5]

cp ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC_fullFrag3.txt

make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC_fullFrag3
make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC_fullFrag3.root   nn=v37_test15_mu_exp_noMC_fullFrag3    options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff,Frag --freezeNuisanceGroup tt_th_pdf_only" freeze="--freezeParameters lumi_13TeV"

 POI: r= 0.957041 -> [0.5,1.5]

-- this will lead to unreasonable large uncertainty

bt_sig  = 0.961


what if both problems, the unphysical TOPPT in muons and the bend in electrons, are the same?
-- they are due to some mistake in handling lepton jets



### check how lepton jets are handled now, check the variations

{in the past some procedure for lepton jets drastically and unreasonably increased the data-mc difference
 maybe it was due to that one error in jet-met propagation, which was fixed in data?}

https://twiki.cern.ch/twiki/bin/view/CMSPublic/WorkBookMetAnalysis#Type_I_Correction

MET = - JEC jets - unclustered particles

probably the unclustered include the isolated leptons

so, in principle, the inly thing to propagate is the recalculated JER
and it is not propagated now by default

resub test16

and 2 test files:

output written, time elapsed 0:21:13.794651
output written, time elapsed 0:21:15.613446

root -l temp/MC2016_Summer16_TTJets_powheg_84.root
root -l temp/2/MC2016_Summer16_TTJets_powheg_84.root

ttree_out->Draw("event_met_lep_mt>>h(20,0,250)", "selection_stage == 9 || selection_stage == 7")

h_ = (TH1D*) ttree_out->GetHistogram()

h_nom = (TH1D*) h_->Clone()
h_nom->SetDirectory(0)


h_nom->SetName("nom")
out_file  = (TFile*) new TFile("met_lepjet_prop_test_nominal.root", "RECREATE")


h_nom->SetDirectory(out_file)

out_file->Write()
out_file->Close()


h_nom->SetName("lepjet")
out_file  = (TFile*) new TFile("met_lepjet_prop_test_lepjet.root", "RECREATE")


hadd -f met_lepjet_prop_test_all.root met_lepjet_prop_test_lepjet.root met_lepjet_prop_test_nominal.root

root -l met_lepjet_prop_test_all.root

lepjet->SetLineColor(kRed)

lepjet->Draw()
nom->Draw("same")

lepjet->Divide(nom)
lepjet->Draw()

met with no conditions on events
--- sub percent deviation?

mt with mu_sel condition
--- fluctuations

python sumup_ttree_draw.py "event_met_lep_mt" --histo-range 20,0,250 --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7)*event_weight" --output met_lep_prop_test_MT_in_v37_test15.root       --histo-name mt_lep_met_test15       lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "event_met_lep_mt" --histo-range 20,0,250 --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7)*event_weight" --output met_lep_prop_test_MT_in_v37_test16.root       --histo-name mt_lep_met_test16       lstore_outdirs/v37/test16/MC2016_Summer16_TTJets_powheg/*root     &

python sumup_ttree_draw.py "event_met_lep_mt" --histo-range 20,0,250 --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight"    --output met_lep_prop_test_MT_in_v37_test15_mu_selVloose.root       --histo-name mt_lep_met_test15_mu_selVloose       lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "event_met_lep_mt" --histo-range 20,0,250 --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight"    --output met_lep_prop_test_MT_in_v37_test16_mu_selVloose.root       --histo-name mt_lep_met_test16_mu_selVloose       lstore_outdirs/v37/test16/MC2016_Summer16_TTJets_powheg/*root     &

python sumup_ttree_draw.py "event_met_lep_mt" --histo-range 20,0,250 --ttree ttree_out --cond-com "(selection_stage == 19 || selection_stage == 17 || selection_stage == 15)*event_weight" --output met_lep_prop_test_MT_in_v37_test15_el_selVloose.root       --histo-name mt_lep_met_test15_el_selVloose       lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "event_met_lep_mt" --histo-range 20,0,250 --ttree ttree_out --cond-com "(selection_stage == 19 || selection_stage == 17 || selection_stage == 15)*event_weight" --output met_lep_prop_test_MT_in_v37_test16_el_selVloose.root       --histo-name mt_lep_met_test16_el_selVloose       lstore_outdirs/v37/test16/MC2016_Summer16_TTJets_powheg/*root     &

hadd -f met_lep_prop_test_MT_all_v37_tests.root met_lep_prop_test_MT_in_v37_test15*.root met_lep_prop_test_MT_in_v37_test16*.root

root -l met_lep_prop_test_MT_all_v37_tests.root

mt_lep_met_test15
mt_lep_met_test15_el_selVloose
mt_lep_met_test15_mu_selVloose

mt_lep_met_test16                ->SetLineColor(kRed)
mt_lep_met_test16_el_selVloose   ->SetLineColor(kRed)
mt_lep_met_test16_mu_selVloose   ->SetLineColor(kRed)

mt_lep_met_test15->Draw()
mt_lep_met_test16->Draw("same")
mt_lep_met_test15_el_selVloose->Draw()
mt_lep_met_test16_el_selVloose->Draw("same")
mt_lep_met_test15_mu_selVloose->Draw()
mt_lep_met_test16_mu_selVloose->Draw("same")


mt_lep_met_test16->Divide( mt_lep_met_test15)
mt_lep_met_test16_el_selVloose->Divide( mt_lep_met_test15_el_selVloose)
mt_lep_met_test16_mu_selVloose->Divide( mt_lep_met_test15_mu_selVloose)

mt_lep_met_test16             ->Draw()
mt_lep_met_test16_el_selVloose->Draw()
mt_lep_met_test16_mu_selVloose->Draw()

-- slight rise of Mt, 1-2%
   I don't see a bend-like change


noooooooooooooooooooooo!
it's not in JER!
JER should not be done on the lep jet, neither propagated to MET!
lep jet is a phantom object that should not exist and neither should its' part in MET.
JES of the lep jet included in the Type1 MET must also be removed.

so, there are 2 options:
1) try to remove only the JES correction
2) try to remove the whole jet from MET

-- and these are done both in Data and MC?

check JES factor in Data and MC

root -l gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/MC2016_Summer16_TTJets_powheg_1.root

root -l gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/Data13TeV_SingleMuon2016H_03Feb2017_ver2_1.root

ntupler->Get("reduced_ttree")->Draw("jet_uncorrected_jecFactor[0]")

-- present in both

test:

ntupler->Get("reduced_ttree")->Draw("jet_uncorrected_jecFactor[0]*jet_jes_recorrection[0]")

= 1 in both

so 1) is done by 1 - jet_uncorrected_jecFactor


test17 and test18
-- proper handling of lep jet

test17

python sumup_ttree_draw.py "event_met_lep_mt" --histo-range 20,0,250 --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight"    --output met_lep_prop_test_MT_in_v37_test17_mu_selVloose.root       --histo-name mt_lep_met_test17_mu_selVloose       lstore_outdirs/v37/test17/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "event_met_lep_mt" --histo-range 20,0,250 --ttree ttree_out --cond-com "(selection_stage == 19 || selection_stage == 17 || selection_stage == 15)*event_weight" --output met_lep_prop_test_MT_in_v37_test17_el_selVloose.root       --histo-name mt_lep_met_test17_el_selVloose       lstore_outdirs/v37/test17/MC2016_Summer16_TTJets_powheg/*root     &

test18

python sumup_ttree_draw.py "event_met_lep_mt" --histo-range 20,0,250 --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight"    --output met_lep_prop_test_MT_in_v37_test18_mu_selVloose.root       --histo-name mt_lep_met_test18_mu_selVloose       lstore_outdirs/v37/test18/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "event_met_lep_mt" --histo-range 20,0,250 --ttree ttree_out --cond-com "(selection_stage == 19 || selection_stage == 17 || selection_stage == 15)*event_weight" --output met_lep_prop_test_MT_in_v37_test18_el_selVloose.root       --histo-name mt_lep_met_test18_el_selVloose       lstore_outdirs/v37/test18/MC2016_Summer16_TTJets_powheg/*root     &

hadd -f met_lep_prop_test_MT_all_v37_tests.root met_lep_prop_test_MT_in_v37_test1*.root

root -l met_lep_prop_test_MT_all_v37_tests.root

mt_lep_met_test15_el_selVloose
mt_lep_met_test15_mu_selVloose

mt_lep_met_test16_el_selVloose   ->SetLineColor(kRed)
mt_lep_met_test16_mu_selVloose   ->SetLineColor(kRed)

mt_lep_met_test15->Draw()
mt_lep_met_test16->Draw("same")
mt_lep_met_test15_el_selVloose->Draw()
mt_lep_met_test16_el_selVloose->Draw("same")
mt_lep_met_test15_mu_selVloose->Draw()
mt_lep_met_test16_mu_selVloose->Draw("same")


mt_lep_met_test16->Divide( mt_lep_met_test15)
mt_lep_met_test16_el_selVloose->Divide( mt_lep_met_test15_el_selVloose)
mt_lep_met_test16_mu_selVloose->Divide( mt_lep_met_test15_mu_selVloose)

normalize, since some jobs are missing:

mt_lep_met_test15_el_selVloose->Scale(1./mt_lep_met_test15_el_selVloose->Integral())
mt_lep_met_test15_mu_selVloose->Scale(1./mt_lep_met_test15_mu_selVloose->Integral())

mt_lep_met_test17_el_selVloose->Scale(1./mt_lep_met_test17_el_selVloose->Integral())
mt_lep_met_test17_mu_selVloose->Scale(1./mt_lep_met_test17_mu_selVloose->Integral())

mt_lep_met_test18_el_selVloose->Scale(1./mt_lep_met_test18_el_selVloose->Integral())
mt_lep_met_test18_mu_selVloose->Scale(1./mt_lep_met_test18_mu_selVloose->Integral())



mt_lep_met_test17_el_selVloose->Divide( mt_lep_met_test15_el_selVloose)
mt_lep_met_test17_mu_selVloose->Divide( mt_lep_met_test15_mu_selVloose)

mt_lep_met_test18_el_selVloose->Divide( mt_lep_met_test15_el_selVloose)
mt_lep_met_test18_mu_selVloose->Divide( mt_lep_met_test15_mu_selVloose)

mt_lep_met_test17_el_selVloose->Draw()
mt_lep_met_test17_mu_selVloose->Draw()

mt_lep_met_test18_el_selVloose->Draw()
mt_lep_met_test18_mu_selVloose->Draw("same")

-- 17 strong shift to smaller values, linear +8% to -12%, flattens at very large values, similar el and mu
   18 very stron shift, non linear shape +150% to -75%, flattens at very large values

these shifts propagate to data too, so the final effect is hard to estimate
finish both procedures, test17 first


### test17 plots

python stack_plot.py distrs/distrs_v37_test17_bunchFULLFIT1_mc1.root distrs/v37_test17_bunchFULLFIT1/SingleElectron.root  -o plots/v37_test17_bunchFULLFIT1_mc1/ --data-nick data_other --overwrite -p -r -c el_sel -x el_selVloose --qcd 1.05 --wjets 1.4 -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,250.  --lumi 35800 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend
python stack_plot.py distrs/distrs_v37_test17_bunchFULLFIT1_mc1.root distrs/v37_test17_bunchFULLFIT1/SingleMuon.root      -o plots/v37_test17_bunchFULLFIT1_mc1/ --data-nick data_other --overwrite -p -r -c mu_sel -x mu_selVloose --qcd 1.05 --wjets 1.4 -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,375.  --lumi 35800 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend

-- el is muc better?

python stack_plot.py distrs/distrs_v37_test17_bunchFULLFIT1_mc1.root distrs/v37_test17_bunchFULLFIT1/SingleElectron.root  -o plots/v37_test17_bunchFULLFIT1_mc1/ --data-nick data_other --overwrite -p -r -c el_sel_lj    -x el_selVloose_lj    --qcd 1.05 --wjets 1.4 -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,250.  --lumi 35800 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend
python stack_plot.py distrs/distrs_v37_test17_bunchFULLFIT1_mc1.root distrs/v37_test17_bunchFULLFIT1/SingleMuon.root      -o plots/v37_test17_bunchFULLFIT1_mc1/ --data-nick data_other --overwrite -p -r -c mu_sel_lj    -x mu_selVloose_lj    --qcd 1.05 --wjets 1.4 -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,375.  --lumi 35800 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend

python stack_plot.py distrs/distrs_v37_test17_bunchFULLFIT1_mc1.root distrs/v37_test17_bunchFULLFIT1/SingleElectron.root  -o plots/v37_test17_bunchFULLFIT1_mc1/ --data-nick data_other --overwrite -p -r -c el_sel_ljout -x el_selVloose_ljout --qcd 1.05 --wjets 1.4 -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,250.  --lumi 35800 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend
python stack_plot.py distrs/distrs_v37_test17_bunchFULLFIT1_mc1.root distrs/v37_test17_bunchFULLFIT1/SingleMuon.root      -o plots/v37_test17_bunchFULLFIT1_mc1/ --data-nick data_other --overwrite -p -r -c mu_sel_ljout -x mu_selVloose_ljout --qcd 1.05 --wjets 1.4 -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,375.  --lumi 35800 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend

evince plots/v37_test17_bunchFULLFIT1_mc1//distrs,distrs_v37_test*_lj*

-- looks kind of the same as before,
   in el the bend is broken but in another weird way, no trend though
   in mu both categories have similar slope and linearity, ljout has smaller slope than lj

compare to test15

mkdir -p plots/v37_test15_bunchFULLFIT1_mc_1/

python stack_plot.py distrs/v37_test15_bunchFULLFIT1_mc_1.root distrs/v37_test15_bunchFULLFIT1/SingleElectron.root  -o plots/v37_test15_bunchFULLFIT1_mc_1/ --data-nick data_other --overwrite -p -r -c el_sel_lj    -x el_selVloose_lj    --qcd 1.05 --wjets 1.4 -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,250.  --lumi 35800 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend
python stack_plot.py distrs/v37_test15_bunchFULLFIT1_mc_1.root distrs/v37_test15_bunchFULLFIT1/SingleMuon.root      -o plots/v37_test15_bunchFULLFIT1_mc_1/ --data-nick data_other --overwrite -p -r -c mu_sel_lj    -x mu_selVloose_lj    --qcd 1.05 --wjets 1.4 -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,375.  --lumi 35800 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend

python stack_plot.py distrs/v37_test15_bunchFULLFIT1_mc_1.root distrs/v37_test15_bunchFULLFIT1/SingleElectron.root  -o plots/v37_test15_bunchFULLFIT1_mc_1/ --data-nick data_other --overwrite -p -r -c el_sel_ljout -x el_selVloose_ljout --qcd 1.05 --wjets 1.4 -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,250.  --lumi 35800 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend
python stack_plot.py distrs/v37_test15_bunchFULLFIT1_mc_1.root distrs/v37_test15_bunchFULLFIT1/SingleMuon.root      -o plots/v37_test15_bunchFULLFIT1_mc_1/ --data-nick data_other --overwrite -p -r -c mu_sel_ljout -x mu_selVloose_ljout --qcd 1.05 --wjets 1.4 -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,375.  --lumi 35800 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend

evince plots/v37_test17_bunchFULLFIT1_mc1//distrs,distrs_v37_test*_el_sel_lj* plots/v37_test15_bunchFULLFIT1_mc_1/distr*_el_sel_lj*
evince plots/v37_test17_bunchFULLFIT1_mc1//distrs,distrs_v37_test*_mu_sel_lj* plots/v37_test15_bunchFULLFIT1_mc_1/distr*_mu_sel_lj*


-- yeah, they are practically the same, just some variations in bins


histograms

make run_std_histos out=histosels/v37_test17_bunchFULLFIT1/ wjets_norm=1.4 lumi_mu=35800 lumi_el=35800 mc=distrs/distrs_v37_test17_bunchFULLFIT1_mc1.root data_mu=distrs/v37_test17_bunchFULLFIT1/SingleMuon.root data_el=distrs/v37_test17_bunchFULLFIT1/SingleElectron.root

something crashes with "file exists, nothing is written"?

make run_histos mc=distrs/distrs_v37_test17_bunchFULLFIT1_mc1.root data=distrs/v37_test17_bunchFULLFIT1/SingleMuon.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test17_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_lj"    & \
make run_histos mc=distrs/distrs_v37_test17_bunchFULLFIT1_mc1.root data=distrs/v37_test17_bunchFULLFIT1/SingleElectron.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test17_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_lj"    & \
make run_histos mc=distrs/distrs_v37_test17_bunchFULLFIT1_mc1.root data=distrs/v37_test17_bunchFULLFIT1/SingleMuon.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test17_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_ljout" & \
make run_histos mc=distrs/distrs_v37_test17_bunchFULLFIT1_mc1.root data=distrs/v37_test17_bunchFULLFIT1/SingleElectron.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test17_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_ljout" & \

make run_histos mc=distrs/distrs_v37_test17_bunchFULLFIT1_mc1.root data=distrs/v37_test17_bunchFULLFIT1/SingleMuon.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test17_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_lj    systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_lj" & \
make run_histos mc=distrs/distrs_v37_test17_bunchFULLFIT1_mc1.root data=distrs/v37_test17_bunchFULLFIT1/SingleElectron.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test17_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_lj    systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_lj" & \
make run_histos mc=distrs/distrs_v37_test17_bunchFULLFIT1_mc1.root data=distrs/v37_test17_bunchFULLFIT1/SingleMuon.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test17_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel_ljout systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_ljout" & \
make run_histos mc=distrs/distrs_v37_test17_bunchFULLFIT1_mc1.root data=distrs/v37_test17_bunchFULLFIT1/SingleElectron.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test17_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel_ljout systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_ljout" & \

make run_histos mc=distrs/distrs_v37_test17_bunchFULLFIT1_mc1.root data=distrs/v37_test17_bunchFULLFIT1/SingleMuon.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test17_bunchFULLFIT1/ wjets_norm=1.4 chan=mu_sel & \
make run_histos mc=distrs/distrs_v37_test17_bunchFULLFIT1_mc1.root data=distrs/v37_test17_bunchFULLFIT1/SingleElectron.root options= lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test17_bunchFULLFIT1/ wjets_norm=1.4 chan=el_sel & 

-- all ok

hadd histosels/datafile_HISTOSEL_v37_test17_bunchFULLFIT1.root histosels/v37_test17_bunchFULLFIT1/*

cp ttxsec/datacard_v37_test15_bunchFULLFIT1_el.txt ttxsec/datacard_v37_test17_bunchFULLFIT1_el.txt
cp ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.txt ttxsec/datacard_v37_test17_bunchFULLFIT1_mu.txt

vim -p ttxsec/datacard_v37_test17_bunchFULLFIT1_el.txt ttxsec/datacard_v37_test17_bunchFULLFIT1_mu.txt

shapes qcd       el_sel_lj     fit-stuff/datafile_HISTOSEL_v37_test17_bunchFULLFIT1.root  el_sel_lj/qcd_other/NOMINAL/el_sel_lj_qcd_NOMINAL_Mt_lep_met_c                 el_sel_lj/qcd_other/$SYSTEMATIC/el_sel_lj_qcd_$SYSTEMATIC_Mt_lep_met_c
shapes qcd       el_sel_ljout  fit-stuff/datafile_HISTOSEL_v37_test17_bunchFULLFIT1.root  el_sel_ljout/qcd_other/NOMINAL/el_sel_ljout_qcd_NOMINAL_Mt_lep_met_c           el_sel_ljout/qcd_other/$SYSTEMATIC/el_sel_ljout_qcd_$SYSTEMATIC_Mt_lep_met_c

shapes qcd       mu_sel_lj     fit-stuff/datafile_HISTOSEL_v37_test17_bunchFULLFIT1.root  mu_sel_lj/qcd_other/NOMINAL/mu_sel_lj_qcd_NOMINAL_Mt_lep_met_c                 mu_sel_lj/qcd_other/$SYSTEMATIC/mu_sel_lj_qcd_$SYSTEMATIC_Mt_lep_met_c
shapes qcd       mu_sel_ljout  fit-stuff/datafile_HISTOSEL_v37_test17_bunchFULLFIT1.root  mu_sel_ljout/qcd_other/NOMINAL/mu_sel_ljout_qcd_NOMINAL_Mt_lep_met_c           mu_sel_ljout/qcd_other/$SYSTEMATIC/mu_sel_ljout_qcd_$SYSTEMATIC_Mt_lep_met_c


make workspace datacard=ttxsec/datacard_v37_test17_bunchFULLFIT1_el
make workspace datacard=ttxsec/datacard_v37_test17_bunchFULLFIT1_mu
make both mucard=ttxsec/datacard_v37_test17_bunchFULLFIT1_mu elcard=ttxsec/datacard_v37_test17_bunchFULLFIT1_el bothcard=ttxsec/datacard_v37_test17_bunchFULLFIT1_both
make workspace datacard=ttxsec/datacard_v37_test17_bunchFULLFIT1_both

combineCards.py mu=ttxsec/datacard_v37_test17_bunchFULLFIT1_mu.txt el=ttxsec/datacard_v37_test17_bunchFULLFIT1_el.txt > ttxsec/datacard_v37_test17_bunchFULLFIT1_both.txt
../scripts/text2workspace.py ttxsec/datacard_v37_test17_bunchFULLFIT1_el.txt


make nll  workspace=ttxsec/datacard_v37_test17_bunchFULLFIT1_mu.root   nn=v37_test17_mu_test1
make nll  workspace=ttxsec/datacard_v37_test17_bunchFULLFIT1_el.root   nn=v37_test17_el_test1
make nll  workspace=ttxsec/datacard_v37_test17_bunchFULLFIT1_both.root nn=v37_test17_both_test1

 POI: r= 0.858347 -> [0.5,1.5]

-- wtf??? muons fail??? muons look better than before!
   ljout has one bin where data fluctuates to MC, comparing to the test15

 POI: r= 0.932541 -> [0.5,1.5]
 POI: r= 0.89147 -> [0.5,1.5]

wtf?
.. but both ends up in between

VS

 POI: r= 0.945318 -> [0.5,1.5]
 POI: r= 0.944658 -> [0.5,1.5]
 POI: r= 0.958266 -> [0.5,1.5]

root -l higgsCombinev37_test17_mu_test1.MultiDimFit.mH120.root
limit->Draw("2*deltaNLL:r",         "deltaNLL>0 && 2*deltaNLL<10", "L")
limit->Draw("2*deltaNLL:TOPPT",     "deltaNLL>0 && 2*deltaNLL<10", "L")

-- and it's smooth?


make impacts  workspace=ttxsec/datacard_v37_test17_bunchFULLFIT1_mu.root   nn=v37_test17_mu_test1    &
make impacts  workspace=ttxsec/datacard_v37_test17_bunchFULLFIT1_el.root   nn=v37_test17_el_test1    &
make impacts  workspace=ttxsec/datacard_v37_test17_bunchFULLFIT1_both.root nn=v37_test17_both_test1  &


freeze JES and JER which might contain an error

make nll  workspace=ttxsec/datacard_v37_test17_bunchFULLFIT1_mu.root   nn=v37_test17_mu_test1_noJESJER freeze="--freezeParameters lumi_13TeV,JES,JER"

 POI: r= 0.92108 -> [0.5,1.5]

better, but:

make nll  workspace=ttxsec/datacard_v37_test17_bunchFULLFIT1_el.root   nn=v37_test17_el_test1_noJESJER    freeze="--freezeParameters lumi_13TeV,JES,JER"
make nll  workspace=ttxsec/datacard_v37_test17_bunchFULLFIT1_both.root nn=v37_test17_both_test1_noJESJER  freeze="--freezeParameters lumi_13TeV,JES,JER"

 POI: r= 0.936244 -> [0.5,1.5]

-- again they are not so far apart....

 POI: r= 0.927886 -> [0.5,1.5]

at last!!!!!!!!!!!!

if only correct JES and JER brought them a bit higher



## rebinning Mt

outlier bin, _f and _c2



## separate Mt lj ljout plots

python stack_plot.py histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c mu_sel_lj    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,375.  --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend

python stack_plot.py histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c mu_sel_ljout -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,375.  --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend

evince plots/update-v8_plot_with_sys//histosels,v37_test15_bunchFULLFIT1_HISTOSEL_histosels,v37_test15_bunchFULLFIT1_HISTOSEL_Mt_lep_met_c_mu_sel_lj_NOMINAL_stack_ratio.pdf plots/update-v8_plot_with_sys//histosels,v37_test15_bunchFULLFIT1_HISTOSEL_histosels,v37_test15_bunchFULLFIT1_HISTOSEL_Mt_lep_met_c_mu_sel_ljout_NOMINAL_stack_ratio.pdf

-- ljout is close to agreement

python stack_plot.py histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c mu_sel_lj    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,375.  --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend --sys TOPPTUp
python stack_plot.py histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c mu_sel_ljout -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,375.  --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend --sys TOPPTUp

evince plots/update-v8_plot_with_sys//histosels,v37_test15_bunchFULLFIT1_HISTOSEL_histosels,v37_test15_bunchFULLFIT1_HISTOSEL_Mt_lep_met_c_mu_sel_lj_NOMINAL_stack_ratio.pdf plots/update-v8_plot_with_sys//histosels,v37_test15_bunchFULLFIT1_HISTOSEL_histosels,v37_test15_bunchFULLFIT1_HISTOSEL_Mt_lep_met_c_mu_sel_lj_TOPPTUp_stack_ratio.pdf

evince plots/update-v8_plot_with_sys//histosels,v37_test15_bunchFULLFIT1_HISTOSEL_histosels,v37_test15_bunchFULLFIT1_HISTOSEL_Mt_lep_met_c_mu_sel_ljout_NOMINAL_stack_ratio.pdf plots/update-v8_plot_with_sys//histosels,v37_test15_bunchFULLFIT1_HISTOSEL_histosels,v37_test15_bunchFULLFIT1_HISTOSEL_Mt_lep_met_c_mu_sel_ljout_TOPPTUp_stack_ratio.pdf

-- TOPPT slightly improves both, brings ljout in full agreement but lj not completely, some bins fluctuate


compare to electrons

python stack_plot.py histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c el_sel_lj    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,250.  --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend
python stack_plot.py histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c el_sel_ljout -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,250.  --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend

python stack_plot.py histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c el_sel_lj    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,250.  --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend --sys TOPPTUp
python stack_plot.py histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c el_sel_ljout -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,250.  --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend --sys TOPPTUp

evince plots/update-v8_plot_with_sys//histosels,v37_test15_bunchFULLFIT1_HISTOSEL_histosels,v37_test15_bunchFULLFIT1_HISTOSEL_Mt_lep_met_c_el_sel_lj_NOMINAL_stack_ratio.pdf plots/update-v8_plot_with_sys//histosels,v37_test15_bunchFULLFIT1_HISTOSEL_histosels,v37_test15_bunchFULLFIT1_HISTOSEL_Mt_lep_met_c_el_sel_lj_TOPPTUp_stack_ratio.pdf
evince plots/update-v8_plot_with_sys//histosels,v37_test15_bunchFULLFIT1_HISTOSEL_histosels,v37_test15_bunchFULLFIT1_HISTOSEL_Mt_lep_met_c_el_sel_ljout_NOMINAL_stack_ratio.pdf plots/update-v8_plot_with_sys//histosels,v37_test15_bunchFULLFIT1_HISTOSEL_histosels,v37_test15_bunchFULLFIT1_HISTOSEL_Mt_lep_met_c_el_sel_ljout_TOPPTUp_stack_ratio.pdf

-- large fluctuations, as before (another problem -- the bend in ljout, can it be due to el-matched jet and propagation to MET?)
   barely visible effect in lj and noticeable correction in ljout



the effect of Frag:

python stack_plot.py histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c mu_sel_lj    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,375.  --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend --sys FragUp
python stack_plot.py histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c mu_sel_ljout -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj,tt_taultauh,tt_other. --y-range 0,375.  --lumi-label 35.8 --output-type pdf --ratio-range 0.55 --text-size-axes-labels 20 --text-size-axes-titles 25 --leg-n-columns 3 --top-legend --sys FragUp

evince plots/update-v8_plot_with_sys//histosels,v37_test15_bunchFULLFIT1_HISTOSEL_histosels,v37_test15_bunchFULLFIT1_HISTOSEL_Mt_lep_met_c_mu_sel_lj_NOMINAL_stack_ratio.pdf plots/update-v8_plot_with_sys//histosels,v37_test15_bunchFULLFIT1_HISTOSEL_histosels,v37_test15_bunchFULLFIT1_HISTOSEL_Mt_lep_met_c_mu_sel_lj_FragUp_stack_ratio.pdf

evince plots/update-v8_plot_with_sys//histosels,v37_test15_bunchFULLFIT1_HISTOSEL_histosels,v37_test15_bunchFULLFIT1_HISTOSEL_Mt_lep_met_c_mu_sel_ljout_NOMINAL_stack_ratio.pdf plots/update-v8_plot_with_sys//histosels,v37_test15_bunchFULLFIT1_HISTOSEL_histosels,v37_test15_bunchFULLFIT1_HISTOSEL_Mt_lep_met_c_mu_sel_ljout_FragUp_stack_ratio.pdf

-- FragUp reduces all MC

python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root -c mu_sel_lj    -d Mt_lep_met_c -s FragUp,FragDown   --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/tests/ --outname mu_sel_lj_all_Mt_lep_met_f_FragUp,FragDown.png       --ratio-y-line 1.0 --ratio-range 0.3

python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root -c mu_sel_ljout    -d Mt_lep_met_c -s FragUp,FragDown   --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/tests/ --outname mu_sel_ljout_all_Mt_lep_met_f_FragUp,FragDown.png       --ratio-y-line 1.0 --ratio-range 0.3

-- quite asymmetric, Up has larger effect and Up reduces small Mt more



check separate tt processes:

python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root -c mu_sel_lj     -p tt_mutau  -d Mt_lep_met_c -s FragUp,FragDown   --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/tests/ --outname mu_sel_lj_tt_mutau_Mt_lep_met_f_FragUp,FragDown.png      --ratio-y-line 1.0   --ratio-range 0.3
python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root -c mu_sel_ljout  -p tt_mutau  -d Mt_lep_met_c -s FragUp,FragDown   --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/tests/ --outname mu_sel_ljout_tt_mutau_Mt_lep_met_f_FragUp,FragDown.png   --ratio-y-line 1.0   --ratio-range 0.3

python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root -c mu_sel_lj     -p tt_lj  -d Mt_lep_met_c -s FragUp,FragDown   --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/tests/ --outname mu_sel_lj_tt_lj_Mt_lep_met_f_FragUp,FragDown.png      --ratio-y-line 1.0   --ratio-range 0.3
python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root -c mu_sel_ljout  -p tt_lj  -d Mt_lep_met_c -s FragUp,FragDown   --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/tests/ --outname mu_sel_ljout_tt_lj_Mt_lep_met_f_FragUp,FragDown.png   --ratio-y-line 1.0   --ratio-range 0.3

eog plots/tests//mu_sel_lj_tt_mutau_Mt_lep_met_f_FragUp,FragDown.png plots/tests//mu_sel_ljout_tt_mutau_Mt_lep_met_f_FragUp,FragDown.png plots/tests//mu_sel_lj_tt_lj_Mt_lep_met_f_FragUp,FragDown.png plots/tests//mu_sel_ljout_tt_lj_Mt_lep_met_f_FragUp,FragDown.png

-- symmetric and quite flat
   must be the missing QCD!

   the effect on tt_lj is up to 5%
   and on tt_mutau around 2-4%




# more questions on v7

## just make the plot with combined channel only

python ttxsec/fit-stuff/plot_uncertainty_scans.py v37_test15_exp_unc --xsec-scale 831.76 --title-x "cross section [pb]"



## another look at the weirdness in the fitting

the fit in combined channel > in el and mu

the hypothesis is:
this is due to no TOPPT pull up in mu,
which makes the fitted signal strength smaller in mu than in case of TOPPT 1sigma up;
the TOPPT is up in el and in combined;
if mu had TOPPT up the signal strength would be > in combined.

first clue:
in newest fit files the MC normalization is slightly smaller than in fitted histosel datafiles
-- why is that, is it reasonable, does the fit in new files produce larger signal strength in mu?


### check the hypothesis

find the fitted datacards
refit mu with TOPPT set to one

old is exported:
export/v37_test13_bunchFULLFIT2/

but the most recent version in proc/xsec_calculations.jl is v13 test15 paper6
seems to correspond to
scan_mu_v37_test15_exp_unc.png
-- only the sig strength is 0.946 instead of 0.945
but both and el correspond too

-- which datacard was it?

this stuff:

make fit_unc      nn=mu_v37_test15_exp_unc   workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   &
make fit_unc_toys nn=mu_v37_test15_exp_unc   workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   &

let's repeat and confirm the hypothesis

make fit_unc      nn=mu_v37_test15_exp_unc_REPTEST   workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   &

r = 0.946

eog ./scan_mu_v37_test15_exp_unc_REPTEST.png ./scan_mu_v37_test15_exp_unc.png

-- and identical 

nll

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   nn=v37_test15_mu_exp_REPTEST
make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   nn=v37_test15_mu_exp_REPTEST_TOPPT1 freeze="--freezeParameters lumi_13TeV       --setParameters TOPPT=1"
make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   nn=v37_test15_mu_exp_REPTEST_TOPPT1 freeze="--freezeParameters lumi_13TeV,TOPPT --setParameters TOPPT=1"

 POI: r= 0.945318 -> [0.5,1.5]

-- strangely not 0.946

Set Default Value of Parameter TOPPT To : 1
Computing results starting from observation (a-posteriori)
 POI: r= 0.945335 -> [0.5,1.5]

Set Default Value of Parameter TOPPT To : 1
Computing results starting from observation (a-posteriori)
 POI: r= 0.96354 -> [0.5,1.5]

-- and both is:

bt_sig  = 0.961


----- yeah, the hypothesis is right

the datacard and datafile are:

ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.txt
ttxsec/fit-stuff/v37_test15_bunchFULLFIT1_HISTOSEL.root


### check the first clue

are new files indeed different in normalization?
how do they fit?
why are they different, which correction was applied/changed?

which files are the new files?
-- in the sys uncertainty propagation


python stack_plot.py distrs/v37_test15_bunchFULLFIT1_mc_1.root distrs/v37_test15_bunchFULLFIT1/SingleMuon.root     -p -r -o plots/test/v37_test15_bunchFULLFIT1_nocats_TRACKNORM/ --data-nick data_other --overwrite --lumi 35800 -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02   --y-range 0,250. --qcd 1.05 --bin-norm

INFO:root:data       =    23026.000000      451.527152
INFO:root:mc sum     =    23384.346228    23384.346228
INFO:root:mc sum unc =      358.025025      358.025025
INFO:root:mc sum unc =      358.025025      358.025025
MC sum error 45.1649933904 2836.94840317

INFO:root:data       =     1090.115000       22.406628
INFO:root:mc sum     =     1108.050102     1108.050102
INFO:root:mc sum unc =       17.632043       17.632043
INFO:root:mc sum unc =       17.632043       17.632043
MC sum error 2.25824966952 141.847420158

-- looks very similar to before

eog plots/test/v37_test15_bunchFULLFIT1_nocats_TRACKNORM//distrs,v37_test15_bunchFULLFIT1_mc_1_distrs,v37_test15_bunchFULLFIT1,SingleMuon_Mt_lep_met_c_mu_sel_NOMINAL_stack_ratio_dataqcd.png plots/v37_test13_bunchFULLFIT2/distrs,v37_test13_bunchFULLFIT2_mc_distrs,v37_test13_bunchFULLFIT2,SingleMuon_Mt_lep_met_c_mu_sel_NOMINAL_stack_ratio_x_mu_selVloose_dataqcd.png

-- practically the same, very small variations in bins

I bet the smaller normalization was in running stack on HISTOSEL files, which reapplied the corrections second time....

let's confirm

python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc.root distrs/v37_test13_bunchFULLFIT2/SingleMuon.root -o plots/test/v37_test15_bunchFULLFIT1_nocats_TRACKNORM/ --data-nick data_other --overwrite -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d Mt_lep_met_c --wjet 1.4 --qcd 1.05 --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02  --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --y-range 0,250.

python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats.root -o plots/test/v37_test15_bunchFULLFIT1_nocats_TRACKNORM/ --data-nick data_other --overwrite -p -r --lumi 1 -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02  --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --y-range 0,250.

INFO:root:data       =     1090.115000       22.406628
INFO:root:mc sum     =     1115.028687     1115.028687

INFO:root:data       =     1090.115000       22.406628
INFO:root:mc sum     =     1064.060467     1064.060467

eog plots/test/v37_test15_bunchFULLFIT1_nocats_TRACKNORM//distrs,v37_test15_bunchFULLFIT1_mc_1_distrs,v37_test15_bunchFULLFIT1,SingleMuon_Mt_lep_met_c_mu_sel_NOMINAL_stack_ratio_dataqcd.png plots/test/v37_test15_bunchFULLFIT1_nocats_TRACKNORM//histosels,datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_histosels,datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_Mt_lep_met_c_mu_sel_NOMINAL_stack_ratio.png plots/test/v37_test15_bunchFULLFIT1_nocats_TRACKNORM//distrs,v37_test13_bunchFULLFIT2_mc_distrs,v37_test13_bunchFULLFIT2,SingleMuon_Mt_lep_met_c_mu_sel_NOMINAL_stack_ratio_x_mu_selVloose_dataqcd.png

-- yeah, that's it


### check FULLFIT2 for fit

it is very close to FULLFIT1, but the shape of QCD is smoother, the trend is more linear in large Mt

make run_std_histos out=histosels/v37_test15_bunchFULLFIT2/ wjets_norm=1.4 lumi_mu=35800 lumi_el=35800 mc=distrs/v37_test15_bunchFULLFIT2_mc_1.root data_mu=distrs/v37_test15_bunchFULLFIT2/SingleMuon.root data_el=distrs/v37_test15_bunchFULLFIT2/SingleElectron.root

-- it was test13 FULLFIT2

eog scan_mu_v37_test13_bunchFULLFIT2.png

shows 0.936


### propagate stuff to QCD?

-- everything must be propagated for experimental and toppt systematics

cp ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_qcd_prop.txt
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_qcd_prop

only TOPPT then the others

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_qcd_prop.root   nn=v37_test15_mu_exp_QCDPROP_TOPPT

 POI: r= 0.945315 -> [0.5,1.5]

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_qcd_prop.root   nn=v37_test15_mu_exp_QCDPROP_TOPPTnALLEXP

 POI: r= 0.939738 -> [0.5,1.5]

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_qcd_prop.root   nn=v37_test15_mu_exp_QCDPROP_TOPPTnALLEXP options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff"

limit->Draw("2*deltaNLL:r",         "deltaNLL>0 && 2*deltaNLL<10", "L")
limit->Draw("2*deltaNLL:tauID_eff", "deltaNLL>0 && 2*deltaNLL<10", "L")
limit->Draw("2*deltaNLL:tau_fakes", "deltaNLL>0 && 2*deltaNLL<10", "L")
limit->Draw("2*deltaNLL:TOPPT",     "deltaNLL>0 && 2*deltaNLL<10", "L")

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_el_exp.root   nn=v37_test15_el_exp_REPEAT   options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff"
make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_both_exp.root nn=v37_test15_both_exp_REPEAT options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff"

 POI: r= 0.944658 -> [0.5,1.5]
 POI: r= 0.958266 -> [0.5,1.5]


TOPPT is the most effective in the large and small Mt, where QCD has negligible effect


### error in wjets normalization?

the Mt trend is too linear in muon-tau,
TOPPT bends small and large Mt, fixing the large Mt and failing the small ones,
more wjets would make the bend in Mt, which corresponds exactly to TOPPT

check the effect of TOPPT on the shape, data-mc difference

python stack_plot.py distrs/v37_test15_bunchFULLFIT1_mc_1.root distrs/v37_test15_bunchFULLFIT1/SingleMuon.root     -p -r -o plots/test/v37_test15_bunchFULLFIT1_nocats_TRACKNORM/ --data-nick data_other --overwrite --lumi 35800 -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02   --y-range 0,250. --qcd 1.05 --bin-norm

python stack_plot.py distrs/v37_test15_bunchFULLFIT1_mc_1.root distrs/v37_test15_bunchFULLFIT1/SingleMuon.root     -p -r -o plots/test/v37_test15_bunchFULLFIT1_nocats_TRACKNORM/ --data-nick data_other --overwrite --lumi 35800 -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02   --y-range 0,250. --qcd 1.05 --bin-norm --sys TOPPTUp

DEBUG:root:data qcd for (Mt_lep_met_c, mu_sel_ss) Integral = 23.253098

INFO:root:data       =     1090.115000       22.406628
INFO:root:mc sum     =     1097.922715     1097.922715
INFO:root:mc sum unc =       17.410155       17.410155
INFO:root:mc sum unc =       17.410155       17.410155
MC sum error 2.2525495217 141.195438418

eog plots/test/v37_test15_bunchFULLFIT1_nocats_TRACKNORM//distrs,v37_test15_bunchFULLFIT1_mc_1_distrs,v37_test15_bunchFULLFIT1,SingleMuon_Mt_lep_met_c_mu_sel_*_stack_ratio_dataqcd.png

-- perfectly fits! no distortion at small Mt!
   it must be applied

try an additional factor for wjets directly in the fit first


cp ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_wjets15.txt
cp ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_wjets12.txt

make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_wjets15
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_wjets12

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_wjets15.root   nn=v37_test15_mu_exp_wjets15 freeze="--freezeParameters lumi_13TeV,TOPPT --setParameters TOPPT=1"
make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_wjets12.root   nn=v37_test15_mu_exp_wjets12 freeze="--freezeParameters lumi_13TeV,TOPPT --setParameters TOPPT=1"

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_wjets15.root   nn=v37_test15_mu_exp_wjets15    options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff"
make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_wjets12.root   nn=v37_test15_mu_exp_wjets12    options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff"

 POI: r= 0.929815 -> [0.5,1.5]
 POI: r= 0.929826 -> [0.5,1.5]

-- ??????

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   nn=v37_test15_mu_exp_REPEAT2    options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff"

 POI: r= 0.945318 -> [0.5,1.5]

BS

with factor 1.0:

ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_wjets14.txt

make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_wjets14

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_wjets14.root   nn=v37_test15_mu_exp_wjets14    options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff"

 POI: r= 0.929904 -> [0.5,1.5]

-- 1!=1 wtf how higgscombine works?

and all of them have TOPPT around 0.1!



remake the histos

make run_std_histos out=histosels/v37_test15_bunchFULLFIT1_wjets15/ wjets_norm=1.5 lumi_mu=35800 lumi_el=35800 mc=distrs/v37_test15_bunchFULLFIT1_mc_1.root data_mu=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root data_el=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root
hadd -f histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_wjets15.root histosels/v37_test15_bunchFULLFIT1_wjets15/*root

make run_std_histos out=histosels/v37_test15_bunchFULLFIT1_wjets13/ wjets_norm=1.3 lumi_mu=35800 lumi_el=35800 mc=distrs/v37_test15_bunchFULLFIT1_mc_1.root data_mu=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root data_el=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root
hadd -f histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_wjets13.root histosels/v37_test15_bunchFULLFIT1_wjets13/*root

cp ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_wjets13.txt

make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_wjets13

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_wjets13.root   nn=v37_test15_mu_exp_wjets14    options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff --freezeNuisanceGroup tt_th_pdf"

 POI: r= 0.945169 -> [0.5,1.5]

-- no difference

combine -M FitDiagnostics ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_wjets13.root --plots --saveShapes --saveWithUncertainties --name v37_test15_mu_exp_wjets13_REPEAT_covariances --freezeNuisanceGroup tt_th_pdf





### fit with the outlier bin?

make run_std_histos out=histosels/v37_test15_bunchFULLFIT1_withOVERFLOWS/ wjets_norm=1.4 lumi_mu=35800 lumi_el=35800 mc=distrs/v37_test15_bunchFULLFIT1_mc_1.root data_mu=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root data_el=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root options='"--draw-overflows 5"'

hadd -f histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_withOVERFLOWS.root histosels/v37_test15_bunchFULLFIT1_withOVERFLOWS/*root

cp histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_withOVERFLOWS.root ../../fit-stuff/

datacard:

cp ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_withOVERFLOW.txt

and correct the numbers (! so higgscombine does not use overflows after all)

python numbers_for_datacard.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_withOVERFLOWS.root -d Mt_lep_met_c -c mu_sel_lj,mu_sel_ljout --data-nick data_other

bin           mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                
process       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                       
rate          5021.631                 3609.587                 204.639                  272.438                  85.639                   23.271                   226.264                  34.568                   229.457                  0.000                    15.283                   228.929                  8.529                    190.632                  176.650                  
mu_sel_lj/data_other/NOMINAL/mu_sel_lj_data_other_NOMINAL_Mt_lep_met_c
obs 9932.000000
mc sum = 10327.515914
INFO:root:mu_sel_ljout
bin           mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             
process       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                       
rate          8022.158                 2507.487                 142.576                  458.961                  173.945                  55.917                   289.888                  52.688                   462.813                  0.000                    29.676                   364.950                  23.466                   390.389                  178.219                  
mu_sel_ljout/data_other/NOMINAL/mu_sel_ljout_data_other_NOMINAL_Mt_lep_met_c
obs 13094.000000
mc sum = 13153.132784



make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_withOVERFLOW

-- all MC does not have bSF sys histo

make --dry-run run_std_histos out=histosels/v37_test15_bunchFULLFIT1_withOVERFLOWS/ wjets_norm=1.4 lumi_mu=35800 lumi_el=35800 mc=distrs/v37_test15_bunchFULLFIT1_mc_1.root data_mu=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root data_el=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root options='"--draw-overflows 5"'

make --dry-run run_histos mc=distrs/v37_test15_bunchFULLFIT1_mc_1.root data=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root options="--draw-overflows 5" lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_withOVERFLOWS/ wjets_norm=1.4 chan=mu_sel_lj    systematics="bSFUp" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_lj"    & \

python stack_plot.py distrs/v37_test15_bunchFULLFIT1_mc_1.root distrs/v37_test15_bunchFULLFIT1/SingleMuon.root -o histosels/v37_test15_bunchFULLFIT1_withOVERFLOWS/ --data-nick data_other --lumi 35800 -c mu_sel_lj -d Mt_lep_met_c --wjet 1.4 --qcd 1.05 -x mu_selVloose_lj --systematic bSFUp --draw-overflows 5

-- renaming of systematics crashes on processing data histo


only TOPPT then the others

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_withOVERFLOW.root   nn=v37_test15_mu_exp_withOVERFLOW options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff"

 POI: r= 0.945004 -> [0.5,1.5]

no good

but TOPPT landed at 0.6!!!???

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_withOVERFLOW.root   nn=v37_test15_mu_exp_withOVERFLOW options="--saveSpecifiedNuis tau_fakes,tauID_eff --setParameters TOPPT=1" freeze="--freezeParameters lumi_13TeV,TOPPT"

 POI: r= 0.958599 -> [0.5,1.5]

-- damn, so probably with overflows all signal strengths slide down



### rebin?

 KEY: TH1D	mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_c;1	
 KEY: TH1D	mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_c2;1	
 KEY: TH1D	mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f;1	

-- use c2 or f?

make run_std_histos out=histosels/v37_test15_bunchFULLFIT1_Mt_lep_met_f/ wjets_norm=1.4 lumi_mu=35800 lumi_el=35800 mc=distrs/v37_test15_bunchFULLFIT1_mc_1.root data_mu=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root data_el=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root  distr=Mt_lep_met_f
hadd -f histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_Mt_lep_met_f.root histosels/v37_test15_bunchFULLFIT1_Mt_lep_met_f/*root

make run_std_histos out=histosels/v37_test15_bunchFULLFIT1_Mt_lep_met_c2/ wjets_norm=1.4 lumi_mu=35800 lumi_el=35800 mc=distrs/v37_test15_bunchFULLFIT1_mc_1.root data_mu=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root data_el=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root  distr=Mt_lep_met_c2
hadd -f histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_Mt_lep_met_c2.root histosels/v37_test15_bunchFULLFIT1_Mt_lep_met_c2/*root



## new systematics for the ratio to dilepton

-- cannot find the old source, some analysis nore!

new table is from the paper:
https://arxiv.org/abs/1812.10505



something is wrong with the acceptance uncertainties:

ME scales                       &  0.3    &  0.4   &  0.3 \\
PDF                             &  1.2    &  1.4   &  1.3 \\
underlying event (Pythia tune)  &  0.3    &  0.2   &  0.3 \\
ME-PS matching ($h_{\rm damp}$) &  1.1    &  1.4   &  1.3 \\
initial state radiation (ISR)   &  0.7    &  0.3   &  0.4 \\
final state radiation (FSR)     &  2.8    &  2.8   &  2.8 \\

A_{\ttbar}(e\tauh)      &= 0.1687 \pm 0.0004 \rm{(stat.)} \pm 0.0025 \rm{(syst.)}, \\
A_{\ttbar}(\mu\tauh)    &= 0.1756 \pm 0.0004 \rm{(stat.)} \pm 0.0022 \rm{(syst.)}, \\
A_{\ttbar}(\ell\tauh)   &= 0.1722 \pm 0.0003 \rm{(stat.)} \pm 0.0023 \rm{(syst.)}.


                               eltau      mutau        sum
 nominal_0 nom                           0.1687     0.1756     0.1722
 nominal_0 scales_renorm                 0.0007     0.0013     0.0010
 nominal_0 scales_refact                 0.0021     0.0022     0.0021
 nominal_0 scales_both                   0.0015     0.0017     0.0016
 nominal_0 pdfs                          0.0017     0.0019     0.0017
      tune nom                           0.0025     0.0019     0.0021
     hdamp nom                           0.0084     0.0104     0.0094
       isr nom                           0.0050     0.0025     0.0033
       fsr nom                           0.0198     0.0199     0.0198

                               eltau      mutau        sum
 nominal_0 nom                           0.1687     0.1756     0.1722
 nominal_0 scales_renorm                 0.0010     0.0018     0.0014
 nominal_0 scales_refact                 0.0029     0.0030     0.0029
 nominal_0 scales_both                   0.0021     0.0025     0.0022
 nominal_0 pdfs                          0.0129     0.0141     0.0133
      tune nom                           0.0025     0.0019     0.0021
     hdamp nom                           0.0084     0.0104     0.0094
       isr nom                           0.0050     0.0025     0.0033
       fsr nom                           0.0198     0.0199     0.0198

sum                           0.0260     0.0270     0.0263

 nominal_0 nom                           0.1687     0.1756     0.1722
sum                           0.0044     0.0047     0.0045





### make the covariances matrix

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   nn=v37_test15_mu_exp_REPEAT2    options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff"

cp ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.txt
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC
combine -M FitDiagnostics ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.root --plots --saveShapes --saveWithUncertainties --name v37_test15_mu_exp_REPEAT_covariances --freezeNuisanceGroup tt_th_pdf
combine -M FitDiagnostics ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.root --plots --saveShapes --saveWithUncertainties --name v37_test15_mu_exp_REPEAT_covariances --freezeNuisanceGroup tt_th_pdf_only

Best fit r: 0.946876  -0.0699566/+0.074483  (68% CL)


eog covariance_fit_s.png

-- unusable higgsCombine settings for the plot, the figure is too small, the text is too large....

root -l fitDiagnosticsv37_test15_mu_exp_REPEAT_covariances.root
gStyle->SetPaintTextFormat("1.2f")
covariance_fit_s->SetMarkerSize(1.)
covariance_fit_s->Draw("colz text")

-- the TOPPT correlations:

+0.29 signal
-0.10 wjets norm
-0.09 tau fakes
+0.09 Frag
-0.08 PU
+0.08 tau ID

+0.26 signal
+0.13 Mr
-0.10 wjets
+0.09 tau ID
-0.08 tau fakes
+0.08 Frag
+0.08 Mfr
-0.07 PU


-- try wjets after all?
   smaller wjets first

   also fakes correlate with many other parameters, including FSR, check FSR?

   what's with Mr?


wjets 1.3 -- no difference, covariance with signal is about the same 0.31

freeze FSR

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.root   nn=v37_test15_mu_exp_noMC_noFSR    options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff --freezeNuisanceGroup tt_th_pdf,tt_updowns"
 POI: r= 0.957302 -> [0.5,1.5]

and Frag:

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.root   nn=v37_test15_mu_exp_noMC_noFSR    options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag"

 POI: r= 0.955832 -> [0.5,1.5]

TOPPT 0.4

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.root   nn=v37_test15_mu_exp_noMC_noFSR    options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag" freeze="--freezeParameters lumi_13TeV,JES"

 POI: r= 0.945972 -> [0.5,1.5]

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.root   nn=v37_test15_mu_exp_noMC_noFSR    options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag" freeze="--freezeParameters lumi_13TeV,JER"

 POI: r= 0.958228 -> [0.5,1.5]

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.root   nn=v37_test15_mu_exp_noMC_noFSR    options="--saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag" freeze="--freezeParameters lumi_13TeV,JER"


vary FSR:

cp ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC_varyFSR.txt
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noMC






## the stack plots with systematic uncertainties

python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc.root distrs/v37_test13_bunchFULLFIT2/SingleMuon.root     -o plots/v37_test13_bunchFULLFIT2/paper/ --data-nick data_other --overwrite --y-range 0,250. -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d Mt_lep_met_c --wjet 1.4 --qcd 1.05 --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]"       --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02  --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other
python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc.root distrs/v37_test13_bunchFULLFIT2/SingleElectron.root -o plots/v37_test13_bunchFULLFIT2/paper/ --data-nick data_other --overwrite --y-range 0,250. -p -r --lumi 35800 -c el_sel    -x el_selVloose    -d Mt_lep_met_c --wjet 1.4 --qcd 1.05 --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02  --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other

python stack_plot.py distrs/v37_test15_bunchFULLFIT1_mc_1.root distrs/v37_test15_bunchFULLFIT1/SingleMuon.root -o plots/tests/ -p -r --lumi 35800 -c mu_sel -x mu_selVloose -d Mt_lep_met_c --wjet 1.4 --qcd 1.05 --ratio-range 0.5 --title "" --title-x "M_{T}(, MET) [GeV]" --title-y "Events" --data-nick data_other --overwrite

make plot_sel_paper_1  nt=v37 proc=test13 distrs=bunchFULLFIT2 lumi=35800 chan_tag=mu datafile=SingleMuon     title_lep=#mu merge_procs="--merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other"
make plot_sel_paper_1  nt=v37 proc=test13 distrs=bunchFULLFIT2 lumi=35800 chan_tag=el datafile=SingleElectron title_lep=e

python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc.root distrs/v37_test13_bunchFULLFIT2/SingleMuon.root -o plots/v37_test13_bunchFULLFIT2/paper/ --data-nick data_other --overwrite -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d Mt_lep_met_c --wjet 1.4 --qcd 1.05 --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02  --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --y-range 0,250.

python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats.root -o plots/test --data-nick data_other --overwrite -p -r --lumi 1 -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02  --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --y-range 0,250.


-- ok, but the Data>MC more than in the paper
   which data went to the paper and why this one is different?
   --- here I rerun the stack_plot on histosel datafile, which reapplies the corrections second time, reducing the MC norm

try systematic uncertainties

python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats.root -o plots/test --data-nick data_other --overwrite -p -r --lumi 1 -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02  --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --y-range 0,250. --uncertainty-systematic bSF,PU

-- works

python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats.root -o plots/test --data-nick data_other --overwrite -p -r --lumi 1 -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02  --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --y-range 0,250. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID

-- only tau stuff is missing

mkdir plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/

python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_test.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_test.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r --lumi 1 -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02  --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --y-range 0,250. --uncertainty-systematic TauMisID,TauID

python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_test.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_test.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r --lumi 1 -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02  --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --y-range 0,250. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID


-- need the original data files instead of
histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats.root
distrs/v37_test15_bunchFULLFIT1_mc_1.root
distrs/v37_test15_bunchFULLFIT1/SingleMuon.root
distrs/v37_test15_bunchFULLFIT1/SingleElectron.root



python stack_plot.py distrs/v37_test15_bunchFULLFIT1_mc_1.root distrs/v37_test15_bunchFULLFIT1/SingleMuon.root -o plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys --data-nick data_other --overwrite --lumi 35800 -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02   --y-range 0,250.  --rename-sys TauIDUp   --factor-rate-systematic tt_mutau,tt_eltau,tt_taultauh,s_top_mutau,s_top_eltau,s_top_other,dy_tautau,dibosons_other:1.05
python stack_plot.py distrs/v37_test15_bunchFULLFIT1_mc_1.root distrs/v37_test15_bunchFULLFIT1/SingleMuon.root -o plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys --data-nick data_other --overwrite --lumi 35800 -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02   --y-range 0,250.  --rename-sys TauIDDown --factor-rate-systematic tt_mutau,tt_eltau,tt_taultauh,s_top_mutau,s_top_eltau,s_top_other,dy_tautau,dibosons_other:0.95

python stack_plot.py distrs/v37_test15_bunchFULLFIT1_mc_1.root distrs/v37_test15_bunchFULLFIT1/SingleElectron.root -o plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys --data-nick data_other --overwrite --lumi 35800 -c el_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02   --y-range 0,250.  --rename-sys TauIDUp   --factor-rate-systematic tt_eltau,tt_eltau,tt_taultauh,s_top_eltau,s_top_eltau,s_top_other,dy_tautau,dibosons_other:1.05
python stack_plot.py distrs/v37_test15_bunchFULLFIT1_mc_1.root distrs/v37_test15_bunchFULLFIT1/SingleElectron.root -o plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys --data-nick data_other --overwrite --lumi 35800 -c el_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02   --y-range 0,250.  --rename-sys TauIDDown --factor-rate-systematic tt_eltau,tt_eltau,tt_taultauh,s_top_eltau,s_top_eltau,s_top_other,dy_tautau,dibosons_other:0.95


python stack_plot.py distrs/v37_test15_bunchFULLFIT1_mc_1.root distrs/v37_test15_bunchFULLFIT1/SingleMuon.root -o plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys --data-nick data_other --overwrite --lumi 35800 -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02   --y-range 0,250.  --rename-sys TauMisIDUp   --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj:1.3
python stack_plot.py distrs/v37_test15_bunchFULLFIT1_mc_1.root distrs/v37_test15_bunchFULLFIT1/SingleMuon.root -o plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys --data-nick data_other --overwrite --lumi 35800 -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02   --y-range 0,250.  --rename-sys TauMisIDDown --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj:0.7

python stack_plot.py distrs/v37_test15_bunchFULLFIT1_mc_1.root distrs/v37_test15_bunchFULLFIT1/SingleElectron.root -o plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys --data-nick data_other --overwrite --lumi 35800 -c el_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02   --y-range 0,250.  --rename-sys TauMisIDUp   --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj:1.3
python stack_plot.py distrs/v37_test15_bunchFULLFIT1_mc_1.root distrs/v37_test15_bunchFULLFIT1/SingleElectron.root -o plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys --data-nick data_other --overwrite --lumi 35800 -c el_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02   --y-range 0,250.  --rename-sys TauMisIDDown --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj:0.7


python stack_plot.py distrs/v37_test15_bunchFULLFIT1_mc_1.root distrs/v37_test15_bunchFULLFIT1/SingleMuon.root     -o plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys --data-nick data_other --overwrite --lumi 35800 -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02   --y-range 0,250.
python stack_plot.py distrs/v37_test15_bunchFULLFIT1_mc_1.root distrs/v37_test15_bunchFULLFIT1/SingleElectron.root -o plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys --data-nick data_other --overwrite --lumi 35800 -c el_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02   --y-range 0,250.


again with histosel to pass by the qcd issue:

make a nominal with datadriven qcd and overflows
then make the rates out of it

python stack_plot.py distrs/v37_test15_bunchFULLFIT1_mc_1.root distrs/v37_test15_bunchFULLFIT1/SingleMuon.root     -o plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/renominal --data-nick data_other --overwrite --lumi 35800 -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02   --y-range 0,250. --qcd 1.05
python stack_plot.py distrs/v37_test15_bunchFULLFIT1_mc_1.root distrs/v37_test15_bunchFULLFIT1/SingleElectron.root -o plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/renominal --data-nick data_other --overwrite --lumi 35800 -c el_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02   --y-range 0,250. --qcd 1.05

hadd plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/renominal/histosel.root plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/renominal/*.root

and the rates:

python stack_plot.py plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/renominal/histosel.root plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/renominal/histosel.root   -o plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys --data-nick data_other --overwrite --lumi 1 -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --legend-shift 0.02   --y-range 0,250.  --rename-sys TauMisIDUp   --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj:1.3
python stack_plot.py plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/renominal/histosel.root plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/renominal/histosel.root   -o plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys --data-nick data_other --overwrite --lumi 1 -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --legend-shift 0.02   --y-range 0,250.  --rename-sys TauMisIDDown --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj:0.7

python stack_plot.py plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/renominal/histosel.root plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/renominal/histosel.root   -o plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys --data-nick data_other --overwrite --lumi 1 -c el_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --legend-shift 0.02   --y-range 0,250.  --rename-sys TauMisIDUp   --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj:1.3
python stack_plot.py plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/renominal/histosel.root plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/renominal/histosel.root   -o plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys --data-nick data_other --overwrite --lumi 1 -c el_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --legend-shift 0.02   --y-range 0,250.  --rename-sys TauMisIDDown --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj:0.7


python stack_plot.py plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/renominal/histosel.root plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/renominal/histosel.root -o plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys --data-nick data_other --overwrite --lumi 1 -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --legend-shift 0.02   --y-range 0,250.  --rename-sys TauIDUp   --factor-rate-systematic tt_mutau,tt_eltau,tt_taultauh,s_top_mutau,s_top_eltau,s_top_other,dy_tautau,dibosons_other:1.05
python stack_plot.py plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/renominal/histosel.root plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/renominal/histosel.root -o plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys --data-nick data_other --overwrite --lumi 1 -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --legend-shift 0.02   --y-range 0,250.  --rename-sys TauIDDown --factor-rate-systematic tt_mutau,tt_eltau,tt_taultauh,s_top_mutau,s_top_eltau,s_top_other,dy_tautau,dibosons_other:0.95

python stack_plot.py plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/renominal/histosel.root plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/renominal/histosel.root -o plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys --data-nick data_other --overwrite --lumi 1 -c el_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --legend-shift 0.02   --y-range 0,250.  --rename-sys TauIDUp   --factor-rate-systematic tt_eltau,tt_eltau,tt_taultauh,s_top_eltau,s_top_eltau,s_top_other,dy_tautau,dibosons_other:1.05
python stack_plot.py plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/renominal/histosel.root plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/renominal/histosel.root -o plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys --data-nick data_other --overwrite --lumi 1 -c el_sel    -d Mt_lep_met_c --ratio-range 0.5  --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --legend-shift 0.02   --y-range 0,250.  --rename-sys TauIDDown --factor-rate-systematic tt_eltau,tt_eltau,tt_taultauh,s_top_eltau,s_top_eltau,s_top_other,dy_tautau,dibosons_other:0.95


hadd -f histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_test_renom.root plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/plots,*root plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/renominal/*root




hadd -f histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_test.root plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/*root plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/other/*root

hadd -f histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats.root plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/*root

final fix:

hadd -f histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats.root plots/test/v37_test15_bunchFULLFIT1_nocats_tau_sys/plots,*root



python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r --lumi 1 -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02  --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --y-range 0,250. --uncertainty-systematic TauMisID

python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r --lumi 1 -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02  --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --y-range 0,250. --uncertainty-systematic TauID


python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r --lumi 1 -c mu_sel    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02  --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --y-range 0,250. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID

python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r --lumi 1 -c el_sel    -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02  --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --y-range 0,250. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID



python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c mu_sel -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, p^{miss}_{T}) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj:tt_muj.tt_taultauh,tt_other. --y-range 0,250. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPmuTRG,LEPmuID,TauMisID,TauID --lumi-label 35.8

python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c el_sel -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, p^{miss}_{T}) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj:tt_elj.tt_taultauh,tt_other. --y-range 0,250. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --lumi-label 35.8



### some spike in uncertainty in eltau

full sys:

python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c el_sel -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj:tt_elj.tt_taultauh,tt_other. --y-range 0,250. --uncertainty-systematic bSF,PU,JES,JER,TES,LEPelTRG,LEPelID,TauMisID,TauID --lumi-label 35.8

no sys:

python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c el_sel -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj:tt_elj.tt_taultauh,tt_other. --y-range 0,250. --lumi-label 35.8

-- no spike

python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c el_sel -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj:tt_elj.tt_taultauh,tt_other. --y-range 0,250. --uncertainty-systematic TauMisID,TauID --lumi-label 35.8

-- here


python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c el_sel -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj:tt_elj.tt_taultauh,tt_other. --y-range 0,250. --uncertainty-systematic TauMisID --lumi-label 35.8

-- here at 60-80

python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c el_sel -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj:tt_elj.tt_taultauh,tt_other. --y-range 0,250. --uncertainty-systematic TauID    --lumi-label 35.8

-- and here at 60-80

python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_with_tauSys.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c el_sel -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj:tt_elj.tt_taultauh,tt_other. --y-range 0,250. --sys TauMisIDUp --lumi-label 35.8

-- it's from MC QCD

histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_test_renom.root

python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_test_renom.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_test_renom.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c el_sel -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj:tt_elj.tt_taultauh,tt_other. --y-range 0,250. --sys TauMisIDUp --lumi-label 35.8

python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_test_renom.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_test_renom.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c el_sel -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj:tt_elj.tt_taultauh,tt_other. --y-range 0,250. --uncertainty-systematic TauMisID --lumi-label 35.8

-- qcd is still there, even in nominal distr!

python stack_plot.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_test_renom.root histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_test_renom.root -o plots/update-v8_plot_with_sys/ --data-nick data_other --overwrite -p -r -c el_sel -d Mt_lep_met_c --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_lj,tt_taulj:tt_elj.tt_taultauh,tt_other. --y-range 0,250. --sys NOMINAL --lumi-label 35.8

-- here it is
   fixed the typo in hadd
   now ok





## NLL in the full phase space and with all scans on 1 plot

python ttxsec/fit-stuff/plot_uncertainty_scans.py v37_test15_exp_unc --xsec-scale 831.76
python ttxsec/fit-stuff/plot_uncertainty_scans.py v37_test15_exp_unc --xsec-scale 831.76 --title-x "cross section [pb]"


## plot sig-bckg shape without Y title

python get_shapes.py --x-title "M_{T}(l, MET) [GeV]" --y-title "" --norm-binwidth --formula "background:signal" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "signal":distrs/v37_test15_bunchFULLFIT1_mc_1.root:mu_selVloose/tt_mutau/NOMINAL "background":distrs/v37_test15_bunchFULLFIT1_mc_1.root:mu_selVloose/tt_lj/NOMINAL --y-range 0,0.015

and with correct label

python get_shapes.py --x-title "M_{T}(l, p^{miss}_{T}) [GeV]" --y-title "" --norm-binwidth --formula "background:signal" -c mu_selVloose -d Mt_lep_met_c -p tt_lj "signal":distrs/v37_test15_bunchFULLFIT1_mc_1.root:mu_selVloose/tt_mutau/NOMINAL "background":distrs/v37_test15_bunchFULLFIT1_mc_1.root:mu_selVloose/tt_lj/NOMINAL --y-range 0,0.015



## justify 60GeV cut in lj categories

check the separation of sig/background and statistics per different cuts for el and mu sel

-- 58GeV did separate them into equal stats, but maybe the sig/bckg separation is better with 60GeV?
   also everything must differ in el and mu

plot the diagram of lj cuts:

S S1 S2
B B1 B2
  C1 C2

min |C1 - C2|
max |S1 - B1|

-- scatter plot for different values of lj cut

signal and background

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>30 && gen_proc_id<40)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_sig_nocut.root --histo-name sig_nocut lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>20 && gen_proc_id<30)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_bck_nocut.root --histo-name bck_nocut lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<20.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_sig_less20.root --histo-name sig_less20 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<20.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_bck_less20.root --histo-name bck_less20 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<40.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_sig_less40.root --histo-name sig_less40 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<40.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_bck_less40.root --histo-name bck_less40 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<50.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_sig_less50.root --histo-name sig_less50 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<50.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_bck_less50.root --histo-name bck_less50 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<55.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_sig_less55.root --histo-name sig_less55 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<55.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_bck_less55.root --histo-name bck_less55 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<57.5)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_sig_less57_5.root --histo-name sig_less57_5 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<57.5)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_bck_less57_5.root --histo-name bck_less57_5 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<60.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_sig_less60.root --histo-name sig_less60 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<60.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_bck_less60.root --histo-name bck_less60 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<62.5)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_sig_less62_5.root --histo-name sig_less62_5 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<62.5)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_bck_less62_5.root --histo-name bck_less62_5 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<65.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_sig_less65.root --histo-name sig_less65 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<65.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_bck_less65.root --histo-name bck_less65 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<70.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_sig_less70.root --histo-name sig_less70 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<70.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_bck_less70.root --histo-name bck_less70 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<90.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_sig_less90.root --histo-name sig_less90 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<90.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_bck_less90.root --histo-name bck_less90 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<150.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_sig_less150.root --histo-name sig_less150 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<150.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_bck_less150.root --histo-name bck_less150 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<250.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_sig_less250.root --histo-name sig_less250 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 9 || selection_stage == 7) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<250.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_bck_less250.root --histo-name bck_less250 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

hadd -f v37_test15_all_lj_cut_diagram.root v37_test15_lj_cut_diagram_*.root

root -l v37_test15_all_lj_cut_diagram.root

cout << "20"  << ',' << sig_less20->Integral() << ',' << bck_less20->Integral() << endl
cout << "40"  << ',' << sig_less40->Integral() << ',' << bck_less40->Integral() << endl
cout << "50"  << ',' << sig_less50->Integral() << ',' << bck_less50->Integral() << endl
cout << "55"  << ',' << sig_less55->Integral() << ',' << bck_less55->Integral() << endl
cout << "57_5" << ',' << sig_less57_5->Integral() << ',' << bck_less57_5->Integral() << endl
cout << "60"  << ',' << sig_less60->Integral() << ',' << bck_less60->Integral() << endl
cout << "62_5" << ',' << sig_less62_5->Integral() << ',' << bck_less62_5->Integral() << endl
cout << "65"  << ',' << sig_less65->Integral() << ',' << bck_less65->Integral() << endl
cout << "70"  << ',' << sig_less70->Integral() << ',' << bck_less70->Integral() << endl
cout << "90"  << ',' << sig_less90->Integral() << ',' << bck_less90->Integral() << endl
cout << "150" << ',' << sig_less150->Integral() << ',' << bck_less150->Integral() << endl
cout << "250" << ',' << sig_less250->Integral() << ',' << bck_less250->Integral() << endl
cout << "all" << ',' << sig_nocut->Integral()  << ',' << bck_nocut->Integral() << endl

cut,S1,B1
20,3328.42,4261.75
40,9435.7,7715.29
50,12122.9,8843.6
55,13184.2,9267.25
57_5,13634.1,9431.56
60,14067.9,9610.53
62_5,14523.8,9775.78
65,14931.6,9922.25
70,15620.6,10168.9
90,17898.7,10931
150,22308.7,12372.9
250,25970.1,13469.2

all,36512.8,16285.8

R
cuts = read.csv("data.csv", header=T)
S = 36512.8
B = 16285.8

cuts$S2 = S - cuts$S1
cuts$B2 = B - cuts$B1

cuts$C1 = cuts$S1 + cuts$B1
cuts$C2 = cuts$S2 + cuts$B2

library(ggplot2)

ggplot(cuts, aes(abs(C1-C2), abs(S1-B1))) + geom_point()

ggplot(cuts, aes(abs(C1-C2), abs(S1-B1))) + geom_text(label=cuts$cut)

-- 70 is clearly the best

ggplot(cuts, aes(abs(C1-C2), S1/B1)) + geom_text(label=cuts$cut)


ggplot(cuts, aes(abs(C1-C2), abs(S2-B2))) + geom_text(label=cuts$cut)

-- damn, clearly 70 is the best

ggplot(cuts, aes(C1-C2, (S2-B2)/C2)) + geom_text(label=cuts$cut) + geom_text(mapping=aes(x=C1-C2, y=(S1-B1)/C1, label=cuts$cut))
ggplot(cuts, aes(C1-C2, (S2-B2)/C2)) + geom_text(label=cuts$cut) + geom_text(mapping=aes(x=C1-C2, y=(B1-S1)/C1, label=cuts$cut), color="red")

-- I think, back then I tried to find a cut with background > signal in one category...

ggplot(cuts, aes(C1-C2, S2/S-B2/B)) + geom_text(label=cuts$cut)
ggplot(cuts, aes(C1-C2, S2/S-B2/B)) + geom_text(label=cuts$cut) + geom_text(mapping=aes(x=C2-C1, y=S1/S-B1/B, label=cuts$cut), color="red")

ggplot(cuts, aes(C1-C2, S2/C2-B1/C1)) + geom_text(label=cuts$cut)

ggplot(cuts, aes(C1-C2, (S2-B2)/(S1-B1))) + geom_text(label=cuts$cut)

maybe try the angle between vectors of the matrix: (S1/S, B1/B) and (S2/S, B2/B)

ggplot(cuts, aes(C1-C2, (S1/S)*(S2/S) + (B1/B)*(B2/B))) + geom_text(label=cuts$cut)

-- max is around 65GeV??
   TODO: check what this means
         does it mean the vectors are the closest to each other and solve the questions poorly

ggplot(cuts, aes(C1-C2, (B1/S1)^2 + (S2/B2)^2)) + geom_text(label=cuts$cut)
ggplot(cuts, aes(abs(C1-C2), (B1/S1)^2 + (S2/B2)^2)) + geom_text(label=cuts$cut)

ggplot(cuts, aes(abs(C1-C2), (B2/S2)^2 + (S1/B1)^2)) + geom_text(label=cuts$cut)

ggplot(cuts, aes(C1-C2, S1, label=cut)) + geom_text() +
    geom_text(mapping=aes(y=S2), color="red") +
    geom_text(mapping=aes(y=B1), color="green") +
    geom_text(mapping=aes(y=B2), color="blue")

-- signals cross at about 90
   backgrounds at 45
   in C1-C2 the 60 is indeed around the middle between the two points

ggplot(cuts, aes(C1-C2, (S2-B2)/C2, label=cut)) + geom_text() +
    geom_text(mapping=aes(y=(B1-S1)/C1), color="red")

ggplot(cuts, aes(abs(C1-C2), S2-B2, label=cuts$cut)) + geom_text() +
    geom_text(mapping=aes(y=B1-S1), color="red")

-- I want to maximize both Y axes
   the line B1-S1 is mostly < 0, because overall there are more signal than background everywhere
   so, I must compare fractions of signal and background?

ggplot(cuts, aes(B1/B, S1/S, label=cuts$cut)) + geom_text() +
    geom_text(mapping=aes(x=B2/B, y=S2/S), color="red")

ggplot(cuts, aes(C1-C2, (B1/B - B2/B)^2 + (S1/S - S2/S)^2, label=cuts$cut)) + geom_text()

ggplot(cuts, aes(C1-C2, ((B1/B - B2/B)^2 + (S1/S - S2/S)^2)/(((S1/S)^2 + (B1/B)^2)*((S2/S)^2 + (B2/B)^2)), label=cuts$cut)) + geom_text()

ggplot(cuts, aes(C1-C2, (B1/B*B2/B + S1/S*S2/S)/(((S1/S)^2 + (B1/B)^2)*((S2/S)^2 + (B2/B)^2)), label=cuts$cut)) + geom_text()

-- here the minimum is at 55 -- 57.5 -- 60
   but it is the minimal angle between two vectors,
   if we maximize the angle, than it's the worst combination
nope! without sqrt it's not the cosine!

ggplot(cuts, aes(C1-C2, (B1/B*B2/B + S1/S*S2/S)/sqrt(((S1/S)^2 + (B1/B)^2)*((S2/S)^2 + (B2/B)^2)), label=cuts$cut)) + geom_text()

-- a line from 0.9 to 0.95,
   60 does have smaller cosine than 70!

ggplot(cuts, aes((C1-C2)/(C1+C2), (B1/B*B2/B + S1/S*S2/S)/sqrt(((S1/S)^2 + (B1/B)^2)*((S2/S)^2 + (B2/B)^2)), label=cuts$cut)) + geom_text()

60 is about -0.125

ggplot(cuts, aes((C1-C2)/(C1+C2), S2/S1, label=cuts$cut)) + geom_text() +
    geom_text(mapping=aes(y=B1/B2), color="red")


p <- ggplot(cuts, aes((C1-C2)/(C1+C2), S2/S1, label=cuts$cut)) + geom_text() +
    geom_text(mapping=aes(y=B1/B2), color="red") +
    scale_y_log10()


g <- ggplotGrob(p)

g[[1]][[13]]$children[[1]]$label <- c("S2/S1;",  "B1/B2")
g[[1]][[13]]$children[[1]]$gp$col <- c("black", "red")
g[[1]][[13]]$children[[1]]$hjust <- c(1, 0)
g[[1]][[13]]$children[[1]]$y <- unit(c(0.5, 0.5), "npc")

plot(g)

ggsave("tradeoff_lj_cut_in_main_selection_muontau.png")



-- what's in el channel?

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>30 && gen_proc_id<40)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_sig_nocut.root --histo-name sig_el_nocut lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>20 && gen_proc_id<30)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_bck_nocut.root --histo-name bck_el_nocut lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<20.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_sig_el_less20.root --histo-name sig_el_less20 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<20.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_bck_el_less20.root --histo-name bck_el_less20 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<40.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_sig_el_less40.root --histo-name sig_el_less40 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<40.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_bck_el_less40.root --histo-name bck_el_less40 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<50.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_sig_el_less50.root --histo-name sig_el_less50 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<50.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_bck_el_less50.root --histo-name bck_el_less50 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<55.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_sig_el_less55.root --histo-name sig_el_less55 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<55.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_bck_el_less55.root --histo-name bck_el_less55 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<57.5)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_sig_el_less57_5.root --histo-name sig_el_less57_5 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<57.5)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_bck_el_less57_5.root --histo-name bck_el_less57_5 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<60.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_sig_el_less60.root --histo-name sig_el_less60 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<60.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_bck_el_less60.root --histo-name bck_el_less60 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<62.5)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_sig_el_less62_5.root --histo-name sig_el_less62_5 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<62.5)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_bck_el_less62_5.root --histo-name bck_el_less62_5 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<65.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_sig_el_less65.root --histo-name sig_el_less65 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<65.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_bck_el_less65.root --histo-name bck_el_less65 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<70.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_sig_el_less70.root --histo-name sig_el_less70 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<70.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_bck_el_less70.root --histo-name bck_el_less70 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<90.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_sig_el_less90.root --histo-name sig_el_less90 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<90.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_bck_el_less90.root --histo-name bck_el_less90 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<150.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_sig_el_less150.root --histo-name sig_el_less150 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<150.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_bck_el_less150.root --histo-name bck_el_less150 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>30 && gen_proc_id<40 && event_jets_lj_var<250.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_sig_el_less250.root --histo-name sig_el_less250 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "((selection_stage == 19 || selection_stage == 17) && gen_proc_id>20 && gen_proc_id<30 && event_jets_lj_var<250.)*event_weight" --histo-range 5,0,5 --output v37_test15_lj_cut_diagram_el_bck_el_less250.root --histo-name bck_el_less250 lstore_outdirs/v37/test15/MC2016_Summer16_TTJets_powheg/*root &

hadd -f v37_test15_all_lj_cut_diagram.root v37_test15_lj_cut_diagram_*.root

root -l v37_test15_all_lj_cut_diagram.root

cout << "20"   << ',' << sig_el_less20->Integral()   << ',' << bck_el_less20->Integral() << endl
cout << "40"   << ',' << sig_el_less40->Integral()   << ',' << bck_el_less40->Integral() << endl
cout << "50"   << ',' << sig_el_less50->Integral()   << ',' << bck_el_less50->Integral() << endl
cout << "55"   << ',' << sig_el_less55->Integral()   << ',' << bck_el_less55->Integral() << endl
cout << "57_5" << ',' << sig_el_less57_5->Integral() << ',' << bck_el_less57_5->Integral() << endl
cout << "60"   << ',' << sig_el_less60->Integral()   << ',' << bck_el_less60->Integral() << endl
cout << "62_5" << ',' << sig_el_less62_5->Integral() << ',' << bck_el_less62_5->Integral() << endl
cout << "65"   << ',' << sig_el_less65->Integral()   << ',' << bck_el_less65->Integral() << endl
cout << "70"   << ',' << sig_el_less70->Integral()   << ',' << bck_el_less70->Integral() << endl
cout << "90"   << ',' << sig_el_less90->Integral()   << ',' << bck_el_less90->Integral() << endl
cout << "150"  << ',' << sig_el_less150->Integral()  << ',' << bck_el_less150->Integral() << endl
cout << "250"  << ',' << sig_el_less250->Integral()  << ',' << bck_el_less250->Integral() << endl
cout << "all"  << ',' << sig_el_nocut->Integral()    << ',' << bck_el_nocut->Integral() << endl






## the question on the advantage of lj categories

fit with no shape

python stack_plot.py distrs/v37_test15_bunchFULLFIT1_mc_1.root distrs/v37_test15_bunchFULLFIT1/SingleMuon.root -o plots/ -p -r --lumi 35800 -c mu_sel_lj -d Mt_lep_met_f --wjet 1.4 --qcd 1.05 --ratio-range 0.5 --title "" --title-x "M_{T}(, MET) [GeV]" --title-y "Events" --data-nick data_other --overwrite --rebin 20

make run_std_histos_no_shape out=histosels/v37_test15_bunchFULLFIT1_noshape/ options='"--rebin 20"' distr=Mt_lep_met_f wjets_norm=1.4 lumi_mu=35800 lumi_el=35800 mc=distrs/v37_test15_bunchFULLFIT1_mc_1.root data_mu=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root data_el=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root

make run_histos     --dry-run mc=distrs/v37_test15_bunchFULLFIT1_mc_1.root data=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root options="--rebin 20" lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test15_bunchFULLFIT1_noshape/ wjets_norm=1.4 chan=mu_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_lj" & \


make both mucard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noshapes elcard=ttxsec/datacard_v37_test15_bunchFULLFIT1_el_exp_noshapes bothcard=ttxsec/datacard_v37_test15_bunchFULLFIT1_both_exp_noshapes

make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noshapes
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_el_exp_noshapes
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_both_exp_noshapes

make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noshapes.root   nn=v37_test15_mu_exp_noshapes
make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_el_exp_noshapes.root   nn=v37_test15_el_exp_noshapes
make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_both_exp_noshapes.root nn=v37_test15_both_exp_noshapes



and fit with no lj categories

sel with all sys?
-- yes! present in the v37_test15_bunchFULLFIT1_mc_1.root

make run_std_histos_nocats out=histosels/v37_test15_bunchFULLFIT1_nocats/ distr=Mt_lep_met_c wjets_norm=1.4 lumi_mu=35800 lumi_el=35800 mc=distrs/v37_test15_bunchFULLFIT1_mc_1.root data_mu=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root data_el=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root

hadd histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats.root histosels/v37_test15_bunchFULLFIT1_nocats/*root

python numbers_for_datacard.py histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats.root -d Mt_lep_met_c -c el_sel,mu_sel --data-nick data_other

make both mucard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_nocats elcard=ttxsec/datacard_v37_test15_bunchFULLFIT1_el_exp_nocats bothcard=ttxsec/datacard_v37_test15_bunchFULLFIT1_both_exp_nocats

make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_nocats
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_el_exp_nocats
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_both_exp_nocats

make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_nocats.root   nn=v37_test15_mu_exp_nocats
make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_el_exp_nocats.root   nn=v37_test15_el_exp_nocats
make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_both_exp_nocats.root nn=v37_test15_both_exp_nocats


hmm? in nocats the fakes and FSR are much smaller than usually? (and correspondingly the overall uncertainty is about 0.2% smaller)
-- are pre-fit tau fakes reduced to 20%?
   no, they are 50%
-- try without MC stat?
-- rerun the usual exp

make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   nn=v37_test15_mu_exp_2

   r :    +0.945   -0.070/+0.076 (68%)

make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_nocats.root   nn=v37_test15_mu_exp_nocats

   r :    +0.947   -0.068/+0.074 (68%)

-- smaller per-bin stats?
   -- test the toys

make impacts_toys workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_nocats.root nn=mu_v37_test15_mu_exp_1_nocats
make impacts_toys workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.root            nn=mu_v37_test15_mu_1
make impacts_toys workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root        nn=mu_v37_test15_mu_exp_1

   r :    +1.000   -0.070/+0.080 (68%)
   r :    +1.000   -0.075/+0.089 (68%)
   r :    +1.000   -0.071/+0.082 (68%)

-- damn! the 0.1-0.2%
   and as before, the fakes and FSR are much smaller in nocats
   -- FSR and others must have different variation in nocats!!!!!!!!!!!!!!!!

rescale to larger lumi

make run_std_histos        out=histosels/v37_test15_bunchFULLFIT1_100fb_cat/    distr=Mt_lep_met_c wjets_norm=1.4 lumi_mu=100000 lumi_el=100000 mc=distrs/v37_test15_bunchFULLFIT1_mc_1.root data_mu=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root data_el=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root
make run_std_histos_nocats out=histosels/v37_test15_bunchFULLFIT1_100fb_nocats/ distr=Mt_lep_met_c wjets_norm=1.4 lumi_mu=100000 lumi_el=100000 mc=distrs/v37_test15_bunchFULLFIT1_mc_1.root data_mu=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root data_el=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root

-- try the parameters in the combine
   -- combine gitbook is 404?

dilep_norm              extArg                   1.         [0.8,1.2]
tau_ratio               extArg                   1.         [0.85,1.15]
rate_elmu               rateParam  elmu     tt_other  (@0)   dilep_norm
rate_eltau              rateParam  el       tt_eltau (@0*@1) dilep_norm,tau_ratio

make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_100fb
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_nocats_100fb

make impacts_toys workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_nocats_100fb.root nn=mu_v37_test15_mu_exp_1_nocats_100fb
make impacts_toys workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_100fb.root        nn=mu_v37_test15_mu_exp_1_100fb

   r :    +1.000   -0.137/+0.162 (68%)
   r :    +1.000   -0.122/+0.151 (68%)

-- lol! unc even larger?
also it has no freeze lumi!

   r :    +1.000   -0.137/+0.162 (68%)
   r :    +1.000   -0.123/+0.151 (68%)

-- same

more stat -- larger uncertainty, but caregories do help?
-- why on Earth the uncertainty is larger?

   in both cases, the largest uncertainty is fakes, then JES, then MC stat

try no MC stat

make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_100fb_noMCstat
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_nocats_100fb_noMCstat

make impacts_toys workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_nocats_100fb_noMCstat.root nn=mu_v37_test15_mu_exp_1_nocats_100fb_noMCstat
make impacts_toys workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_100fb_noMCstat.root        nn=mu_v37_test15_mu_exp_1_100fb_noMCstat




ok, try normal lumi now, with frozen lumi nuisance

make impacts_toys workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_nocats.root nn=mu_v37_test15_mu_exp_1_nocats
make impacts_toys workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root        nn=mu_v37_test15_mu_exp_1

   r :    +1.000   -0.067/+0.077 (68%)
   r :    +1.000   -0.069/+0.079 (68%)

-- same, just lumi was significant uncertainty

try without FSR

make impacts_toys workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_nocats.root nn=mu_v37_test15_mu_exp_1_nocats_noFSR   freeze="--freezeParameters lumi_13TeV,FSR"
make impacts_toys workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root        nn=mu_v37_test15_mu_exp_1_noFSR          freeze="--freezeParameters lumi_13TeV,FSR"

   r :    +1.000   -0.066/+0.077 (68%)
   r :    +1.000   -0.066/+0.076 (68%)

-- aha
   look at fakes, their impact and constraint now

   fakes are asymmetric, more so in nocats,
   they are constrained to about the same impact, 7th in usual and 10th in nocats, but the magnitude is the same

   also ISR is one of the largest now

make impacts_toys workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_nocats.root nn=mu_v37_test15_mu_exp_1_nocats_noFSR_noISR   freeze="--freezeParameters lumi_13TeV,FSR,ISR"
make impacts_toys workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root        nn=mu_v37_test15_mu_exp_1_noFSR_noISR          freeze="--freezeParameters lumi_13TeV,FSR,ISR"

   r :    +1.000   -0.065/+0.075 (68%)
   r :    +1.000   -0.064/+0.073 (68%)

no updaowns and no Frag-s etc (they are constrained in _exp!)

make impacts_toys workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_nocats.root nn=mu_v37_test15_mu_exp_1_nocats_noUpdowns_noFrags freeze="--freezeParameters lumi_13TeV --freezeNuisanceGroup tt_updowns,tt_th_frag"
make impacts_toys workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root        nn=mu_v37_test15_mu_exp_1_noUpdowns_noFrags        freeze="--freezeParameters lumi_13TeV --freezeNuisanceGroup tt_updowns,tt_th_frag"

   r :    +1.000   -0.062/+0.071 (68%)
   r :    +1.000   -0.062/+0.070 (68%)

-- ok


and now, I need to compare the fakes in these selections + no shape

make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noshapes.root   nn=v37_test15_mu_exp_noshapes_noUpdowns_noFrags freeze="--freezeParameters lumi_13TeV --freezeNuisanceGroup tt_updowns,tt_th_frag"

   r :    +1.049   -0.131/+0.113 (68%)

-- signal is pulled?

-- compare only fakes in all 3

python new_impact_table.py --merge-pdf  ./latest_impacts_mu_v37_test15_mu_exp_1_noUpdowns_noFrags_toys.json
$\tauh$ jet identification  &  4.9 \\
           PU uncertainty  &  2.3 \\
     b-tagging efficiency  &  1.5 \\
$\tauh$ misidentification background  &  1.1 \\
       muon ID efficiency  &  0.7 \\
                      TES  &  0.6 \\
 Single Top normalization  &  0.6 \\
...

python new_impact_table.py --merge-pdf  ./latest_impacts_mu_v37_test15_mu_exp_1_nocats_noUpdowns_noFrags_toys.json                                                                                                                                                             
$\tauh$ jet identification  &  4.9 \\
           PU uncertainty  &  2.2 \\
     b-tagging efficiency  &  1.3 \\
$\tauh$ misidentification background  &  1.2 \\
       muon ID efficiency  &  0.7 \\
...

python new_impact_table.py --merge-pdf  ./latest_impacts_v37_test15_mu_exp_noshapes_noUpdowns_noFrags.json
$\tauh$ misidentification background  &  9.7 \\
                      JES  &  9.3 \\
$\tauh$ jet identification  &  6.1 \\
     b-tagging efficiency  &  4.1 \\
     W+jets normalization  &  2.6 \\
           PU uncertainty  &  2.1 \\
                      TES  &  1.8 \\
                      JER  &  1.7 \\
       muon ID efficiency  &  1.3 \\
 Single Top normalization  &  0.9 \\
...

-- why JES is so large and why fakes are not constrained?
   also, fakes are pulled to -0.5!!!?
   but they are constrained about the same as in usual fits

make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noshapes.root   nn=v37_test15_mu_exp_noshapes_noUpdowns_noFrags_noJES freeze="--freezeParameters lumi_13TeV,JES --freezeNuisanceGroup tt_updowns,tt_th_frag"

   r :    +1.057   -0.093/+0.101 (68%)

python new_impact_table.py --merge-pdf  ./latest_impacts_v37_test15_mu_exp_noshapes_noUpdowns_noFrags_noJES.json

$\tauh$ jet identification  &  6.2 \\
$\tauh$ misidentification background  &  5.1 \\
     b-tagging efficiency  &  4.6 \\
     W+jets normalization  &  2.5 \\
           PU uncertainty  &  2.1 \\
                      JER  &  2.0 \\
                      TES  &  1.5 \\
       muon ID efficiency  &  1.2 \\
 Single Top normalization  &  1.0 \\
...

-- fakes are still pulled to -0.5
   and no parameter except signal compensates for it!

make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noshapes.root   nn=v37_test15_mu_exp_noshapes_noUpdowns_noFrags_noJES freeze="--freezeParameters lumi_13TeV,JES --freezeNuisanceGroup tt_updowns,tt_th_frag,tt_th_pdf"

   r :    +1.057   -0.093/+0.101 (68%)

-- damn! make toys

make impacts_toys  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noshapes.root   nn=v37_test15_mu_exp_noshapes_noUpdowns_noFrags_noJES freeze="--freezeParameters lumi_13TeV,JES --freezeNuisanceGroup tt_updowns,tt_th_frag,tt_th_pdf"

   r :    +1.000   -0.090/+0.100 (68%)

  tauID_eff :   -0.000  -0.994/+0.994  +0.059/-0.057

  Parameter :   Best-fit               r            
  tau_fakes :   +0.000  -0.252/+0.226WARNING: underflow to inf in pdf_binmu_sel_lj_obsOnly for bin 0, weight 10202.3
FASTEXIT from pdf_binmu_sel_lj_obsOnly
WARNING: underflow to inf in pdf_binmu_sel_ljout_obsOnly for bin 0, weight 12888.9
FASTEXIT from pdf_binmu_sel_ljout_obsOnly
[#0] WARNING:Minization -- RooMinimizerFcn: Minimized function has error status.

python new_impact_table.py --merge-pdf  ./latest_impacts_v37_test15_mu_exp_noshapes_noUpdowns_noFrags_noJES_toys.json

-- and there are no fakes in the table



-- make NLL and save fakes, probably several minima

combine -M MultiDimFit ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noshapes.root -t -1 --expectSignal 1. --algo grid --points 100 --rMax 2 --name v37_test15_mu_exp_noshapes_noUpdowns_noFrags_noJES --forceRecreateNLL --saveSpecifiedNuis TOPPT,tau_fakes,tauID_eff --freezeParameters lumi_13TeV,JES --freezeNuisanceGroup tt_updowns,tt_th_frag,tt_th_pdf

root -l higgsCombinev37_test15_mu_exp_noshapes_noUpdowns_noFrags_noJES.MultiDimFit.mH120.root
limit->Draw("2*deltaNLL:r",         "deltaNLL>0 && 2*deltaNLL<10", "L")
limit->Draw("2*deltaNLL:tauID_eff", "deltaNLL>0 && 2*deltaNLL<10", "L")
limit->Draw("2*deltaNLL:tau_fakes", "deltaNLL>0 && 2*deltaNLL<10", "L")

-- at 2 (where the variation of tauID_eff ~= 1.) the fakes are varied to slightly less than 0.2

let's try fakes 20%

make workspace      datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noshapes
make impacts_toys  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noshapes.root   nn=v37_test15_mu_exp_noshapes_noUpdowns_noFrags_noJES freeze="--freezeParameters lumi_13TeV,JES --freezeNuisanceGroup tt_updowns,tt_th_frag,tt_th_pdf"

   r :    +1.000   -0.086/+0.096 (68%)

-- sure

  tau_fakes :   +0.000  -0.494/+0.457  +0.046/-0.039

try 30% and 40%

make impacts_toys  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noshapes.root   nn=v37_test15_mu_exp_noshapes_noUpdowns_noFrags_noJES_30p freeze="--freezeParameters lumi_13TeV,JES --freezeNuisanceGroup tt_updowns,tt_th_frag,tt_th_pdf"

   r :    +1.000   -0.088/+0.098 (68%)
  tau_fakes :   +0.000  -0.370/+0.337  +0.049/-0.041

make impacts_toys  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noshapes.root   nn=v37_test15_mu_exp_noshapes_noUpdowns_noFrags_noJES_40p freeze="--freezeParameters lumi_13TeV,JES --freezeNuisanceGroup tt_updowns,tt_th_frag,tt_th_pdf"

   r :    +1.000   -0.089/+0.099 (68%)
  tau_fakes :   +0.000  -0.298/+0.269  +0.050/-0.042

make impacts_toys  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_noshapes.root   nn=v37_test15_mu_exp_noshapes_noUpdowns_noFrags_noJES_50p freeze="--freezeParameters lumi_13TeV,JES --freezeNuisanceGroup tt_updowns,tt_th_frag,tt_th_pdf"

   r :    +1.000   -0.090/+0.100 (68%)
  tau_fakes :   +0.000  -0.252/+0.226WARNING: underflow to inf in pdf_binmu_sel_lj_obsOnly for bin 0, weight 10202.3
FASTEXIT from pdf_binmu_sel_lj_obsOnly
WARNING: underflow to inf in pdf_binmu_sel_ljout_obsOnly for bin 0, weight 12888.9
FASTEXIT from pdf_binmu_sel_ljout_obsOnly
[#0] WARNING:Minization -- RooMinimizerFcn: Minimized function has error status.





also and in no cats and no shape -- then start from here, how much each method improves this result:
from 50%->5% with only categories and from 50%->2.5% with only shape and 50->2% with both

make run_std_histos_nocats out=histosels/v37_test15_bunchFULLFIT1_nocats/ options='"--rebin 20"' distr=Mt_lep_met_f wjets_norm=1.4 lumi_mu=35800 lumi_el=35800 mc=distrs/v37_test15_bunchFULLFIT1_mc_1.root data_mu=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root data_el=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root

histosels/datafile_HISTOSEL_v37_test15_bunchFULLFIT1_nocats_noshape.root

make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_nocats_noshape_noMCstat

-- the workspace crashes for the datacard with autoMCstat

make impacts_toys  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_nocats_noshape_noMCstat.root   nn=v37_test15_mu_exp_nocats_noshapes_noUpdowns_noFrags_noJES_50p freeze="--freezeParameters lumi_13TeV,JES --freezeNuisanceGroup tt_updowns,tt_th_frag,tt_th_pdf"

   r :    +1.000   -0.293/+0.215 (68%)
  tau_fakes :   +0.000  -0.994/+0.994  +0.191/-0.286

-- so, from 25% of uncertainty

the uncertainty with 20% variation of fakes should be 0.2 of this:

make impacts_toys  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp_nocats_noshape_noMCstat.root   nn=v37_test15_mu_exp_nocats_noshapes_noUpdowns_noFrags_noJES_20p freeze="--freezeParameters lumi_13TeV,JES --freezeNuisanceGroup tt_updowns,tt_th_frag,tt_th_pdf"

   r :    +1.000   -0.136/+0.130 (68%)
  tauID_eff :   +0.000  -0.994/+0.994  +0.058/-0.055
  tau_fakes :   +0.000  -0.994/+0.994  +0.095/-0.114

-- aha





# post-update v37 test13

Three main problems:
1) the fit in both channels is asymmetric from the separate channels
   -- test14 with fixes
      does not change the asymmetry, what happens is the fit in el pulls TOPPT Up, but mu does not
      then the fit in both pulls TOPPT Up too
      this asymmetric uncertainty + the correlated ones switch the fit into another domain of nuisances
      for example, the fit looks perfect without TOPPT, also good without TOPPT and Frag, ok without Frag only

      Frag alone produces too large impact
      -- it is due to new b-frag weights in the ntuples, which have about 1/4 larger variation (the old one around 2% new is 2.5%)
         the weights changed in ntuples themselves since around v35
         the procedure for the weights did not change since than, neither in ntupler nor in BFrag plugin,
         maybe it is due to the switch to CMSSW 8 0 29 from 26?

      it's not clear why TOPPT is not prefered in mu, maybe because ljout is very flat there
      the TOPPT bends the distribution, which is suitable in el, but in mu it is not needed

      both uncertainties can be "shaken" into a different behavior with the change in lj variable (test15)

2) the pulls in muon channel for the systematics:
   JES, LEPmuID, LEPmuTRG, Peterson, TES
   -- FIXED
       the issue is the same in fit with all systematics and with less parameters, it also propagates to the fit of both channels
      there is no such issue in electron channel, el has some issue in Mf and some PDFs
3) DY tautau basic and 3j look strange in the distrs:
   different the composition in lep pT and tau pT (more qcd, wjets in one of them).
   -- NO, IT's FINE! the difference is between eltau and mutau plots!

Also:
1) high MET trends: MC>Data at high MET
   -- the TOPPT in elmu, presel and main selection does not fix them entirely
      it cannot be due to QCD -- it's in high MET, especially at 200-500GeV
   is it the reason of the disagreement in Mt?
   is it fixable with recoil corrections?
2) and lj in muon has too large disagreement?
   -- the fit in el and mu has different conditions, it fits different things, which is probably one of the sources of problems with asymmetry in fit of both channels etc
   actually lj seems similar in el and mu, but in ljout el has the bending trend and very large contribution of QCD, and mu is on contrary quite flat

asymmetric systematics:

TT weight sys look weird (Mf, Mr, Mfr) <- NO, IT's FINE! the MC distrs did not have QCD!
mu LEP                                 <- error with new per-epoch PU, wron place of parentheses
JES, TES and JER                       <- error in the propagation to met

why fit broke when one of the systematics was rate?

check goodness of the fit




## correcting plots for the Enriques suggestions

make --dry-run plot_sel_paper_1  nt=v37 proc=test13 distrs=bunchFULLFIT2 lumi=35800 chan_tag=mu datafile=SingleMuon     title_lep=#mu  merge_procs="--merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other" y_range="--y-range 0,250."
make --dry-run plot_sel_paper_1  nt=v37 proc=test13 distrs=bunchFULLFIT2 lumi=35800 chan_tag=el datafile=SingleElectron title_lep=e    merge_procs="--merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other" y_range="--y-range 0,200."

python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc.root distrs/v37_test13_bunchFULLFIT2/SingleMuon.root     -o plots/v37_test13_bunchFULLFIT2/paper/ --data-nick data_other --overwrite --y-range 0,250. -p -r --lumi 35800 -c mu_sel    -x mu_selVloose    -d Mt_lep_met_c --wjet 1.4 --qcd 1.05 --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]"       --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02  --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other
python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc.root distrs/v37_test13_bunchFULLFIT2/SingleElectron.root -o plots/v37_test13_bunchFULLFIT2/paper/ --data-nick data_other --overwrite --y-range 0,250. -p -r --lumi 35800 -c el_sel    -x el_selVloose    -d Mt_lep_met_c --wjet 1.4 --qcd 1.05 --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02  --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other

make  plot_sel_paper_1  nt=v37 proc=test13 distrs=bunchFULLFIT2 lumi=35800 chan_tag=mu datafile=SingleMuon     title_lep=#mu  merge_procs="--merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other" y_range="--y-range 0,250."
make  plot_sel_paper_1  nt=v37 proc=test13 distrs=bunchFULLFIT2 lumi=35800 chan_tag=el datafile=SingleElectron title_lep=e    merge_procs="--merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other" y_range="--y-range 0,200."



## redo the figures of QCD shape in OS and SS selections to have fitting dimensions -- the same as relIso plot

696x672

*2

1392 1344



root -l jobsums/distrs/v37_test5_bunch2_mc_4_amcatnlo.root

-- poor stats

TH1D* h_mu_presel    = (TH1D*) (mu_preselCand->Get("qcd_other/NOMINAL/mu_preselCand_qcd_other_NOMINAL_Mt_lep_met_f"))
TH1D* h_mu_presel_ss = (TH1D*) (mu_preselCand_ss->Get("qcd_other/NOMINAL/mu_preselCand_ss_qcd_other_NOMINAL_Mt_lep_met_f"))

h_mu_presel_ss ->SetLineColor(kRed)

h_mu_presel   ->SetXTitle("M_{T} (#mu, E^{miss}_{T}) [GeV]")

h_mu_presel    ->Draw()
h_mu_presel_ss ->Draw("same")

leg = new TLegend(0.6,0.7, 0.9,0.9)
leg->AddEntry(h_mu_presel,    "Opposite Sign", "l")
leg->AddEntry(h_mu_presel_ss, "Same Sign",     "l")

gStyle->SetOptStat(0)

leg->Draw("same")

c1->SaveAs("v37_test5_bunch2_mc_4_amcatnlo_mt_shapes_os_ss_mu_presel.png")
c1->SaveAs("v37_test5_bunch2_mc_4_amcatnlo_mt_shapes_os_ss_el_presel.png")


TODO: record it in scripts

time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=pQCDtest nt=v35   cond="(selection_stage==107 || selection_stage==105 || selection_stage==103 || selection_stage== 7 || selection_stage== 5 || selection_stage== 3)"  chan="mu_presel" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=pQCDtest nt=v35   cond="(selection_stage==106 || selection_stage==104 || selection_stage==102 || selection_stage== 6 || selection_stage== 4 || selection_stage== 2)"  chan="mu_presel_ss" &

hadd -f distrs_v35pQCDtest_QCD_HT_mu_preselCand.root distrs/*root

root -l distrs_v35pQCDtest_QCD_HT_mu_preselCand.root

gStyle->SetOptStat(0)
gROOT->SetBatch()

TH1D* h_mu_presel    = (TH1D*) (mu_presel->Get("qcd/NOMINAL/mu_presel_qcd_NOMINAL_Mt_lep_met_f/mu_presel_qcd_NOMINAL_mu_presel_qcd_NOMINAL_Mt_lep_met_f_mu_presel_qcd_NOMINAL_Mt_lep_met_f"))
TH1D* h_mu_presel_ss = (TH1D*) (mu_presel_ss->Get("qcd/NOMINAL/mu_presel_ss_qcd_NOMINAL_Mt_lep_met_f/mu_presel_ss_qcd_NOMINAL_mu_presel_ss_qcd_NOMINAL_Mt_lep_met_f_mu_presel_ss_qcd_NOMINAL_Mt_lep_met_f"))

h_mu_presel_ss ->SetLineColor(kRed)

h_mu_presel   ->SetXTitle("M_{T} (#mu, p^{miss}_{T}) [GeV]")

c1 = (TCanvas*) new TCanvas("c1","OS to SS", 1392, 1344)
c1->Draw()

h_mu_presel    ->Draw()
h_mu_presel_ss ->Draw("same")

leg = new TLegend(0.6,0.7, 0.9,0.9)
leg->AddEntry(h_mu_presel,    "Opposite Sign", "l")
leg->AddEntry(h_mu_presel_ss, "Same Sign",     "l")

leg->Draw("same")

left_title = (TPaveText*) new TPaveText(0.15, 0.845, 0.40, 0.89, "brNDC")
left_title->AddText("CMS simulation")
left_title->SetTextFont(1)
left_title->SetFillColor(0)
left_title->Draw("same")

c1->SaveAs("v35_pQCDtest_mt_shapes_os_ss_mu_presel.png")




## check the large impact of QCD in mu and both and not in el

is it correlated with W+jets?

which datacard was it?
el was around 1.02 -- the old lumi cert

reproduce the impacts:

make impacts  workspace=ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_bFrag.root   nn=v25v26_update_an9_p5_largeQCD      freeze="--freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf"
make impacts  workspace=ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_bFrag.root   nn=v25v26_update_an9_p5_largeQCD_el   freeze="--freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf"
make impacts  workspace=ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_bFrag.root nn=v25v26_update_an9_p5_largeQCD_both freeze="--freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf"

make impacts  workspace=ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_bFrag.root   nn=v25v26_update_an9_p5_largeQCD_mu_noWJets      freeze="--freezeParameters lumi_13TeV,wjets_norm --freezeNuisanceGroup tt_th_pdf"

python new_impact_table.py --merge-pdf  latest_impacts_v25v26_update_an9_p5_largeQCD.json  latest_impacts_v25v26_update_an9_p5_largeQCD_mu_noWJets.json latest_impacts_v25v26_update_an9_p5_largeQCD_el.json latest_impacts_v25v26_update_an9_p5_largeQCD_both.json

-- no, it's not


is it really an8 datacard?


make impacts  workspace=ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_noMC.root nn=searching_ANv8_datacard_both

python new_impact_table.py --merge-pdf  ./latest_impacts_searching_ANv8_datacard_both.json

     W+jets normalization  &  1.2 \\
        QCD normalization  &  0.8 \\

make impacts  workspace=ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_noMC.root nn=searching_ANv8_datacard_both freeze="--freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf"
python new_impact_table.py --merge-pdf  ./latest_impacts_searching_ANv8_datacard_both.json

make impacts  workspace=ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_noMC.root nn=searching_ANv8_datacard_both_noWJets freeze="--freezeParameters lumi_13TeV,wjets_norm --freezeNuisanceGroup tt_th_pdf"
python new_impact_table.py --merge-pdf  ./latest_impacts_searching_ANv8_datacard_both_noWJets.json

     W+jets normalization  &  1.1 \\
        QCD normalization  &  1.0 \\

noWJets
        QCD normalization  &  0.9 \\


make impacts  workspace=ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop.root nn=searching_ANv8_datacard_mu_lepMETprop freeze="--freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf"
python new_impact_table.py --merge-pdf ./latest_impacts_searching_ANv8_datacard_mu_lepMETprop.json

0.917

        QCD normalization  &  3.8 \\
$\tauh$ misidentification background  &  2.7 \\
     b-tagging efficiency  &  2.2 \\
           PU uncertainty  &  2.1 \\
                      JES  &  1.7 \\
     W+jets normalization  &  1.4 \\
                      TES  &  1.3 \\
       muon ID efficiency  &  0.9 \\

-- large QCD in mu!

make impacts  workspace=ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop.root nn=searching_ANv8_datacard_el_lepMETprop freeze="--freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf"
python new_impact_table.py --merge-pdf ./latest_impacts_searching_ANv8_datacard_el_lepMETprop.json

   r :    +0.985   -0.089/+0.094 (68%)

python new_impact_table.py --merge-pdf ./latest_impacts_searching_ANv8_datacard_el_lepMETprop.json ./latest_impacts_searching_ANv8_datacard_mu_lepMETprop.json

$\tauh$ jet identification  &  5.1 &  4.8 \\
        top quark $p_{T}$  &  2.8 &  4.0 \\
        QCD normalization  &  0.6 &  3.8 \\
electron trigger efficiency  &  2.8 \\
$\tauh$ misidentification background  &  2.6 &  2.7 \\
     b-tagging efficiency  &  1.9 &  2.2 \\
   electron ID efficiency  &  2.1 \\
           PU uncertainty  &  2.5 &  2.1 \\
                      JES  &  1.4 &  1.7 \\
     W+jets normalization  &  0.4 &  1.4 \\
                      TES  &  1.0 &  1.3 \\
       muon ID efficiency  &  0.9 \\
 Single Top normalization  &  0.7 &  0.5 \\
  muon trigger efficiency  &  0.4 \\
                      JER  &  0.2 &  0.3 \\
         DY normalization  &  0.3 &  0.3 \\
   Dibosons normalization  &  0.0 &  0.0 \\
               Luminosity  &  0.0 &  0.0 \\
          b fragmentation  &  2.8 &  2.4 \\
  final   state radiation  &  2.0 &  2.0 \\
  initial state radiation  &  2.0 &  1.6 \\
underlying event (Pythia tune)  &  0.6 &  0.7 \\
semi-leptonic b-hadron BRs  &  0.5 &  0.2 \\
   ME-PS matching (hdamp)  &  0.0 &  0.2 \\
   ME Factorization scale  &  0.0 &  0.0 \\
 ME Renormalization scale  &  0.0 &  0.0 \\
ME combined scale variation  &  0.0 &  0.0 \\
                      PDF  &  0.0 &  0.0 \\
            MC statistics  &  2.9 &  1.9 \\

-- freeze wjets in mu

make impacts  workspace=ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop.root nn=searching_ANv8_datacard_mu_lepMETprop_noWJets freeze="--freezeParameters lumi_13TeV,wjets_norm --freezeNuisanceGroup tt_th_pdf"
python new_impact_table.py --merge-pdf ./latest_impacts_searching_ANv8_datacard_mu_lepMETprop_noWJets.json

   r :    +0.944   -0.086/+0.081 (68%)

  tauID_eff :   +0.319  -0.978/+0.977  +0.031/-0.046
  qcd_norm  :   +1.213  -0.948/+0.789  -0.019/+0.021

-- pulled, but the impact is smaller

$\tauh$ jet identification  &  4.6 \\
$\tauh$ misidentification background  &  2.7 \\
        top quark $p_{T}$  &  2.4 \\
     b-tagging efficiency  &  2.3 \\
        QCD normalization  &  2.1 \\
           PU uncertainty  &  1.9 \\
                      JES  &  1.5 \\
                      TES  &  1.3 \\
       muon ID efficiency  &  0.9 \\
 Single Top normalization  &  0.6 \\
  muon trigger efficiency  &  0.4 \\
                      JER  &  0.3 \\
         DY normalization  &  0.2 \\
   Dibosons normalization  &  0.0 \\
     W+jets normalization  &  0.0 \\
               Luminosity  &  0.0 \\
          b fragmentation  &  2.5 \\
  final   state radiation  &  2.4 \\
  initial state radiation  &  1.8 \\
underlying event (Pythia tune)  &  1.0 \\
semi-leptonic b-hadron BRs  &  0.3 \\
   ME-PS matching (hdamp)  &  0.2 \\
   ME Factorization scale  &  0.0 \\
 ME Renormalization scale  &  0.0 \\
ME combined scale variation  &  0.0 \\
                      PDF  &  0.0 \\
            MC statistics  &  2.1 \\

-- so, this datacard is close to an8!



make impacts  workspace=ttxsec/datacard_v37_test13_bunchFULLFIT2_mu.root nn=searching_ANv8_datacard_mu_v37_test13_bunchFULLFIT2 freeze="--freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf"
python new_impact_table.py --merge-pdf ./latest_impacts_searching_ANv8_datacard_mu_v37_test13_bunchFULLFIT2.json

0.92

make impacts  workspace=ttxsec/datacard_v37_test13_bunchFULLFIT2_el.root nn=searching_ANv8_datacard_el_v37_test13_bunchFULLFIT2 freeze="--freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf"
python new_impact_table.py --merge-pdf ./latest_impacts_searching_ANv8_datacard_el_v37_test13_bunchFULLFIT2.json

   r :    +0.939   -0.082/+0.088 (68%)






## test14 FIT with fixed LEPmu and object systematics

v37_test14_bunchFULLFIT3_mc_1.root

make run_std_histos out=histosels/v37_test14_bunchFULLFIT3_mc_1/ wjets_norm=1.4 lumi_mu=35800 lumi_el=35800 mc=distrs/v37_test14_bunchFULLFIT3_mc_1.root data_mu=distrs/v37_test14_bunchFULLFIT3/SingleMuon.root data_el=distrs/v37_test14_bunchFULLFIT3/SingleElectron.root


make workspace datacard=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL
make impacts  workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL.root nn=v37_test14_mu

   r :    +0.935   -0.066/+0.072 (68%)

refit with 1.0 variations:

   r :    +0.955   -0.080/+0.085 (68%)

-- no tauID_eff in the impacts???


test with small Frag:

   r :    +0.927   -0.065/+0.075 (68%)


pulls

make workspace datacard=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_noMCstat
make pre_pulls_short workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_noMCstat.root   nn=mu_v37_test14_bunchFULLFIT3_noMCstat

-- look ok



to both impacts:

cp ttxsec/datacard_v37_test13_bunchFULLFIT2_el.txt ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL.txt

make workspace datacard=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL
make impacts  workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL.root nn=v37_test14_el

   r :    +0.949   -0.083/+0.093 (68%)


make both mucard=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL elcard=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL bothcard=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL
make workspace datacard=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL
make impacts  workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL.root nn=v37_test14_both

   r :    +0.936   -0.064/+0.068 (68%)

-- very close to mu, but within the el-mu fit

refit with 1.0 variations in mu:

   r :    +0.973   -0.075/+0.083 (68%)

-- damn, now it is sideways again!!



python new_impact_table.py --merge-pdf  latest_impacts_v37_test14_el.json  latest_impacts_v37_test14_mu.json latest_impacts_v37_test14_both.json

$\tauh$ jet identification  &  4.7 &  4.3 &  4.5 \\
       pileup uncertainty  &  2.5 &  2.4 &  2.5 \\
        top quark $p_{T}$  &  3.2 &  2.2 &  2.2 \\
$\tauh$ misidentification background  &  3.0 &  2.0 &  2.0 \\
         jet energy scale  &  1.1 &  0.0 &  1.1 \\
     W+jets normalization  &  0.1 &  0.7 &  0.7 \\
     b-tagging efficiency  &  1.0 &  1.0 &  0.7 \\
     $\tauh$ Energy Scale  &  0.9 &  0.0 &  0.7 \\
         DY normalization  &  0.4 &  0.4 &  0.5 \\
 Single Top normalization  &  0.6 &  0.5 &  0.5 \\
        QCD normalization  &  1.5 &  0.7 &  0.3 \\
   electron ID efficiency  &  1.8 &  0.1 \\
electron trigger efficiency  &  2.3 &  0.1 \\
    jet energy resolution  &  0.1 &  0.1 &  0.0 \\
       muon ID efficiency  &  0.0 &  0.0 \\
   Dibosons normalization  &  0.0 &  0.0 &  0.0 \\
  muon trigger efficiency  &  0.0 &  0.0 \\
               Luminosity  &  0.0 &  0.0 &  0.0 \\
  final   state radiation  &  1.6 &  2.4 &  2.0 \\
  initial state radiation  &  1.6 &  1.3 &  1.2 \\
 ME Renormalization scale  &  0.9 &  1.0 &  0.8 \\
          b fragmentation  &  4.4 &  0.7 &  0.8 \\
ME combined scale variation  &  0.7 &  0.9 &  0.7 \\
   ME-PS matching (hdamp)  &  0.4 &  0.6 &  0.7 \\
underlying event (Pythia tune)  &  0.4 &  0.6 &  0.6 \\
   ME Factorization scale  &  0.3 &  0.0 &  0.2 \\
semi-leptonic b-hadron BRs  &  1.4 &  0.0 &  0.1 \\
                      PDF  &  1.4 &  1.4 &  1.4 \\
            MC statistics  &  2.2 &  1.7 &  1.7 \\


-- minimum everywhere, except QCD norm?


test with small Frag in mu:

make both mucard=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL elcard=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL bothcard=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL_test1
make workspace datacard=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL_test1
make impacts  workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL_test1.root nn=v37_test14_both_test1

0.954 +- 0.0856

python new_impact_table.py --merge-pdf  latest_impacts_v37_test14_el.json  latest_impacts_v37_test14_mu.json latest_impacts_v37_test14_both_test1.json

$\tauh$ jet identification  &  4.7 &  4.7 &  4.4 \\
$\tauh$ misidentification background  &  3.0 &  2.5 &  2.9 \\
       pileup uncertainty  &  2.5 &  2.3 &  2.8 \\
        top quark $p_{T}$  &  3.2 &  3.5 &  2.5 \\
    jet energy resolution  &  0.1 &  0.5 &  1.0 \\
         jet energy scale  &  1.1 &  0.1 &  0.9 \\
     W+jets normalization  &  0.1 &  0.6 &  0.8 \\
     b-tagging efficiency  &  1.0 &  1.0 &  0.8 \\
       muon ID efficiency  &  0.6 &  0.7 \\
         DY normalization  &  0.4 &  0.4 &  0.5 \\
 Single Top normalization  &  0.6 &  0.5 &  0.5 \\
     $\tauh$ Energy Scale  &  0.9 &  0.5 &  0.5 \\
  muon trigger efficiency  &  0.3 &  0.3 \\
   electron ID efficiency  &  1.8 &  0.1 \\
electron trigger efficiency  &  2.3 &  0.1 \\
        QCD normalization  &  1.5 &  0.6 &  0.0 \\
   Dibosons normalization  &  0.0 &  0.0 &  0.0 \\
               Luminosity  &  0.0 &  0.0 &  0.0 \\
          b fragmentation  &  4.4 &  2.1 &  2.5 \\
  final   state radiation  &  1.6 &  1.6 &  2.5 \\
  initial state radiation  &  1.6 &  1.3 &  1.3 \\
semi-leptonic b-hadron BRs  &  1.4 &  1.0 &  1.1 \\
 ME Renormalization scale  &  0.9 &  1.2 &  0.9 \\
ME combined scale variation  &  0.7 &  1.1 &  0.7 \\
   ME-PS matching (hdamp)  &  0.4 &  0.6 &  0.7 \\
underlying event (Pythia tune)  &  0.4 &  0.5 &  0.6 \\
   ME Factorization scale  &  0.3 &  0.1 &  0.2 \\
                      PDF  &  1.4 &  1.3 &  1.4 \\
            MC statistics  &  2.2 &  1.7 &  1.7 \\

not too bad

head -n-2 ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL.txt  > ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL_noMCstat.txt
head -n-2 ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL.txt  > ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL_noMCstat.txt

make both mucard=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL_noMCstat elcard=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL_noMCstat bothcard=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL_test1_noMCstat

make workspace datacard=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL_noMCstat
make workspace datacard=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL_noMCstat
make workspace datacard=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL_test1_noMCstat

make impacts  workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL_noMCstat.root nn=v37_test14_el_test1_noMCtest
make impacts  workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL_noMCstat.root nn=v37_test14_mu_test1_noMCtest
make impacts  workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL_test1_noMCstat.root nn=v37_test14_both_test1_noMCtest

el:
   r :    +0.965   -0.081/+0.092 (68%)

mu:
   r :    +0.922   -0.063/+0.072 (68%)

both:
   r :    +0.962   -0.120/+0.072 (68%)

-- Frag is large in el, 2nd largest systematic

check pulls

make pre_pulls_short workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL_noMCstat.root   nn=el_v37_test14_bunchFULLFIT3_noMCstat
make pre_pulls_short workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL_noMCstat.root   nn=mu_v37_test14_bunchFULLFIT3_noMCstat
make pre_pulls_short workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL_test1_noMCstat.root nn=both_v37_test14_bunchFULLFIT3_noMCstat

-- el looks ok
   mu: JES constrained, Peterson, TES are constrained, TOPPT is pulled slightly down and constrained
   Semilep, Tune, Mf sit on zero

   Mf variation = 0.5 in mu, JES is not applied to all processes, Frag is 0.1

   -- cancel all these and rerun

el:
   r :    +0.965   -0.081/+0.092 (68%)
mu:
   r :    +0.943   -0.073/+0.097 (68%)
both:
   r :    +0.983   -0.074/+0.083 (68%)

-- same crap

check pulls, which nuisnaces are different in el and mu
if not obvious: use NLL to find fit result and search by freezing nuisances

make pre_pulls_short workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL_noMCstat.root   nn=el_v37_test14_bunchFULLFIT3_noMCstat
make pre_pulls_short workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL_noMCstat.root   nn=mu_v37_test14_bunchFULLFIT3_noMCstat

python ttxsec/fit-stuff/pulls_plot.py pulls_of_nuisances_both_v37_test14_bunchFULLFIT3_noMCstat_shapeshort.root
python ttxsec/fit-stuff/pulls_plot.py pulls_of_nuisances_mu_v37_test14_bunchFULLFIT3_noMCstat_shapeshort.root
python ttxsec/fit-stuff/pulls_plot.py pulls_of_nuisances_el_v37_test14_bunchFULLFIT3_noMCstat_shapeshort.root

from el in both are:
PU, Peterson,
TOPPT,
TES, tau fakes,
slightly JER.

try freezing them:
pre_pulls_short: freeze=--freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf_only

make nll workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL_noMCstat.root         nn=el_v37_test14_bunchFULLFIT3_noMCstat   freeze="--freezeParameters lumi_13TeV,PU,Peterson,TOPPT,TES,JER --freezeNuisanceGroup tt_th_pdf_only"
make nll workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL_noMCstat.root         nn=mu_v37_test14_bunchFULLFIT3_noMCstat   freeze="--freezeParameters lumi_13TeV,PU,Peterson,TOPPT,TES,JER --freezeNuisanceGroup tt_th_pdf_only"
make nll workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL_test1_noMCstat.root nn=both_v37_test14_bunchFULLFIT3_noMCstat freeze="--freezeParameters lumi_13TeV,PU,Peterson,TOPPT,TES,JER --freezeNuisanceGroup tt_th_pdf_only"

el:
 POI: r= 0.919302 -> [0.5,1.5]
mu:
 POI: r= 0.930163 -> [0.5,1.5]
both:
 POI: r= 0.930545 -> [0.5,1.5]

closer

make nll workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL_noMCstat.root         nn=el_v37_test14_bunchFULLFIT3_noMCstat   freeze="--freezeParameters lumi_13TeV,PU,Peterson,TOPPT,TES,JER,tau_fakes --freezeNuisanceGroup tt_th_pdf_only"
make nll workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL_noMCstat.root         nn=mu_v37_test14_bunchFULLFIT3_noMCstat   freeze="--freezeParameters lumi_13TeV,PU,Peterson,TOPPT,TES,JER,tau_fakes --freezeNuisanceGroup tt_th_pdf_only"
make nll workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL_test1_noMCstat.root nn=both_v37_test14_bunchFULLFIT3_noMCstat freeze="--freezeParameters lumi_13TeV,PU,Peterson,TOPPT,TES,JER,tau_fakes --freezeNuisanceGroup tt_th_pdf_only"

 POI: r= 0.9224 -> [0.5,1.5]
 POI: r= 0.961668 -> [0.5,1.5]
 POI: r= 0.950317 -> [0.5,1.5]

-- kind of ok

only fakes:

make nll workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL_noMCstat.root         nn=el_v37_test14_bunchFULLFIT3_noMCstat   freeze="--freezeParameters lumi_13TeV,tau_fakes --freezeNuisanceGroup tt_th_pdf_only"
make nll workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL_noMCstat.root         nn=mu_v37_test14_bunchFULLFIT3_noMCstat   freeze="--freezeParameters lumi_13TeV,tau_fakes --freezeNuisanceGroup tt_th_pdf_only"
make nll workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL_test1_noMCstat.root nn=both_v37_test14_bunchFULLFIT3_noMCstat freeze="--freezeParameters lumi_13TeV,tau_fakes --freezeNuisanceGroup tt_th_pdf_only"

 POI: r= 0.963768 -> [0.5,1.5]
 POI: r= 0.975455 -> [0.5,1.5]
 POI: r= 1.00394 -> [0.5,1.5]

-- nope

make nll workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL_noMCstat.root         nn=el_v37_test14_bunchFULLFIT3_noMCstat   freeze="--freezeParameters lumi_13TeV,tau_fakes,TOPPT --freezeNuisanceGroup tt_th_pdf_only"
make nll workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL_noMCstat.root         nn=mu_v37_test14_bunchFULLFIT3_noMCstat   freeze="--freezeParameters lumi_13TeV,tau_fakes,TOPPT --freezeNuisanceGroup tt_th_pdf_only"
make nll workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL_test1_noMCstat.root nn=both_v37_test14_bunchFULLFIT3_noMCstat freeze="--freezeParameters lumi_13TeV,tau_fakes,TOPPT --freezeNuisanceGroup tt_th_pdf_only"

 POI: r= 0.930022 -> [0.5,1.5]
 POI: r= 0.97347 -> [0.5,1.5]
 POI: r= 0.961981 -> [0.5,1.5]

-- aha

let's see these:

make pre_pulls_short workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL_noMCstat.root         nn=el_v37_test14_bunchFULLFIT3_noMCstat_freeze1    freeze="--freezeParameters lumi_13TeV,tau_fakes,TOPPT --freezeNuisanceGroup tt_th_pdf_only"
make pre_pulls_short workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL_noMCstat.root         nn=mu_v37_test14_bunchFULLFIT3_noMCstat_freeze1    freeze="--freezeParameters lumi_13TeV,tau_fakes,TOPPT --freezeNuisanceGroup tt_th_pdf_only"
make pre_pulls_short workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL_test1_noMCstat.root nn=both_v37_test14_bunchFULLFIT3_noMCstat_freeze1  freeze="--freezeParameters lumi_13TeV,tau_fakes,TOPPT --freezeNuisanceGroup tt_th_pdf_only"

python ttxsec/fit-stuff/pulls_plot.py pulls_of_nuisances_el_v37_test14_bunchFULLFIT3_noMCstat_freeze1_shapeshort.root
python ttxsec/fit-stuff/pulls_plot.py pulls_of_nuisances_mu_v37_test14_bunchFULLFIT3_noMCstat_freeze1_shapeshort.root
python ttxsec/fit-stuff/pulls_plot.py pulls_of_nuisances_both_v37_test14_bunchFULLFIT3_noMCstat_freeze1_shapeshort.root

-- pulls look the same as before?

make impacts workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL_noMCstat.root         nn=el_v37_test14_bunchFULLFIT3_noMCstat_freeze1    freeze="--freezeParameters lumi_13TeV,tau_fakes,TOPPT --freezeNuisanceGroup tt_th_pdf_only"
make impacts workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL_noMCstat.root         nn=mu_v37_test14_bunchFULLFIT3_noMCstat_freeze1    freeze="--freezeParameters lumi_13TeV,tau_fakes,TOPPT --freezeNuisanceGroup tt_th_pdf_only"
make impacts workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL_test1_noMCstat.root nn=both_v37_test14_bunchFULLFIT3_noMCstat_freeze1  freeze="--freezeParameters lumi_13TeV,tau_fakes,TOPPT --freezeNuisanceGroup tt_th_pdf_only"

   r :    +0.930   -0.070/+0.076 (68%)
   r :    +0.973   -0.068/+0.073 (68%)
   r :    +0.962   -0.062/+0.066 (68%)

python new_impact_table.py --merge-pdf  latest_impacts_el_v37_test14_bunchFULLFIT3_noMCstat_freeze1.json latest_impacts_mu_v37_test14_bunchFULLFIT3_noMCstat_freeze1.json latest_impacts_both_v37_test14_bunchFULLFIT3_noMCstat_freeze1.json


$\tauh$ jet identification  &  4.6 &  4.8 &  4.6 \\
       pileup uncertainty  &  1.9 &  1.9 &  1.6 \\
    jet energy resolution  &  0.0 &  0.5 &  1.4 \\
     b-tagging efficiency  &  1.2 &  1.5 &  1.2 \\
         jet energy scale  &  0.9 &  0.6 &  0.9 \\
         DY normalization  &  0.4 &  0.5 &  0.7 \\
 Single Top normalization  &  0.6 &  0.6 &  0.6 \\
       muon ID efficiency  &  0.6 &  0.6 \\
     W+jets normalization  &  0.1 &  1.0 &  0.5 \\
     $\tauh$ Energy Scale  &  0.3 &  0.1 &  0.4 \\
  muon trigger efficiency  &  0.3 &  0.3 \\
electron trigger efficiency  &  2.1 &  0.2 \\
   electron ID efficiency  &  1.5 &  0.1 \\
   Dibosons normalization  &  0.0 &  0.0 &  0.0 \\
        QCD normalization  &  0.8 &  0.4 &  0.0 \\
$\tauh$ misidentification background  &  0.0 &  0.0 &  0.0 \\
        top quark $p_{T}$  &  0.0 &  0.0 &  0.0 \\
               Luminosity  &  0.0 &  0.0 &  0.0 \\
          b fragmentation  &  3.0 &  2.5 &  2.5 \\
  final   state radiation  &  2.5 &  2.1 &  2.0 \\
  initial state radiation  &  1.7 &  1.8 &  1.8 \\
 ME Renormalization scale  &  0.9 &  1.5 &  1.2 \\
ME combined scale variation  &  0.6 &  1.4 &  1.0 \\
semi-leptonic b-hadron BRs  &  1.1 &  0.7 &  0.7 \\
   ME Factorization scale  &  0.4 &  0.2 &  0.3 \\
underlying event (Pythia tune)  &  0.2 &  0.3 &  0.2 \\
   ME-PS matching (hdamp)  &  0.1 &  0.2 &  0.1 \\
                      PDF  &  0.0 &  0.1 &  0.0 \\
            MC statistics  &  0.0 &  0.0 &  0.0 \\

-- PDF != 0 in mu???
   JER = 0 in el??
   LEP el drop so much in both?



try freezing only TOPPT

make nll workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL_noMCstat.root         nn=el_v37_test14_bunchFULLFIT3_noMCstat   freeze="--freezeParameters lumi_13TeV,TOPPT --freezeNuisanceGroup tt_th_pdf_only"
make nll workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL_noMCstat.root         nn=mu_v37_test14_bunchFULLFIT3_noMCstat   freeze="--freezeParameters lumi_13TeV,TOPPT --freezeNuisanceGroup tt_th_pdf_only"
make nll workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL_test1_noMCstat.root nn=both_v37_test14_bunchFULLFIT3_noMCstat freeze="--freezeParameters lumi_13TeV,TOPPT --freezeNuisanceGroup tt_th_pdf_only"

 POI: r= 0.926722 -> [0.5,1.5]
 POI: r= 0.940619 -> [0.5,1.5]
 POI: r= 0.937092 -> [0.5,1.5]

-- ok
   also: without TOPPT el drops from 0.96 to 0.92,
         mu stays the same,
         both drops

TOPPT is indeed asymmetric, apparently it works like a switch

make pre_pulls_short workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL_noMCstat.root         nn=el_v37_test14_bunchFULLFIT3_noMCstat_freeze1    freeze="--freezeParameters lumi_13TeV,TOPPT --freezeNuisanceGroup tt_th_pdf_only"
make pre_pulls_short workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL_noMCstat.root         nn=mu_v37_test14_bunchFULLFIT3_noMCstat_freeze1    freeze="--freezeParameters lumi_13TeV,TOPPT --freezeNuisanceGroup tt_th_pdf_only"
make pre_pulls_short workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL_test1_noMCstat.root nn=both_v37_test14_bunchFULLFIT3_noMCstat_freeze1  freeze="--freezeParameters lumi_13TeV,TOPPT --freezeNuisanceGroup tt_th_pdf_only"

python ttxsec/fit-stuff/pulls_plot.py pulls_of_nuisances_el_v37_test14_bunchFULLFIT3_noMCstat_freeze1_shapeshort.root
python ttxsec/fit-stuff/pulls_plot.py pulls_of_nuisances_mu_v37_test14_bunchFULLFIT3_noMCstat_freeze1_shapeshort.root
python ttxsec/fit-stuff/pulls_plot.py pulls_of_nuisances_both_v37_test14_bunchFULLFIT3_noMCstat_freeze1_shapeshort.root




try full fit without TOPPT

make both mucard=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL elcard=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL bothcard=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL

make workspace datacard=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL
make workspace datacard=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL
make workspace datacard=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL

make impacts  workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL.root     nn=v37_test14_el_test1_freezeTOPPT     freeze="--freezeParameters lumi_13TeV,TOPPT"
make impacts  workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL.root     nn=v37_test14_mu_test1_freezeTOPPT     freeze="--freezeParameters lumi_13TeV,TOPPT"
make impacts  workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL.root   nn=v37_test14_both_test1_freezeTOPPT   freeze="--freezeParameters lumi_13TeV,TOPPT"

   r :    +0.921   -0.075/+0.083 (68%)
   r :    +0.945   -0.073/+0.078 (68%)
   r :    +0.936   -0.070/+0.072 (68%)

-- yeap

python new_impact_table.py --merge-pdf  ./latest_impacts_v37_test14_el_test1_freezeTOPPT.json ./latest_impacts_v37_test14_mu_test1_freezeTOPPT.json ./latest_impacts_v37_test14_both_test1_freezeTOPPT.json

$\tauh$ jet identification  &  4.7 &  4.8 &  4.7 \\
$\tauh$ misidentification background  &  2.9 &  3.2 &  3.3 \\
       pileup uncertainty  &  2.1 &  2.2 &  1.8 \\
    jet energy resolution  &  0.1 &  0.5 &  1.2 \\
     b-tagging efficiency  &  1.1 &  1.3 &  1.0 \\
     $\tauh$ Energy Scale  &  0.8 &  0.5 &  0.7 \\
     W+jets normalization  &  0.0 &  1.0 &  0.7 \\
       muon ID efficiency  &  0.6 &  0.6 \\
 Single Top normalization  &  0.6 &  0.5 &  0.5 \\
         jet energy scale  &  0.6 &  0.2 &  0.5 \\
         DY normalization  &  0.3 &  0.3 &  0.4 \\
  muon trigger efficiency  &  0.4 &  0.3 \\
electron trigger efficiency  &  2.3 &  0.2 \\
   electron ID efficiency  &  1.8 &  0.2 \\
        QCD normalization  &  1.0 &  0.4 &  0.1 \\
   Dibosons normalization  &  0.0 &  0.0 &  0.0 \\
        top quark $p_{T}$  &  0.0 &  0.0 &  0.0 \\
               Luminosity  &  0.0 &  0.0 &  0.0 \\
          b fragmentation  &  3.6 &  3.0 \\
  final   state radiation  &  1.2 &  2.0 &  2.0 \\
  initial state radiation  &  1.7 &  1.5 &  1.5 \\
 ME Renormalization scale  &  0.9 &  1.3 &  1.2 \\
ME combined scale variation  &  0.7 &  1.1 &  1.0 \\
semi-leptonic b-hadron BRs  &  1.3 &  0.9 &  0.9 \\
   ME-PS matching (hdamp)  &  0.4 &  0.4 &  0.5 \\
underlying event (Pythia tune)  &  0.3 &  0.4 &  0.3 \\
   ME Factorization scale  &  0.3 &  0.3 &  0.3 \\
                      PDF  &  1.4 &  1.3 &  1.3 \\
            MC statistics  &  2.1 &  1.6 &  1.7 \\

still LEPel are suppressed, many impacts are asymmetric
Frag is lost in mu!?

make pre_pulls_short workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL.root   nn=el_v37_test14_bunchFULLFIT3_freezeTOPPT    freeze="--freezeParameters lumi_13TeV,TOPPT"
make pre_pulls_short workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL.root   nn=mu_v37_test14_bunchFULLFIT3_freezeTOPPT    freeze="--freezeParameters lumi_13TeV,TOPPT"
make pre_pulls_short workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL.root nn=both_v37_test14_bunchFULLFIT3_freezeTOPPT  freeze="--freezeParameters lumi_13TeV,TOPPT"

python ttxsec/fit-stuff/pulls_plot.py pulls_of_nuisances_el_v37_test14_bunchFULLFIT3_freezeTOPPT_shapeshort.root
python ttxsec/fit-stuff/pulls_plot.py pulls_of_nuisances_mu_v37_test14_bunchFULLFIT3_freezeTOPPT_shapeshort.root
python ttxsec/fit-stuff/pulls_plot.py pulls_of_nuisances_both_v37_test14_bunchFULLFIT3_freezeTOPPT_shapeshort.root

-- Frag is still there, and at the same value as in the PDF-less short pull distr.....

so, what's up with TOPPT?

compare:

make impacts  workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL.root     nn=v37_test14_el_test1_NOfreezeTOPPT     freeze="--freezeParameters lumi_13TeV"
make impacts  workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL.root     nn=v37_test14_mu_test1_NOfreezeTOPPT     freeze="--freezeParameters lumi_13TeV"
make impacts  workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL.root   nn=v37_test14_both_test1_NOfreezeTOPPT   freeze="--freezeParameters lumi_13TeV"

   r :    +0.949   -0.083/+0.093 (68%)
   r :    +0.948   -0.075/+0.096 (68%)
   r :    +0.973   -0.074/+0.083 (68%)

-- damn!

   also mu is different from before?

   Frag is too large in both mu and el
   TOPPT is pulled up in el, centered in mu -- why mu does not favor TOPPT?

python new_impact_table.py --merge-pdf  latest_impacts_v37_test14_el_test1_NOfreezeTOPPT.json latest_impacts_v37_test14_mu_test1_NOfreezeTOPPT.json latest_impacts_v37_test14_both_test1_NOfreezeTOPPT.json



check freezing Frag

make nll workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL.root      nn=el_v37_test14_bunchFULLFIT3_freezeFrag   freeze="--freezeParameters lumi_13TeV,Frag"
make nll workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL.root      nn=mu_v37_test14_bunchFULLFIT3_freezeFrag   freeze="--freezeParameters lumi_13TeV,Frag"
make nll workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL.root    nn=both_v37_test14_bunchFULLFIT3_freezeFrag freeze="--freezeParameters lumi_13TeV,Frag"

 POI: r= 0.963434 -> [0.5,1.5]
 POI: r= 0.933502 -> [0.5,1.5]
 POI: r= 0.955115 -> [0.5,1.5]

-- not bad
   so, maybe correcting Frag we'll get to ok fit in both
   Frag is strangely large now




### check Frag norm factors

check what's applied in histosel?

root -l ttxsec/fit-stuff/v37_test14_bunchFULLFIT3_mc_1_HISTOSEL.root

el_sel_ljout->Get("tt_eltau/NOMINAL")

el_sel_ljout->Get("tt_eltau/NOMINAL/el_sel_ljout_tt_eltau_NOMINAL_Mt_lep_met_c")->Print()
el_sel_ljout->Get("tt_eltau/FragUp/el_sel_ljout_tt_eltau_FragUp_Mt_lep_met_c")->Print()
el_sel_ljout->Get("tt_eltau/FragDown/el_sel_ljout_tt_eltau_FragDown_Mt_lep_met_c")->Print()
TH1.Print Name  = el_sel_ljout_tt_eltau_NOMINAL_Mt_lep_met_c, Entries= 20649, Total sum= 5135.77
TH1.Print Name  = el_sel_ljout_tt_eltau_FragUp_Mt_lep_met_c, Entries= 20649, Total sum= 4948.97
TH1.Print Name  = el_sel_ljout_tt_eltau_FragDown_Mt_lep_met_c, Entries= 20649, Total sum= 5277.82

Up
root [8] 4948.97 / 5135.77
(double) 0.963628
Down
root [9] 5277.82 / 5135.77
(double) 1.02766

((TH1D*) el_sel_ljout->Get("tt_lj/FragUp/el_sel_ljout_tt_lj_FragUp_Mt_lep_met_c"))->Integral()     / ((TH1D*) el_sel_ljout->Get("tt_lj/NOMINAL/el_sel_ljout_tt_lj_NOMINAL_Mt_lep_met_c"))->Integral()
((TH1D*) el_sel_ljout->Get("tt_lj/FragDown/el_sel_ljout_tt_lj_FragDown_Mt_lep_met_c"))->Integral() / ((TH1D*) el_sel_ljout->Get("tt_lj/NOMINAL/el_sel_ljout_tt_lj_NOMINAL_Mt_lep_met_c"))->Integral()

(double) 0.935758
(double) 1.05290


-- somehow very close to the factors:

              FragUp             0.958843
            FragDown             1.029369

-- checked them in new ntuples

are the factors actualy applied?


root -l distrs/v37_test13_bunchFULLFIT2_mc_1.root

((TH1D*) el_sel_ljout->Get("tt_eltau/FragUp/el_sel_ljout_tt_eltau_FragUp_Mt_lep_met_c"))->Integral()      / ((TH1D*) el_sel_ljout->Get("tt_eltau/NOMINAL/el_sel_ljout_tt_eltau_NOMINAL_Mt_lep_met_c"))->Integral()
((TH1D*) el_sel_ljout->Get("tt_eltau/FragDown/el_sel_ljout_tt_eltau_FragDown_Mt_lep_met_c"))->Integral()  / ((TH1D*) el_sel_ljout->Get("tt_eltau/NOMINAL/el_sel_ljout_tt_eltau_NOMINAL_Mt_lep_met_c"))->Integral()

(double) 0.923977
(double) 1.05783

-- applied....

python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc_1.root distrs/v37_test13_bunchFULLFIT2/SingleMuon.root -o histosels/v37_test13_bunchFULLFIT2_issue_w_TT_weights/ --data-nick data_other --lumi 35800 -c mu_sel_ljout -d Mt_lep_met_c --wjet 1.4  -x mu_selVloose_ljout --sys NOMINAL
python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc_1.root distrs/v37_test13_bunchFULLFIT2/SingleMuon.root -o histosels/v37_test13_bunchFULLFIT2_issue_w_TT_weights/ --data-nick data_other --lumi 35800 -c mu_sel_ljout -d Mt_lep_met_c --wjet 1.4  -x mu_selVloose_ljout --sys FragUp
python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc_1.root distrs/v37_test13_bunchFULLFIT2/SingleMuon.root -o histosels/v37_test13_bunchFULLFIT2_issue_w_TT_weights/ --data-nick data_other --lumi 35800 -c mu_sel_ljout -d Mt_lep_met_c --wjet 1.4  -x mu_selVloose_ljout --sys FragDown


how large was it before?

root -l distrs/v25v26_redo_4_mc.root

((TH1D*) el_sel_ljout->Get("tt_eltau/FragUp/el_sel_ljout_tt_eltau_FragUp_Mt_lep_met_f"))->Integral()      / ((TH1D*) el_sel_ljout->Get("tt_eltau/NOMINAL/el_sel_ljout_tt_eltau_NOMINAL_Mt_lep_met_f"))->Integral()
((TH1D*) el_sel_ljout->Get("tt_eltau/FragDown/el_sel_ljout_tt_eltau_FragDown_Mt_lep_met_f"))->Integral()  / ((TH1D*) el_sel_ljout->Get("tt_eltau/NOMINAL/el_sel_ljout_tt_eltau_NOMINAL_Mt_lep_met_f"))->Integral()

(double) 0.973473
(double) 1.02142

-- aha!

so, why is the effect larger now?

'FragUp'        : lambda ev: ev.event_weight*ev.event_weight_FragUp       ,
'FragDown'      : lambda ev: ev.event_weight*ev.event_weight_FragDown     ,


check MfrUp MfrDown too:

((TH1D*) el_sel_ljout->Get("tt_eltau/MfrUp/el_sel_ljout_tt_eltau_MfrUp_Mt_lep_met_f"))->Integral()      / ((TH1D*) el_sel_ljout->Get("tt_eltau/NOMINAL/el_sel_ljout_tt_eltau_NOMINAL_Mt_lep_met_f"))->Integral()
((TH1D*) el_sel_ljout->Get("tt_eltau/MfrDown/el_sel_ljout_tt_eltau_MfrDown_Mt_lep_met_f"))->Integral()  / ((TH1D*) el_sel_ljout->Get("tt_eltau/NOMINAL/el_sel_ljout_tt_eltau_NOMINAL_Mt_lep_met_f"))->Integral()

was:

(double) 0.875502
(double) 1.13343

now:

root -l distrs/v37_test14_bunchFULLFIT3_mc_1.root

(double) 0.875225
(double) 1.13388

-- same

but Frag:

(double) 0.923977
(double) 1.05783

is off

check raw frag weight

python sumup_ttree_draw.py "event_met_lep_mt" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight"                       --histo-range 20,0,250 --output v37_test14_tooLargeFrag_Mt_NOMINAL.root  --histo-name Mt_NOMINAL  lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root    &
python sumup_ttree_draw.py "event_met_lep_mt" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight*event_weight_FragUp"   --histo-range 20,0,250 --output v37_test14_tooLargeFrag_Mt_FragUp.root   --histo-name Mt_FragUp   lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root    &
python sumup_ttree_draw.py "event_met_lep_mt" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight*event_weight_FragDown" --histo-range 20,0,250 --output v37_test14_tooLargeFrag_Mt_FragDown.root --histo-name Mt_FragDown lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root    &

hadd v37_test14_tooLargeFrag_all.root v37_test14_tooLargeFrag_Mt_*.root

Mt_FragUp   ->Integral() / Mt_NOMINAL ->Integral()
Mt_FragDown ->Integral() / Mt_NOMINAL ->Integral()

(double) 0.912181
(double) 1.06949

and
>>> sqrt(0.912181)
0.9550816719003669
>>> sqrt(1.06949)
1.0341614960923657


python sumup_ttree_draw.py "event_met_lep_mt" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight"                       --histo-range 20,0,250 --output v37_test14_tooLargeFrag_Mt_v26_NOMINAL.root  --histo-name Mt_v26_NOMINAL  lstore_outdirs/v26/resub4p/MC2016_Summer16_TTJets_powheg/*root    &
python sumup_ttree_draw.py "event_met_lep_mt" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight*event_weight_FragUp"   --histo-range 20,0,250 --output v37_test14_tooLargeFrag_Mt_v26_FragUp.root   --histo-name Mt_v26_FragUp   lstore_outdirs/v26/resub4p/MC2016_Summer16_TTJets_powheg/*root    &
python sumup_ttree_draw.py "event_met_lep_mt" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight*event_weight_FragDown" --histo-range 20,0,250 --output v37_test14_tooLargeFrag_Mt_v26_FragDown.root --histo-name Mt_v26_FragDown lstore_outdirs/v26/resub4p/MC2016_Summer16_TTJets_powheg/*root    &

hadd v37_test14_tooLargeFrag_all.root v37_test14_tooLargeFrag_Mt_*.root

Mt_v26_FragUp   ->Integral() / Mt_v26_NOMINAL ->Integral()
Mt_v26_FragDown ->Integral() / Mt_v26_NOMINAL ->Integral()

(double) 0.960752
(double) 1.03496

what's with weights in the ntuples?

gen_weight_centralFrag <- not negligible
gen_weight_FragUp
gen_weight_FragDown

python sumup_ttree_draw.py "gen_weight_FragUp   / gen_weight_centralFrag" --histo-range 100,0,2 --output v37_test14_tooLargeFrag_ntuple_weight_FragUp.root   --histo-name ntuple_weight_FragUp   gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/MC*root    &
python sumup_ttree_draw.py "gen_weight_FragDown / gen_weight_centralFrag" --histo-range 100,0,2 --output v37_test14_tooLargeFrag_ntuple_weight_FragDown.root --histo-name ntuple_weight_FragDown gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/MC*root    &

python sumup_ttree_draw.py "gen_weight_FragUp   / gen_weight_centralFrag" --histo-range 100,0,2 --output v37_test14_tooLargeFrag_ntuple_weight_v26_FragUp.root   --histo-name ntuple_weight_v26_FragUp   gstore_outdirs/v26/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v26_MC2016_Summer16_TTJets_powheg/*/0000/MC*root    &
python sumup_ttree_draw.py "gen_weight_FragDown / gen_weight_centralFrag" --histo-range 100,0,2 --output v37_test14_tooLargeFrag_ntuple_weight_v26_FragDown.root --histo-name ntuple_weight_v26_FragDown gstore_outdirs/v26/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v26_MC2016_Summer16_TTJets_powheg/*/0000/MC*root    &

hadd -f v37_test14_all_tooLargeFrag.root v37_test14_tooLargeFrag_*.root
root -l v37_test14_all_tooLargeFrag.root

ntuple_weight_v26_FragUp   ->SetLineColor(kRed)
ntuple_weight_v26_FragDown ->SetLineColor(kRed)

ntuple_weight_FragUp   ->Scale(1./ntuple_weight_FragUp   ->Integral())
ntuple_weight_FragDown ->Scale(1./ntuple_weight_FragDown ->Integral())

ntuple_weight_v26_FragUp   ->Scale(1./ntuple_weight_v26_FragUp   ->Integral())
ntuple_weight_v26_FragDown ->Scale(1./ntuple_weight_v26_FragDown ->Integral())

ntuple_weight_FragUp     ->Draw("histo")
ntuple_weight_v26_FragUp ->Draw("histo same")

ntuple_weight_FragDown     ->Draw("histo")
ntuple_weight_v26_FragDown ->Draw("histo same")

-- looks similar, but the selection of events is noticeable

python sumup_ttree_draw.py "gen_weight_FragUp   / gen_weight_centralFrag" --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && ntaus>0" --histo-range 100,0,2 --output v37_test14_tooLargeFrag_ntuple_weight_FragUp.root       --histo-name ntuple_weight_FragUp       gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/*/*/*root &
python sumup_ttree_draw.py "gen_weight_FragDown / gen_weight_centralFrag" --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && ntaus>0" --histo-range 100,0,2 --output v37_test14_tooLargeFrag_ntuple_weight_FragDown.root     --histo-name ntuple_weight_FragDown     gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/*/*/*root &
python sumup_ttree_draw.py "gen_weight_FragUp   / gen_weight_centralFrag" --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && ntaus>0" --histo-range 100,0,2 --output v37_test14_tooLargeFrag_ntuple_weight_v26_FragUp.root   --histo-name ntuple_weight_v26_FragUp   gstore_outdirs/v26/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v26_MC2016_Summer16_TTJets_powheg/*/*/*root &
python sumup_ttree_draw.py "gen_weight_FragDown / gen_weight_centralFrag" --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && ntaus>0" --histo-range 100,0,2 --output v37_test14_tooLargeFrag_ntuple_weight_v26_FragDown.root --histo-name ntuple_weight_v26_FragDown gstore_outdirs/v26/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v26_MC2016_Summer16_TTJets_powheg/*/*/*root &

-- practically the same amount of events (veto leps etc are needed)
   but still the same difference in the distrs!

   red is large in Up and smaller in Down

so, it seems the weight has changed in ntuples?
git shows no difference for this weight:
the genjets come from token particleLevel:jets

        genJetsToken_ = consumes<std::vector<reco::GenJet> >(edm::InputTag("particleLevel:jets")); // not sure if it is different from previous one
                iEvent.getByToken( genJetsToken_, genJets2);

then the loop with weights did not change, only a separate match to leptons was added, which is just added and that's all

how come this weight has changed, but the weight in the histo of sys weights has not?
-- I forgot to divide the sys by central Frag?
   no, I did divide it!
   so, how come?

check separate distrs

python sumup_ttree_draw.py "gen_weight_FragUp"      --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && ntaus>0" --histo-range 100,0,2 --output v37_test14_tooLargeFrag_ntuple_weight_FragUp_distr.root    --histo-name ntuple_weight_FragUp_distr   gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/*/*/*root &
python sumup_ttree_draw.py "gen_weight_FragDown"    --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && ntaus>0" --histo-range 100,0,2 --output v37_test14_tooLargeFrag_ntuple_weight_FragDown_distr.root  --histo-name ntuple_weight_FragDown_distr gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/*/*/*root &
python sumup_ttree_draw.py "gen_weight_centralFrag" --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && ntaus>0" --histo-range 100,0,2 --output v37_test14_tooLargeFrag_ntuple_weight_central_distr.root   --histo-name ntuple_weight_central_distr  gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/*/*/*root &

python sumup_ttree_draw.py "gen_weight_FragUp"      --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && ntaus>0" --histo-range 100,0,2 --output v37_test14_tooLargeFrag_ntuple_weight_v26_FragUp_distr.root   --histo-name ntuple_weight_v26_FragUp_distr   gstore_outdirs/v26/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v26_MC2016_Summer16_TTJets_powheg/*/*/*root &
python sumup_ttree_draw.py "gen_weight_FragDown"    --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && ntaus>0" --histo-range 100,0,2 --output v37_test14_tooLargeFrag_ntuple_weight_v26_FragDown_distr.root --histo-name ntuple_weight_v26_FragDown_distr gstore_outdirs/v26/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v26_MC2016_Summer16_TTJets_powheg/*/*/*root &
python sumup_ttree_draw.py "gen_weight_centralFrag" --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && ntaus>0" --histo-range 100,0,2 --output v37_test14_tooLargeFrag_ntuple_weight_v26_central_distr.root  --histo-name ntuple_weight_v26_central_distr  gstore_outdirs/v26/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v26_MC2016_Summer16_TTJets_powheg/*/*/*root &

ntuple_weight_v26_FragUp_distr   ->SetLineColor(kRed)
ntuple_weight_v26_FragDown_distr ->SetLineColor(kRed)
ntuple_weight_v26_central_distr  ->SetLineColor(kRed)

ntuple_weight_FragUp_distr   ->Scale(1./ntuple_weight_FragUp_distr   ->Integral())
ntuple_weight_FragDown_distr ->Scale(1./ntuple_weight_FragDown_distr ->Integral())
ntuple_weight_central_distr  ->Scale(1./ntuple_weight_central_distr  ->Integral())

ntuple_weight_v26_FragUp_distr   ->Scale(1./ntuple_weight_v26_FragUp_distr   ->Integral())
ntuple_weight_v26_FragDown_distr ->Scale(1./ntuple_weight_v26_FragDown_distr ->Integral())
ntuple_weight_v26_central_distr  ->Scale(1./ntuple_weight_v26_central_distr  ->Integral())

ntuple_weight_FragUp_distr     ->Draw("histo")
ntuple_weight_v26_FragUp_distr ->Draw("histo same")

ntuple_weight_FragDown_distr     ->Draw("histo")
ntuple_weight_v26_FragDown_distr ->Draw("histo same")

ntuple_weight_central_distr     ->Draw("histo")
ntuple_weight_v26_central_distr ->Draw("histo same")

-- all different

experiment with sqrt:

python sumup_ttree_draw.py "sqrt(gen_weight_FragUp)"      --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && ntaus>0" --histo-range 100,0,2 --output v37_test14_tooLargeFrag_ntuple_weight_FragUp_distr_sqrt.root    --histo-name ntuple_weight_FragUp_distr_sqrt   gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/*/*/*root &
python sumup_ttree_draw.py "sqrt(gen_weight_FragDown)"    --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && ntaus>0" --histo-range 100,0,2 --output v37_test14_tooLargeFrag_ntuple_weight_FragDown_distr_sqrt.root  --histo-name ntuple_weight_FragDown_distr_sqrt gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/*/*/*root &
python sumup_ttree_draw.py "sqrt(gen_weight_centralFrag)" --cond-com "(abs(leps_ID) == 11 || abs(leps_ID) == 13) && ntaus>0" --histo-range 100,0,2 --output v37_test14_tooLargeFrag_ntuple_weight_central_distr_sqrt.root   --histo-name ntuple_weight_central_distr_sqrt  gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/*/*/*root &

ntuple_weight_FragUp_distr_sqrt   ->Scale(1./ntuple_weight_FragUp_distr_sqrt   ->Integral())
ntuple_weight_FragDown_distr_sqrt ->Scale(1./ntuple_weight_FragDown_distr_sqrt ->Integral())
ntuple_weight_central_distr_sqrt  ->Scale(1./ntuple_weight_central_distr_sqrt  ->Integral())

ntuple_weight_FragUp_distr_sqrt ->Draw("histo")
ntuple_weight_v26_FragUp_distr  ->Draw("histo same")

ntuple_weight_FragDown_distr_sqrt ->Draw("histo")
ntuple_weight_v26_FragDown_distr  ->Draw("histo same")

ntuple_weight_central_distr_sqrt ->Draw("histo")
ntuple_weight_v26_central_distr  ->Draw("histo same")

-- red (v26) is wider

damn!

python syst_rates.py --sys-histo ntupler/systematic_weights proc/gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/*/0000/*root
python syst_rates.py --sys-histo ntupler/systematic_weights proc/gstore_outdirs/v26/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v26_MC2016_Summer16_TTJets_powheg/*/0000/*root

                 v37                                               v26
                init 77862932.0                                   init 77862932.0
                nom  77862932.0                                   nom  77862932.0
               MU_PU             1.013878                        MU_PU             1.013878
             MU_PUUp             0.994845                      MU_PUUp             0.994845
           MU_PUDown             1.036569                    MU_PUDown             1.036569
               El_PU             1.031057                        El_PU             1.031057
             El_PUUp             1.008920                      El_PUUp             1.008920
           El_PUDown             1.057174                    El_PUDown             1.057174
               TOPPT             1.000487                        TOPPT             1.000487

              FragUp             0.958843                       FragUp             1.001121
            FragDown             1.029369                     FragDown             0.999304
         SemilepBRUp             1.002655                  SemilepBRUp             1.008565
       SemilepBRDown             1.035816                SemilepBRDown             0.987051
          PetersonUp             0.990594                   PetersonUp             1.000034

                MrUp             0.896599                         MrUp             0.896599
              MrDown             1.114157                       MrDown             1.114157
                MfUp             0.980611                         MfUp             0.980611
              MfDown             1.025510                       MfDown             1.025510
               MfrUp             0.874600                        MfrUp             0.874600
             MfrDown             1.135833                      MfrDown             1.135833
          AlphaSDown             1.015573                   AlphaSDown             1.015573
            AlphaSUp             0.984924                     AlphaSUp             0.984924

-- so they did change...
   but in git nothing has changed since tag v25
   maybe in Bfrag? -- frag is unchanged by git log.. but there is a modified source laying in backup?

in other ntuples:

v31v27

init 77099579.0
nom  77099579.0
               MU_PU             1.013877
             MU_PUUp             0.994846
           MU_PUDown             1.036567
               El_PU             1.031054
             El_PUUp             1.008917
           El_PUDown             1.057172
               TOPPT             1.000487

              FragUp             1.001121
            FragDown             0.999305
         SemilepBRUp             1.008565
       SemilepBRDown             0.987050
          PetersonUp             1.000036

                MrUp             0.896600
              MrDown             1.114157
                MfUp             0.980608
              MfDown             1.025513
               MfrUp             0.874598
             MfrDown             1.135837
          AlphaSDown             1.015573
            AlphaSUp             0.984924

v34

init 77106788.0
nom  77106788.0
               MU_PU             1.013878
             MU_PUUp             0.994846
           MU_PUDown             1.036568
               El_PU             1.031058
             El_PUUp             1.008922
           El_PUDown             1.057173
               TOPPT             1.000487

              FragUp             0.958841
            FragDown             1.029370
         SemilepBRUp             1.002656
       SemilepBRDown             1.035816
          PetersonUp             0.990594

                MrUp             0.896601
              MrDown             1.114155
                MfUp             0.980612
              MfDown             1.025509
               MfrUp             0.874603
             MfrDown             1.135830
          AlphaSDown             1.015573
            AlphaSUp             0.984924

-- the change happened between these, which is probably the ntupler was switched to CMSSW 8 0 29



but what's the overall effect of this change?

In v37 final variation is:

Up
root [8] 4948.97 / 5135.77
(double) 0.963628
Down
root [9] 5277.82 / 5135.77
(double) 1.02766

from this:

(double) 0.923977
(double) 1.05783

in v26 it is:

root -l ttxsec/HISTOSELS_v25v25redo_PUnormFix.root

((TH1D*) el_sel_ljout->Get("tt_eltau/FragUp/el_sel_ljout_tt_eltau_FragUp_Mt_lep_met_f"))->Integral()      / ((TH1D*) el_sel_ljout->Get("tt_eltau/NOMINAL/el_sel_ljout_tt_eltau_NOMINAL_Mt_lep_met_f"))->Integral()
((TH1D*) el_sel_ljout->Get("tt_eltau/FragDown/el_sel_ljout_tt_eltau_FragDown_Mt_lep_met_f"))->Integral()  / ((TH1D*) el_sel_ljout->Get("tt_eltau/NOMINAL/el_sel_ljout_tt_eltau_NOMINAL_Mt_lep_met_f"))->Integral()

(double) 0.972381
(double) 1.02213

from:

(double) 0.973473
(double) 1.02142

so, it's larger by 1% and 0.5% now...

what is reduce these systematics by this amount?

cp ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL.txt   ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL_reducedFrag.txt
cp ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL.txt   ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL_reducedFrag.txt
cp ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL.txt ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL_reducedFrag.txt

vim -p ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL_reducedFrag.txt ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL_reducedFrag.txt ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL_reducedFrag.txt

make workspace datacard=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL_reducedFrag
make workspace datacard=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL_reducedFrag
make workspace datacard=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL_reducedFrag

make nll workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL_reducedFrag.root      nn=el_v37_test14_bunchFULLFIT3_reducedFrag   freeze="--freezeParameters lumi_13TeV"
make nll workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL_reducedFrag.root      nn=mu_v37_test14_bunchFULLFIT3_reducedFrag   freeze="--freezeParameters lumi_13TeV"
make nll workspace=ttxsec/datacard_v37_test14_bunchFULLFIT3_both_1_HISTOSEL_reducedFrag.root    nn=both_v37_test14_bunchFULLFIT3_reducedFrag freeze="--freezeParameters lumi_13TeV"

 POI: r= 0.943315 -> [0.5,1.5]
 POI: r= 0.940765 -> [0.5,1.5]
 POI: r= 0.948811 -> [0.5,1.5]

-- not too bad, but still there is an asymmetry





## TT weight sys

root -l distrs/v37_test13_bunchFULLFIT2_mc.root

nom      = (TH1D*) mu_sel->Get("tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_c")
mfr_up   = (TH1D*) mu_sel->Get("tt_mutau/MfrUp/mu_sel_tt_mutau_MfrUp_Mt_lep_met_c")
mfr_down = (TH1D*) mu_sel->Get("tt_mutau/MfrDown/mu_sel_tt_mutau_MfrDown_Mt_lep_met_c")

mfr_up->SetLineColor(kRed)
mfr_down->SetLineColor(kRed+2)

nom      ->Draw()
mfr_up   ->Draw("same")
mfr_down ->Draw("same")

-- looks ok

mfr_up   ->Divide(nom)
mfr_down ->Divide(nom)

mfr_up   ->Draw()
mfr_down ->Draw("same")

-- totally symmetric

check the histosel file which was used in the fit

root -l ../../fit-stuff/v37_test13_bunchFULLFIT2.root

nom      = (TH1D*) mu_sel_ljout->Get("tt_mutau/NOMINAL/mu_sel_ljout_tt_mutau_NOMINAL_Mt_lep_met_c")
mfr_up   = (TH1D*) mu_sel_ljout->Get("tt_mutau/MfrUp/mu_sel_ljout_tt_mutau_MfrUp_Mt_lep_met_c")
mfr_down = (TH1D*) mu_sel_ljout->Get("tt_mutau/MfrDown/mu_sel_ljout_tt_mutau_MfrDown_Mt_lep_met_c")


looks as if it is just normalized to the same integral and the stat variations are large this way


mfr_up   ->Integral() /nom      ->Integral()
mfr_down ->Integral() /nom      ->Integral()

1.00260
0.998200

and in the distrs file:

root -l distrs/v37_test13_bunchFULLFIT2_mc.root

(double) 0.876873
(double) 1.13379

normalize and plot:

nom      ->Scale(1. / nom     ->Integral())
mfr_up   ->Scale(1. / mfr_up  ->Integral())
mfr_down ->Scale(1. / mfr_down->Integral())

mfr_up   ->Divide(nom)
mfr_down ->Divide(nom)

mfr_up   ->Draw()
mfr_down ->Draw("same")

c1->SaveAs("v37_test13_post_update_tt-weight-systs-issue_Mfr_in-distrs-file_normalized.png")

c1->SaveAs("v37_test13_post_update_tt-weight-systs-issue_Mfr_in-fit-datafile_original_ratio.png")
c1->SaveAs("v37_test13_post_update_tt-weight-systs-issue_Mfr_in-fit-datafile_normalized.png")


-- the normalized distrs are slightly different, the fit datafile is flatter with less difference between Up and Down


reproduce the histosel sys variation

make --dry-run run_std_histos out=histosels/v37_test13_bunchFULLFIT2/ wjets_norm=1.4 lumi_mu=35800 lumi_el=35800 mc=distrs/v37_test13_bunchFULLFIT2_mc_1.root data_mu=distrs/v37_test13_bunchFULLFIT2/SingleMuon.root data_el=distrs/v37_test13_bunchFULLFIT2/SingleElectron.root | grep mu_sel_ljout

make --dry-run run_histos mc=distrs/v37_test13_bunchFULLFIT2_mc_1.root data=distrs/v37_test13_bunchFULLFIT2/SingleMuon.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test13_bunchFULLFIT2/ wjets_norm=1.4 chan=mu_sel_ljout systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_ljout"

python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc_1.root distrs/v37_test13_bunchFULLFIT2/SingleMuon.root -o histosels/v37_test13_bunchFULLFIT2_issue_w_TT_weights/ --data-nick data_other --lumi 35800 -c mu_sel_ljout -d Mt_lep_met_c --wjet 1.4  -x mu_selVloose_ljout --sys NOMINAL
python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc_1.root distrs/v37_test13_bunchFULLFIT2/SingleMuon.root -o histosels/v37_test13_bunchFULLFIT2_issue_w_TT_weights/ --data-nick data_other --lumi 35800 -c mu_sel_ljout -d Mt_lep_met_c --wjet 1.4  -x mu_selVloose_ljout --sys MfrUp
python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc_1.root distrs/v37_test13_bunchFULLFIT2/SingleMuon.root -o histosels/v37_test13_bunchFULLFIT2_issue_w_TT_weights/ --data-nick data_other --lumi 35800 -c mu_sel_ljout -d Mt_lep_met_c --wjet 1.4  -x mu_selVloose_ljout --sys MfrDown



-- yeah! here the Vloose shape is used!

-- then if the Vloose and Medium variations are indeed different, is Vloose shape justified here?


and the main issue is in mc sums -- the variations are not even close to nominal, far from stat fluctuations

nom      = (TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL")
mfr_up   = (TH1D*) mu_sel_ljout->Get("sums_MfrUp/mc_sum1_MfrUp")
mfr_down = (TH1D*) mu_sel_ljout->Get("sums_MfrDown/mc_sum1_MfrDown")

mfr_up->SetLineColor(kRed)
mfr_down->SetLineColor(kRed+2)

nom      ->Draw()
mfr_up   ->Draw("same")
mfr_down ->Draw("same")

-- yep, they are off
   probably it is the missing QCD?

reproduce this issue and then remove QCD in nominal

python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc_1.root distrs/v37_test13_bunchFULLFIT2/SingleMuon.root -o histosels/v37_test13_bunchFULLFIT2_issue_w_TT_weights/ --data-nick data_other --lumi 35800 -c mu_sel_ljout -d Mt_lep_met_c --wjet 1.4  -x mu_selVloose_ljout --sys NOMINAL --overwrite --qcd 1.05
python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc_1.root distrs/v37_test13_bunchFULLFIT2/SingleMuon.root -o histosels/v37_test13_bunchFULLFIT2_issue_w_TT_weights/ --data-nick data_other --lumi 35800 -c mu_sel_ljout -d Mt_lep_met_c --wjet 1.4  -x mu_selVloose_ljout --sys NOMINAL --overwrite --skip-QCD
python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc_1.root distrs/v37_test13_bunchFULLFIT2/SingleMuon.root -o histosels/v37_test13_bunchFULLFIT2_issue_w_TT_weights/ --data-nick data_other --lumi 35800 -c mu_sel_ljout -d Mt_lep_met_c --wjet 1.4  -x mu_selVloose_ljout --sys MfrUp   --overwrite --skip-QCD
python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc_1.root distrs/v37_test13_bunchFULLFIT2/SingleMuon.root -o histosels/v37_test13_bunchFULLFIT2_issue_w_TT_weights/ --data-nick data_other --lumi 35800 -c mu_sel_ljout -d Mt_lep_met_c --wjet 1.4  -x mu_selVloose_ljout --sys MfrDown --overwrite --skip-QCD


hadd nom_w_data_qcd.root distrs,v37_test13_bunchFULLFIT2_mc_1_HISTOSEL_Mt_lep_met_c_mu_sel_ljout_NOMINAL_data-qcd_shape-mu_selVloose_ljout.root *Mfr*
hadd nom_w_no_qcd.root   distrs,v37_test13_bunchFULLFIT2_mc_1_HISTOSEL_Mt_lep_met_c_mu_sel_ljout_NOMINAL_shape-mu_selVloose_ljout.root          *Mfr*

root -l nom_w_data_qcd.root
-- exactly as in the fit

root -l nom_w_no_qcd.root
-- much better

mfr_up   ->Divide(nom)
mfr_down ->Divide(nom)

mfr_up   ->Draw()
mfr_down ->Draw("same")

-- yeah, all ok



## reproduce sys vars without QCD

histosel without QCD

mkdir histosels/v37_test13_bunchFULLFIT2_noqcd/

make run_std_histos_noqcd out=histosels/v37_test13_bunchFULLFIT2_noqcd/ wjets_norm=1.4 lumi_mu=35800 lumi_el=35800 mc=distrs/v37_test13_bunchFULLFIT2_mc_1.root data_mu=distrs/v37_test13_bunchFULLFIT2/SingleMuon.root data_el=distrs/v37_test13_bunchFULLFIT2/SingleElectron.root

hadd histosels/v37_test13_bunchFULLFIT2_noqcd.root histosels/v37_test13_bunchFULLFIT2_noqcd/*.root


make plot_sys_vars histosel_file=histosels/v37_test13_bunchFULLFIT2_noqcd.root outdir=plots/v37_test13_update1/sys-variations2/

also

make plot_sys_vars_tau_ID_misID mc=distrs/v37_test13_bunchFULLFIT2_mc.root data_mu=distrs/v37_test13_bunchFULLFIT2/SingleMuon.root data_el=distrs/v37_test13_bunchFULLFIT2/SingleElectron.root output=plots/v37_test13_update1/sys-variations2/


Mr, Mf and Mfr symmetric

JES OK, some jumps at 150-200GeV, similar to the data-mc disagreament
JER -- useless stat fluctuations
TES OK + stat fluctuations

LEPmu -- symmetric + a slight bent, not as the past





## check the LEPmu systematic vars - fixed

'LEPmuIDUp'   : lambda ev: ev.event_weight*ev.event_weight_LEPmuIDUp   ,
'LEPmuIDDown' : lambda ev: ev.event_weight*ev.event_weight_LEPmuIDDown ,
'LEPmuTRGUp'  : lambda ev: ev.event_weight*ev.event_weight_LEPmuTRGUp  ,
'LEPmuTRGDown': lambda ev: ev.event_weight*ev.event_weight_LEPmuTRGDown,

            event_weight_LEPmuIDUp[0]    = (weight_lep_pu_muIDUp    / weight_lep_pu) if weight_lep_pu > 0.0001 else 0.
            event_weight_LEPmuIDDown[0]  = (weight_lep_pu_muIDDown  / weight_lep_pu) if weight_lep_pu > 0.0001 else 0.
            event_weight_LEPmuTRGUp[0]   = (weight_lep_pu_muTRGUp   / weight_lep_pu) if weight_lep_pu > 0.0001 else 0.
            event_weight_LEPmuTRGDown[0] = (weight_lep_pu_muTRGDown / weight_lep_pu) if weight_lep_pu > 0.0001 else 0.

-- OK..


make --dry-run plot_sys_vars histosel_file=histosels/v37_test13_bunchFULLFIT2_noqcd.root outdir=plots/v37_test13_update1/sys-variations2/ | grep LEPmu

for sysdef in LEPmuIDUp,LEPmuIDDown LEPmuTRGUp,LEPmuTRGDown ; \
do \
python mc_per_sys.py --ratio-range 0.1 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_lj    -d Mt_lep_met_f -s $sysdef --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_lj_all_Mt_lep_met_f_$sysdef.png ; \
python mc_per_sys.py --ratio-range 0.1 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_ljout -d Mt_lep_met_f -s $sysdef --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_ljout_all_Mt_lep_met_f_$sysdef.png ; \
done


python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_lj    -d Mt_lep_met_f -s LEPmuIDUp,LEPmuIDDown   --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_lj_all_Mt_lep_met_f_LEPmuIDUp,LEPmuIDDown.png       --ratio-y-line 1.0
python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_ljout -d Mt_lep_met_f -s LEPmuIDUp,LEPmuIDDown   --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_ljout_all_Mt_lep_met_f_LEPmuIDUp,LEPmuIDDown.png    --ratio-y-line 1.0

python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_lj    -d Mt_lep_met_f -s LEPmuTRGUp,LEPmuTRGDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_lj_all_Mt_lep_met_f_LEPmuTRGUp,LEPmuTRGDown.png     --ratio-y-line 1.0
python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_ljout -d Mt_lep_met_f -s LEPmuTRGUp,LEPmuTRGDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_ljout_all_Mt_lep_met_f_LEPmuTRGUp,LEPmuTRGDown.png  --ratio-y-line 1.0


-- yeah, muTRG is asymmetric, especially at mu_sel_lj
   muID is also asymmetric, though to a lesser degree


but PU is OK...

yeah! the variations weight was incorrectly calculated:

                weight_lep_pu_muTRGUp   = (ratio_bcdef * (mu_trg_sf_b + trg_b_unc) * mu_b_trk * mu_sfs_b[3][0] * mu_sfs_b[4][0]  * weight_pu_bcdef + \
                                              ratio_gh * (mu_trg_sf_h + trg_h_unc) * mu_h_trk * mu_sfs_h[3][0] * mu_sfs_h[4][0]) * weight_pu_gh
                weight_lep_pu_muTRGDown = (ratio_bcdef * (mu_trg_sf_b - trg_b_unc) * mu_b_trk * mu_sfs_b[3][0] * mu_sfs_b[4][0]  * weight_pu_bcdef + \
                                              ratio_gh * (mu_trg_sf_h - trg_h_unc) * mu_h_trk * mu_sfs_h[3][0] * mu_sfs_h[4][0]) * weight_pu_gh

PU was ok:

                weight_lep_pu_PUUp = ratio_bcdef * mu_trg_sf_b * mu_b_trk * mu_sfs_b[3][0] * mu_sfs_b[4][0] * weight_pu_bcdef_up + \
                                        ratio_gh * mu_trg_sf_h * mu_h_trk * mu_sfs_h[3][0] * mu_sfs_h[4][0] * weight_pu_gh_up
                weight_lep_pu_PUDown = ratio_bcdef * mu_trg_sf_b * mu_b_trk * mu_sfs_b[3][0] * mu_sfs_b[4][0] * weight_pu_bcdef_dn + \
                                          ratio_gh * mu_trg_sf_h * mu_h_trk * mu_sfs_h[3][0] * mu_sfs_h[4][0] * weight_pu_gh_dn

I'm surprised it did not destroy the event yield in these variations.

v37 test14





## check other pull-constrained systematics JES, Peterson, TES

JES does look strange, the 150-200GeV bin especially,
but no such asymmetry as in LEPmu

Peterson is ok, also no difference between el and mu

TES is like JES, the bins at 150 and 200GeV are close to asymmetry
but not like LEPMu


### weird muon short pulls

change to rate: ID 1%, TRG 0.2%

vim ttxsec/datacard_v37_test13_bunchFULLFIT2_mu_noMCstat_exp.txt

make workspace        datacard=ttxsec/datacard_v37_test13_bunchFULLFIT2_mu_noMCstat_exp
make pre_pulls_short workspace=ttxsec/datacard_v37_test13_bunchFULLFIT2_mu_noMCstat_exp.root   nn=mu_v37_test13_2_exp
python ttxsec/fit-stuff/pulls_plot.py pulls_of_nuisances_mu_v37_test13_2_exp_shapeshort.root

LEPmuID         shape          1.0    1.0   1.0   1.0   1.0        1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -                  1.0    1.0   1.0   1.0   1.0        1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -
LEPmuTRG        shape          1.0    1.0   1.0   1.0   1.0        1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -                  1.0    1.0   1.0   1.0   1.0        1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -


LEPmuID         lnN          0.02    0.02   0.02   0.02   0.02        0.02      0.02   0.02   0.02      0.02   0.02      0.02   0.02      -                  0.02    0.02   0.02   0.02   0.02        0.02      0.02   0.02   0.02      0.02   0.02      0.02   0.02      -
LEPmuTRG        lnN          0.005    0.005   0.005   0.005   0.005        0.005      0.005   0.005   0.005      0.005   0.005      0.005   0.005      -                  0.005    0.005   0.005   0.005   0.005        0.005      0.005   0.005   0.005      0.005   0.005      0.005   0.005      -

Best fit r: 0.877361  -0.877361/+0.132101  (68% CL)

damn

JES             shape          1.0    1.0   1.0   1.0   1.0        1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -                  1.0    1.0   1.0   1.0   1.0        1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -
JER             shape          1.0    1.0   1.0   1.0   1.0        1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -                  1.0    1.0   1.0   1.0   1.0        1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -

JES             lnN          0.015    0.015   0.015   0.015   0.015        0.015      0.015   0.015   0.015      0.015   0.015      0.015   0.015      -                  0.015    0.015   0.015   0.015   0.015        0.015      0.015   0.015   0.015      0.015   0.015      0.015   0.015      -
JER             lnN          0.005    0.005   0.005   0.005   0.005        0.005      0.005   0.005   0.005      0.005   0.005      0.005   0.005      -                  0.005    0.005   0.005   0.005   0.005        0.005      0.005   0.005   0.005      0.005   0.005      0.005   0.005      -

Mr              shape     1.0    1.0 1.0 1.0    1.0      -    -    -  -  - - - -     -      1.0    1.0 1.0 1.0    1.0           -           -           -       -            -             -           -           -               -              
Mf              shape     1.0    1.0 1.0 1.0    1.0      -    -    -  -  - - - -     -      1.0    1.0 1.0 1.0    1.0           -           -           -       -            -             -           -           -               -              
Mfr             shape     1.0    1.0 1.0 1.0    1.0      -    -    -  -  - - - -     -      1.0    1.0 1.0 1.0    1.0           -           -           -       -            -             -           -           -               -              

Mr              lnN     0.05    0.05 0.05 0.05    0.05      -    -    -  -  - - - -     -      0.05    0.05 0.05 0.05    0.05           -           -           -       -            -             -           -           -               -              
Mf              lnN     0.05    0.05 0.05 0.05    0.05      -    -    -  -  - - - -     -      0.05    0.05 0.05 0.05    0.05           -           -           -       -            -             -           -           -               -              
Mfr             lnN     0.05    0.05 0.05 0.05    0.05      -    -    -  -  - - - -     -      0.05    0.05 0.05 0.05    0.05           -           -           -       -            -             -           -           -               -              


Frag            shape          0.5    0.5   0.5   0.5   0.5        -        -     -     -        -     -        -     -        -                  0.5    0.5   0.5   0.5   0.5        -        -     -     -        -     -        -     -        -
SemilepBR       shape          0.01    0.01   0.01   0.01   0.01        -        -     -     -        -     -        -     -        -                  0.01    0.01   0.01   0.01   0.01        -        -     -     -        -     -        -     -        -
Peterson        shape          0.5    0.5   0.5   0.5   0.5        -        -     -     -        -     -        -     -        -                  0.5    0.5   0.5   0.5   0.5        -        -     -     -        -     -        -     -        -

Frag            lnN          0.015    0.015   0.015   0.015   0.015        -        -     -     -        -     -        -     -        -                  0.015    0.015   0.015   0.015   0.015        -        -     -     -        -     -        -     -        -
SemilepBR       lnN          0.001    0.001   0.001   0.001   0.001        -        -     -     -        -     -        -     -        -                  0.001    0.001   0.001   0.001   0.001        -        -     -     -        -     -        -     -        -
Peterson        lnN          0.98/1.    0.98/1.   0.98/1.   0.98/1.   0.98/1.        -        -     -     -        -     -        -     -        -                  0.98/1.    0.98/1.   0.98/1.   0.98/1.   0.98/1.        -        -     -     -        -     -        -     -        -


Best fit r: 2.13888  -2.13888/+0.150254  (68% CL)

wtf?


vim ttxsec/datacard_v37_test13_bunchFULLFIT2_mu_noMCstat_exp2.txt
make workspace datacard=ttxsec/datacard_v37_test13_bunchFULLFIT2_mu_noMCstat_exp2
make pre_pulls_short workspace=ttxsec/datacard_v37_test13_bunchFULLFIT2_mu_noMCstat_exp2.root   nn=mu_v37_test13_bunchFULLFIT2_noMCstat_exp2

python ttxsec/fit-stuff/pulls_plot.py pulls_of_nuisances_mu_v37_test13_bunchFULLFIT2_noMCstat_exp2_shapeshort.root

combine -M FitDiagnostics ttxsec/datacard_v37_test13_bunchFULLFIT2_mu_noMCstat_exp2.root   --name mu_v37_test13_bunchFULLFIT2_noMCstat_exp2ShapeShort    --noMCbonly 0 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf_only

combine -M FitDiagnostics ttxsec/datacard_v37_test13_bunchFULLFIT2_mu_noMCstat_exp2.root   --name mu_v37_test13_bunchFULLFIT2_noMCstat_exp2ShapeShort    --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf_only

name                                              b-only fit            s+b fit         rho
['FSR', 'Frag', 'HDAMP', 'ISR', 'JER', 'JES', 'LEPmuID', 'LEPmuTRG', 'Mf', 'Mfr', 'Mr', 'PU', 'Peterson', 'TES', 'TOPPT', 'bSF', 'tau_fakes', 'wjets_norm']
FSR                                              +0.79, 0.76        +0.79, 0.76       -0.28
Frag                                             +0.32, 0.92        +0.32, 0.92       +0.26
HDAMP                                            -1.00, 0.96        -1.00, 0.96       -0.09
ISR                                              -0.71, 0.97        -0.71, 0.97       +0.19
JER                                              +0.46, 0.97        +0.46, 0.97       -0.07
JES                                              -0.00, 0.55        -0.00, 0.55       +0.01
LEPmuID                                       ! +0.00, 0.39!     ! +0.00, 0.39!       -0.01
LEPmuTRG                                      ! -0.00, 0.39!     ! -0.00, 0.39!       -0.00
Mf                                            ! +0.00, 0.24!     ! +0.00, 0.24!       +0.00
Mfr                                              -0.35, 0.88        -0.35, 0.88       -0.14
Mr                                               -0.34, 0.90        -0.34, 0.90       -0.15
PU                                               -0.45, 0.98        -0.45, 0.98       -0.35
Peterson                                         +0.01, 0.75        +0.01, 0.75       +0.01
TES                                           ! -0.00, 0.46!     ! -0.00, 0.46!       -0.00

they are dead on 0, the error bars are slightly larger

LEPmuID         shape          0.2    0.2   0.2   0.2   0.2        0.2      0.2   0.2   0.2      0.2   0.2      0.2   0.2      -                  0.2    0.2   0.2   0.2   0.2        0.2      0.2   0.2   0.2      0.2   0.2      0.2   0.2      - 

LEPmuID         lnN          0.2    0.2   0.2   0.2   0.2        0.2      0.2   0.2   0.2      0.2   0.2      0.2   0.2      -                  0.2    0.2   0.2   0.2   0.2        0.2      0.2   0.2   0.2      0.2   0.2      0.2   0.2      - 
LEPmuID         lnN          0.2    -     0.2   0.2   0.2        -        -     -     -        -     -        -     -        -                  0.2    0.2   0.2   0.2   0.2        -        -     -     -        -     -        -     -        - 

-- immediately insane fit


JES             shape          0.1    0.1   0.1   0.1   0.1        0.1      0.1   0.1   0.1      0.1   0.1      0.1   0.1      -                  0.1    0.1   0.1   0.1   0.1        0.1      0.1   0.1   0.1      0.1   0.1      0.1   0.1      -
JES             lnN          0.02    0.02   0.02   -     -          0.02      -     -     0.02      -     0.02      -     0.02      -                  0.02    0.02   -     -     -          0.02      -     -     0.02      0.02   -        -     0.02      -

same crap
Best fit r: 1.49109  -0.409809/+0.899405  (68% CL)

ok let's do shapes..

Best fit r: 0.930202  -0.0631903/+0.0690552  (68% CL)

and back to normal

ok:
ttxsec/datacard_v37_test13_bunchFULLFIT2_mu_noMCstat_exp2.txt

make both mucard=ttxsec/datacard_v37_test13_bunchFULLFIT2_mu_noMCstat_exp2 elcard=ttxsec/datacard_v37_test13_bunchFULLFIT2_el_noMCstat bothcard=ttxsec/datacard_v37_test13_bunchFULLFIT2_both_noMCstat_exp2

make workspace datacard=ttxsec/datacard_v37_test13_bunchFULLFIT2_both_noMCstat_exp2
make pre_pulls_short workspace=ttxsec/datacard_v37_test13_bunchFULLFIT2_both_noMCstat_exp2.root   nn=both_v37_test13_bunchFULLFIT2_noMCstat_exp2
python ttxsec/fit-stuff/pulls_plot.py pulls_of_nuisances_both_v37_test13_bunchFULLFIT2_noMCstat_exp2_shapeshort.root


cp ttxsec/datacard_v37_test13_bunchFULLFIT2_mu_noMCstat_exp2.txt ttxsec/datacard_v37_test13_bunchFULLFIT2_mu_exp2.txt
vim -p ttxsec/datacard_v37_test13_bunchFULLFIT2_mu_exp2.txt ttxsec/datacard_v37_test13_bunchFULLFIT2_mu.txt 


make both mucard=ttxsec/datacard_v37_test13_bunchFULLFIT2_mu_exp2 elcard=ttxsec/datacard_v37_test13_bunchFULLFIT2_el bothcard=ttxsec/datacard_v37_test13_bunchFULLFIT2_both_exp2
make workspace datacard=ttxsec/datacard_v37_test13_bunchFULLFIT2_both_exp2

make impacts workspace=ttxsec/datacard_v37_test13_bunchFULLFIT2_mu_exp2.root   nn=mu_v37_test13_2_exp2
make impacts workspace=ttxsec/datacard_v37_test13_bunchFULLFIT2_both_exp2.root nn=both_v37_test13_2_exp2


./latest_impacts_both_v37_test13_2_exp2.pdf
-- looks like mu only + all LEP are not even close

use only lessparams pulls

evince ./latest_impacts_both_v37_test13_2_exp2.pdf
evince ./latest_impacts_mu_v37_test13_2_exp2.pdf



#### extracting and renaming all fitting plots


defs for JES and TES:

'JESDown':  lambda ev: ev.event_weight,
'JESUp'  :  lambda ev: ev.event_weight,
'TESDown':  lambda ev: ev.event_weight,
'TESUp'  :  lambda ev: ev.event_weight,

systs_objects_mt_variation = {
'NOMINAL'  : lambda ev: ev.event_met_lep_mt,
'JERUp'    : lambda ev: ev.event_met_lep_mt_JERUp,
'JERDown'  : lambda ev: ev.event_met_lep_mt_JERDown,
'JESUp'    : lambda ev: ev.event_met_lep_mt_JESUp,
'JESDown'  : lambda ev: ev.event_met_lep_mt_JESDown,
'TESUp'    : lambda ev: ev.event_met_lep_mt_TESUp,
'TESDown'  : lambda ev: ev.event_met_lep_mt_TESDown,
}

main_sel_stages = {
'NOMINAL':  lambda ev: ev.selection_stage,
'JERDown':  lambda ev: ev.selection_stage_JERDown,
'JERUp'  :  lambda ev: ev.selection_stage_JERUp  ,
'JESDown':  lambda ev: ev.selection_stage_JESDown,
'JESUp'  :  lambda ev: ev.selection_stage_JESUp  ,
'TESDown':  lambda ev: ev.selection_stage_TESDown,
'TESUp'  :  lambda ev: ev.selection_stage_TESUp  ,
}

-- all ok

        tt_channel_sel_stage          = passes_tt_selection_stages(passed_triggers, leps, (N_jets_nom_med,     N_jets_nom_all),     [tau for tau in sel_taus if (tau[0]*tau[1][0]).pt() > TAUS_PT_CUT], proc_met)

        tt_channel_sel_stage_TESUp    = passes_tt_selection_stages(passed_triggers, leps, (N_jets_nom_med,     N_jets_nom_all),     [tau for tau in sel_taus if (tau[0]*tau[1][1]).pt() > TAUS_PT_CUT], proc_met)
        tt_channel_sel_stage_TESDown  = passes_tt_selection_stages(passed_triggers, leps, (N_jets_nom_med,     N_jets_nom_all),     [tau for tau in sel_taus if (tau[0]*tau[1][2]).pt() > TAUS_PT_CUT], proc_met)
        tt_channel_sel_stage_JERUp    = passes_tt_selection_stages(passed_triggers, leps, (N_jets_JERUp_med,   N_jets_JERUp_all),   [tau for tau in sel_taus if (tau[0]*tau[1][0]).pt() > TAUS_PT_CUT], proc_met)
        tt_channel_sel_stage_JERDown  = passes_tt_selection_stages(passed_triggers, leps, (N_jets_JERDown_med, N_jets_JERDown_all), [tau for tau in sel_taus if (tau[0]*tau[1][0]).pt() > TAUS_PT_CUT], proc_met)
        tt_channel_sel_stage_JESUp    = passes_tt_selection_stages(passed_triggers, leps, (N_jets_JESUp_med,   N_jets_JESUp_all),   [tau for tau in sel_taus if (tau[0]*tau[1][0]).pt() > TAUS_PT_CUT], proc_met)
        tt_channel_sel_stage_JESDown  = passes_tt_selection_stages(passed_triggers, leps, (N_jets_JESDown_med, N_jets_JESDown_all), [tau for tau in sel_taus if (tau[0]*tau[1][0]).pt() > TAUS_PT_CUT], proc_met)

also ok

make plot_sys_vars_tau_ID_misID mc=distrs/v37_test13_bunchFULLFIT2_mc.root data_mu=distrs/v37_test13_bunchFULLFIT2/SingleMuon.root data_el=distrs/v37_test13_bunchFULLFIT2/SingleElectron.root output=plots/v37_test13_update1/sys-variations/

-- weird looking muon ID and TRG
   Mfr, Mr, Mf (worse in el)  -- off from nominal
   Frag, Peterson, Semilep    -- off from nominal
   JER, JES
   TES is more or less ok




### corrections to JES in PS datasets

stage2 calculation

        event_met_lep_mt         [0] = transverse_mass_pts(lep_p4[0].Px(), lep_p4[0].Py(), proc_met.Px(), proc_met.Py())
        event_met_lep_mt_JERUp   [0] = transverse_mass_pts(lep_p4[0].Px(), lep_p4[0].Py(), proc_met_JERUp.Px(),   proc_met_JERUp.Py())
        event_met_lep_mt_JERDown [0] = transverse_mass_pts(lep_p4[0].Px(), lep_p4[0].Py(), proc_met_JERDown.Px(), proc_met_JERDown.Py())
        event_met_lep_mt_JESUp   [0] = transverse_mass_pts(lep_p4[0].Px(), lep_p4[0].Py(), proc_met_JESUp.Px(),   proc_met_JESUp.Py())
        event_met_lep_mt_JESDown [0] = transverse_mass_pts(lep_p4[0].Px(), lep_p4[0].Py(), proc_met_JESDown.Px(), proc_met_JESDown.Py())
        event_met_lep_mt_TESUp   [0] = transverse_mass_pts(lep_p4[0].Px(), lep_p4[0].Py(), proc_met_TESUp.Px(),   proc_met_TESUp.Py())
        event_met_lep_mt_TESDown [0] = transverse_mass_pts(lep_p4[0].Px(), lep_p4[0].Py(), proc_met_TESDown.Px(), proc_met_TESDown.Py())

(the only?) difference between nominal jets and variations:

                    if jet_pt > JETS_PT_CUT:
                        proc_met -= p4 * (en_factor - 1.)
                    if jet_pt_JERUp > JETS_PT_CUT:
                        proc_met_JERUp   -= p4 * (jet_factor_JERUp - 1.)
                    if jet_pt_JERDown > JETS_PT_CUT:
                        proc_met_JERDown -= p4 * (jet_factor_JERDown - 1.)
                    if jet_pt_JESUp > JETS_PT_CUT:
                        proc_met_JESUp   -= p4 * (jet_factor_JESUp - 1.)
                    if jet_pt_JESDown > JETS_PT_CUT:
                        proc_met_JESDown -= p4 * (jet_factor_JESDown - 1.)
                    # these were broken! the nominal jer factor was not applied, but now it is.

but:

                        jet_factor_JESUp   = en_factor * (1 + jes_shift)
                        jet_factor_JESDown = en_factor * (1 - jes_shift)

and these:

                        up, down = ev.jet_jer_factor_up[i], ev.jet_jer_factor_down[i]
                        jet_factor_JERUp   = up    if jer_factor > 0 else 0
                        jet_factor_JERDown = down  if jer_factor > 0 else 0

where

				jer_factor = TMath::Max(0., 1. + (jer_sf - 1) * dPt / jet.pt());
				jer_factor_up   = TMath::Max(0., 1. + (jer_sf_up   - 1) * dPt / jet.pt());
				jer_factor_down = TMath::Max(0., 1. + (jer_sf_down - 1) * dPt / jet.pt());
				jet.setP4(jet.p4()*jer_factor); // same as scaleEnergy in the Jet POG example

but I use

            p4 = ev.jet_initial_p4[i]

-- so, here I do not need to divide by nominal JER!
   the jet has only JES applied,
   I multiply by jer with en_factor
   then I multiply by JER Up Down to get the variations
   -- but! jet_pt already inlcudes JER?

            jet_pt  = p4.pt() * en_factor
            jet_eta = p4.eta()
            possible_jet_pts = [jet_pt]

and

            jet_pt_JERUp   = jet_pt
            jet_pt_JERDown = jet_pt
            jet_pt_JESUp   = jet_pt
            jet_pt_JESDown = jet_pt

-- JER is wrong

but then I do:

                        jet_pt_JESUp    = p4.pt() * jet_factor_JESUp  
                        jet_pt_JESDown  = p4.pt() * jet_factor_JESDown

and what I propagate to MET?
-- MET is equalized with initial jets
   I correct them by JER factor for nominal and by systematic factors for the rest
   these factors are propagated to MET

   so I need 1 factor for each jet variation, which includes full correction

so, now the factors for MET propagation are correct, but the pT of systematic jets are not




what's the problem with TES?

                taus_main.append((p4, (TES_factor, TES_factor_up, TES_factor_dn), tau_pdgID, i, tau_ID, jetmatched))

        event_met_lep_mt_TESUp   [0] = transverse_mass_pts(lep_p4[0].Px(), lep_p4[0].Py(), proc_met_TESUp.Px(),   proc_met_TESUp.Py())
        event_met_lep_mt_TESDown [0] = transverse_mass_pts(lep_p4[0].Px(), lep_p4[0].Py(), proc_met_TESDown.Px(), proc_met_TESDown.Py())

-- and propagations and pT cuts look ok

'TESDown':  lambda ev: ev.event_weight,
'TESUp'  :  lambda ev: ev.event_weight,

'TESUp'    : lambda ev: ev.event_met_lep_mt_TESUp,
'TESDown'  : lambda ev: ev.event_met_lep_mt_TESDown,

damn!

    proc_met_TESUp
    proc_met_TESDown

-- they don't get all the nominal JER propagation!!!

-->> go test14 TT and the rest


check the change in TT:

python sumup_ttree_draw.py "event_met_lep_mt" --ttree ttree_out --cond-com "(selection_stage == 19 || selection_stage == 17 || selection_stage == 15)*event_weight"                        --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_Mt_NOMINAL_el.root    --histo-name Mt_NOMINAL_el lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "event_met_lep_mt" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight"                           --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_Mt_NOMINAL_mu.root    --histo-name Mt_NOMINAL_mu lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root     &

python sumup_ttree_draw.py "event_met_lep_mt" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight*event_weight_LEPmuTRGUp"   --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_Mt_LEPmuTRGUp.root   --histo-name  Mt_LEPmuTRGUp  lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root    &
python sumup_ttree_draw.py "event_met_lep_mt" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight*event_weight_LEPmuTRGDown" --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_Mt_LEPmuTRGDown.root --histo-name Mt_LEPmuTRGDown lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root    &
python sumup_ttree_draw.py "event_met_lep_mt" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight*event_weight_LEPmuIDUp"    --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_Mt_LEPmuIDUp.root    --histo-name  Mt_LEPmuIDUp   lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root    &
python sumup_ttree_draw.py "event_met_lep_mt" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight*event_weight_LEPmuIDDown"  --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_Mt_LEPmuIDDown.root  --histo-name  Mt_LEPmuIDDown lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root    &

python sumup_ttree_draw.py "event_met_lep_mt_JESUp"   --ttree ttree_out --cond-com "(selection_stage_JESUp   == 9 || selection_stage_JESUp   == 7 || selection_stage_JESUp   == 5)*event_weight"  --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_Mt_JESUp.root    --histo-name Mt_JESUp    lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root    &
python sumup_ttree_draw.py "event_met_lep_mt_JESDown" --ttree ttree_out --cond-com "(selection_stage_JESDown == 9 || selection_stage_JESDown == 7 || selection_stage_JESDown == 5)*event_weight"  --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_Mt_JESDown.root  --histo-name Mt_JESDown  lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root    &

python sumup_ttree_draw.py "event_met_lep_mt_TESUp"   --ttree ttree_out --cond-com "(selection_stage_TESUp   == 9 || selection_stage_TESUp   == 7 || selection_stage_TESUp   == 5)*event_weight"  --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_Mt_TESUp.root    --histo-name Mt_TESUp   lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "event_met_lep_mt_TESDown" --ttree ttree_out --cond-com "(selection_stage_TESDown == 9 || selection_stage_TESDown == 7 || selection_stage_TESDown == 5)*event_weight"  --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_Mt_TESDown.root  --histo-name Mt_TESDown lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root     &

python sumup_ttree_draw.py "event_met_lep_mt_JERUp"   --ttree ttree_out --cond-com "(selection_stage_JERUp   == 9 || selection_stage_JERUp   == 7 || selection_stage_JERUp   == 5)*event_weight"  --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_Mt_JERUp.root    --histo-name Mt_JERUp   lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "event_met_lep_mt_JERDown" --ttree ttree_out --cond-com "(selection_stage_JERDown == 9 || selection_stage_JERDown == 7 || selection_stage_JERDown == 5)*event_weight"  --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_Mt_JERDown.root  --histo-name Mt_JERDown lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root     &

python sumup_ttree_draw.py "event_met_lep_mt_JERUp"   --ttree ttree_out --cond-com "(selection_stage_JERUp   == 19 || selection_stage_JERUp   == 17 || selection_stage_JERUp   == 15)*event_weight" --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_Mt_JERUp_el.root    --histo-name Mt_JERUp_el   lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &
python sumup_ttree_draw.py "event_met_lep_mt_JERDown" --ttree ttree_out --cond-com "(selection_stage_JERDown == 19 || selection_stage_JERDown == 17 || selection_stage_JERDown == 15)*event_weight" --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_Mt_JERDown_el.root  --histo-name Mt_JERDown_el lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &

-- damn! the el selections!

hadd -f v37_test14_LEPmu_JES_JER_TES_issue.root v37_test14_LEPmu_JES_JER_TES_issue_*root

root -l v37_test14_LEPmu_JES_JER_TES_issue.root

Mt_LEPmuTRGUp   ->SetLineColor(kRed)
Mt_LEPmuTRGDown ->SetLineColor(kRed+2)
Mt_LEPmuIDUp    ->SetLineColor(kRed)
Mt_LEPmuIDDown  ->SetLineColor(kRed+2)
Mt_TESUp    ->SetLineColor(kRed)
Mt_TESDown  ->SetLineColor(kRed+2)
Mt_JESUp    ->SetLineColor(kRed)
Mt_JESDown  ->SetLineColor(kRed+2)
Mt_JERUp    ->SetLineColor(kRed)
Mt_JERDown  ->SetLineColor(kRed+2)
Mt_JERUp_el    ->SetLineColor(kRed)
Mt_JERDown_el  ->SetLineColor(kRed+2)

Mt_LEPmuTRGUp   ->Divide(Mt_NOMINAL_mu)
Mt_LEPmuTRGDown ->Divide(Mt_NOMINAL_mu)
Mt_LEPmuIDUp    ->Divide(Mt_NOMINAL_mu)
Mt_LEPmuIDDown  ->Divide(Mt_NOMINAL_mu)
Mt_TESUp        ->Divide(Mt_NOMINAL_mu)
Mt_TESDown      ->Divide(Mt_NOMINAL_mu)
Mt_JESUp        ->Divide(Mt_NOMINAL_mu)
Mt_JESDown      ->Divide(Mt_NOMINAL_mu)
Mt_JERUp        ->Divide(Mt_NOMINAL_mu)
Mt_JERDown      ->Divide(Mt_NOMINAL_mu)
Mt_JERUp_el     ->Divide(Mt_NOMINAL_el)
Mt_JERDown_el   ->Divide(Mt_NOMINAL_el)


Mt_LEPmuTRGUp   ->Draw()
Mt_LEPmuTRGDown ->Draw("same")
Mt_LEPmuIDUp    ->Draw()
Mt_LEPmuIDDown  ->Draw("same")
Mt_TESUp        ->Draw()
Mt_TESDown      ->Draw("same")
Mt_JESUp        ->Draw()
Mt_JESDown      ->Draw("same")
Mt_JERUp        ->Draw()
Mt_JERDown      ->Draw("same")
Mt_JERUp_el     ->Draw()
Mt_JERDown_el   ->Draw("same")

l = (TLine*) new TLine(0., 1.0, 250., 1.0)
l->Draw("same")

-- LEPmu are perfect

   TES is good, except bins at 210-220GeV

   JES more bins flipped

   JER most bins are asymmetric from NOMINAL

   the others are stat deviations, often asymmetric from NOMINAL
   and they were made with wrong selection_stages-s
   -- with correct selections:
      TES and JES - much better
      but still in some bins TESUp < NOMINAL and TESDown > NOMINAL?
      JER -- still crapy, in most bins variations are on one side of NOMINAL
             and the variations are close each other, they are just shifted to a side of NOMINAL

what's with JER in the other (muon) channel?
-- same stuff

since the variations are often close to each other, it looks like some nominal stuf is not propagated to them



### LEPmu -- identical Up Down

root -l lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_1.root
ttree_out->Draw("event_weight_LEPmuTRGUp:event_weight_LEPmuTRGDown")
ttree_out->Draw("event_weight_LEPmuIDUp:event_weight_LEPmuIDDown")

ttree_out->Draw("event_weight_LEPmuTRGUp - event_weight_LEPmuTRGDown")
ttree_out->Draw("event_weight_LEPmuIDUp  - event_weight_LEPmuIDDown")

does show them identical
also some weights are > 1000!
-- fixed to maximum = twice the nominal LEP weight

debugger shows them different

python -m pdb channel_distrs_full_loop.py --overwrite --do-W-stitching --metmuegclean false --options no_prop_lepjets -l logss temp/ channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/MC2016_Summer16_TTJets_powheg_64.root

break 98
r
b stage2:4729
c

(Pdb) p weight_lep_pu
1.145978025815098
(Pdb) p weight_lep_pu_muIDUp
1.1547874854163567
(Pdb) p pass_mu
True
(Pdb) p pass_el
False
(Pdb) p pass_elmu
False
(Pdb) p pass_mumu
False
(Pdb) p pass_elel
False
(Pdb) p weight_lep_pu_muIDUp
1.1547874854163567
(Pdb) p weight_lep_pu_muIDDown
1.137195091197873

let's test this file

time python channel_distrs_full_loop.py --overwrite --do-W-stitching --metmuegclean false --options no_prop_lepjets -l logss temp/ channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/MC2016_Summer16_TTJets_powheg_65.root

-- line +1 and weaker -1

1.145978025815098
1.154787485416357
1.137195091197873

1.154787485416357 - 1.145978025815098
0.008809459601258895

1.145978025815098 - 1.137195091197873
0.008782934617225013

line +1 is not from pass_mu!

((TTree*) ttree_out)->Draw("event_weight_LEPmuIDUp:event_weight_LEPmuIDDown>>h(100,0.9,1.1,100,0.9,1.1)", "selection_stage == 9 || selection_stage == 7 || selection_stage == 5", "col")
((TTree*) ttree_out)->Draw("event_weight_LEPmuIDUp - event_weight_LEPmuIDDown",                           "selection_stage == 9 || selection_stage == 7 || selection_stage == 5")

-- short -1 line

the difference peaks at 0.015

((TTree*) ttree_out)->Draw("event_weight_LEPmuTRGUp - event_weight_LEPmuTRGDown",                         "selection_stage == 9 || selection_stage == 7 || selection_stage == 5")

-- peak at 0.005

compare to nominal:

((TTree*) ttree_out)->Draw("event_weight_LEPmuTRGUp   * event_weight_LEP_PU - event_weight_LEP_PU",       "selection_stage == 9 || selection_stage == 7 || selection_stage == 5")
((TTree*) ttree_out)->Draw("event_weight_LEPmuTRGDown * event_weight_LEP_PU - event_weight_LEP_PU",       "selection_stage == 9 || selection_stage == 7 || selection_stage == 5")

-- peak at 0.0025 and -0.0025

((TTree*) ttree_out)->Draw("event_weight_LEPmuIDUp   * event_weight_LEP_PU - event_weight_LEP_PU",        "selection_stage == 9 || selection_stage == 7 || selection_stage == 5")
((TTree*) ttree_out)->Draw("event_weight_LEPmuIDDown * event_weight_LEP_PU - event_weight_LEP_PU",        "selection_stage == 9 || selection_stage == 7 || selection_stage == 5")

-- at 0.008 and -0.008

So, check an actual test14 file:

root -l lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_65.root

-- same

all ok, just confused the el and mu selection stages!



### check JER in pdb

the problem is:
the JER deviations are well withing stat uncertainties, but they don't look like stat fluctuation:
they are closer to each other than the stat uncertainty and consistently asymmetrically off the nominal


python -m pdb channel_distrs_full_loop.py --overwrite --do-W-stitching --metmuegclean false --options no_prop_lepjets -l logss temp/ channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/MC2016_Summer16_TTJets_powheg_64.root

break 98
r
b stage2:3871
b stage2:4137
c

p (jet_pt, jet_pt_JERUp, jet_pt_JERDown, jet_pt_JESUp, jet_pt_JESDown)

p (jet_pt, jet_pt_JERUp, jet_pt_JERDown, jet_pt_JESUp, jet_pt_JESDown)
p (proc_met.pt(), proc_met_JERUp.pt(), proc_met_JERDown.pt(), proc_met_JESUp.pt(), proc_met_JESDown.pt())

(116.20066159957423, 116.3231554422673, 116.07815405970541, 117.34846416708938, 115.05285903205909)
(146.21824645996094, 146.21824645996094, 146.21824645996094, 146.21824645996094, 146.21824645996094)

(41.013478935302366, 41.04752402729718, 40.979433843307554, 41.69352002299687, 40.33343784760786)
(147.35364960906952, 147.46073977343505, 147.24657149110465, 148.3580500785504, 146.3513579868092)

(35.61375328476379, 35.66372104283346, 35.563789754442496, 36.69022598895816, 34.537280580569416)
(147.35364960906952, 147.46073977343505, 147.24657149110465, 148.3580500785504, 146.3513579868092)

-- consistently JER Up Down in MET pT are +- from nominal...


the issue can be due to the correlation in MET pT-phi?

check JER Up Down in met pT and phi separately

python sumup_ttree_draw.py "event_met.pt()"          --ttree ttree_out --cond-com "(selection_stage         == 9 || selection_stage         == 7 || selection_stage         == 5)*event_weight" --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_NOMINAL.root --histo-name MET_pT_NOMINAL lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &
python sumup_ttree_draw.py "event_met_JERUp.pt()"    --ttree ttree_out --cond-com "(selection_stage_JERUp   == 9 || selection_stage_JERUp   == 7 || selection_stage_JERUp   == 5)*event_weight" --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_JERUp.root   --histo-name MET_pT_JERUp   lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &
python sumup_ttree_draw.py "event_met_JERDown.pt()"  --ttree ttree_out --cond-com "(selection_stage_JERDown == 9 || selection_stage_JERDown == 7 || selection_stage_JERDown == 5)*event_weight" --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_JERDown.root --histo-name MET_pT_JERDown lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &

python sumup_ttree_draw.py "event_met.phi()"         --ttree ttree_out --cond-com "(selection_stage         == 9 || selection_stage         == 7 || selection_stage         == 5)*event_weight" --histo-range 20,-3.15,3.15 --output v37_test14_LEPmu_JES_JER_TES_issue_MET_phi_NOMINAL.root --histo-name MET_phi_NOMINAL lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &
python sumup_ttree_draw.py "event_met_JERUp.phi()"   --ttree ttree_out --cond-com "(selection_stage_JERUp   == 9 || selection_stage_JERUp   == 7 || selection_stage_JERUp   == 5)*event_weight" --histo-range 20,-3.15,3.15 --output v37_test14_LEPmu_JES_JER_TES_issue_MET_phi_JERUp.root   --histo-name MET_phi_JERUp   lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &
python sumup_ttree_draw.py "event_met_JERDown.phi()" --ttree ttree_out --cond-com "(selection_stage_JERDown == 9 || selection_stage_JERDown == 7 || selection_stage_JERDown == 5)*event_weight" --histo-range 20,-3.15,3.15 --output v37_test14_LEPmu_JES_JER_TES_issue_MET_phi_JERDown.root --histo-name MET_phi_JERDown lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &

hadd -f v37_test14_LEPmu_JES_JER_TES_issue_MET.root v37_test14_LEPmu_JES_JER_TES_issue_MET_*root

root -l v37_test14_LEPmu_JES_JER_TES_issue_MET.root

MET_pT_JERUp   ->SetLineColor(kRed)
MET_pT_JERDown ->SetLineColor(kRed+2)

MET_phi_JERUp   ->SetLineColor(kRed)
MET_phi_JERDown ->SetLineColor(kRed+2)

MET_pT_JERUp   ->Divide(MET_pT_NOMINAL)
MET_pT_JERDown ->Divide(MET_pT_NOMINAL)

MET_phi_JERUp   ->Divide(MET_phi_NOMINAL)
MET_phi_JERDown ->Divide(MET_phi_NOMINAL)



l = (TLine*) new TLine(0., 1.0, 250., 1.0)
MET_pT_JERUp   ->Draw()
MET_pT_JERDown ->Draw("same")
l->Draw("same")

-- no, pT is also asymmetric in many bins..


lphi = (TLine*) new TLine(-3.15, 1.0, 3.15, 1.0)
MET_phi_JERUp   ->Draw()
MET_phi_JERDown ->Draw("same")
lphi->Draw("same")

-- phi is random fluctuations

root [1] MET_pT_JERUp->Print()
TH1.Print Name  = MET_pT_JERUp, Entries= 114651, Total sum= 103886
root [2] MET_pT_NOMINAL->Print()
TH1.Print Name  = MET_pT_NOMINAL, Entries= 114674, Total sum= 103893
root [3] MET_pT_JERDown->Print()
TH1.Print Name  = MET_pT_JERDown, Entries= 114697, Total sum= 103936

-- JERUp has less events




check the correlation in 1 file

root -l lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_27.root

ttree_out->Draw("(event_met.pt()-event_met_JERUp.pt()):(event_met.phi()-event_met_JERUp.phi())")
ttree_out->Draw("(event_met.pt()-event_met_JERDown.pt()):(event_met.phi()-event_met_JERDown.phi())")

-- no correlation

ttree_out->Draw("event_met.pt()-event_met_JERUp.pt()>>h(20,-1,1)")
ttree_out->Draw("event_met.pt()-event_met_JERDown.pt()>>h(20,-1,1)")

-- around 0: JERDown +0.06 +- 0.27
             JERUp   -0.06 +- 0.27

ttree_out->Draw("event_met_JERDown.pt()-event_met_JERUp.pt()>>h(20,-1.,1.)")

-- also wide peak
   -0.08 +- 0.38

ttree_out->Draw("event_met_JERDown.pt()-event_met.pt():event_met_JERUp.pt()-event_met.pt()>>h(200,-0.1,0.1,200,-0.1,0.1)", "selection_stage == 5 || selection_stage == 7 || selection_stage == 9", "col")

-- clear line -1
   cannot be a fluctuation then, can it?

   JERUp   = NOM + x
   JERDown = NOM - x

   x = +- 0.27

   so both variations have bin-by-bin migration in both directions of 0.3 GeV magnitude -- within 1 bin or maximum between neighbors
   but why does it even out so well that they look closer to each other than to NOMINAL at the end?

it is the migration of thin layer between neighbor bins!
the migration of thin layer between bins leads to variations proportional to differences between heights of neighbor bins
if Up and Down vary in both directions equally (as in my case) the result for both is the same
and it depends on heights of the given bin and its' neighbors

if it is so, then the difference of heights of neighboring bins should matter

the expected deviation must be proportional to 2nd derivative:
for bins [N-1][N][N+1] the central bin N varies for both Up and Down close to
(N+1) + (N-1) - 2*N

root -l v37_test14_LEPmu_JES_JER_TES_issue_MET.root

MET_pT_NOMINAL   ->GetBinContent(1)
MET_pT_NOMINAL   ->GetBinContent(2)
MET_pT_NOMINAL   ->GetBinContent(3)
MET_pT_NOMINAL   ->GetBinContent(4)
MET_pT_NOMINAL   ->GetBinContent(5)
MET_pT_NOMINAL   ->GetBinContent(6)
MET_pT_NOMINAL   ->GetBinContent(7)
MET_pT_NOMINAL   ->GetBinContent(8)
MET_pT_NOMINAL   ->GetBinContent(9)
MET_pT_NOMINAL   ->GetBinContent(10)
MET_pT_NOMINAL   ->GetBinContent(11)
MET_pT_NOMINAL   ->GetBinContent(12)
MET_pT_NOMINAL   ->GetBinContent(13)
MET_pT_NOMINAL   ->GetBinContent(14)
MET_pT_NOMINAL   ->GetBinContent(15)

bins = [ 3215.15 8821.89 12504.1 14386.2 13869.2 12351.9 10155.2 7793.23 5938.67 4208.46 3167.35 2187.72 1548.06 1080.29 852.619 ]

bins[1:length(bins)]

bins_nominal = bins[2:length(bins)-1]
bins_left    = bins[1:length(bins)-2]
bins_right   = bins[3:length(bins)]

bins_right + bins_left - 2*bins_nominal

 -1924.53 
 -1800.11 
 -2399.1  
 -1000.3  
  -679.4  
  -165.27 
   507.41 
   124.35 
   689.1  
    61.48 
   339.97 
   171.89 
   240.099

* some factor

MET_pT_JERUp   ->SetLineColor(kRed)
MET_pT_JERDown ->SetLineColor(kRed+2)

MET_pT_JERUp   ->Divide(MET_pT_NOMINAL)
MET_pT_JERDown ->Divide(MET_pT_NOMINAL)


l = (TLine*) new TLine(0., 1.0, 250., 1.0)
MET_pT_JERUp   ->Draw()
MET_pT_JERDown ->Draw("same")
l->Draw("same")

-- the distr does not follow too well
   the solid bin content is probably not good approximation

max bin content per bin width:

14386.2 / 12.5000
1150.90

1150.90 * 0.3
345.270

make finer bins and check the actuall points to move?

12.5 / 0.5
25
12.5 / 0.25
50

python sumup_ttree_draw.py "event_met.pt()" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight" --histo-range 1000,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_NOMINAL_fine2.root --histo-name MET_pT_NOMINAL_fine2 lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &
python sumup_ttree_draw.py "event_met.pt()" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight" --histo-range  500,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_NOMINAL_fine.root  --histo-name MET_pT_NOMINAL_fine  lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &

python sumup_ttree_draw.py "event_met.pt()" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight" --histo-range 2000,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_NOMINAL_fine3.root --histo-name MET_pT_NOMINAL_fine3 lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &

hadd v37_test14_JER_binning_test.root v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_NOMINAL_fine2.root v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_NOMINAL_fine.root v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_NOMINAL.root

root -l v37_test14_JER_binning_test.root

MET_pT_NOMINAL      ->GetBinR(25)
MET_pT_NOMINAL_fine ->GetBinCenter(25)

MET_pT_NOMINAL      ->GetBinLowEdge(1*1)  + MET_pT_NOMINAL      ->GetBinWidth(1*1)
MET_pT_NOMINAL_fine ->GetBinLowEdge(1*25) + MET_pT_NOMINAL_fine ->GetBinWidth(1*25)
MET_pT_NOMINAL_fine2->GetBinLowEdge(1*50) + MET_pT_NOMINAL_fine2->GetBinWidth(1*50)

(double) 12.5000
(double) 12.5000
(double) 12.5000

MET_pT_NOMINAL      ->GetBinLowEdge(2*1)  + MET_pT_NOMINAL      ->GetBinWidth(2*1)
MET_pT_NOMINAL_fine ->GetBinLowEdge(2*25) + MET_pT_NOMINAL_fine ->GetBinWidth(2*25)
MET_pT_NOMINAL_fine2->GetBinLowEdge(2*50) + MET_pT_NOMINAL_fine2->GetBinWidth(2*50)

(double) 25.0000
(double) 25.0000
(double) 25.0000

mult=25
for (int i =0; i<15*mult; ) {
	i += mult;
	cout << MET_pT_NOMINAL_fine ->GetBinLowEdge(i) + MET_pT_NOMINAL_fine ->GetBinWidth(i) << '\t' << MET_pT_NOMINAL_fine->GetBinContent(i) << endl;
	}

12.5	233.237
25	441.169
37.5	546.877
50	642.236
62.5	560.885
75	457.119
87.5	349.283
100	281.726
112.5	227.336
125	146.267
137.5	109.135
150	66.3027
162.5	68.648
175	38.0659
187.5	28.6125

bins_25 = [ 233.237 441.169 546.877 642.236 560.885 457.119 349.283 281.726 227.336 146.267 109.135 66.3027 68.648 38.0659 28.6125 ]


mult=50
for (int i =0; i<15*mult; ) {
	i += mult;
	cout << MET_pT_NOMINAL_fine2->GetBinLowEdge(i) + MET_pT_NOMINAL_fine2->GetBinWidth(i) << '\t' << MET_pT_NOMINAL_fine2->GetBinContent(i) << endl;
	}

12.5	119.177
25	231.524
37.5	266.865
50	334.267
62.5	279.729
75	249.043
87.5	183.315
100	124.16
112.5	102.861
125	74.1076
137.5	47.5184
150	32.9129
162.5	31.3639
175	18.9432
187.5	15.2979

bins_50 = [ 119.177 231.524 266.865 334.267 279.729 249.043 183.315 124.16 102.861 74.1076 47.5184 32.9129 31.3639 18.9432 15.2979 ]

(bins_50 ./ bins_25)'
15x1 Array{Float64,2}:
 0.51097 
 0.524797
 0.48798 
 0.520474
 0.498728
 0.54481 
 0.524832
 0.440712
 0.452462
 0.50666 
 0.435409
 0.496404
 0.45688 
 0.497642
 0.534658

-- practically the same

bins_nominal = bins_50[2:length(bins_50)-1]
bins_left    = bins_50[1:length(bins_50)-2]
bins_right   = bins_50[3:length(bins_50)]

bins_right + bins_left - 2*bins_nominal

  -77.006 
   32.061 
 -121.94  
   23.852 
  -35.042 
    6.573 
   37.856 
   -7.4544
    2.1642
   11.9837
   13.0565
  -10.8717
    8.7754

bins_nominal = bins_25[2:length(bins_25)-1]
bins_left    = bins_25[1:length(bins_25)-2]
bins_right   = bins_25[3:length(bins_25)]

bins_right + bins_left - 2*bins_nominal

 -102.224 
  -10.349 
 -176.71  
  -22.415 
   -4.07  
   40.279 
   13.167 
  -26.679 
   43.937 
   -5.7003
   45.1776
  -32.9274
   21.1287

and some factor
-- the factor is the width of the neighboring layer,
   so this number is the estimation of the actual amount of events moved into this bin
   with fine binning the layer width = bin width

damn!
I need 2 neighboring layer-bins!

mult=1
for (int i =0; i<15*mult; ) {
	i += mult;
	cout << MET_pT_NOMINAL->GetBinLowEdge(i) + MET_pT_NOMINAL->GetBinWidth(i) << '\t' << MET_pT_NOMINAL->GetBinContent(i) << '\t' << MET_pT_NOMINAL->GetBinContent(i+1) << endl;
	}

12.5	3215.15	8821.89
25	8821.89	12504.1
37.5	12504.1	14386.2
50	14386.2	13869.2
62.5	13869.2	12351.9
75	12351.9	10155.2
87.5	10155.2	7793.23
100	7793.23	5938.67
112.5	5938.67	4208.46
125	4208.46	3167.35
137.5	3167.35	2187.72
150	2187.72	1548.06
162.5	1548.06	1080.29
175	1080.29	852.619
187.5	852.619	583.361

mult=25
for (int i =0; i<15*mult; ) {
	i += mult;
	cout << MET_pT_NOMINAL_fine->GetBinLowEdge(i) + MET_pT_NOMINAL_fine->GetBinWidth(i) << '\t' << MET_pT_NOMINAL_fine->GetBinContent(i) << '\t' << MET_pT_NOMINAL_fine->GetBinContent(i+1) << endl;
	}

12.5	233.237	226.92
25	441.169	445.615
37.5	546.877	535.026
50	642.236	547.133
62.5	560.885	555.021
75	457.119	462.159
87.5	349.283	350.987
100	281.726	298.24
112.5	227.336	195.48
125	146.267	156.141
137.5	109.135	110.703
150	66.3027	63.2794
162.5	68.648	53.7083
175	38.0659	42.3108
187.5	28.6125	25.3716

mult=50
for (int i =0; i<15*mult; ) {
	i += mult;
	cout << MET_pT_NOMINAL_fine2->GetBinLowEdge(i) + MET_pT_NOMINAL_fine2->GetBinWidth(i) << '\t' << MET_pT_NOMINAL_fine2->GetBinContent(i) << '\t' << MET_pT_NOMINAL_fine2->GetBinContent(i+1) << endl;
	}

-- difference of these is the flow between i and i+1 (through the left edge of the bin of i+1)

12.5	119.177	106.835
25	231.524	207.715
37.5	266.865	248.603
50	334.267	273.827
62.5	279.729	297.188
75	249.043	251.525
87.5	183.315	180.342
100	124.16	160.851
112.5	102.861	95.1995
125	74.1076	83.0732
137.5	47.5184	37.0997
150	32.9129	29.7503
162.5	31.3639	34.0885
175	18.9432	15.2845
187.5	15.2979	14.5592


mult=50
for (int i =0; i<15*mult; ) {
	i += mult;
	cout << MET_pT_NOMINAL_fine2->GetBinContent(i) - MET_pT_NOMINAL_fine2->GetBinContent(i+1) << endl;
	}

flow_on_the_right_of_i_to_i1 = [ 12.342 23.8086 18.2616 60.4402 -17.4592 -2.48169 2.97281 -36.6906 7.66119 -8.96563 10.4188 3.16254 -2.72451 3.6587 0.738682 ]'

flow_on_the_right_of_i_to_i1[1:length(flow_on_the_right_of_i_to_i1)-2] - flow_on_the_right_of_i_to_i1[2:length(flow_on_the_right_of_i_to_i1)-1]

 -11.4666 
   5.547  
 -42.1786 
  77.8994 
 -14.9775 
  -5.4545 
  39.6634 
 -44.3518 
  16.6268 
 -19.3844 
   7.25626
   5.88705
  -6.38321
   2.92002

mult=25
for (int i =0; i<15*mult; ) {
	i += mult;
	cout << MET_pT_NOMINAL_fine->GetBinContent(i) - MET_pT_NOMINAL_fine->GetBinContent(i+1) << endl;
	}

flow_on_the_right_of_i_to_i1 = [ 6.31657 -4.44666 11.8508 95.1032 5.86414 -5.04001 -1.7037 -16.5141 31.8551 -9.87376 -1.56789 3.02328 14.9397 -4.24484 3.24096 ]

-- quite a fluctuation from the other one

  10.7632 
 -16.2975 
 -83.2524 
  89.2391 
  10.9041 
  -3.33631
  14.8104 
 -48.3692 
  41.7289 
  -8.30587
  -4.59117
 -11.9164 
  19.1845 
  -7.4858 

-- these are absolute values of how much each bin gains after the fluctuation
   what's the relative gain?
   tune the bin width to match the gain?


bins = [ 3215.15 8821.89 12504.1 14386.2 13869.2 12351.9 10155.2 7793.23 5938.67 4208.46 3167.35 2187.72 1548.06 1080.29 852.619 ]

bins[1:length(bins)]

bins_nominal = bins[2:length(bins)-1]
bins_left    = bins[1:length(bins)-2]
bins_right   = bins[3:length(bins)]

flow = flow_on_the_right_of_i_to_i1[1:length(flow_on_the_right_of_i_to_i1)-2] - flow_on_the_right_of_i_to_i1[2:length(flow_on_the_right_of_i_to_i1)-1]

the bin variations in met pT are usually < 1%, about 0.2%

flow ./ bins_nominal
13-element Array{Float64,1}:
  0.00122006 
 -0.00130337 
 -0.00578696 
  0.00643433 
  0.000882791
 -0.000328532
  0.00190042 
 -0.00814479 
  0.00991547 
 -0.00262234 
 -0.00209861 
 -0.00769765 
  0.0177587

-- close
   the problem is that the flow from mult 50 is also close in the magnitude
   the choice of these bins changes the whole flow and the flow is already comparable to the difference in systematics

   the bin width should = to JER variation of met
   does it depenp on nominal met?


root -l lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_27.root

ttree_out->Draw("(event_met.pt()-event_met_JERUp.pt()):event_met.pt()")

ttree_out->Draw("(event_met.pt()-event_met_JERUp.pt())>>h(20,-1.,1.)")
ttree_out->Draw("(event_met.pt()-event_met_JERUp.pt())>>h(20,-1.,1.)", "event_met.pt() < 50")
ttree_out->Draw("(event_met.pt()-event_met_JERUp.pt())>>h(20,-1.,1.)", "event_met.pt() > 50")

all
-0.063 +- 0.269

< 50
-0.035 +- 0.254

> 50
-0.081 +- 0.277

-- quite close


   it's also non-gaussian


maybe target the bin width of exactly 0.27? -- non gaussian, wide distribution can have deviations

ttree_out->Draw("event_met.pt()-event_met_JERUp.pt()")

-- here -0.076 +- 1.564



what we see is this:

ttree_out->Draw("(event_met.pt()-event_met_JERUp.pt()):event_met.pt()>>h(500,0,250,20,-1.,1.)", "", "col")

let see 1 bin

ttree_out->Draw("(event_met.pt()-event_met_JERUp.pt()):event_met.pt()>>h(500,0,250,20,-1.,1.)", "event_met.pt() > 12.5 && event_met.pt() < 25.", "col")
ttree_out->Draw("event_met.pt()-event_met_JERUp.pt()", "event_met.pt() > 12.5 && event_met.pt() < 25.", "col")
8679

mean +- std dev = -0.065 +- 1.331


ttree_out->Draw("event_met_JERUp.pt()>>h(100,0,50)", "event_met.pt() > 12.5 && event_met.pt() < 25.", "col")
8679
events in the bin

events which leave the bin after JERUp:

ttree_out->Draw("event_met.pt()>>h(100,0,50)", "event_met.pt() > 12.5 && event_met.pt() < 25. && (event_met_JERUp.pt() < 12.5 || event_met_JERUp.pt() > 25.)", "col")
320

events fall out of the bin after the JES variation
and they are not only the closest to the bin edges

how many of them are close to edges:

ttree_out->Draw("event_met.pt()>>h(100,0,50)", "((event_met.pt() > 12.5 && event_met.pt() < (12.5+0.25)) || (event_met.pt() > (25.-0.25) && event_met.pt() < 25.)) && (event_met_JERUp.pt() < 12.5 || event_met_JERUp.pt() > 25.)", "col")
83
ttree_out->Draw("event_met.pt()>>h(100,0,50)", "((event_met.pt() > 12.5 && event_met.pt() < (12.5+0.5)) || (event_met.pt() > (25.-0.5) && event_met.pt() < 25.)) && (event_met_JERUp.pt() < 12.5 || event_met_JERUp.pt() > 25.)", "col")
126
ttree_out->Draw("event_met.pt()>>h(100,0,50)", "((event_met.pt() > 12.5 && event_met.pt() < (12.5+1.5)) || (event_met.pt() > (25.-1.5) && event_met.pt() < 25.)) && (event_met_JERUp.pt() < 12.5 || event_met_JERUp.pt() > 25.)", "col")
193



the number of events on edges of 1.33 deviation:
ttree_out->Draw("event_met.pt()-event_met_JERUp.pt()", "event_met.pt() > (25. - 1.33) && event_met.pt() < 25.", "col")
ttree_out->Draw("event_met.pt()-event_met_JERUp.pt()", "event_met.pt() > 12.5 && event_met.pt() < (12.5 + 1.33)", "col")
1138
662

ttree_out->Draw("event_met.pt()-event_met_JERUp.pt()", "event_met.pt() > (25. - 0.5) && event_met.pt() < 25.", "col")
ttree_out->Draw("event_met.pt()-event_met_JERUp.pt()", "event_met.pt() > 12.5 && event_met.pt() < (12.5 + 0.5)", "col")
442
247

ttree_out->Draw("event_met.pt()-event_met_JERUp.pt()", "event_met.pt() > (25. - 0.25) && event_met.pt() < 25.", "col")
ttree_out->Draw("event_met.pt()-event_met_JERUp.pt()", "event_met.pt() > 12.5 && event_met.pt() < (12.5 + 0.25)", "col")
207
117

-- the 0.25 layer already contains as much events as the JERUp variation kicks out of the bin
   but from the original 320 events which leave the bin only 83 are in the 0.25 layer

   this non-gaussian shape of JER breaks the locality and neighboring layers

so, is a good estimation of the number of events leaving and entering the bin possible?
"good" means the estimation does no suffer from fluctuations

this trend is not destroied by the fluctuations -- fluctuations are smaller than the trend therefore there should be a method to estimate it

320 events leave, hom many enter? the magnitude of the overall flow?
for the same bin check events entering it

ttree_out->Draw("event_met.pt()>>h(100,0,50)", "(event_met.pt() > 12.5 && event_met.pt() < 25.) && (event_met_JERUp.pt() < 12.5 || event_met_JERUp.pt() > 25.)", "col")
ttree_out->Draw("event_met.pt()>>h(100,0,50)", "(event_met_JERUp.pt() > 12.5 && event_met_JERUp.pt() < 25.) && (event_met.pt() < 12.5 || event_met.pt() > 25.)", "col")

320
287

for Down:

ttree_out->Draw("event_met.pt()>>h(100,0,50)", "(event_met.pt() > 12.5 && event_met.pt() < 25.) && (event_met_JERDown.pt() < 12.5 || event_met_JERDown.pt() > 25.)", "col")
ttree_out->Draw("event_met.pt()>>h(100,0,50)", "(event_met_JERDown.pt() > 12.5 && event_met_JERDown.pt() < 25.) && (event_met.pt() < 12.5 || event_met.pt() > 25.)", "col")

257
328

so, Down moves events into the bin, Up moves them out
what's on the plot:

ttree_out->Draw("event_met_JESUp.pt()>>h(20,0,250)", "", "same")
ttree_out->Draw("event_met_JESDown.pt()>>h(20,0,250)", "", "same")

ttree_out->Draw("event_met.pt()>>h(20,0,250)", "", "")
ttree_out->Draw("event_met_JERUp.pt()>>h(20,0,250)", "", "same")
ttree_out->Draw("event_met_JERDown.pt()>>h(20,0,250)", "", "same")

h_ = (TH1D*) ttree_out->GetHistogram()

h_nom = (TH1D*) h_->Clone()
h_nom->SetDirectory(0)
h_nom->SetName("nom")

h_up = (TH1D*) h_->Clone()
h_up->SetDirectory(0)
h_up->SetName("up")

h_down = (TH1D*) h_->Clone()
h_down->SetDirectory(0)
h_down->SetName("down")

h_up->SetLineColor(kRed)
h_down->SetLineColor(kGreen)

h_nom->Draw()
h_up->Draw("same")
h_down->Draw("same")

h_up->Divide(h_nom)
h_down->Divide(h_nom)
h_up->Draw("")
h_down->Draw("same")

-- for JES clear variation with pivot point around 75GeV
   JER -- bin by bin within 1%, but no correlation between Up and Down, really stat fluctuations

ttree_out->Draw("event_met.pt()>>h(20,0,250)",         "selection_stage == 9 || selection_stage == 7 || selection_stage == 5", "")
ttree_out->Draw("event_met_JERUp.pt()>>h(20,0,250)",   "selection_stage_JERUp == 9 || selection_stage_JERUp == 7 || selection_stage_JERUp == 5", "")
ttree_out->Draw("event_met_JERDown.pt()>>h(20,0,250)", "selection_stage_JERDown == 9 || selection_stage_JERDown == 7 || selection_stage_JERDown == 5", "")

-- also clear fluctuations

no weight full:

python sumup_ttree_draw.py "event_met.pt()"          --ttree ttree_out --cond-com "(selection_stage         == 9 || selection_stage         == 7 || selection_stage         == 5)" --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_NOMINAL_noweight.root --histo-name MET_pT_NOMINAL_noweight lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &
python sumup_ttree_draw.py "event_met_JERUp.pt()"    --ttree ttree_out --cond-com "(selection_stage_JERUp   == 9 || selection_stage_JERUp   == 7 || selection_stage_JERUp   == 5)" --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_JERUp_noweight.root   --histo-name MET_pT_JERUp_noweight   lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &
python sumup_ttree_draw.py "event_met_JERDown.pt()"  --ttree ttree_out --cond-com "(selection_stage_JERDown == 9 || selection_stage_JERDown == 7 || selection_stage_JERDown == 5)" --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_JERDown_noweight.root --histo-name MET_pT_JERDown_noweight lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &

hadd v37_test14_JER_noweight.root v37_test14_*_noweight.root

root -l v37_test14_JER_noweight.root

MET_pT_JERUp_noweight->SetLineColor(kRed)
MET_pT_JERDown_noweight->SetLineColor(kGreen)

MET_pT_JERUp_noweight   ->Divide(MET_pT_NOMINAL_noweight)
MET_pT_JERDown_noweight ->Divide(MET_pT_NOMINAL_noweight)

MET_pT_JERUp_noweight   ->Draw()
MET_pT_JERDown_noweight ->Draw("same")

-- practically each bin deviates asymmetrically

TODO: check the pT shapes with nomina selection stage to confirm it does not matter that much!



also:

python sumup_ttree_draw.py "event_met_JESUp"   --ttree ttree_out --cond-com "(selection_stage_JESUp   == 9 || selection_stage_JESUp   == 7 || selection_stage_JESUp   == 5)*event_weight"  --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_Mt_JESUp.root    --histo-name Mt_JESUp    lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root    &
python sumup_ttree_draw.py "event_met_JESDown" --ttree ttree_out --cond-com "(selection_stage_JESDown == 9 || selection_stage_JESDown == 7 || selection_stage_JESDown == 5)*event_weight"  --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_Mt_JESDown.root  --histo-name Mt_JESDown  lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root    &

python sumup_ttree_draw.py "event_met_TESUp"   --ttree ttree_out --cond-com "(selection_stage_TESUp   == 9 || selection_stage_TESUp   == 7 || selection_stage_TESUp   == 5)*event_weight"  --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_Mt_TESUp.root    --histo-name Mt_TESUp   lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "event_met_TESDown" --ttree ttree_out --cond-com "(selection_stage_TESDown == 9 || selection_stage_TESDown == 7 || selection_stage_TESDown == 5)*event_weight"  --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_Mt_TESDown.root  --histo-name Mt_TESDown lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root     &


#### check amount of bin cross-talk in a given bin


ttree_out->Draw("event_met.pt()>>h(100,0,50)", "(event_met.pt() > 12.5 && event_met.pt() < 25.) && (event_met_JERUp.pt() < 12.5 || event_met_JERUp.pt() > 25.)", "col")
ttree_out->Draw("event_met.pt()>>h(100,0,50)", "(event_met_JERUp.pt() > 12.5 && event_met_JERUp.pt() < 25.) && (event_met.pt() < 12.5 || event_met.pt() > 25.)", "col")

ttree_out->Draw("event_met.pt()>>h(100,0,50)", "(event_met.pt() > 12.5 && event_met.pt() < 25.) && (event_met_JERDown.pt() < 12.5 || event_met_JERDown.pt() > 25.)", "col")
ttree_out->Draw("event_met.pt()>>h(100,0,50)", "(event_met_JERDown.pt() > 12.5 && event_met_JERDown.pt() < 25.) && (event_met.pt() < 12.5 || event_met.pt() > 25.)", "col")


python sumup_ttree_draw.py "event_met.pt()"          --ttree ttree_out --cond-com "(selection_stage         == 9 || selection_stage         == 7 || selection_stage         == 5)" --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_NOMINAL_noweight.root --histo-name MET_pT_NOMINAL_noweight lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &
python sumup_ttree_draw.py "event_met_JERUp.pt()"    --ttree ttree_out --cond-com "(selection_stage_JERUp   == 9 || selection_stage_JERUp   == 7 || selection_stage_JERUp   == 5)" --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_JERUp_noweight.root   --histo-name MET_pT_JERUp_noweight   lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &
python sumup_ttree_draw.py "event_met_JERDown.pt()"  --ttree ttree_out --cond-com "(selection_stage_JERDown == 9 || selection_stage_JERDown == 7 || selection_stage_JERDown == 5)" --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_JERDown_noweight.root --histo-name MET_pT_JERDown_noweight lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &

let's JERUp:

python sumup_ttree_draw.py "event_met_JERUp.pt()"    --ttree ttree_out --cond-com "(event_met.pt() > 12.5 && event_met.pt() < 25.) && (event_met_JERUp.pt() < 12.5 || event_met_JERUp.pt() > 25.) && (selection_stage_JERUp   == 9 || selection_stage_JERUp   == 7 || selection_stage_JERUp   == 5)" --histo-range 100,0,50 --output v37_test14_JER_bin_crosstalk_JERUp_wasin_n_left.root  --histo-name MET_pT_JERUp_wasin_n_left  lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &
python sumup_ttree_draw.py "event_met_JERUp.pt()"    --ttree ttree_out --cond-com "(event_met_JERUp.pt() > 12.5 && event_met_JERUp.pt() < 25.) && (event_met.pt() < 12.5 || event_met.pt() > 25.) && (selection_stage_JERUp   == 9 || selection_stage_JERUp   == 7 || selection_stage_JERUp   == 5)" --histo-range 100,0,50 --output v37_test14_JER_bin_crosstalk_JERUp_wasout_n_in.root   --histo-name MET_pT_JERUp_wasout_n_in   lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &

python sumup_ttree_draw.py "event_met_JERDown.pt()"  --ttree ttree_out --cond-com "(event_met.pt() > 12.5 && event_met.pt() < 25.) && (event_met_JERDown.pt() < 12.5 || event_met_JERDown.pt() > 25.) && (selection_stage_JERDown   == 9 || selection_stage_JERDown   == 7 || selection_stage_JERDown   == 5)" --histo-range 100,0,50 --output v37_test14_JER_bin_crosstalk_JERDown_wasin_n_left.root  --histo-name MET_pT_JERDown_wasin_n_left  lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &
python sumup_ttree_draw.py "event_met_JERDown.pt()"  --ttree ttree_out --cond-com "(event_met_JERDown.pt() > 12.5 && event_met_JERDown.pt() < 25.) && (event_met.pt() < 12.5 || event_met.pt() > 25.) && (selection_stage_JERDown   == 9 || selection_stage_JERDown   == 7 || selection_stage_JERDown   == 5)" --histo-range 100,0,50 --output v37_test14_JER_bin_crosstalk_JERDown_wasout_n_in.root   --histo-name MET_pT_JERDown_wasout_n_in   lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &


hadd v37_test14_JER_bin_crosstalk.root v37_test14_JER_bin_crosstalk_JERUp_wasin_n_left.root v37_test14_JER_bin_crosstalk_JERUp_wasout_n_in.root v37_test14_JER_bin_crosstalk_JERDown_wasin_n_left.root v37_test14_JER_bin_crosstalk_JERDown_wasout_n_in.root

root -l v37_test14_JER_bin_crosstalk.root

MET_pT_JERUp_wasin_n_left ->Draw()
MET_pT_JERUp_wasout_n_in  ->Draw()
MET_pT_JERDown_wasin_n_left ->Draw()
MET_pT_JERDown_wasout_n_in  ->Draw()

MET_pT_JERUp_wasin_n_left   ->Integral()
MET_pT_JERUp_wasout_n_in    ->Integral()
MET_pT_JERDown_wasin_n_left ->Integral()
MET_pT_JERDown_wasout_n_in  ->Integral()

(Double_t) 317.000
(Double_t) 323.000

(Double_t) 290.000
(Double_t) 312.000

JERUp must grow and JERDown must reduce
but it does not: they are both above nominal, Down is too (and higher than the Up is)
contradiction?


python sumup_ttree_draw.py "event_met.pt()"          --ttree ttree_out --cond-com "(selection_stage         == 9 || selection_stage         == 7 || selection_stage         == 5)" --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_NOMINAL_noweight.root --histo-name MET_pT_NOMINAL lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &
python sumup_ttree_draw.py "event_met_JERUp.pt()"    --ttree ttree_out --cond-com "(selection_stage_JERUp   == 9 || selection_stage_JERUp   == 7 || selection_stage_JERUp   == 5)" --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_JERUp_noweight.root   --histo-name MET_pT_JERUp   lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &
python sumup_ttree_draw.py "event_met_JERDown.pt()"  --ttree ttree_out --cond-com "(selection_stage_JERDown == 9 || selection_stage_JERDown == 7 || selection_stage_JERDown == 5)" --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_JERDown_noweight.root --histo-name MET_pT_JERDown lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &

hadd v37_test14_JER_issue_MET_pT_per_JER_noweight.root v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_*_noweight.root

root -l v37_test14_JER_issue_MET_pT_per_JER_noweight.root

MET_pT_JERUp_noweight   ->SetLineColor(kRed)
MET_pT_JERDown_noweight ->SetLineColor(kRed+2)

MET_pT_JERUp_noweight   ->Divide(MET_pT_NOMINAL_noweight)
MET_pT_JERDown_noweight ->Divide(MET_pT_NOMINAL_noweight)

l = (TLine*) new TLine(0., 1.0, 250., 1.0)
MET_pT_JERUp_noweight   ->Draw()
MET_pT_JERDown_noweight ->Draw("same")
l->Draw("same")

-- in 12.5-25 both variations are above nominal



#### check with nominal selection stage

python sumup_ttree_draw.py "event_met.pt()"          --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)" --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_NOMINAL_noweight_nomsel.root --histo-name MET_pT_NOMINAL_nomsel lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &
python sumup_ttree_draw.py "event_met_JERUp.pt()"    --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)" --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_JERUp_noweight_nomsel.root   --histo-name MET_pT_JERUp_nomsel   lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &
python sumup_ttree_draw.py "event_met_JERDown.pt()"  --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)" --histo-range 20,0,250 --output v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_JERDown_noweight_nomsel.root --histo-name MET_pT_JERDown_nomsel lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &

hadd v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_per_JER_noweight_nomsel.root v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_*_noweight_nomsel.root

root -l v37_test14_LEPmu_JES_JER_TES_issue_MET_pT_per_JER_noweight_nomsel.root

MET_pT_JERUp_nomsel   ->SetLineColor(kRed)
MET_pT_JERDown_nomsel ->SetLineColor(kRed+2)

MET_pT_JERUp_nomsel   ->Divide(MET_pT_NOMINAL_nomsel)
MET_pT_JERDown_nomsel ->Divide(MET_pT_NOMINAL_nomsel)

l = (TLine*) new TLine(0., 1.0, 250., 1.0)
MET_pT_JERUp_nomsel   ->Draw()
MET_pT_JERDown_nomsel ->Draw("same")
l->Draw("same")

-- in 12.5-25 UP (light red) is at nominal, Down is above

TODO: check the flow with only nominal selection stage





### see this fluctuations in test13 TT only -- to quickly assess the test14

initial plots:

python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_lj    -d Mt_lep_met_c -s JESUp,JESDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_lj_all_Mt_lep_met_c_JESUp,JESDown.png     --ratio-y-line 1.0
python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_ljout -d Mt_lep_met_c -s JESUp,JESDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_ljout_all_Mt_lep_met_c_JESUp,JESDown.png  --ratio-y-line 1.0

python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_lj    -p tt_mutau -d Mt_lep_met_c -s JESUp,JESDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_lj_tt_mutau_Mt_lep_met_c_JESUp,JESDown.png     --ratio-y-line 1.0
python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_ljout -p tt_mutau -d Mt_lep_met_c -s JESUp,JESDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_ljout_tt_mutau_Mt_lep_met_c_JESUp,JESDown.png  --ratio-y-line 1.0

python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_lj    -p tt_lj -d Mt_lep_met_c -s JESUp,JESDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_lj_tt_lj_Mt_lep_met_c_JESUp,JESDown.png     --ratio-y-line 1.0
python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_ljout -p tt_lj -d Mt_lep_met_c -s JESUp,JESDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_ljout_tt_lj_Mt_lep_met_c_JESUp,JESDown.png  --ratio-y-line 1.0

-- you can see the high Mt fluctuations in tt_mutau, which dominates high Mt region


python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_lj    -d Mt_lep_met_c -s JERUp,JERDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_lj_all_Mt_lep_met_c_JERUp,JERDown.png     --ratio-y-line 1.0
python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_ljout -d Mt_lep_met_c -s JERUp,JERDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_ljout_all_Mt_lep_met_c_JERUp,JERDown.png  --ratio-y-line 1.0

python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_lj    -p tt_mutau -d Mt_lep_met_c -s JERUp,JERDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_lj_tt_mutau_Mt_lep_met_c_JERUp,JERDown.png     --ratio-y-line 1.0
python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_ljout -p tt_mutau -d Mt_lep_met_c -s JERUp,JERDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_ljout_tt_mutau_Mt_lep_met_c_JERUp,JERDown.png  --ratio-y-line 1.0

python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_lj    -p tt_lj -d Mt_lep_met_c -s JERUp,JERDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_lj_tt_lj_Mt_lep_met_c_JERUp,JERDown.png     --ratio-y-line 1.0
python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_ljout -p tt_lj -d Mt_lep_met_c -s JERUp,JERDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_ljout_tt_lj_Mt_lep_met_c_JERUp,JERDown.png  --ratio-y-line 1.0

-- both show deviations, tt_lj especially


python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_lj    -d Mt_lep_met_c -s TESUp,TESDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_lj_all_Mt_lep_met_c_TESUp,TESDown.png     --ratio-y-line 1.0
python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_ljout -d Mt_lep_met_c -s TESUp,TESDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_ljout_all_Mt_lep_met_c_TESUp,TESDown.png  --ratio-y-line 1.0

python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_lj    -p tt_mutau -d Mt_lep_met_c -s TESUp,TESDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_lj_tt_mutau_Mt_lep_met_c_TESUp,TESDown.png     --ratio-y-line 1.0
python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_ljout -p tt_mutau -d Mt_lep_met_c -s TESUp,TESDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_ljout_tt_mutau_Mt_lep_met_c_TESUp,TESDown.png  --ratio-y-line 1.0

python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_lj    -p tt_lj -d Mt_lep_met_c -s TESUp,TESDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_lj_tt_lj_Mt_lep_met_c_TESUp,TESDown.png     --ratio-y-line 1.0
python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_ljout -p tt_lj -d Mt_lep_met_c -s TESUp,TESDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_ljout_tt_lj_Mt_lep_met_c_TESUp,TESDown.png  --ratio-y-line 1.0

-- also can be see, in tt_lj too









## DY tautau plots, different process yields

which plots?

No! It's fine, the difference is between mutau and eltau!
eltau has less true tau contribution and more fakes.
Probably there are less DY tauel-tauh events due to higher pT cut on the electron.


python stack_plot.py distrs/v37_test13_bunch1YIELDS_mc_2.root distrs/v37_test13_bunch1YIELDS/SingleMuon.root -o histosels/v37_test13_bunch1_yields1_dy_tautau/ --data-nick data_other --lumi 35800 -d yield --wjet 1.4 -c dy_mutau    --qcd-factor 2.5 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt

make --dry-run plot_control_dy_mutau nt=v37 proc=test13 distrs=bunchCONTROLS1 lumi=35800 datafile=SingleMuon      options=--overwrite
make --dry-run plot_control_dy_eltau nt=v37 proc=test13 distrs=bunchCONTROLS1 lumi=35800 datafile=SingleElectron  options=--overwrite




## trends at 500GeV MET

maybe the nominal MET propagation (JER factor) is wrong? Or TES?
-- check their variations
recoil corrections? -- they are too small?

1) compare to initial met
2) which processes dominate the met tail? check process composition in the met tail
3) how does it look in controls: DY, WJets, tt elmu?

in controls:
WJets are surprisingly flat
DY mumu seems ok, elel has slight trend (but it is upto 250GeV)
elmu has the trend, TOPPT almost fixes it (what's in tight elmu, when the jet requirements are the same as in main selection? and in elmu both leptons are 30GeV now!)
tt presel, sel do have the trend, maybe in el it is larger, and it seems in sel it is larger than in presel

python stack_plot.py distrs/v37_test13_bunchDILEP1_mc.root distrs/v37_test13_bunchDILEP1/SingleMuon.root     -o plots/v37_test13_bunchDILEP1/ --overwrite --factor-dy 1.05 -p -r --lumi 35800 --data-nick data_other -c dy_mumu -d met_c --wjet 1.4 --qcd-factor 2.5 --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(, MET) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_lj:tt_else.tt_other:tt_elmu
python stack_plot.py distrs/v37_test13_bunchDILEP1_mc.root distrs/v37_test13_bunchDILEP1/SingleElectron.root -o plots/v37_test13_bunchDILEP1/ --overwrite --factor-dy 1.05 -p -r --lumi 35800 --data-nick data_other -c dy_elel -d met_c --wjet 1.4 --qcd-factor 2.5 --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(, MET) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_lj:tt_else.tt_other:tt_elmu

-- both DY are mostly flat, but make some bend, mumu at 100GeV and elel at 150GeV, mumu more than elel
   they get to about 10% deviation at 500GeV


plots on tt elmu, presel and sel:

eog plots/v37_test13_bunchDILEP1/*n_met_c_tt_elmu*
eog plots/v37_test13_bunchCONTROLS1/*n_met_c_??_presel*
eog plots/v37_test13_bunchCONTROLS1/*n_met_c_??_sel_*

-- in presel TOPPT almost fixes the difference, like in elmu, but the remaining gap is still larger in el

python stack_plot.py distrs/v37_test13_bunchCONTROLS1_mc_1.root distrs/v37_test13_bunchCONTROLS1/SingleMuon.root     -p -r -o plots/v37_test13_bunchCONTROLS1/ -c mu_sel --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 1.4 --qcd 1.05
python stack_plot.py distrs/v37_test13_bunchCONTROLS1_mc_1.root distrs/v37_test13_bunchCONTROLS1/SingleElectron.root -p -r -o plots/v37_test13_bunchCONTROLS1/ -c el_sel --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 1.4 --qcd 1.05

python stack_plot.py distrs/v37_test13_bunchCONTROLS1_mc_1.root distrs/v37_test13_bunchCONTROLS1/SingleMuon.root     -p -r -o plots/v37_test13_bunchCONTROLS1/ -c mu_sel --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 1.4 --qcd 1.05 --sys TOPPTUp
python stack_plot.py distrs/v37_test13_bunchCONTROLS1_mc_1.root distrs/v37_test13_bunchCONTROLS1/SingleElectron.root -p -r -o plots/v37_test13_bunchCONTROLS1/ -c el_sel --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 1.4 --qcd 1.05 --sys TOPPTUp

-- TOPPT was not saved for main selection?

python stack_plot.py distrs/v37_test13_bunchCONTROLMET_mc.root distrs/v37_test13_bunchCONTROLMET/SingleMuon.root     -p -r -o plots/v37_test13_bunchCONTROLMET/ -c mu_sel --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 1.4 --qcd 1.05
python stack_plot.py distrs/v37_test13_bunchCONTROLMET_mc.root distrs/v37_test13_bunchCONTROLMET/SingleElectron.root -p -r -o plots/v37_test13_bunchCONTROLMET/ -c el_sel --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 1.4 --qcd 1.05

python stack_plot.py distrs/v37_test13_bunchCONTROLMET_mc.root distrs/v37_test13_bunchCONTROLMET/SingleMuon.root     -p -r -o plots/v37_test13_bunchCONTROLMET/ -c mu_sel --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 1.4 --qcd 1.05 --sys TOPPTUp
python stack_plot.py distrs/v37_test13_bunchCONTROLMET_mc.root distrs/v37_test13_bunchCONTROLMET/SingleElectron.root -p -r -o plots/v37_test13_bunchCONTROLMET/ -c el_sel --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 1.4 --qcd 1.05 --sys TOPPTUp

-- the same, but slightly worse


overall it should not be a large problem, it seems to show up only in tt and it is mostly fixed by TOPPT
however, it's strange, and maybe it is due to some small correction, like propagating lep-matched jet etc



### compare with init met

python sumup_ttree_draw.py "event_met.pt()"      --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight"  --histo-range 50,0,500 --output v37_test14_met_trends_met.root      --histo-name met      lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &
python sumup_ttree_draw.py "event_met_init.pt()" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight"  --histo-range 50,0,500 --output v37_test14_met_trends_met_init.root --histo-name met_init lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &

hadd -f v37_test14_all_met_trends.root v37_test14_met_trends*.root
root -l v37_test14_all_met_trends.root

met_init->SetLineColor(kRed)

met->Draw("hist")
met_init->Draw("hist same")

met->Divide(met_init)
met->Draw("hist")

-- very slight rising slope, about -2% at 0GeV and +2% at 200GeV and up
   so, it could be the remaining correction in TT

check in tt_elmu

python sumup_ttree_draw.py "event_met.pt()"      --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210)*event_weight"  --histo-range 50,0,500 --output v37_test14_met_trends_tt_elmu_met.root      --histo-name tt_elmu_met      lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &
python sumup_ttree_draw.py "event_met_init.pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210)*event_weight"  --histo-range 50,0,500 --output v37_test14_met_trends_tt_elmu_met_init.root --histo-name tt_elmu_met_init lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &

python sumup_ttree_draw.py "event_met.pt()"      --ttree ttree_out --cond-com "(selection_stage_em == 205)*event_weight"  --histo-range 50,0,500 --output v37_test14_met_trends_tt_elmu_tight_met.root      --histo-name tt_elmu_tight_met      lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &
python sumup_ttree_draw.py "event_met_init.pt()" --ttree ttree_out --cond-com "(selection_stage_em == 205)*event_weight"  --histo-range 50,0,500 --output v37_test14_met_trends_tt_elmu_tight_met_init.root --histo-name tt_elmu_tight_met_init lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &

tt_elmu_met_init->SetLineColor(kRed)
tt_elmu_met->Draw("hist")
tt_elmu_met_init->Draw("hist same")

tt_elmu_tight_met_init->SetLineColor(kRed)
tt_elmu_tight_met->Draw("hist")
tt_elmu_tight_met_init->Draw("hist same")

tt_elmu_met->Divide(tt_elmu_met_init)
tt_elmu_met->Draw("hist")

-- same in 1% range

tt_elmu_tight_met->Divide(tt_elmu_tight_met_init)
tt_elmu_tight_met->Draw("hist")

-- practically no deviation!



check in preselection

selection_stage_presel

python sumup_ttree_draw.py "event_met.pt()"      --ttree ttree_out --cond-com "(selection_stage_presel == 9)*event_weight"  --histo-range 50,0,500 --output v37_test14_met_trends_mu_preselCand_met.root      --histo-name mu_preselCand_met      lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &
python sumup_ttree_draw.py "event_met_init.pt()" --ttree ttree_out --cond-com "(selection_stage_presel == 9)*event_weight"  --histo-range 50,0,500 --output v37_test14_met_trends_mu_preselCand_met_init.root --histo-name mu_preselCand_met_init lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &

python sumup_ttree_draw.py "event_met.pt()"      --ttree ttree_out --cond-com "(selection_stage_presel == 19)*event_weight" --histo-range 50,0,500 --output v37_test14_met_trends_el_preselCand_met.root      --histo-name el_preselCand_met      lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &
python sumup_ttree_draw.py "event_met_init.pt()" --ttree ttree_out --cond-com "(selection_stage_presel == 19)*event_weight" --histo-range 50,0,500 --output v37_test14_met_trends_el_preselCand_met_init.root --histo-name el_preselCand_met_init lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root  &

mu_preselCand_met->Divide(mu_preselCand_met_init)
mu_preselCand_met->Draw("hist")

-- same as in main selection, deviation in 2% range

el_preselCand_met->SetLineColor(kRed)
el_preselCand_met->Divide(el_preselCand_met_init)
el_preselCand_met->Draw("hist same")

-- same

side question: how come tt_elmu is different from these two? TES propagation?




## issues with lj division?

el ljout looks strange: a bending trend and too large QCD

it seems the jets are added to the jet collections with any(jet_pt > cut for jet_pt in all_jet_pt_per_sys)
not only nominal jets are considered
but does it matter much?

python sumup_ttree_draw.py "event_jets_lj_var" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight"                       --histo-range 20,0,300 --output v37_test14_fixed_jets_for_lj_var_test14.root    --histo-name lj_var_test14    lstore_outdirs/v37/test14/MC2016_Summer16_TTJets_powheg/*root    &
python sumup_ttree_draw.py "event_jets_lj_var" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight"                       --histo-range 20,0,300 --output v37_test14_fixed_jets_for_lj_var_test14_1.root  --histo-name lj_var_test14_1  lstore_outdirs/v37/test14_1/MC2016_Summer16_TTJets_powheg/*root  &

hadd -f v37_test14_fixed_jets_comparison.root v37_test14_fixed_jets_for_lj_var_test14*.root
root -l v37_test14_fixed_jets_comparison.root

lj_var_test14_1->SetLineColor(kRed)

lj_var_test14->Draw("hist")
lj_var_test14_1->Draw("hist same")

-- slightly different, the red is smaller at low values

lj_var_test14_1->Divide(lj_var_test14)
lj_var_test14_1->Draw()

ok, then let produce it for refit
test15

TODO: so, actually I need separate jet collections of JES, JER (and TES?) jets for separate lj variables?





how does bFrag affect lj categories? do they correlate?


root -l fit-stuff/v37_test14_bunchFULLFIT3_mc_1_HISTOSEL.root

((TH1D*) el_sel_ljout->Get("tt_lj/FragUp/el_sel_ljout_tt_lj_FragUp_Mt_lep_met_c"))->Integral()     / ((TH1D*) el_sel_ljout->Get("tt_lj/NOMINAL/el_sel_ljout_tt_lj_NOMINAL_Mt_lep_met_c"))->Integral()
((TH1D*) el_sel_ljout->Get("tt_lj/FragDown/el_sel_ljout_tt_lj_FragDown_Mt_lep_met_c"))->Integral() / ((TH1D*) el_sel_ljout->Get("tt_lj/NOMINAL/el_sel_ljout_tt_lj_NOMINAL_Mt_lep_met_c"))->Integral()

((TH1D*) el_sel_lj->Get("tt_lj/FragUp/el_sel_lj_tt_lj_FragUp_Mt_lep_met_c"))->Integral()     / ((TH1D*) el_sel_lj->Get("tt_lj/NOMINAL/el_sel_lj_tt_lj_NOMINAL_Mt_lep_met_c"))->Integral()
((TH1D*) el_sel_lj->Get("tt_lj/FragDown/el_sel_lj_tt_lj_FragDown_Mt_lep_met_c"))->Integral() / ((TH1D*) el_sel_lj->Get("tt_lj/NOMINAL/el_sel_lj_tt_lj_NOMINAL_Mt_lep_met_c"))->Integral()

(double) 0.935758
(double) 1.05290

(double) 0.935851
(double) 1.05245

-- in 3rd digit

((TH1D*) el_sel_ljout->Get("tt_eltau/FragUp/el_sel_ljout_tt_eltau_FragUp_Mt_lep_met_c"))->Integral()     / ((TH1D*) el_sel_ljout->Get("tt_eltau/NOMINAL/el_sel_ljout_tt_eltau_NOMINAL_Mt_lep_met_c"))->Integral()
((TH1D*) el_sel_ljout->Get("tt_eltau/FragDown/el_sel_ljout_tt_eltau_FragDown_Mt_lep_met_c"))->Integral() / ((TH1D*) el_sel_ljout->Get("tt_eltau/NOMINAL/el_sel_ljout_tt_eltau_NOMINAL_Mt_lep_met_c"))->Integral()

((TH1D*) el_sel_lj->Get("tt_eltau/FragUp/el_sel_lj_tt_eltau_FragUp_Mt_lep_met_c"))->Integral()     / ((TH1D*) el_sel_lj->Get("tt_eltau/NOMINAL/el_sel_lj_tt_eltau_NOMINAL_Mt_lep_met_c"))->Integral()
((TH1D*) el_sel_lj->Get("tt_eltau/FragDown/el_sel_lj_tt_eltau_FragDown_Mt_lep_met_c"))->Integral() / ((TH1D*) el_sel_lj->Get("tt_eltau/NOMINAL/el_sel_lj_tt_eltau_NOMINAL_Mt_lep_met_c"))->Integral()

(double) 0.963629
(double) 1.02766

(double) 0.957281
(double) 1.03199

-- aha! 0.5% effect



### test15 the fit

make run_std_histos out=histosels/v37_test15_bunchFULLFIT1/ wjets_norm=1.4 lumi_mu=35800 lumi_el=35800 mc=distrs/v37_test15_bunchFULLFIT1_mc_1.root data_mu=distrs/v37_test15_bunchFULLFIT1/SingleMuon.root data_el=distrs/v37_test15_bunchFULLFIT1/SingleElectron.root

python numbers_for_datacard.py histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root -d Mt_lep_met_c -c el_sel_lj,el_sel_ljout --data-nick data_other
python numbers_for_datacard.py histosels/v37_test15_bunchFULLFIT1_HISTOSEL.root -d Mt_lep_met_c -c mu_sel_lj,mu_sel_ljout --data-nick data_other

bin           el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                
process       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_eltau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        12                       13                       14                       15                       16                       17                       18                       
rate          3261.234                 2403.519                 129.315                  185.239                  63.863                   15.511                   167.755                  23.972                   164.546                  0.981                    14.372                   176.465                  29.613                   118.405                  106.377                  
el_sel_lj/data_other/NOMINAL/el_sel_lj_data_other_NOMINAL_Mt_lep_met_c
obs 6690.000000
mc sum = 6861.168569
INFO:root:el_sel_ljout
bin           el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             
process       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_eltau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        12                       13                       14                       15                       16                       17                       18                       
rate          5217.944                 1651.873                 87.149                   309.987                  112.089                  35.835                   186.706                  32.157                   303.162                  1.928                    12.859                   223.866                  79.913                   228.733                  343.455                  
el_sel_ljout/data_other/NOMINAL/el_sel_ljout_data_other_NOMINAL_Mt_lep_met_c
obs 8414.000000
mc sum = 8827.654918

bin           mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                
process       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                       
rate          4910.391                 3608.734                 204.639                  271.988                  84.299                   23.138                   226.131                  34.416                   220.923                  0.000                    15.283                   228.671                  8.529                    190.632                  175.391                  
mu_sel_lj/data_other/NOMINAL/mu_sel_lj_data_other_NOMINAL_Mt_lep_met_c
obs 9831.000000
mc sum = 10203.165384
INFO:root:mu_sel_ljout
bin           mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             
process       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                       
rate          7791.608                 2507.052                 142.576                  457.262                  171.572                  54.709                   289.521                  52.217                   440.611                  0.000                    29.676                   364.950                  23.466                   390.389                  174.009                  
mu_sel_ljout/data_other/NOMINAL/mu_sel_ljout_data_other_NOMINAL_Mt_lep_met_c
obs 12855.000000
mc sum = 12889.619626

old:
bin          el_sel_lj         el_sel_ljout
observation  6690.000000       8414.000000

bin          mu_sel_lj         mu_sel_ljout
observation  9831.000000       12855.000000




cp ttxsec/datacard_v37_test14_bunchFULLFIT3_mu_1_HISTOSEL.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.txt
cp ttxsec/datacard_v37_test14_bunchFULLFIT3_el_1_HISTOSEL.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_el.txt

make both mucard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu elcard=ttxsec/datacard_v37_test15_bunchFULLFIT1_el bothcard=ttxsec/datacard_v37_test15_bunchFULLFIT1_both

make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_el
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_both

make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.root nn=v37_test15_mu     &
make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_el.root nn=v37_test15_el     &
make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_both.root nn=v37_test15_both &

0.9447181224822998,
0.9507748484611511,
0.9710243940353394,

-- damn!

python new_impact_table.py --merge-pdf  latest_impacts_v37_test15_el.json latest_impacts_v37_test15_mu.json latest_impacts_v37_test15_both.json

$\tauh$ jet identification  &  4.7 &  4.4 &  4.5 \\
        top quark $p_{T}$  &  3.1 &  3.1 &  3.1 \\
$\tauh$ misidentification background  &  2.6 &  2.3 &  3.0 \\
       pileup uncertainty  &  2.4 &  2.5 &  2.2 \\
    jet energy resolution  &  0.5 &  0.9 &  1.1 \\
     b-tagging efficiency  &  1.2 &  1.1 &  1.1 \\
     W+jets normalization  &  0.2 &  1.1 &  1.0 \\
     $\tauh$ Energy Scale  &  0.7 &  0.7 &  0.8 \\
         DY normalization  &  0.4 &  0.8 &  0.7 \\
       muon ID efficiency  &  0.6 &  0.6 \\
         jet energy scale  &  1.2 &  0.4 &  0.6 \\
 Single Top normalization  &  0.6 &  0.4 &  0.5 \\
  muon trigger efficiency  &  0.3 &  0.3 \\
        QCD normalization  &  1.0 &  0.8 &  0.1 \\
electron trigger efficiency  &  2.3 &  0.1 \\
   electron ID efficiency  &  1.8 &  0.1 \\
   Dibosons normalization  &  0.0 &  0.0 &  0.0 \\
               Luminosity  &  0.0 &  0.0 &  0.0 \\
          b fragmentation  &  3.8 &  4.5 &  4.0 \\
  final   state radiation  &  1.2 &  1.9 &  1.8 \\
  initial state radiation  &  1.7 &  1.6 &  1.7 \\
 ME Renormalization scale  &  0.9 &  0.9 &  1.0 \\
ME combined scale variation  &  0.6 &  0.9 &  1.0 \\
semi-leptonic b-hadron BRs  &  1.5 &  1.2 &  1.0 \\
underlying event (Pythia tune)  &  0.4 &  0.7 &  0.4 \\
   ME-PS matching (hdamp)  &  0.4 &  0.3 &  0.3 \\
   ME Factorization scale  &  0.2 &  0.3 &  0.2 \\
                      PDF  &  1.4 &  1.9 &  1.4 \\
            MC statistics  &  2.1 &  2.6 &  2.1 \\

-- gigantic Frag 4%?
   some of main systematics are asymmetric

TOPPT is still not prefered in mu, though it is slightly pulled up.


try reducing frag by 1/4?

try different Mt distribution, more bins?


cp  ttxsec/datacard_v37_test15_bunchFULLFIT1_mu.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.txt
cp  ttxsec/datacard_v37_test15_bunchFULLFIT1_el.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_el_exp.txt

vim -p ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.txt ttxsec/datacard_v37_test15_bunchFULLFIT1_el_exp.txt

make both mucard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp elcard=ttxsec/datacard_v37_test15_bunchFULLFIT1_el_exp bothcard=ttxsec/datacard_v37_test15_bunchFULLFIT1_both_exp

make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_el_exp
make workspace datacard=ttxsec/datacard_v37_test15_bunchFULLFIT1_both_exp

make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   nn=v37_test15_mu_exp
make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_el_exp.root   nn=v37_test15_el_exp
make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_both_exp.root nn=v37_test15_both_exp

   r :    +0.945   -0.070/+0.076 (68%)
   r :    +0.945   -0.079/+0.086 (68%)
   r :    +0.958   -0.066/+0.073 (68%)

-- mu also slightly pulls up FSR

python new_impact_table.py --merge-pdf  latest_impacts_v37_test15_el_exp.json latest_impacts_v37_test15_mu_exp.json latest_impacts_v37_test15_both_exp.json

$\tauh$ jet identification  &  4.7 &  4.5 &  4.4 \\
       pileup uncertainty  &  2.6 &  2.4 &  2.4 \\
$\tauh$ misidentification background  &  2.2 &  2.1 &  2.3 \\
        top quark $p_{T}$  &  2.9 &  2.2 &  2.3 \\
         jet energy scale  &  1.1 &  0.5 &  1.1 \\
     b-tagging efficiency  &  1.1 &  1.1 &  0.9 \\
     W+jets normalization  &  0.2 &  0.7 &  0.7 \\
     $\tauh$ Energy Scale  &  0.9 &  0.6 &  0.7 \\
       muon ID efficiency  &  0.6 &  0.6 \\
         DY normalization  &  0.4 &  0.5 &  0.6 \\
 Single Top normalization  &  0.6 &  0.5 &  0.5 \\
  muon trigger efficiency  &  0.3 &  0.3 \\
electron trigger efficiency  &  2.3 &  0.2 \\
   electron ID efficiency  &  1.8 &  0.2 \\
    jet energy resolution  &  0.3 &  0.6 &  0.1 \\
        QCD normalization  &  0.9 &  0.5 &  0.1 \\
   Dibosons normalization  &  0.0 &  0.0 &  0.0 \\
               Luminosity  &  0.0 &  0.0 &  0.0 \\
          b fragmentation  &  2.3 &  2.0 &  2.3 \\
  initial state radiation  &  1.6 &  1.5 &  1.6 \\
  final   state radiation  &  1.3 &  2.0 &  1.6 \\
 ME Renormalization scale  &  0.9 &  0.8 &  0.8 \\
ME combined scale variation  &  0.5 &  0.9 &  0.7 \\
semi-leptonic b-hadron BRs  &  0.7 &  0.6 &  0.6 \\
underlying event (Pythia tune)  &  0.4 &  0.5 &  0.5 \\
   ME-PS matching (hdamp)  &  0.5 &  0.4 &  0.4 \\
   ME Factorization scale  &  0.3 &  0.0 &  0.1 \\
                      PDF  &  1.4 &  1.5 &  1.5 \\
            MC statistics  &  2.1 &  1.8 &  1.7 \\

-- PU is very large
   otherwise dissent, although with asymmetries and over-constrained LEPel and QCD norm


make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   nn=v37_test15_mu_exp    freeze="--freezeParameters lumi_13TeV,FSR"
make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_el_exp.root   nn=v37_test15_el_exp    freeze="--freezeParameters lumi_13TeV,FSR"
make impacts  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_both_exp.root nn=v37_test15_both_exp  freeze="--freezeParameters lumi_13TeV,FSR"

   r :    +0.951   -0.069/+0.074 (68%)
   r :    +0.941   -0.077/+0.084 (68%)
   r :    +0.958   -0.065/+0.070 (68%)

-- so, FSR does correlate with TOPPT and signal strength in mu, but it's not the largest factor

python new_impact_table.py --merge-pdf  latest_impacts_v37_test15_el_exp.json latest_impacts_v37_test15_mu_exp.json latest_impacts_v37_test15_both_exp.json

$\tauh$ jet identification  &  4.6 &  4.4 &  4.3 \\
       pileup uncertainty  &  2.5 &  2.3 &  2.3 \\
        top quark $p_{T}$  &  2.9 &  2.2 &  2.3 \\
$\tauh$ misidentification background  &  1.8 &  0.8 &  1.8 \\
     b-tagging efficiency  &  1.1 &  1.2 &  1.0 \\
         jet energy scale  &  1.1 &  0.4 &  1.0 \\
     W+jets normalization  &  0.3 &  0.9 &  0.9 \\
     $\tauh$ Energy Scale  &  0.9 &  0.6 &  0.7 \\
       muon ID efficiency  &  0.6 &  0.6 \\
         DY normalization  &  0.4 &  0.5 &  0.6 \\
 Single Top normalization  &  0.7 &  0.5 &  0.5 \\
  muon trigger efficiency  &  0.3 &  0.2 \\
electron trigger efficiency  &  2.4 &  0.2 \\
   electron ID efficiency  &  1.8 &  0.1 \\
        QCD normalization  &  1.0 &  0.5 &  0.1 \\
    jet energy resolution  &  0.4 &  0.5 &  0.0 \\
   Dibosons normalization  &  0.0 &  0.0 &  0.0 \\
               Luminosity  &  0.0 &  0.0 &  0.0 \\
          b fragmentation  &  2.3 &  2.1 &  2.3 \\
  initial state radiation  &  1.8 &  1.8 &  1.8 \\
ME combined scale variation  &  0.5 &  1.0 &  0.8 \\
 ME Renormalization scale  &  0.8 &  0.8 &  0.8 \\
semi-leptonic b-hadron BRs  &  0.7 &  0.7 &  0.7 \\
   ME-PS matching (hdamp)  &  0.4 &  0.5 &  0.4 \\
underlying event (Pythia tune)  &  0.4 &  0.5 &  0.4 \\
   ME Factorization scale  &  0.2 &  0.1 &  0.0 \\
  final   state radiation  &  0.0 &  0.0 &  0.0 \\
                      PDF  &  1.5 &  1.5 &  1.5 \\
            MC statistics  &  2.1 &  1.9 &  1.8 \\

-- dissent
   let's look at NLL

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   nn=v37_test15_mu_exp
make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_el_exp.root   nn=v37_test15_el_exp
make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_both_exp.root nn=v37_test15_both_exp

 POI: r= 0.945318 -> [0.5,1.5]
 POI: r= 0.944658 -> [0.5,1.5]
 POI: r= 0.958266 -> [0.5,1.5]

-- el, mu and both are all smooth
   does it mean that the domains of fits are very close, practically smooth transitions and indeed even an additional bin can move the minimum?



also try no updowns and pdfs

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   nn=v37_test15_mu_exp    freeze="--freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns"
make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_el_exp.root   nn=v37_test15_el_exp    freeze="--freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns"
make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_both_exp.root nn=v37_test15_both_exp  freeze="--freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns"

 POI: r= 0.953684 -> [0.5,1.5]
 POI: r= 0.938149 -> [0.5,1.5]
 POI: r= 0.960828 -> [0.5,1.5]


no frag, and no frag no bSF

make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   nn=v37_test15_mu_exp    freeze="--freezeParameters lumi_13TeV,Frag"
make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_el_exp.root   nn=v37_test15_el_exp    freeze="--freezeParameters lumi_13TeV,Frag"
make nll  workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_both_exp.root nn=v37_test15_both_exp  freeze="--freezeParameters lumi_13TeV,Frag"

 POI: r= 0.944062 -> [0.5,1.5]
 POI: r= 0.947951 -> [0.5,1.5]
 POI: r= 0.961713 -> [0.5,1.5]

-- aha


#### using this fit in the update paper v6, note v10

just update the paper with corrections,
note later -- possibly with new corrections

in paper:
1) Y systs table,
2) Y NLL scal for expected and observed fit,
3) the numbers

python new_impact_table.py --merge-pdf  latest_impacts_v37_test15_el_exp.json latest_impacts_v37_test15_mu_exp.json latest_impacts_v37_test15_both_exp.json

$\tauh$ jet identification  &  4.7 &  4.5 &  4.4 \\
$\tauh$ misidentification background  &  2.3 &  2.2 &  2.3 \\
       pileup uncertainty   &  2.6 &  2.3 &  2.3 \\
         jet energy scale   &  1.1 &  0.5 &  1.1 \\
     b-tagging efficiency   &  1.1 &  1.1 &  0.9 \\
     W+jets normalization   &  0.2 &  0.7 &  0.7 \\
     $\tauh$ Energy Scale   &  0.9 &  0.6 &  0.7 \\
       muon ID efficiency   &   -  &  0.6 &  0.6 \\
         DY normalization   &  0.4 &  0.5 &  0.6 \\
 Single Top normalization   &  0.6 &  0.5 &  0.5 \\
  muon trigger efficiency   &   -  &  0.3 &  0.3 \\
electron trigger efficiency &  2.3 &   -  &  0.2 \\
   electron ID efficiency   &  1.8 &   -  &  0.2 \\
    jet energy resolution   &  0.3 &  0.6 &  0.1 \\
        QCD normalization   &  0.9 &  0.5 &  0.1 \\
   Dibosons normalization   &  0.005 &  0.003 &  0.004 \\

        top quark $p_{T}$  &  2.9 &  2.2 &  2.3 \\
          b fragmentation  &  2.3 &  2.0 &  2.3 \\
  initial state radiation  &  1.6 &  1.5 &  1.6 \\
  final   state radiation  &  1.3 &  2.0 &  1.6 \\
 ME Renormalization scale  &  0.9 &  0.8 &  0.8 \\
ME combined scale variation  &  0.5 &  0.9 &  0.7 \\
semi-leptonic b-hadron BRs  &  0.7 &  0.6 &  0.6 \\
underlying event (Pythia tune)  &  0.4 &  0.5 &  0.5 \\
   ME-PS matching (hdamp)  &  0.5 &  0.4 &  0.4 \\
   ME Factorization scale  &  0.3 &  0.03 &  0.1 \\
                      PDF  &  1.4 &  1.5 &  1.5 \\
            MC statistics  &  2.1 &  1.8 &  1.7 \\

   Dibosons normalization  & 0.005 & 0.003 & 0.004 \\
   ME Factorization scale  & 0.250 & 0.033 & 0.117 \\

make fit_unc      nn=mu_v37_test15_exp_unc   workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   &
make fit_unc_toys nn=mu_v37_test15_exp_unc   workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_mu_exp.root   &

make fit_unc      nn=el_v37_test15_exp_unc   workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_el_exp.root   &
make fit_unc_toys nn=el_v37_test15_exp_unc   workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_el_exp.root   &

make fit_unc      nn=both_v37_test15_exp_unc workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_both_exp.root &
make fit_unc_toys nn=both_v37_test15_exp_unc workspace=ttxsec/datacard_v37_test15_bunchFULLFIT1_both_exp.root &

python ttxsec/fit-stuff/plot_uncertainty_scans.py v37_test15_exp_unc

numbers:

[132.74074475199998 1.9644507679999998 11.506068783999998 3.5079477999999997]
[138.02391792 1.6066276160000001 10.516108032 3.6514264000000005]
[137.643138192 1.289061648 10.169264111999999 3.5807268000000003]

786.8449599999999 [11.01582944 69.88362806047859 19.671124]
786.0132 [8.6461452 63.010638355457665 19.65033]
799.3213599999999 [7.1938922399999985 63.05360982046214 19.983034]



#### post-fit distributions to see the QCD in el lj-ljout is not asymmetric

make postfit_distrs fit_tag=v37_test15_bunchFULLFIT1

-- exactly the same proportions of QCD as before, in el and in mu!



#### test15 with additional bins in Mt distribution?

python new_impact_table.py --merge-pdf  latest_impacts_v37_test15_el_exp.json latest_impacts_v37_test15_mu_exp.json latest_impacts_v37_test15_both_exp.json





